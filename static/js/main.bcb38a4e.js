/*! For license information please see main.bcb38a4e.js.LICENSE.txt */
(()=>{"use strict";var e={85:(e,t,i)=>{var n=i(340),r=i(950),o=i(119);function a(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var i=2;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function l(e){var t=e,i=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(i=t.return),e=t.return}while(e)}return 3===t.tag?i:null}function c(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function u(e){if(l(e)!==e)throw Error(a(188))}function h(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e;for(e=e.child;null!==e;){if(null!==(t=h(e)))return t;e=e.sibling}return null}var d=Object.assign,f=Symbol.for("react.element"),g=Symbol.for("react.transitional.element"),p=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),v=Symbol.for("react.strict_mode"),y=Symbol.for("react.profiler"),b=Symbol.for("react.provider"),S=Symbol.for("react.consumer"),w=Symbol.for("react.context"),C=Symbol.for("react.forward_ref"),x=Symbol.for("react.suspense"),T=Symbol.for("react.suspense_list"),E=Symbol.for("react.memo"),I=Symbol.for("react.lazy");Symbol.for("react.scope");var O=Symbol.for("react.activity");Symbol.for("react.legacy_hidden"),Symbol.for("react.tracing_marker");var A=Symbol.for("react.memo_cache_sentinel");Symbol.for("react.view_transition");var R=Symbol.iterator;function D(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=R&&e[R]||e["@@iterator"])?e:null}var k=Symbol.for("react.client.reference");function L(e){if(null==e)return null;if("function"===typeof e)return e.$$typeof===k?null:e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case _:return"Fragment";case y:return"Profiler";case v:return"StrictMode";case x:return"Suspense";case T:return"SuspenseList";case O:return"Activity"}if("object"===typeof e)switch(e.$$typeof){case p:return"Portal";case w:return(e.displayName||"Context")+".Provider";case S:return(e._context.displayName||"Context")+".Consumer";case C:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case E:return null!==(t=e.displayName||null)?t:L(e.type)||"Memo";case I:t=e._payload,e=e._init;try{return L(e(t))}catch(j){}}return null}var M=Array.isArray,F=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,P=o.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,B={pending:!1,data:null,method:null,action:null},N=[],U=-1;function V(e){return{current:e}}function W(e){0>U||(e.current=N[U],N[U]=null,U--)}function G(e,t){U++,N[U]=e.current,e.current=t}var z=V(null),H=V(null),Y=V(null),X=V(null);function q(e,t){switch(G(Y,t),G(H,e),G(z,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?ah(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)e=sh(t=ah(t),e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}W(z),G(z,e)}function Z(){W(z),W(H),W(Y)}function K(e){null!==e.memoizedState&&G(X,e);var t=z.current,i=sh(t,e.type);t!==i&&(G(H,e),G(z,i))}function J(e){H.current===e&&(W(z),W(H)),X.current===e&&(W(X),Kh._currentValue=B)}var Q=Object.prototype.hasOwnProperty,$=n.unstable_scheduleCallback,ee=n.unstable_cancelCallback,te=n.unstable_shouldYield,ie=n.unstable_requestPaint,ne=n.unstable_now,re=n.unstable_getCurrentPriorityLevel,oe=n.unstable_ImmediatePriority,ae=n.unstable_UserBlockingPriority,se=n.unstable_NormalPriority,le=n.unstable_LowPriority,ce=n.unstable_IdlePriority,ue=n.log,he=n.unstable_setDisableYieldValue,de=null,fe=null;function ge(e){if("function"===typeof ue&&he(e),fe&&"function"===typeof fe.setStrictMode)try{fe.setStrictMode(de,e)}catch(t){}}var pe=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(me(e)/_e|0)|0},me=Math.log,_e=Math.LN2;var ve=256,ye=4194304;function be(e){var t=42&e;if(0!==t)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194048&e;case 4194304:case 8388608:case 16777216:case 33554432:return 62914560&e;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function Se(e,t,i){var n=e.pendingLanes;if(0===n)return 0;var r=0,o=e.suspendedLanes,a=e.pingedLanes;e=e.warmLanes;var s=134217727&n;return 0!==s?0!==(n=s&~o)?r=be(n):0!==(a&=s)?r=be(a):i||0!==(i=s&~e)&&(r=be(i)):0!==(s=n&~o)?r=be(s):0!==a?r=be(a):i||0!==(i=n&~e)&&(r=be(i)),0===r?0:0!==t&&t!==r&&0===(t&o)&&((o=r&-r)>=(i=t&-t)||32===o&&0!==(4194048&i))?t:r}function we(e,t){return 0===(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)}function Ce(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function xe(){var e=ve;return 0===(4194048&(ve<<=1))&&(ve=256),e}function Te(){var e=ye;return 0===(62914560&(ye<<=1))&&(ye=4194304),e}function Ee(e){for(var t=[],i=0;31>i;i++)t.push(e);return t}function Ie(e,t){e.pendingLanes|=t,268435456!==t&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Oe(e,t,i){e.pendingLanes|=t,e.suspendedLanes&=~t;var n=31-pe(t);e.entangledLanes|=t,e.entanglements[n]=1073741824|e.entanglements[n]|4194090&i}function Ae(e,t){var i=e.entangledLanes|=t;for(e=e.entanglements;i;){var n=31-pe(i),r=1<<n;r&t|e[n]&t&&(e[n]|=t),i&=~r}}function Re(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function De(e){return 2<(e&=-e)?8<e?0!==(134217727&e)?32:268435456:8:2}function ke(){var e=P.p;return 0!==e?e:void 0===(e=window.event)?32:hd(e.type)}var Le=Math.random().toString(36).slice(2),Me="__reactFiber$"+Le,Fe="__reactProps$"+Le,Pe="__reactContainer$"+Le,Be="__reactEvents$"+Le,Ne="__reactListeners$"+Le,je="__reactHandles$"+Le,Ue="__reactResources$"+Le,Ve="__reactMarker$"+Le;function We(e){delete e[Me],delete e[Fe],delete e[Be],delete e[Ne],delete e[je]}function Ge(e){var t=e[Me];if(t)return t;for(var i=e.parentNode;i;){if(t=i[Pe]||i[Me]){if(i=t.alternate,null!==t.child||null!==i&&null!==i.child)for(e=Sh(e);null!==e;){if(i=e[Me])return i;e=Sh(e)}return t}i=(e=i).parentNode}return null}function ze(e){if(e=e[Me]||e[Pe]){var t=e.tag;if(5===t||6===t||13===t||26===t||27===t||3===t)return e}return null}function He(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e.stateNode;throw Error(a(33))}function Ye(e){var t=e[Ue];return t||(t=e[Ue]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function Xe(e){e[Ve]=!0}var qe=new Set,Ze={};function Ke(e,t){Je(e,t),Je(e+"Capture",t)}function Je(e,t){for(Ze[e]=t,e=0;e<t.length;e++)qe.add(t[e])}var Qe,$e,et=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),tt={},it={};function nt(e,t,i){if(r=t,Q.call(it,r)||!Q.call(tt,r)&&(et.test(r)?it[r]=!0:(tt[r]=!0,0)))if(null===i)e.removeAttribute(t);else{switch(typeof i){case"undefined":case"function":case"symbol":return void e.removeAttribute(t);case"boolean":var n=t.toLowerCase().slice(0,5);if("data-"!==n&&"aria-"!==n)return void e.removeAttribute(t)}e.setAttribute(t,""+i)}var r}function rt(e,t,i){if(null===i)e.removeAttribute(t);else{switch(typeof i){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(t)}e.setAttribute(t,""+i)}}function ot(e,t,i,n){if(null===n)e.removeAttribute(i);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(i)}e.setAttributeNS(t,i,""+n)}}function at(e){if(void 0===Qe)try{throw Error()}catch(j){var t=j.stack.trim().match(/\n( *(at )?)/);Qe=t&&t[1]||"",$e=-1<j.stack.indexOf("\n    at")?" (<anonymous>)":-1<j.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+Qe+e+$e}var st=!1;function lt(e,t){if(!e||st)return"";st=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var n={DetermineComponentFrameRoot:function(){try{if(t){var i=function(){throw Error()};if(Object.defineProperty(i.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(i,[])}catch(j){var n=j}Reflect.construct(e,[],i)}else{try{i.call()}catch(r){n=r}e.call(i.prototype)}}else{try{throw Error()}catch(o){n=o}(i=e())&&"function"===typeof i.catch&&i.catch((function(){}))}}catch(a){if(a&&n&&"string"===typeof a.stack)return[a.stack,n.stack]}return[null,null]}};n.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var r=Object.getOwnPropertyDescriptor(n.DetermineComponentFrameRoot,"name");r&&r.configurable&&Object.defineProperty(n.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var o=n.DetermineComponentFrameRoot(),a=o[0],s=o[1];if(a&&s){var l=a.split("\n"),c=s.split("\n");for(r=n=0;n<l.length&&!l[n].includes("DetermineComponentFrameRoot");)n++;for(;r<c.length&&!c[r].includes("DetermineComponentFrameRoot");)r++;if(n===l.length||r===c.length)for(n=l.length-1,r=c.length-1;1<=n&&0<=r&&l[n]!==c[r];)r--;for(;1<=n&&0<=r;n--,r--)if(l[n]!==c[r]){if(1!==n||1!==r)do{if(n--,0>--r||l[n]!==c[r]){var u="\n"+l[n].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}}while(1<=n&&0<=r);break}}}finally{st=!1,Error.prepareStackTrace=i}return(i=e?e.displayName||e.name:"")?at(i):""}function ct(e){switch(e.tag){case 26:case 27:case 5:return at(e.type);case 16:return at("Lazy");case 13:return at("Suspense");case 19:return at("SuspenseList");case 0:case 15:return lt(e.type,!1);case 11:return lt(e.type.render,!1);case 1:return lt(e.type,!0);case 31:return at("Activity");default:return""}}function ut(e){try{var t="";do{t+=ct(e),e=e.return}while(e);return t}catch(j){return"\nError generating stack: "+j.message+"\n"+j.stack}}function ht(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function dt(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function ft(e){e._valueTracker||(e._valueTracker=function(e){var t=dt(e)?"checked":"value",i=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof i&&"function"===typeof i.get&&"function"===typeof i.set){var r=i.get,o=i.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){n=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:i.enumerable}),{getValue:function(){return n},setValue:function(e){n=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function gt(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var i=t.getValue(),n="";return e&&(n=dt(e)?e.checked?"true":"false":e.value),(e=n)!==i&&(t.setValue(e),!0)}function pt(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(m){return e.body}}var mt=/[\n"\\]/g;function _t(e){return e.replace(mt,(function(e){return"\\"+e.charCodeAt(0).toString(16)+" "}))}function vt(e,t,i,n,r,o,a,s){e.name="",null!=a&&"function"!==typeof a&&"symbol"!==typeof a&&"boolean"!==typeof a?e.type=a:e.removeAttribute("type"),null!=t?"number"===a?(0===t&&""===e.value||e.value!=t)&&(e.value=""+ht(t)):e.value!==""+ht(t)&&(e.value=""+ht(t)):"submit"!==a&&"reset"!==a||e.removeAttribute("value"),null!=t?bt(e,a,ht(t)):null!=i?bt(e,a,ht(i)):null!=n&&e.removeAttribute("value"),null==r&&null!=o&&(e.defaultChecked=!!o),null!=r&&(e.checked=r&&"function"!==typeof r&&"symbol"!==typeof r),null!=s&&"function"!==typeof s&&"symbol"!==typeof s&&"boolean"!==typeof s?e.name=""+ht(s):e.removeAttribute("name")}function yt(e,t,i,n,r,o,a,s){if(null!=o&&"function"!==typeof o&&"symbol"!==typeof o&&"boolean"!==typeof o&&(e.type=o),null!=t||null!=i){if(!("submit"!==o&&"reset"!==o||void 0!==t&&null!==t))return;i=null!=i?""+ht(i):"",t=null!=t?""+ht(t):i,s||t===e.value||(e.value=t),e.defaultValue=t}n="function"!==typeof(n=null!=n?n:r)&&"symbol"!==typeof n&&!!n,e.checked=s?e.checked:!!n,e.defaultChecked=!!n,null!=a&&"function"!==typeof a&&"symbol"!==typeof a&&"boolean"!==typeof a&&(e.name=a)}function bt(e,t,i){"number"===t&&pt(e.ownerDocument)===e||e.defaultValue===""+i||(e.defaultValue=""+i)}function St(e,t,i,n){if(e=e.options,t){t={};for(var r=0;r<i.length;r++)t["$"+i[r]]=!0;for(i=0;i<e.length;i++)r=t.hasOwnProperty("$"+e[i].value),e[i].selected!==r&&(e[i].selected=r),r&&n&&(e[i].defaultSelected=!0)}else{for(i=""+ht(i),t=null,r=0;r<e.length;r++){if(e[r].value===i)return e[r].selected=!0,void(n&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function wt(e,t,i){null==t||((t=""+ht(t))!==e.value&&(e.value=t),null!=i)?e.defaultValue=null!=i?""+ht(i):"":e.defaultValue!==t&&(e.defaultValue=t)}function Ct(e,t,i,n){if(null==t){if(null!=n){if(null!=i)throw Error(a(92));if(M(n)){if(1<n.length)throw Error(a(93));n=n[0]}i=n}null==i&&(i=""),t=i}i=ht(t),e.defaultValue=i,(n=e.textContent)===i&&""!==n&&null!==n&&(e.value=n)}function xt(e,t){if(t){var i=e.firstChild;if(i&&i===e.lastChild&&3===i.nodeType)return void(i.nodeValue=t)}e.textContent=t}var Tt=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Et(e,t,i){var n=0===t.indexOf("--");null==i||"boolean"===typeof i||""===i?n?e.setProperty(t,""):"float"===t?e.cssFloat="":e[t]="":n?e.setProperty(t,i):"number"!==typeof i||0===i||Tt.has(t)?"float"===t?e.cssFloat=i:e[t]=(""+i).trim():e[t]=i+"px"}function It(e,t,i){if(null!=t&&"object"!==typeof t)throw Error(a(62));if(e=e.style,null!=i){for(var n in i)!i.hasOwnProperty(n)||null!=t&&t.hasOwnProperty(n)||(0===n.indexOf("--")?e.setProperty(n,""):"float"===n?e.cssFloat="":e[n]="");for(var r in t)n=t[r],t.hasOwnProperty(r)&&i[r]!==n&&Et(e,r,n)}else for(var o in t)t.hasOwnProperty(o)&&Et(e,o,t[o])}function Ot(e){if(-1===e.indexOf("-"))return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var At=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Rt=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Dt(e){return Rt.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var kt=null;function Lt(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Mt=null,Ft=null;function Pt(e){var t=ze(e);if(t&&(e=t.stateNode)){var i=e[Fe]||null;e:switch(e=t.stateNode,t.type){case"input":if(vt(e,i.value,i.defaultValue,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name),t=i.name,"radio"===i.type&&null!=t){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll('input[name="'+_t(""+t)+'"][type="radio"]'),t=0;t<i.length;t++){var n=i[t];if(n!==e&&n.form===e.form){var r=n[Fe]||null;if(!r)throw Error(a(90));vt(n,r.value,r.defaultValue,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name)}}for(t=0;t<i.length;t++)(n=i[t]).form===e.form&&gt(n)}break e;case"textarea":wt(e,i.value,i.defaultValue);break e;case"select":null!=(t=i.value)&&St(e,!!i.multiple,t,!1)}}}var Bt=!1;function Nt(e,t,i){if(Bt)return e(t,i);Bt=!0;try{return e(t)}finally{if(Bt=!1,(null!==Mt||null!==Ft)&&(Gc(),Mt&&(t=Mt,e=Ft,Ft=Mt=null,Pt(t),e)))for(t=0;t<e.length;t++)Pt(e[t])}}function jt(e,t){var i=e.stateNode;if(null===i)return null;var n=i[Fe]||null;if(null===n)return null;i=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(n=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!n;break e;default:e=!1}if(e)return null;if(i&&"function"!==typeof i)throw Error(a(231,t,typeof i));return i}var Ut=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),Vt=!1;if(Ut)try{var Wt={};Object.defineProperty(Wt,"passive",{get:function(){Vt=!0}}),window.addEventListener("test",Wt,Wt),window.removeEventListener("test",Wt,Wt)}catch(m){Vt=!1}var Gt=null,zt=null,Ht=null;function Yt(){if(Ht)return Ht;var e,t,i=zt,n=i.length,r="value"in Gt?Gt.value:Gt.textContent,o=r.length;for(e=0;e<n&&i[e]===r[e];e++);var a=n-e;for(t=1;t<=a&&i[n-t]===r[o-t];t++);return Ht=r.slice(e,1<t?1-t:void 0)}function Xt(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function qt(){return!0}function Zt(){return!1}function Kt(e){function t(t,i,n,r,o){for(var a in this._reactName=t,this._targetInst=n,this.type=i,this.nativeEvent=r,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(r):r[a]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?qt:Zt,this.isPropagationStopped=Zt,this}return d(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=qt)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=qt)},persist:function(){},isPersistent:qt}),t}var Jt,Qt,$t,ei={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ti=Kt(ei),ii=d({},ei,{view:0,detail:0}),ni=Kt(ii),ri=d({},ii,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:pi,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==$t&&($t&&"mousemove"===e.type?(Jt=e.screenX-$t.screenX,Qt=e.screenY-$t.screenY):Qt=Jt=0,$t=e),Jt)},movementY:function(e){return"movementY"in e?e.movementY:Qt}}),oi=Kt(ri),ai=Kt(d({},ri,{dataTransfer:0})),si=Kt(d({},ii,{relatedTarget:0})),li=Kt(d({},ei,{animationName:0,elapsedTime:0,pseudoElement:0})),ci=Kt(d({},ei,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),ui=Kt(d({},ei,{data:0})),hi={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},di={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},fi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function gi(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=fi[e])&&!!t[e]}function pi(){return gi}var mi=Kt(d({},ii,{key:function(e){if(e.key){var t=hi[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=Xt(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?di[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:pi,charCode:function(e){return"keypress"===e.type?Xt(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?Xt(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),_i=Kt(d({},ri,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),vi=Kt(d({},ii,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:pi})),yi=Kt(d({},ei,{propertyName:0,elapsedTime:0,pseudoElement:0})),bi=Kt(d({},ri,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),Si=Kt(d({},ei,{newState:0,oldState:0})),wi=[9,13,27,32],Ci=Ut&&"CompositionEvent"in window,xi=null;Ut&&"documentMode"in document&&(xi=document.documentMode);var Ti=Ut&&"TextEvent"in window&&!xi,Ei=Ut&&(!Ci||xi&&8<xi&&11>=xi),Ii=String.fromCharCode(32),Oi=!1;function Ai(e,t){switch(e){case"keyup":return-1!==wi.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ri(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Di=!1;var ki={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Li(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!ki[e.type]:"textarea"===t}function Mi(e,t,i,n){Mt?Ft?Ft.push(n):Ft=[n]:Mt=n,0<(t=Yu(t,"onChange")).length&&(i=new ti("onChange","change",null,i,n),e.push({event:i,listeners:t}))}var Fi=null,Pi=null;function Bi(e){Nu(e,0)}function Ni(e){if(gt(He(e)))return e}function ji(e,t){if("change"===e)return t}var Ui=!1;if(Ut){var Vi;if(Ut){var Wi="oninput"in document;if(!Wi){var Gi=document.createElement("div");Gi.setAttribute("oninput","return;"),Wi="function"===typeof Gi.oninput}Vi=Wi}else Vi=!1;Ui=Vi&&(!document.documentMode||9<document.documentMode)}function zi(){Fi&&(Fi.detachEvent("onpropertychange",Hi),Pi=Fi=null)}function Hi(e){if("value"===e.propertyName&&Ni(Pi)){var t=[];Mi(t,Pi,e,Lt(e)),Nt(Bi,t)}}function Yi(e,t,i){"focusin"===e?(zi(),Pi=i,(Fi=t).attachEvent("onpropertychange",Hi)):"focusout"===e&&zi()}function Xi(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Ni(Pi)}function qi(e,t){if("click"===e)return Ni(t)}function Zi(e,t){if("input"===e||"change"===e)return Ni(t)}var Ki="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function Ji(e,t){if(Ki(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var i=Object.keys(e),n=Object.keys(t);if(i.length!==n.length)return!1;for(n=0;n<i.length;n++){var r=i[n];if(!Q.call(t,r)||!Ki(e[r],t[r]))return!1}return!0}function Qi(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function $i(e,t){var i,n=Qi(e);for(e=0;n;){if(3===n.nodeType){if(i=e+n.textContent.length,e<=t&&i>=t)return{node:n,offset:t-e};e=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Qi(n)}}function en(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?en(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function tn(e){for(var t=pt((e=null!=e&&null!=e.ownerDocument&&null!=e.ownerDocument.defaultView?e.ownerDocument.defaultView:window).document);t instanceof e.HTMLIFrameElement;){try{var i="string"===typeof t.contentWindow.location.href}catch(n){i=!1}if(!i)break;t=pt((e=t.contentWindow).document)}return t}function nn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var rn=Ut&&"documentMode"in document&&11>=document.documentMode,on=null,an=null,sn=null,ln=!1;function cn(e,t,i){var n=i.window===i?i.document:9===i.nodeType?i:i.ownerDocument;ln||null==on||on!==pt(n)||("selectionStart"in(n=on)&&nn(n)?n={start:n.selectionStart,end:n.selectionEnd}:n={anchorNode:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset},sn&&Ji(sn,n)||(sn=n,0<(n=Yu(an,"onSelect")).length&&(t=new ti("onSelect","select",null,t,i),e.push({event:t,listeners:n}),t.target=on)))}function un(e,t){var i={};return i[e.toLowerCase()]=t.toLowerCase(),i["Webkit"+e]="webkit"+t,i["Moz"+e]="moz"+t,i}var hn={animationend:un("Animation","AnimationEnd"),animationiteration:un("Animation","AnimationIteration"),animationstart:un("Animation","AnimationStart"),transitionrun:un("Transition","TransitionRun"),transitionstart:un("Transition","TransitionStart"),transitioncancel:un("Transition","TransitionCancel"),transitionend:un("Transition","TransitionEnd")},dn={},fn={};function gn(e){if(dn[e])return dn[e];if(!hn[e])return e;var t,i=hn[e];for(t in i)if(i.hasOwnProperty(t)&&t in fn)return dn[e]=i[t];return e}Ut&&(fn=document.createElement("div").style,"AnimationEvent"in window||(delete hn.animationend.animation,delete hn.animationiteration.animation,delete hn.animationstart.animation),"TransitionEvent"in window||delete hn.transitionend.transition);var pn=gn("animationend"),mn=gn("animationiteration"),_n=gn("animationstart"),vn=gn("transitionrun"),yn=gn("transitionstart"),bn=gn("transitioncancel"),Sn=gn("transitionend"),wn=new Map,Cn="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function xn(e,t){wn.set(e,t),Ke(t,[e])}Cn.push("scrollEnd");var Tn=new WeakMap;function En(e,t){if("object"===typeof e&&null!==e){var i=Tn.get(e);return void 0!==i?i:(t={value:e,source:t,stack:ut(t)},Tn.set(e,t),t)}return{value:e,source:t,stack:ut(t)}}var In=[],On=0,An=0;function Rn(){for(var e=On,t=An=On=0;t<e;){var i=In[t];In[t++]=null;var n=In[t];In[t++]=null;var r=In[t];In[t++]=null;var o=In[t];if(In[t++]=null,null!==n&&null!==r){var a=n.pending;null===a?r.next=r:(r.next=a.next,a.next=r),n.pending=r}0!==o&&Mn(i,r,o)}}function Dn(e,t,i,n){In[On++]=e,In[On++]=t,In[On++]=i,In[On++]=n,An|=n,e.lanes|=n,null!==(e=e.alternate)&&(e.lanes|=n)}function kn(e,t,i,n){return Dn(e,t,i,n),Fn(e)}function Ln(e,t){return Dn(e,null,null,t),Fn(e)}function Mn(e,t,i){e.lanes|=i;var n=e.alternate;null!==n&&(n.lanes|=i);for(var r=!1,o=e.return;null!==o;)o.childLanes|=i,null!==(n=o.alternate)&&(n.childLanes|=i),22===o.tag&&(null===(e=o.stateNode)||1&e._visibility||(r=!0)),e=o,o=o.return;return 3===e.tag?(o=e.stateNode,r&&null!==t&&(r=31-pe(i),null===(n=(e=o.hiddenUpdates)[r])?e[r]=[t]:n.push(t),t.lane=536870912|i),o):null}function Fn(e){if(50<Mc)throw Mc=0,Fc=null,Error(a(185));for(var t=e.return;null!==t;)t=(e=t).return;return 3===e.tag?e.stateNode:null}var Pn={};function Bn(e,t,i,n){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Nn(e,t,i,n){return new Bn(e,t,i,n)}function jn(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Un(e,t){var i=e.alternate;return null===i?((i=Nn(e.tag,t,e.key,e.mode)).elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=t,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=65011712&e.flags,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,t=e.dependencies,i.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i.refCleanup=e.refCleanup,i}function Vn(e,t){e.flags&=65011714;var i=e.alternate;return null===i?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=i.childLanes,e.lanes=i.lanes,e.child=i.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=i.memoizedProps,e.memoizedState=i.memoizedState,e.updateQueue=i.updateQueue,e.type=i.type,t=i.dependencies,e.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function Wn(e,t,i,n,r,o){var s=0;if(n=e,"function"===typeof e)jn(e)&&(s=1);else if("string"===typeof e)s=function(e,t,i){if(1===i||null!=t.itemProp)return!1;switch(e){case"meta":case"title":return!0;case"style":if("string"!==typeof t.precedence||"string"!==typeof t.href||""===t.href)break;return!0;case"link":if("string"!==typeof t.rel||"string"!==typeof t.href||""===t.href||t.onLoad||t.onError)break;return"stylesheet"!==t.rel||(e=t.disabled,"string"===typeof t.precedence&&null==e);case"script":if(t.async&&"function"!==typeof t.async&&"symbol"!==typeof t.async&&!t.onLoad&&!t.onError&&t.src&&"string"===typeof t.src)return!0}return!1}(e,i,z.current)?26:"html"===e||"head"===e||"body"===e?27:5;else e:switch(e){case O:return(e=Nn(31,i,t,r)).elementType=O,e.lanes=o,e;case _:return Gn(i.children,r,o,t);case v:s=8,r|=24;break;case y:return(e=Nn(12,i,t,2|r)).elementType=y,e.lanes=o,e;case x:return(e=Nn(13,i,t,r)).elementType=x,e.lanes=o,e;case T:return(e=Nn(19,i,t,r)).elementType=T,e.lanes=o,e;default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case b:case w:s=10;break e;case S:s=9;break e;case C:s=11;break e;case E:s=14;break e;case I:s=16,n=null;break e}s=29,i=Error(a(130,null===e?"null":typeof e,"")),n=null}return(t=Nn(s,i,t,r)).elementType=e,t.type=n,t.lanes=o,t}function Gn(e,t,i,n){return(e=Nn(7,e,n,t)).lanes=i,e}function zn(e,t,i){return(e=Nn(6,e,null,t)).lanes=i,e}function Hn(e,t,i){return(t=Nn(4,null!==e.children?e.children:[],e.key,t)).lanes=i,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var Yn=[],Xn=0,qn=null,Zn=0,Kn=[],Jn=0,Qn=null,$n=1,er="";function tr(e,t){Yn[Xn++]=Zn,Yn[Xn++]=qn,qn=e,Zn=t}function ir(e,t,i){Kn[Jn++]=$n,Kn[Jn++]=er,Kn[Jn++]=Qn,Qn=e;var n=$n;e=er;var r=32-pe(n)-1;n&=~(1<<r),i+=1;var o=32-pe(t)+r;if(30<o){var a=r-r%5;o=(n&(1<<a)-1).toString(32),n>>=a,r-=a,$n=1<<32-pe(t)+r|i<<r|n,er=o+e}else $n=1<<o|i<<r|n,er=e}function nr(e){null!==e.return&&(tr(e,1),ir(e,1,0))}function rr(e){for(;e===qn;)qn=Yn[--Xn],Yn[Xn]=null,Zn=Yn[--Xn],Yn[Xn]=null;for(;e===Qn;)Qn=Kn[--Jn],Kn[Jn]=null,er=Kn[--Jn],Kn[Jn]=null,$n=Kn[--Jn],Kn[Jn]=null}var or=null,ar=null,sr=!1,lr=null,cr=!1,ur=Error(a(519));function hr(e){throw _r(En(Error(a(418,"")),e)),ur}function dr(e){var t=e.stateNode,i=e.type,n=e.memoizedProps;switch(t[Me]=e,t[Fe]=n,i){case"dialog":ju("cancel",t),ju("close",t);break;case"iframe":case"object":case"embed":ju("load",t);break;case"video":case"audio":for(i=0;i<Pu.length;i++)ju(Pu[i],t);break;case"source":ju("error",t);break;case"img":case"image":case"link":ju("error",t),ju("load",t);break;case"details":ju("toggle",t);break;case"input":ju("invalid",t),yt(t,n.value,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name,!0),ft(t);break;case"select":ju("invalid",t);break;case"textarea":ju("invalid",t),Ct(t,n.value,n.defaultValue,n.children),ft(t)}"string"!==typeof(i=n.children)&&"number"!==typeof i&&"bigint"!==typeof i||t.textContent===""+i||!0===n.suppressHydrationWarning||Qu(t.textContent,i)?(null!=n.popover&&(ju("beforetoggle",t),ju("toggle",t)),null!=n.onScroll&&ju("scroll",t),null!=n.onScrollEnd&&ju("scrollend",t),null!=n.onClick&&(t.onclick=$u),t=!0):t=!1,t||hr(e)}function fr(e){for(or=e.return;or;)switch(or.tag){case 5:case 13:return void(cr=!1);case 27:case 3:return void(cr=!0);default:or=or.return}}function gr(e){if(e!==or)return!1;if(!sr)return fr(e),sr=!0,!1;var t,i=e.tag;if((t=3!==i&&27!==i)&&((t=5===i)&&(t=!("form"!==(t=e.type)&&"button"!==t)||lh(e.type,e.memoizedProps)),t=!t),t&&ar&&hr(e),fr(e),13===i){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,i=0;e;){if(8===e.nodeType)if("/$"===(t=e.data)){if(0===i){ar=yh(e.nextSibling);break e}i--}else"$"!==t&&"$!"!==t&&"$?"!==t||i++;e=e.nextSibling}ar=null}}else 27===i?(i=ar,ph(e.type)?(e=bh,bh=null,ar=e):ar=i):ar=or?yh(e.stateNode.nextSibling):null;return!0}function pr(){ar=or=null,sr=!1}function mr(){var e=lr;return null!==e&&(null===Sc?Sc=e:Sc.push.apply(Sc,e),lr=null),e}function _r(e){null===lr?lr=[e]:lr.push(e)}var vr=V(null),yr=null,br=null;function Sr(e,t,i){G(vr,t._currentValue),t._currentValue=i}function wr(e){e._currentValue=vr.current,W(vr)}function Cr(e,t,i){for(;null!==e;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==n&&(n.childLanes|=t)):null!==n&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===i)break;e=e.return}}function xr(e,t,i,n){var r=e.child;for(null!==r&&(r.return=e);null!==r;){var o=r.dependencies;if(null!==o){var s=r.child;o=o.firstContext;e:for(;null!==o;){var l=o;o=r;for(var c=0;c<t.length;c++)if(l.context===t[c]){o.lanes|=i,null!==(l=o.alternate)&&(l.lanes|=i),Cr(o.return,i,e),n||(s=null);break e}o=l.next}}else if(18===r.tag){if(null===(s=r.return))throw Error(a(341));s.lanes|=i,null!==(o=s.alternate)&&(o.lanes|=i),Cr(s,i,e),s=null}else s=r.child;if(null!==s)s.return=r;else for(s=r;null!==s;){if(s===e){s=null;break}if(null!==(r=s.sibling)){r.return=s.return,s=r;break}s=s.return}r=s}}function Tr(e,t,i,n){e=null;for(var r=t,o=!1;null!==r;){if(!o)if(0!==(524288&r.flags))o=!0;else if(0!==(262144&r.flags))break;if(10===r.tag){var s=r.alternate;if(null===s)throw Error(a(387));if(null!==(s=s.memoizedProps)){var l=r.type;Ki(r.pendingProps.value,s.value)||(null!==e?e.push(l):e=[l])}}else if(r===X.current){if(null===(s=r.alternate))throw Error(a(387));s.memoizedState.memoizedState!==r.memoizedState.memoizedState&&(null!==e?e.push(Kh):e=[Kh])}r=r.return}null!==e&&xr(t,e,i,n),t.flags|=262144}function Er(e){for(e=e.firstContext;null!==e;){if(!Ki(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Ir(e){yr=e,br=null,null!==(e=e.dependencies)&&(e.firstContext=null)}function Or(e){return Rr(yr,e)}function Ar(e,t){return null===yr&&Ir(e),Rr(e,t)}function Rr(e,t){var i=t._currentValue;if(t={context:t,memoizedValue:i,next:null},null===br){if(null===e)throw Error(a(308));br=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else br=br.next=t;return i}var Dr="undefined"!==typeof AbortController?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(t,i){e.push(i)}};this.abort=function(){t.aborted=!0,e.forEach((function(e){return e()}))}},kr=n.unstable_scheduleCallback,Lr=n.unstable_NormalPriority,Mr={$$typeof:w,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Fr(){return{controller:new Dr,data:new Map,refCount:0}}function Pr(e){e.refCount--,0===e.refCount&&kr(Lr,(function(){e.controller.abort()}))}var Br=null,Nr=0,jr=0,Ur=null;function Vr(){if(0===--Nr&&null!==Br){null!==Ur&&(Ur.status="fulfilled");var e=Br;Br=null,jr=0,Ur=null;for(var t=0;t<e.length;t++)(0,e[t])()}}var Wr=F.S;F.S=function(e,t){"object"===typeof t&&null!==t&&"function"===typeof t.then&&function(e,t){if(null===Br){var i=Br=[];Nr=0,jr=Du(),Ur={status:"pending",value:void 0,then:function(e){i.push(e)}}}Nr++,t.then(Vr,Vr)}(0,t),null!==Wr&&Wr(e,t)};var Gr=V(null);function zr(){var e=Gr.current;return null!==e?e:oc.pooledCache}function Hr(e,t){G(Gr,null===t?Gr.current:t.pool)}function Yr(){var e=zr();return null===e?null:{parent:Mr._currentValue,pool:e}}var Xr=Error(a(460)),qr=Error(a(474)),Zr=Error(a(542)),Kr={then:function(){}};function Jr(e){return"fulfilled"===(e=e.status)||"rejected"===e}function Qr(){}function $r(e,t,i){switch(void 0===(i=e[i])?e.push(t):i!==t&&(t.then(Qr,Qr),t=i),t.status){case"fulfilled":return t.value;case"rejected":throw io(e=t.reason),e;default:if("string"===typeof t.status)t.then(Qr,Qr);else{if(null!==(e=oc)&&100<e.shellSuspendCounter)throw Error(a(482));(e=t).status="pending",e.then((function(e){if("pending"===t.status){var i=t;i.status="fulfilled",i.value=e}}),(function(e){if("pending"===t.status){var i=t;i.status="rejected",i.reason=e}}))}switch(t.status){case"fulfilled":return t.value;case"rejected":throw io(e=t.reason),e}throw eo=t,Xr}}var eo=null;function to(){if(null===eo)throw Error(a(459));var e=eo;return eo=null,e}function io(e){if(e===Xr||e===Zr)throw Error(a(483))}var no=!1;function ro(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function oo(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function ao(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function so(e,t,i){var n=e.updateQueue;if(null===n)return null;if(n=n.shared,0!==(2&rc)){var r=n.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),n.pending=t,t=Fn(e),Mn(e,null,i),t}return Dn(e,n,t,i),Fn(e)}function lo(e,t,i){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194048&i))){var n=t.lanes;i|=n&=e.pendingLanes,t.lanes=i,Ae(e,i)}}function co(e,t){var i=e.updateQueue,n=e.alternate;if(null!==n&&i===(n=n.updateQueue)){var r=null,o=null;if(null!==(i=i.firstBaseUpdate)){do{var a={lane:i.lane,tag:i.tag,payload:i.payload,callback:null,next:null};null===o?r=o=a:o=o.next=a,i=i.next}while(null!==i);null===o?r=o=t:o=o.next=t}else r=o=t;return i={baseState:n.baseState,firstBaseUpdate:r,lastBaseUpdate:o,shared:n.shared,callbacks:n.callbacks},void(e.updateQueue=i)}null===(e=i.lastBaseUpdate)?i.firstBaseUpdate=t:e.next=t,i.lastBaseUpdate=t}var uo=!1;function ho(){if(uo){if(null!==Ur)throw Ur}}function fo(e,t,i,n){uo=!1;var r=e.updateQueue;no=!1;var o=r.firstBaseUpdate,a=r.lastBaseUpdate,s=r.shared.pending;if(null!==s){r.shared.pending=null;var l=s,c=l.next;l.next=null,null===a?o=c:a.next=c,a=l;var u=e.alternate;null!==u&&((s=(u=u.updateQueue).lastBaseUpdate)!==a&&(null===s?u.firstBaseUpdate=c:s.next=c,u.lastBaseUpdate=l))}if(null!==o){var h=r.baseState;for(a=0,u=c=l=null,s=o;;){var f=-536870913&s.lane,g=f!==s.lane;if(g?(sc&f)===f:(n&f)===f){0!==f&&f===jr&&(uo=!0),null!==u&&(u=u.next={lane:0,tag:s.tag,payload:s.payload,callback:null,next:null});e:{var p=e,m=s;f=t;var _=i;switch(m.tag){case 1:if("function"===typeof(p=m.payload)){h=p.call(_,h,f);break e}h=p;break e;case 3:p.flags=-65537&p.flags|128;case 0:if(null===(f="function"===typeof(p=m.payload)?p.call(_,h,f):p)||void 0===f)break e;h=d({},h,f);break e;case 2:no=!0}}null!==(f=s.callback)&&(e.flags|=64,g&&(e.flags|=8192),null===(g=r.callbacks)?r.callbacks=[f]:g.push(f))}else g={lane:f,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===u?(c=u=g,l=h):u=u.next=g,a|=f;if(null===(s=s.next)){if(null===(s=r.shared.pending))break;s=(g=s).next,g.next=null,r.lastBaseUpdate=g,r.shared.pending=null}}null===u&&(l=h),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=u,null===o&&(r.shared.lanes=0),pc|=a,e.lanes=a,e.memoizedState=h}}function go(e,t){if("function"!==typeof e)throw Error(a(191,e));e.call(t)}function po(e,t){var i=e.callbacks;if(null!==i)for(e.callbacks=null,e=0;e<i.length;e++)go(i[e],t)}var mo=V(null),_o=V(0);function vo(e,t){G(_o,e=fc),G(mo,t),fc=e|t.baseLanes}function yo(){G(_o,fc),G(mo,mo.current)}function bo(){fc=_o.current,W(mo),W(_o)}var So=0,wo=null,Co=null,xo=null,To=!1,Eo=!1,Io=!1,Oo=0,Ao=0,Ro=null,Do=0;function ko(){throw Error(a(321))}function Lo(e,t){if(null===t)return!1;for(var i=0;i<t.length&&i<e.length;i++)if(!Ki(e[i],t[i]))return!1;return!0}function Mo(e,t,i,n,r,o){return So=o,wo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,F.H=null===e||null===e.memoizedState?qa:Za,Io=!1,o=i(n,r),Io=!1,Eo&&(o=Po(t,i,n,r)),Fo(e),o}function Fo(e){F.H=Xa;var t=null!==Co&&null!==Co.next;if(So=0,xo=Co=wo=null,To=!1,Ao=0,Ro=null,t)throw Error(a(300));null===e||As||null!==(e=e.dependencies)&&Er(e)&&(As=!0)}function Po(e,t,i,n){wo=e;var r=0;do{if(Eo&&(Ro=null),Ao=0,Eo=!1,25<=r)throw Error(a(301));if(r+=1,xo=Co=null,null!=e.updateQueue){var o=e.updateQueue;o.lastEffect=null,o.events=null,o.stores=null,null!=o.memoCache&&(o.memoCache.index=0)}F.H=Ka,o=t(i,n)}while(Eo);return o}function Bo(){var e=F.H,t=e.useState()[0];return t="function"===typeof t.then?Go(t):t,e=e.useState()[0],(null!==Co?Co.memoizedState:null)!==e&&(wo.flags|=1024),t}function No(){var e=0!==Oo;return Oo=0,e}function jo(e,t,i){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i}function Uo(e){if(To){for(e=e.memoizedState;null!==e;){var t=e.queue;null!==t&&(t.pending=null),e=e.next}To=!1}So=0,xo=Co=wo=null,Eo=!1,Ao=Oo=0,Ro=null}function Vo(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===xo?wo.memoizedState=xo=e:xo=xo.next=e,xo}function Wo(){if(null===Co){var e=wo.alternate;e=null!==e?e.memoizedState:null}else e=Co.next;var t=null===xo?wo.memoizedState:xo.next;if(null!==t)xo=t,Co=e;else{if(null===e){if(null===wo.alternate)throw Error(a(467));throw Error(a(310))}e={memoizedState:(Co=e).memoizedState,baseState:Co.baseState,baseQueue:Co.baseQueue,queue:Co.queue,next:null},null===xo?wo.memoizedState=xo=e:xo=xo.next=e}return xo}function Go(e){var t=Ao;return Ao+=1,null===Ro&&(Ro=[]),e=$r(Ro,e,t),t=wo,null===(null===xo?t.memoizedState:xo.next)&&(t=t.alternate,F.H=null===t||null===t.memoizedState?qa:Za),e}function zo(e){if(null!==e&&"object"===typeof e){if("function"===typeof e.then)return Go(e);if(e.$$typeof===w)return Or(e)}throw Error(a(438,String(e)))}function Ho(e){var t=null,i=wo.updateQueue;if(null!==i&&(t=i.memoCache),null==t){var n=wo.alternate;null!==n&&(null!==(n=n.updateQueue)&&(null!=(n=n.memoCache)&&(t={data:n.data.map((function(e){return e.slice()})),index:0})))}if(null==t&&(t={data:[],index:0}),null===i&&(i={lastEffect:null,events:null,stores:null,memoCache:null},wo.updateQueue=i),i.memoCache=t,void 0===(i=t.data[t.index]))for(i=t.data[t.index]=Array(e),n=0;n<e;n++)i[n]=A;return t.index++,i}function Yo(e,t){return"function"===typeof t?t(e):t}function Xo(e){return qo(Wo(),Co,e)}function qo(e,t,i){var n=e.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=i;var r=e.baseQueue,o=n.pending;if(null!==o){if(null!==r){var s=r.next;r.next=o.next,o.next=s}t.baseQueue=r=o,n.pending=null}if(o=e.baseState,null===r)e.memoizedState=o;else{var l=s=null,c=null,u=t=r.next,h=!1;do{var d=-536870913&u.lane;if(d!==u.lane?(sc&d)===d:(So&d)===d){var f=u.revertLane;if(0===f)null!==c&&(c=c.next={lane:0,revertLane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),d===jr&&(h=!0);else{if((So&f)===f){u=u.next,f===jr&&(h=!0);continue}d={lane:0,revertLane:u.revertLane,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===c?(l=c=d,s=o):c=c.next=d,wo.lanes|=f,pc|=f}d=u.action,Io&&i(o,d),o=u.hasEagerState?u.eagerState:i(o,d)}else f={lane:d,revertLane:u.revertLane,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===c?(l=c=f,s=o):c=c.next=f,wo.lanes|=d,pc|=d;u=u.next}while(null!==u&&u!==t);if(null===c?s=o:c.next=l,!Ki(o,e.memoizedState)&&(As=!0,h&&null!==(i=Ur)))throw i;e.memoizedState=o,e.baseState=s,e.baseQueue=c,n.lastRenderedState=o}return null===r&&(n.lanes=0),[e.memoizedState,n.dispatch]}function Zo(e){var t=Wo(),i=t.queue;if(null===i)throw Error(a(311));i.lastRenderedReducer=e;var n=i.dispatch,r=i.pending,o=t.memoizedState;if(null!==r){i.pending=null;var s=r=r.next;do{o=e(o,s.action),s=s.next}while(s!==r);Ki(o,t.memoizedState)||(As=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),i.lastRenderedState=o}return[o,n]}function Ko(e,t,i){var n=wo,r=Wo(),o=sr;if(o){if(void 0===i)throw Error(a(407));i=i()}else i=t();var s=!Ki((Co||r).memoizedState,i);if(s&&(r.memoizedState=i,As=!0),r=r.queue,ya(2048,8,$o.bind(null,n,r,e),[e]),r.getSnapshot!==t||s||null!==xo&&1&xo.memoizedState.tag){if(n.flags|=2048,ma(9,{destroy:void 0,resource:void 0},Qo.bind(null,n,r,i,t),null),null===oc)throw Error(a(349));o||0!==(124&So)||Jo(n,t,i)}return i}function Jo(e,t,i){e.flags|=16384,e={getSnapshot:t,value:i},null===(t=wo.updateQueue)?(t={lastEffect:null,events:null,stores:null,memoCache:null},wo.updateQueue=t,t.stores=[e]):null===(i=t.stores)?t.stores=[e]:i.push(e)}function Qo(e,t,i,n){t.value=i,t.getSnapshot=n,ea(t)&&ta(e)}function $o(e,t,i){return i((function(){ea(t)&&ta(e)}))}function ea(e){var t=e.getSnapshot;e=e.value;try{var i=t();return!Ki(e,i)}catch(n){return!0}}function ta(e){var t=Ln(e,2);null!==t&&Nc(t,e,2)}function ia(e){var t=Vo();if("function"===typeof e){var i=e;if(e=i(),Io){ge(!0);try{i()}finally{ge(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Yo,lastRenderedState:e},t}function na(e,t,i,n){return e.baseState=i,qo(e,Co,"function"===typeof n?n:Yo)}function ra(e,t,i,n,r){if(za(e))throw Error(a(485));if(null!==(e=t.action)){var o={payload:r,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(e){o.listeners.push(e)}};null!==F.T?i(!0):o.isTransition=!1,n(o),null===(i=t.pending)?(o.next=t.pending=o,oa(t,o)):(o.next=i.next,t.pending=i.next=o)}}function oa(e,t){var i=t.action,n=t.payload,r=e.state;if(t.isTransition){var o=F.T,a={};F.T=a;try{var s=i(r,n),l=F.S;null!==l&&l(a,s),aa(e,t,s)}catch(c){la(e,t,c)}finally{F.T=o}}else try{aa(e,t,o=i(r,n))}catch(u){la(e,t,u)}}function aa(e,t,i){null!==i&&"object"===typeof i&&"function"===typeof i.then?i.then((function(i){sa(e,t,i)}),(function(i){return la(e,t,i)})):sa(e,t,i)}function sa(e,t,i){t.status="fulfilled",t.value=i,ca(t),e.state=i,null!==(t=e.pending)&&((i=t.next)===t?e.pending=null:(i=i.next,t.next=i,oa(e,i)))}function la(e,t,i){var n=e.pending;if(e.pending=null,null!==n){n=n.next;do{t.status="rejected",t.reason=i,ca(t),t=t.next}while(t!==n)}e.action=null}function ca(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function ua(e,t){return t}function ha(e,t){if(sr){var i=oc.formState;if(null!==i){e:{var n=wo;if(sr){if(ar){t:{for(var r=ar,o=cr;8!==r.nodeType;){if(!o){r=null;break t}if(null===(r=yh(r.nextSibling))){r=null;break t}}r="F!"===(o=r.data)||"F"===o?r:null}if(r){ar=yh(r.nextSibling),n="F!"===r.data;break e}}hr(n)}n=!1}n&&(t=i[0])}}return(i=Vo()).memoizedState=i.baseState=t,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ua,lastRenderedState:t},i.queue=n,i=Va.bind(null,wo,n),n.dispatch=i,n=ia(!1),o=Ga.bind(null,wo,!1,n.queue),r={state:t,dispatch:null,action:e,pending:null},(n=Vo()).queue=r,i=ra.bind(null,wo,r,o,i),r.dispatch=i,n.memoizedState=e,[t,i,!1]}function da(e){return fa(Wo(),Co,e)}function fa(e,t,i){if(t=qo(e,t,ua)[0],e=Xo(Yo)[0],"object"===typeof t&&null!==t&&"function"===typeof t.then)try{var n=Go(t)}catch(j){if(j===Xr)throw Zr;throw j}else n=t;var r=(t=Wo()).queue,o=r.dispatch;return i!==t.memoizedState&&(wo.flags|=2048,ma(9,{destroy:void 0,resource:void 0},ga.bind(null,r,i),null)),[n,o,e]}function ga(e,t){e.action=t}function pa(e){var t=Wo(),i=Co;if(null!==i)return fa(t,i,e);Wo(),t=t.memoizedState;var n=(i=Wo()).queue.dispatch;return i.memoizedState=e,[t,n,!1]}function ma(e,t,i,n){return e={tag:e,create:i,deps:n,inst:t,next:null},null===(t=wo.updateQueue)&&(t={lastEffect:null,events:null,stores:null,memoCache:null},wo.updateQueue=t),null===(i=t.lastEffect)?t.lastEffect=e.next=e:(n=i.next,i.next=e,e.next=n,t.lastEffect=e),e}function _a(){return Wo().memoizedState}function va(e,t,i,n){var r=Vo();n=void 0===n?null:n,wo.flags|=e,r.memoizedState=ma(1|t,{destroy:void 0,resource:void 0},i,n)}function ya(e,t,i,n){var r=Wo();n=void 0===n?null:n;var o=r.memoizedState.inst;null!==Co&&null!==n&&Lo(n,Co.memoizedState.deps)?r.memoizedState=ma(t,o,i,n):(wo.flags|=e,r.memoizedState=ma(1|t,o,i,n))}function ba(e,t){va(8390656,8,e,t)}function Sa(e,t){ya(2048,8,e,t)}function wa(e,t){return ya(4,2,e,t)}function Ca(e,t){return ya(4,4,e,t)}function xa(e,t){if("function"===typeof t){e=e();var i=t(e);return function(){"function"===typeof i?i():t(null)}}if(null!==t&&void 0!==t)return e=e(),t.current=e,function(){t.current=null}}function Ta(e,t,i){i=null!==i&&void 0!==i?i.concat([e]):null,ya(4,4,xa.bind(null,t,e),i)}function Ea(){}function Ia(e,t){var i=Wo();t=void 0===t?null:t;var n=i.memoizedState;return null!==t&&Lo(t,n[1])?n[0]:(i.memoizedState=[e,t],e)}function Oa(e,t){var i=Wo();t=void 0===t?null:t;var n=i.memoizedState;if(null!==t&&Lo(t,n[1]))return n[0];if(n=e(),Io){ge(!0);try{e()}finally{ge(!1)}}return i.memoizedState=[n,t],n}function Aa(e,t,i){return void 0===i||0!==(1073741824&So)?e.memoizedState=t:(e.memoizedState=i,e=Bc(),wo.lanes|=e,pc|=e,i)}function Ra(e,t,i,n){return Ki(i,t)?i:null!==mo.current?(e=Aa(e,i,n),Ki(e,t)||(As=!0),e):0===(42&So)?(As=!0,e.memoizedState=i):(e=Bc(),wo.lanes|=e,pc|=e,t)}function Da(e,t,i,n,r){var o=P.p;P.p=0!==o&&8>o?o:8;var a=F.T,s={};F.T=s,Ga(e,!1,t,i);try{var l=r(),c=F.S;if(null!==c&&c(s,l),null!==l&&"object"===typeof l&&"function"===typeof l.then){var u=function(e,t){var i=[],n={status:"pending",value:null,reason:null,then:function(e){i.push(e)}};return e.then((function(){n.status="fulfilled",n.value=t;for(var e=0;e<i.length;e++)(0,i[e])(t)}),(function(e){for(n.status="rejected",n.reason=e,e=0;e<i.length;e++)(0,i[e])(void 0)})),n}(l,n);Wa(e,t,u,Pc())}else Wa(e,t,n,Pc())}catch(h){Wa(e,t,{then:function(){},status:"rejected",reason:h},Pc())}finally{P.p=o,F.T=a}}function ka(){}function La(e,t,i,n){if(5!==e.tag)throw Error(a(476));var r=Ma(e).queue;Da(e,r,t,B,null===i?ka:function(){return Fa(e),i(n)})}function Ma(e){var t=e.memoizedState;if(null!==t)return t;var i={};return(t={memoizedState:B,baseState:B,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Yo,lastRenderedState:B},next:null}).next={memoizedState:i,baseState:i,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Yo,lastRenderedState:i},next:null},e.memoizedState=t,null!==(e=e.alternate)&&(e.memoizedState=t),t}function Fa(e){Wa(e,Ma(e).next.queue,{},Pc())}function Pa(){return Or(Kh)}function Ba(){return Wo().memoizedState}function Na(){return Wo().memoizedState}function ja(e){for(var t=e.return;null!==t;){switch(t.tag){case 24:case 3:var i=Pc(),n=so(t,e=ao(i),i);return null!==n&&(Nc(n,t,i),lo(n,t,i)),t={cache:Fr()},void(e.payload=t)}t=t.return}}function Ua(e,t,i){var n=Pc();i={lane:n,revertLane:0,action:i,hasEagerState:!1,eagerState:null,next:null},za(e)?Ha(t,i):null!==(i=kn(e,t,i,n))&&(Nc(i,e,n),Ya(i,t,n))}function Va(e,t,i){Wa(e,t,i,Pc())}function Wa(e,t,i,n){var r={lane:n,revertLane:0,action:i,hasEagerState:!1,eagerState:null,next:null};if(za(e))Ha(t,r);else{var o=e.alternate;if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var a=t.lastRenderedState,s=o(a,i);if(r.hasEagerState=!0,r.eagerState=s,Ki(s,a))return Dn(e,t,r,0),null===oc&&Rn(),!1}catch(l){}if(null!==(i=kn(e,t,r,n)))return Nc(i,e,n),Ya(i,t,n),!0}return!1}function Ga(e,t,i,n){if(n={lane:2,revertLane:Du(),action:n,hasEagerState:!1,eagerState:null,next:null},za(e)){if(t)throw Error(a(479))}else null!==(t=kn(e,i,n,2))&&Nc(t,e,2)}function za(e){var t=e.alternate;return e===wo||null!==t&&t===wo}function Ha(e,t){Eo=To=!0;var i=e.pending;null===i?t.next=t:(t.next=i.next,i.next=t),e.pending=t}function Ya(e,t,i){if(0!==(4194048&i)){var n=t.lanes;i|=n&=e.pendingLanes,t.lanes=i,Ae(e,i)}}var Xa={readContext:Or,use:zo,useCallback:ko,useContext:ko,useEffect:ko,useImperativeHandle:ko,useLayoutEffect:ko,useInsertionEffect:ko,useMemo:ko,useReducer:ko,useRef:ko,useState:ko,useDebugValue:ko,useDeferredValue:ko,useTransition:ko,useSyncExternalStore:ko,useId:ko,useHostTransitionStatus:ko,useFormState:ko,useActionState:ko,useOptimistic:ko,useMemoCache:ko,useCacheRefresh:ko},qa={readContext:Or,use:zo,useCallback:function(e,t){return Vo().memoizedState=[e,void 0===t?null:t],e},useContext:Or,useEffect:ba,useImperativeHandle:function(e,t,i){i=null!==i&&void 0!==i?i.concat([e]):null,va(4194308,4,xa.bind(null,t,e),i)},useLayoutEffect:function(e,t){return va(4194308,4,e,t)},useInsertionEffect:function(e,t){va(4,2,e,t)},useMemo:function(e,t){var i=Vo();t=void 0===t?null:t;var n=e();if(Io){ge(!0);try{e()}finally{ge(!1)}}return i.memoizedState=[n,t],n},useReducer:function(e,t,i){var n=Vo();if(void 0!==i){var r=i(t);if(Io){ge(!0);try{i(t)}finally{ge(!1)}}}else r=t;return n.memoizedState=n.baseState=r,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:r},n.queue=e,e=e.dispatch=Ua.bind(null,wo,e),[n.memoizedState,e]},useRef:function(e){return e={current:e},Vo().memoizedState=e},useState:function(e){var t=(e=ia(e)).queue,i=Va.bind(null,wo,t);return t.dispatch=i,[e.memoizedState,i]},useDebugValue:Ea,useDeferredValue:function(e,t){return Aa(Vo(),e,t)},useTransition:function(){var e=ia(!1);return e=Da.bind(null,wo,e.queue,!0,!1),Vo().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,i){var n=wo,r=Vo();if(sr){if(void 0===i)throw Error(a(407));i=i()}else{if(i=t(),null===oc)throw Error(a(349));0!==(124&sc)||Jo(n,t,i)}r.memoizedState=i;var o={value:i,getSnapshot:t};return r.queue=o,ba($o.bind(null,n,o,e),[e]),n.flags|=2048,ma(9,{destroy:void 0,resource:void 0},Qo.bind(null,n,o,i,t),null),i},useId:function(){var e=Vo(),t=oc.identifierPrefix;if(sr){var i=er;t="\xab"+t+"R"+(i=($n&~(1<<32-pe($n)-1)).toString(32)+i),0<(i=Oo++)&&(t+="H"+i.toString(32)),t+="\xbb"}else t="\xab"+t+"r"+(i=Do++).toString(32)+"\xbb";return e.memoizedState=t},useHostTransitionStatus:Pa,useFormState:ha,useActionState:ha,useOptimistic:function(e){var t=Vo();t.memoizedState=t.baseState=e;var i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=i,t=Ga.bind(null,wo,!0,i),i.dispatch=t,[e,t]},useMemoCache:Ho,useCacheRefresh:function(){return Vo().memoizedState=ja.bind(null,wo)}},Za={readContext:Or,use:zo,useCallback:Ia,useContext:Or,useEffect:Sa,useImperativeHandle:Ta,useInsertionEffect:wa,useLayoutEffect:Ca,useMemo:Oa,useReducer:Xo,useRef:_a,useState:function(){return Xo(Yo)},useDebugValue:Ea,useDeferredValue:function(e,t){return Ra(Wo(),Co.memoizedState,e,t)},useTransition:function(){var e=Xo(Yo)[0],t=Wo().memoizedState;return["boolean"===typeof e?e:Go(e),t]},useSyncExternalStore:Ko,useId:Ba,useHostTransitionStatus:Pa,useFormState:da,useActionState:da,useOptimistic:function(e,t){return na(Wo(),0,e,t)},useMemoCache:Ho,useCacheRefresh:Na},Ka={readContext:Or,use:zo,useCallback:Ia,useContext:Or,useEffect:Sa,useImperativeHandle:Ta,useInsertionEffect:wa,useLayoutEffect:Ca,useMemo:Oa,useReducer:Zo,useRef:_a,useState:function(){return Zo(Yo)},useDebugValue:Ea,useDeferredValue:function(e,t){var i=Wo();return null===Co?Aa(i,e,t):Ra(i,Co.memoizedState,e,t)},useTransition:function(){var e=Zo(Yo)[0],t=Wo().memoizedState;return["boolean"===typeof e?e:Go(e),t]},useSyncExternalStore:Ko,useId:Ba,useHostTransitionStatus:Pa,useFormState:pa,useActionState:pa,useOptimistic:function(e,t){var i=Wo();return null!==Co?na(i,0,e,t):(i.baseState=e,[e,i.queue.dispatch])},useMemoCache:Ho,useCacheRefresh:Na},Ja=null,Qa=0;function $a(e){var t=Qa;return Qa+=1,null===Ja&&(Ja=[]),$r(Ja,e,t)}function es(e,t){t=t.props.ref,e.ref=void 0!==t?t:null}function ts(e,t){if(t.$$typeof===f)throw Error(a(525));throw e=Object.prototype.toString.call(t),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function is(e){return(0,e._init)(e._payload)}function ns(e){function t(t,i){if(e){var n=t.deletions;null===n?(t.deletions=[i],t.flags|=16):n.push(i)}}function i(i,n){if(!e)return null;for(;null!==n;)t(i,n),n=n.sibling;return null}function n(e){for(var t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function r(e,t){return(e=Un(e,t)).index=0,e.sibling=null,e}function o(t,i,n){return t.index=n,e?null!==(n=t.alternate)?(n=n.index)<i?(t.flags|=67108866,i):n:(t.flags|=67108866,i):(t.flags|=1048576,i)}function s(t){return e&&null===t.alternate&&(t.flags|=67108866),t}function l(e,t,i,n){return null===t||6!==t.tag?((t=zn(i,e.mode,n)).return=e,t):((t=r(t,i)).return=e,t)}function c(e,t,i,n){var o=i.type;return o===_?h(e,t,i.props.children,n,i.key):null!==t&&(t.elementType===o||"object"===typeof o&&null!==o&&o.$$typeof===I&&is(o)===t.type)?(es(t=r(t,i.props),i),t.return=e,t):(es(t=Wn(i.type,i.key,i.props,null,e.mode,n),i),t.return=e,t)}function u(e,t,i,n){return null===t||4!==t.tag||t.stateNode.containerInfo!==i.containerInfo||t.stateNode.implementation!==i.implementation?((t=Hn(i,e.mode,n)).return=e,t):((t=r(t,i.children||[])).return=e,t)}function h(e,t,i,n,o){return null===t||7!==t.tag?((t=Gn(i,e.mode,n,o)).return=e,t):((t=r(t,i)).return=e,t)}function d(e,t,i){if("string"===typeof t&&""!==t||"number"===typeof t||"bigint"===typeof t)return(t=zn(""+t,e.mode,i)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case g:return es(i=Wn(t.type,t.key,t.props,null,e.mode,i),t),i.return=e,i;case p:return(t=Hn(t,e.mode,i)).return=e,t;case I:return d(e,t=(0,t._init)(t._payload),i)}if(M(t)||D(t))return(t=Gn(t,e.mode,i,null)).return=e,t;if("function"===typeof t.then)return d(e,$a(t),i);if(t.$$typeof===w)return d(e,Ar(e,t),i);ts(e,t)}return null}function f(e,t,i,n){var r=null!==t?t.key:null;if("string"===typeof i&&""!==i||"number"===typeof i||"bigint"===typeof i)return null!==r?null:l(e,t,""+i,n);if("object"===typeof i&&null!==i){switch(i.$$typeof){case g:return i.key===r?c(e,t,i,n):null;case p:return i.key===r?u(e,t,i,n):null;case I:return f(e,t,i=(r=i._init)(i._payload),n)}if(M(i)||D(i))return null!==r?null:h(e,t,i,n,null);if("function"===typeof i.then)return f(e,t,$a(i),n);if(i.$$typeof===w)return f(e,t,Ar(e,i),n);ts(e,i)}return null}function m(e,t,i,n,r){if("string"===typeof n&&""!==n||"number"===typeof n||"bigint"===typeof n)return l(t,e=e.get(i)||null,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case g:return c(t,e=e.get(null===n.key?i:n.key)||null,n,r);case p:return u(t,e=e.get(null===n.key?i:n.key)||null,n,r);case I:return m(e,t,i,n=(0,n._init)(n._payload),r)}if(M(n)||D(n))return h(t,e=e.get(i)||null,n,r,null);if("function"===typeof n.then)return m(e,t,i,$a(n),r);if(n.$$typeof===w)return m(e,t,i,Ar(t,n),r);ts(t,n)}return null}function v(l,c,u,h){if("object"===typeof u&&null!==u&&u.type===_&&null===u.key&&(u=u.props.children),"object"===typeof u&&null!==u){switch(u.$$typeof){case g:e:{for(var y=u.key;null!==c;){if(c.key===y){if((y=u.type)===_){if(7===c.tag){i(l,c.sibling),(h=r(c,u.props.children)).return=l,l=h;break e}}else if(c.elementType===y||"object"===typeof y&&null!==y&&y.$$typeof===I&&is(y)===c.type){i(l,c.sibling),es(h=r(c,u.props),u),h.return=l,l=h;break e}i(l,c);break}t(l,c),c=c.sibling}u.type===_?((h=Gn(u.props.children,l.mode,h,u.key)).return=l,l=h):(es(h=Wn(u.type,u.key,u.props,null,l.mode,h),u),h.return=l,l=h)}return s(l);case p:e:{for(y=u.key;null!==c;){if(c.key===y){if(4===c.tag&&c.stateNode.containerInfo===u.containerInfo&&c.stateNode.implementation===u.implementation){i(l,c.sibling),(h=r(c,u.children||[])).return=l,l=h;break e}i(l,c);break}t(l,c),c=c.sibling}(h=Hn(u,l.mode,h)).return=l,l=h}return s(l);case I:return v(l,c,u=(y=u._init)(u._payload),h)}if(M(u))return function(r,a,s,l){for(var c=null,u=null,h=a,g=a=0,p=null;null!==h&&g<s.length;g++){h.index>g?(p=h,h=null):p=h.sibling;var _=f(r,h,s[g],l);if(null===_){null===h&&(h=p);break}e&&h&&null===_.alternate&&t(r,h),a=o(_,a,g),null===u?c=_:u.sibling=_,u=_,h=p}if(g===s.length)return i(r,h),sr&&tr(r,g),c;if(null===h){for(;g<s.length;g++)null!==(h=d(r,s[g],l))&&(a=o(h,a,g),null===u?c=h:u.sibling=h,u=h);return sr&&tr(r,g),c}for(h=n(h);g<s.length;g++)null!==(p=m(h,r,g,s[g],l))&&(e&&null!==p.alternate&&h.delete(null===p.key?g:p.key),a=o(p,a,g),null===u?c=p:u.sibling=p,u=p);return e&&h.forEach((function(e){return t(r,e)})),sr&&tr(r,g),c}(l,c,u,h);if(D(u)){if("function"!==typeof(y=D(u)))throw Error(a(150));return function(r,s,l,c){if(null==l)throw Error(a(151));for(var u=null,h=null,g=s,p=s=0,_=null,v=l.next();null!==g&&!v.done;p++,v=l.next()){g.index>p?(_=g,g=null):_=g.sibling;var y=f(r,g,v.value,c);if(null===y){null===g&&(g=_);break}e&&g&&null===y.alternate&&t(r,g),s=o(y,s,p),null===h?u=y:h.sibling=y,h=y,g=_}if(v.done)return i(r,g),sr&&tr(r,p),u;if(null===g){for(;!v.done;p++,v=l.next())null!==(v=d(r,v.value,c))&&(s=o(v,s,p),null===h?u=v:h.sibling=v,h=v);return sr&&tr(r,p),u}for(g=n(g);!v.done;p++,v=l.next())null!==(v=m(g,r,p,v.value,c))&&(e&&null!==v.alternate&&g.delete(null===v.key?p:v.key),s=o(v,s,p),null===h?u=v:h.sibling=v,h=v);return e&&g.forEach((function(e){return t(r,e)})),sr&&tr(r,p),u}(l,c,u=y.call(u),h)}if("function"===typeof u.then)return v(l,c,$a(u),h);if(u.$$typeof===w)return v(l,c,Ar(l,u),h);ts(l,u)}return"string"===typeof u&&""!==u||"number"===typeof u||"bigint"===typeof u?(u=""+u,null!==c&&6===c.tag?(i(l,c.sibling),(h=r(c,u)).return=l,l=h):(i(l,c),(h=zn(u,l.mode,h)).return=l,l=h),s(l)):i(l,c)}return function(e,t,i,n){try{Qa=0;var r=v(e,t,i,n);return Ja=null,r}catch(j){if(j===Xr||j===Zr)throw j;var o=Nn(29,j,null,e.mode);return o.lanes=n,o.return=e,o}}}var rs=ns(!0),os=ns(!1),as=V(null),ss=null;function ls(e){var t=e.alternate;G(ds,1&ds.current),G(as,e),null===ss&&(null===t||null!==mo.current||null!==t.memoizedState)&&(ss=e)}function cs(e){if(22===e.tag){if(G(ds,ds.current),G(as,e),null===ss){var t=e.alternate;null!==t&&null!==t.memoizedState&&(ss=e)}}else us()}function us(){G(ds,ds.current),G(as,as.current)}function hs(e){W(as),ss===e&&(ss=null),W(ds)}var ds=V(0);function fs(e){for(var t=e;null!==t;){if(13===t.tag){var i=t.memoizedState;if(null!==i&&(null===(i=i.dehydrated)||"$?"===i.data||vh(i)))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function gs(e,t,i,n){i=null===(i=i(n,t=e.memoizedState))||void 0===i?t:d({},t,i),e.memoizedState=i,0===e.lanes&&(e.updateQueue.baseState=i)}var ps={enqueueSetState:function(e,t,i){e=e._reactInternals;var n=Pc(),r=ao(n);r.payload=t,void 0!==i&&null!==i&&(r.callback=i),null!==(t=so(e,r,n))&&(Nc(t,e,n),lo(t,e,n))},enqueueReplaceState:function(e,t,i){e=e._reactInternals;var n=Pc(),r=ao(n);r.tag=1,r.payload=t,void 0!==i&&null!==i&&(r.callback=i),null!==(t=so(e,r,n))&&(Nc(t,e,n),lo(t,e,n))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var i=Pc(),n=ao(i);n.tag=2,void 0!==t&&null!==t&&(n.callback=t),null!==(t=so(e,n,i))&&(Nc(t,e,i),lo(t,e,i))}};function ms(e,t,i,n,r,o,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(n,o,a):!t.prototype||!t.prototype.isPureReactComponent||(!Ji(i,n)||!Ji(r,o))}function _s(e,t,i,n){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(i,n),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(i,n),t.state!==e&&ps.enqueueReplaceState(t,t.state,null)}function vs(e,t){var i=t;if("ref"in t)for(var n in i={},t)"ref"!==n&&(i[n]=t[n]);if(e=e.defaultProps)for(var r in i===t&&(i=d({},i)),e)void 0===i[r]&&(i[r]=e[r]);return i}var ys="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)};function bs(e){ys(e)}function Ss(e){console.error(e)}function ws(e){ys(e)}function Cs(e,t){try{(0,e.onUncaughtError)(t.value,{componentStack:t.stack})}catch(i){setTimeout((function(){throw i}))}}function xs(e,t,i){try{(0,e.onCaughtError)(i.value,{componentStack:i.stack,errorBoundary:1===t.tag?t.stateNode:null})}catch(n){setTimeout((function(){throw n}))}}function Ts(e,t,i){return(i=ao(i)).tag=3,i.payload={element:null},i.callback=function(){Cs(e,t)},i}function Es(e){return(e=ao(e)).tag=3,e}function Is(e,t,i,n){var r=i.type.getDerivedStateFromError;if("function"===typeof r){var o=n.value;e.payload=function(){return r(o)},e.callback=function(){xs(t,i,n)}}var a=i.stateNode;null!==a&&"function"===typeof a.componentDidCatch&&(e.callback=function(){xs(t,i,n),"function"!==typeof r&&(null===Ec?Ec=new Set([this]):Ec.add(this));var e=n.stack;this.componentDidCatch(n.value,{componentStack:null!==e?e:""})})}var Os=Error(a(461)),As=!1;function Rs(e,t,i,n){t.child=null===e?os(t,null,i,n):rs(t,e.child,i,n)}function Ds(e,t,i,n,r){i=i.render;var o=t.ref;if("ref"in n){var a={};for(var s in n)"ref"!==s&&(a[s]=n[s])}else a=n;return Ir(t),n=Mo(e,t,i,a,o,r),s=No(),null===e||As?(sr&&s&&nr(t),t.flags|=1,Rs(e,t,n,r),t.child):(jo(e,t,r),Js(e,t,r))}function ks(e,t,i,n,r){if(null===e){var o=i.type;return"function"!==typeof o||jn(o)||void 0!==o.defaultProps||null!==i.compare?((e=Wn(i.type,null,n,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,Ls(e,t,o,n,r))}if(o=e.child,!Qs(e,r)){var a=o.memoizedProps;if((i=null!==(i=i.compare)?i:Ji)(a,n)&&e.ref===t.ref)return Js(e,t,r)}return t.flags|=1,(e=Un(o,n)).ref=t.ref,e.return=t,t.child=e}function Ls(e,t,i,n,r){if(null!==e){var o=e.memoizedProps;if(Ji(o,n)&&e.ref===t.ref){if(As=!1,t.pendingProps=n=o,!Qs(e,r))return t.lanes=e.lanes,Js(e,t,r);0!==(131072&e.flags)&&(As=!0)}}return Bs(e,t,i,n,r)}function Ms(e,t,i){var n=t.pendingProps,r=n.children,o=null!==e?e.memoizedState:null;if("hidden"===n.mode){if(0!==(128&t.flags)){if(n=null!==o?o.baseLanes|i:i,null!==e){for(r=t.child=e.child,o=0;null!==r;)o=o|r.lanes|r.childLanes,r=r.sibling;t.childLanes=o&~n}else t.childLanes=0,t.child=null;return Fs(e,t,n,i)}if(0===(536870912&i))return t.lanes=t.childLanes=536870912,Fs(e,t,null!==o?o.baseLanes|i:i,i);t.memoizedState={baseLanes:0,cachePool:null},null!==e&&Hr(0,null!==o?o.cachePool:null),null!==o?vo(t,o):yo(),cs(t)}else null!==o?(Hr(0,o.cachePool),vo(t,o),us(),t.memoizedState=null):(null!==e&&Hr(0,null),yo(),us());return Rs(e,t,r,i),t.child}function Fs(e,t,i,n){var r=zr();return r=null===r?null:{parent:Mr._currentValue,pool:r},t.memoizedState={baseLanes:i,cachePool:r},null!==e&&Hr(0,null),yo(),cs(t),null!==e&&Tr(e,t,n,!0),null}function Ps(e,t){var i=t.ref;if(null===i)null!==e&&null!==e.ref&&(t.flags|=4194816);else{if("function"!==typeof i&&"object"!==typeof i)throw Error(a(284));null!==e&&e.ref===i||(t.flags|=4194816)}}function Bs(e,t,i,n,r){return Ir(t),i=Mo(e,t,i,n,void 0,r),n=No(),null===e||As?(sr&&n&&nr(t),t.flags|=1,Rs(e,t,i,r),t.child):(jo(e,t,r),Js(e,t,r))}function Ns(e,t,i,n,r,o){return Ir(t),t.updateQueue=null,i=Po(t,n,i,r),Fo(e),n=No(),null===e||As?(sr&&n&&nr(t),t.flags|=1,Rs(e,t,i,o),t.child):(jo(e,t,o),Js(e,t,o))}function js(e,t,i,n,r){if(Ir(t),null===t.stateNode){var o=Pn,a=i.contextType;"object"===typeof a&&null!==a&&(o=Or(a)),o=new i(n,o),t.memoizedState=null!==o.state&&void 0!==o.state?o.state:null,o.updater=ps,t.stateNode=o,o._reactInternals=t,(o=t.stateNode).props=n,o.state=t.memoizedState,o.refs={},ro(t),a=i.contextType,o.context="object"===typeof a&&null!==a?Or(a):Pn,o.state=t.memoizedState,"function"===typeof(a=i.getDerivedStateFromProps)&&(gs(t,i,a,n),o.state=t.memoizedState),"function"===typeof i.getDerivedStateFromProps||"function"===typeof o.getSnapshotBeforeUpdate||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||(a=o.state,"function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount(),a!==o.state&&ps.enqueueReplaceState(o,o.state,null),fo(t,n,o,r),ho(),o.state=t.memoizedState),"function"===typeof o.componentDidMount&&(t.flags|=4194308),n=!0}else if(null===e){o=t.stateNode;var s=t.memoizedProps,l=vs(i,s);o.props=l;var c=o.context,u=i.contextType;a=Pn,"object"===typeof u&&null!==u&&(a=Or(u));var h=i.getDerivedStateFromProps;u="function"===typeof h||"function"===typeof o.getSnapshotBeforeUpdate,s=t.pendingProps!==s,u||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s||c!==a)&&_s(t,o,n,a),no=!1;var d=t.memoizedState;o.state=d,fo(t,n,o,r),ho(),c=t.memoizedState,s||d!==c||no?("function"===typeof h&&(gs(t,i,h,n),c=t.memoizedState),(l=no||ms(t,i,l,n,d,c,a))?(u||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4194308)):("function"===typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=c),o.props=n,o.state=c,o.context=a,n=l):("function"===typeof o.componentDidMount&&(t.flags|=4194308),n=!1)}else{o=t.stateNode,oo(e,t),u=vs(i,a=t.memoizedProps),o.props=u,h=t.pendingProps,d=o.context,c=i.contextType,l=Pn,"object"===typeof c&&null!==c&&(l=Or(c)),(c="function"===typeof(s=i.getDerivedStateFromProps)||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(a!==h||d!==l)&&_s(t,o,n,l),no=!1,d=t.memoizedState,o.state=d,fo(t,n,o,r),ho();var f=t.memoizedState;a!==h||d!==f||no||null!==e&&null!==e.dependencies&&Er(e.dependencies)?("function"===typeof s&&(gs(t,i,s,n),f=t.memoizedState),(u=no||ms(t,i,u,n,d,f,l)||null!==e&&null!==e.dependencies&&Er(e.dependencies))?(c||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(n,f,l),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(n,f,l)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof o.componentDidUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=f),o.props=n,o.state=f,o.context=l,n=u):("function"!==typeof o.componentDidUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),n=!1)}return o=n,Ps(e,t),n=0!==(128&t.flags),o||n?(o=t.stateNode,i=n&&"function"!==typeof i.getDerivedStateFromError?null:o.render(),t.flags|=1,null!==e&&n?(t.child=rs(t,e.child,null,r),t.child=rs(t,null,i,r)):Rs(e,t,i,r),t.memoizedState=o.state,e=t.child):e=Js(e,t,r),e}function Us(e,t,i,n){return pr(),t.flags|=256,Rs(e,t,i,n),t.child}var Vs={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Ws(e){return{baseLanes:e,cachePool:Yr()}}function Gs(e,t,i){return e=null!==e?e.childLanes&~i:0,t&&(e|=vc),e}function zs(e,t,i){var n,r=t.pendingProps,o=!1,s=0!==(128&t.flags);if((n=s)||(n=(null===e||null!==e.memoizedState)&&0!==(2&ds.current)),n&&(o=!0,t.flags&=-129),n=0!==(32&t.flags),t.flags&=-33,null===e){if(sr){if(o?ls(t):us(),sr){var l,c=ar;if(l=c){e:{for(l=c,c=cr;8!==l.nodeType;){if(!c){c=null;break e}if(null===(l=yh(l.nextSibling))){c=null;break e}}c=l}null!==c?(t.memoizedState={dehydrated:c,treeContext:null!==Qn?{id:$n,overflow:er}:null,retryLane:536870912,hydrationErrors:null},(l=Nn(18,null,null,0)).stateNode=c,l.return=t,t.child=l,or=t,ar=null,l=!0):l=!1}l||hr(t)}if(null!==(c=t.memoizedState)&&null!==(c=c.dehydrated))return vh(c)?t.lanes=32:t.lanes=536870912,null;hs(t)}return c=r.children,r=r.fallback,o?(us(),c=Ys({mode:"hidden",children:c},o=t.mode),r=Gn(r,o,i,null),c.return=t,r.return=t,c.sibling=r,t.child=c,(o=t.child).memoizedState=Ws(i),o.childLanes=Gs(e,n,i),t.memoizedState=Vs,r):(ls(t),Hs(t,c))}if(null!==(l=e.memoizedState)&&null!==(c=l.dehydrated)){if(s)256&t.flags?(ls(t),t.flags&=-257,t=Xs(e,t,i)):null!==t.memoizedState?(us(),t.child=e.child,t.flags|=128,t=null):(us(),o=r.fallback,c=t.mode,r=Ys({mode:"visible",children:r.children},c),(o=Gn(o,c,i,null)).flags|=2,r.return=t,o.return=t,r.sibling=o,t.child=r,rs(t,e.child,null,i),(r=t.child).memoizedState=Ws(i),r.childLanes=Gs(e,n,i),t.memoizedState=Vs,t=o);else if(ls(t),vh(c)){if(n=c.nextSibling&&c.nextSibling.dataset)var u=n.dgst;n=u,(r=Error(a(419))).stack="",r.digest=n,_r({value:r,source:null,stack:null}),t=Xs(e,t,i)}else if(As||Tr(e,t,i,!1),n=0!==(i&e.childLanes),As||n){if(null!==(n=oc)&&(0!==(r=0!==((r=0!==(42&(r=i&-i))?1:Re(r))&(n.suspendedLanes|i))?0:r)&&r!==l.retryLane))throw l.retryLane=r,Ln(e,r),Nc(n,e,r),Os;"$?"===c.data||Zc(),t=Xs(e,t,i)}else"$?"===c.data?(t.flags|=192,t.child=e.child,t=null):(e=l.treeContext,ar=yh(c.nextSibling),or=t,sr=!0,lr=null,cr=!1,null!==e&&(Kn[Jn++]=$n,Kn[Jn++]=er,Kn[Jn++]=Qn,$n=e.id,er=e.overflow,Qn=t),(t=Hs(t,r.children)).flags|=4096);return t}return o?(us(),o=r.fallback,c=t.mode,u=(l=e.child).sibling,(r=Un(l,{mode:"hidden",children:r.children})).subtreeFlags=65011712&l.subtreeFlags,null!==u?o=Un(u,o):(o=Gn(o,c,i,null)).flags|=2,o.return=t,r.return=t,r.sibling=o,t.child=r,r=o,o=t.child,null===(c=e.child.memoizedState)?c=Ws(i):(null!==(l=c.cachePool)?(u=Mr._currentValue,l=l.parent!==u?{parent:u,pool:u}:l):l=Yr(),c={baseLanes:c.baseLanes|i,cachePool:l}),o.memoizedState=c,o.childLanes=Gs(e,n,i),t.memoizedState=Vs,r):(ls(t),e=(i=e.child).sibling,(i=Un(i,{mode:"visible",children:r.children})).return=t,i.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=i,t.memoizedState=null,i)}function Hs(e,t){return(t=Ys({mode:"visible",children:t},e.mode)).return=e,e.child=t}function Ys(e,t){return(e=Nn(22,e,null,t)).lanes=0,e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},e}function Xs(e,t,i){return rs(t,e.child,null,i),(e=Hs(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function qs(e,t,i){e.lanes|=t;var n=e.alternate;null!==n&&(n.lanes|=t),Cr(e.return,t,i)}function Zs(e,t,i,n,r){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:i,tailMode:r}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=n,o.tail=i,o.tailMode=r)}function Ks(e,t,i){var n=t.pendingProps,r=n.revealOrder,o=n.tail;if(Rs(e,t,n.children,i),0!==(2&(n=ds.current)))n=1&n|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&qs(e,i,t);else if(19===e.tag)qs(e,i,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}switch(G(ds,n),r){case"forwards":for(i=t.child,r=null;null!==i;)null!==(e=i.alternate)&&null===fs(e)&&(r=i),i=i.sibling;null===(i=r)?(r=t.child,t.child=null):(r=i.sibling,i.sibling=null),Zs(t,!1,r,i,o);break;case"backwards":for(i=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===fs(e)){t.child=r;break}e=r.sibling,r.sibling=i,i=r,r=e}Zs(t,!0,i,null,o);break;case"together":Zs(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Js(e,t,i){if(null!==e&&(t.dependencies=e.dependencies),pc|=t.lanes,0===(i&t.childLanes)){if(null===e)return null;if(Tr(e,t,i,!1),0===(i&t.childLanes))return null}if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(i=Un(e=t.child,e.pendingProps),t.child=i,i.return=t;null!==e.sibling;)e=e.sibling,(i=i.sibling=Un(e,e.pendingProps)).return=t;i.sibling=null}return t.child}function Qs(e,t){return 0!==(e.lanes&t)||!(null===(e=e.dependencies)||!Er(e))}function $s(e,t,i){if(null!==e)if(e.memoizedProps!==t.pendingProps)As=!0;else{if(!Qs(e,i)&&0===(128&t.flags))return As=!1,function(e,t,i){switch(t.tag){case 3:q(t,t.stateNode.containerInfo),Sr(0,Mr,e.memoizedState.cache),pr();break;case 27:case 5:K(t);break;case 4:q(t,t.stateNode.containerInfo);break;case 10:Sr(0,t.type,t.memoizedProps.value);break;case 13:var n=t.memoizedState;if(null!==n)return null!==n.dehydrated?(ls(t),t.flags|=128,null):0!==(i&t.child.childLanes)?zs(e,t,i):(ls(t),null!==(e=Js(e,t,i))?e.sibling:null);ls(t);break;case 19:var r=0!==(128&e.flags);if((n=0!==(i&t.childLanes))||(Tr(e,t,i,!1),n=0!==(i&t.childLanes)),r){if(n)return Ks(e,t,i);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),G(ds,ds.current),n)break;return null;case 22:case 23:return t.lanes=0,Ms(e,t,i);case 24:Sr(0,Mr,e.memoizedState.cache)}return Js(e,t,i)}(e,t,i);As=0!==(131072&e.flags)}else As=!1,sr&&0!==(1048576&t.flags)&&ir(t,Zn,t.index);switch(t.lanes=0,t.tag){case 16:e:{e=t.pendingProps;var n=t.elementType,r=n._init;if(n=r(n._payload),t.type=n,"function"!==typeof n){if(void 0!==n&&null!==n){if((r=n.$$typeof)===C){t.tag=11,t=Ds(null,t,n,e,i);break e}if(r===E){t.tag=14,t=ks(null,t,n,e,i);break e}}throw t=L(n)||n,Error(a(306,t,""))}jn(n)?(e=vs(n,e),t.tag=1,t=js(null,t,n,e,i)):(t.tag=0,t=Bs(null,t,n,e,i))}return t;case 0:return Bs(e,t,t.type,t.pendingProps,i);case 1:return js(e,t,n=t.type,r=vs(n,t.pendingProps),i);case 3:e:{if(q(t,t.stateNode.containerInfo),null===e)throw Error(a(387));n=t.pendingProps;var o=t.memoizedState;r=o.element,oo(e,t),fo(t,n,null,i);var s=t.memoizedState;if(n=s.cache,Sr(0,Mr,n),n!==o.cache&&xr(t,[Mr],i,!0),ho(),n=s.element,o.isDehydrated){if(o={element:n,isDehydrated:!1,cache:s.cache},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=Us(e,t,n,i);break e}if(n!==r){_r(r=En(Error(a(424)),t)),t=Us(e,t,n,i);break e}if(9===(e=t.stateNode.containerInfo).nodeType)e=e.body;else e="HTML"===e.nodeName?e.ownerDocument.body:e;for(ar=yh(e.firstChild),or=t,sr=!0,lr=null,cr=!0,i=os(t,null,n,i),t.child=i;i;)i.flags=-3&i.flags|4096,i=i.sibling}else{if(pr(),n===r){t=Js(e,t,i);break e}Rs(e,t,n,i)}t=t.child}return t;case 26:return Ps(e,t),null===e?(i=Rh(t.type,null,t.pendingProps,null))?t.memoizedState=i:sr||(i=t.type,e=t.pendingProps,(n=oh(Y.current).createElement(i))[Me]=t,n[Fe]=e,ih(n,i,e),Xe(n),t.stateNode=n):t.memoizedState=Rh(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return K(t),null===e&&sr&&(n=t.stateNode=wh(t.type,t.pendingProps,Y.current),or=t,cr=!0,r=ar,ph(t.type)?(bh=r,ar=yh(n.firstChild)):ar=r),Rs(e,t,t.pendingProps.children,i),Ps(e,t),null===e&&(t.flags|=4194304),t.child;case 5:return null===e&&sr&&((r=n=ar)&&(null!==(n=function(e,t,i,n){for(;1===e.nodeType;){var r=i;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!n&&("INPUT"!==e.nodeName||"hidden"!==e.type))break}else if(n){if(!e[Ve])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if("stylesheet"===(o=e.getAttribute("rel"))&&e.hasAttribute("data-precedence"))break;if(o!==r.rel||e.getAttribute("href")!==(null==r.href||""===r.href?null:r.href)||e.getAttribute("crossorigin")!==(null==r.crossOrigin?null:r.crossOrigin)||e.getAttribute("title")!==(null==r.title?null:r.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(((o=e.getAttribute("src"))!==(null==r.src?null:r.src)||e.getAttribute("type")!==(null==r.type?null:r.type)||e.getAttribute("crossorigin")!==(null==r.crossOrigin?null:r.crossOrigin))&&o&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else{if("input"!==t||"hidden"!==e.type)return e;var o=null==r.name?null:""+r.name;if("hidden"===r.type&&e.getAttribute("name")===o)return e}if(null===(e=yh(e.nextSibling)))break}return null}(n,t.type,t.pendingProps,cr))?(t.stateNode=n,or=t,ar=yh(n.firstChild),cr=!1,r=!0):r=!1),r||hr(t)),K(t),r=t.type,o=t.pendingProps,s=null!==e?e.memoizedProps:null,n=o.children,lh(r,o)?n=null:null!==s&&lh(r,s)&&(t.flags|=32),null!==t.memoizedState&&(r=Mo(e,t,Bo,null,null,i),Kh._currentValue=r),Ps(e,t),Rs(e,t,n,i),t.child;case 6:return null===e&&sr&&((e=i=ar)&&(null!==(i=function(e,t,i){if(""===t)return null;for(;3!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!i)return null;if(null===(e=yh(e.nextSibling)))return null}return e}(i,t.pendingProps,cr))?(t.stateNode=i,or=t,ar=null,e=!0):e=!1),e||hr(t)),null;case 13:return zs(e,t,i);case 4:return q(t,t.stateNode.containerInfo),n=t.pendingProps,null===e?t.child=rs(t,null,n,i):Rs(e,t,n,i),t.child;case 11:return Ds(e,t,t.type,t.pendingProps,i);case 7:return Rs(e,t,t.pendingProps,i),t.child;case 8:case 12:return Rs(e,t,t.pendingProps.children,i),t.child;case 10:return n=t.pendingProps,Sr(0,t.type,n.value),Rs(e,t,n.children,i),t.child;case 9:return r=t.type._context,n=t.pendingProps.children,Ir(t),n=n(r=Or(r)),t.flags|=1,Rs(e,t,n,i),t.child;case 14:return ks(e,t,t.type,t.pendingProps,i);case 15:return Ls(e,t,t.type,t.pendingProps,i);case 19:return Ks(e,t,i);case 31:return n=t.pendingProps,i=t.mode,n={mode:n.mode,children:n.children},null===e?((i=Ys(n,i)).ref=t.ref,t.child=i,i.return=t,t=i):((i=Un(e.child,n)).ref=t.ref,t.child=i,i.return=t,t=i),t;case 22:return Ms(e,t,i);case 24:return Ir(t),n=Or(Mr),null===e?(null===(r=zr())&&(r=oc,o=Fr(),r.pooledCache=o,o.refCount++,null!==o&&(r.pooledCacheLanes|=i),r=o),t.memoizedState={parent:n,cache:r},ro(t),Sr(0,Mr,r)):(0!==(e.lanes&i)&&(oo(e,t),fo(t,null,null,i),ho()),r=e.memoizedState,o=t.memoizedState,r.parent!==n?(r={parent:n,cache:n},t.memoizedState=r,0===t.lanes&&(t.memoizedState=t.updateQueue.baseState=r),Sr(0,Mr,n)):(n=o.cache,Sr(0,Mr,n),n!==r.cache&&xr(t,[Mr],i,!0))),Rs(e,t,t.pendingProps.children,i),t.child;case 29:throw t.pendingProps}throw Error(a(156,t.tag))}function el(e){e.flags|=4}function tl(e,t){if("stylesheet"!==t.type||0!==(4&t.state.loading))e.flags&=-16777217;else if(e.flags|=16777216,!Gh(t)){if(null!==(t=as.current)&&((4194048&sc)===sc?null!==ss:(62914560&sc)!==sc&&0===(536870912&sc)||t!==ss))throw eo=Kr,qr;e.flags|=8192}}function il(e,t){null!==t&&(e.flags|=4),16384&e.flags&&(t=22!==e.tag?Te():536870912,e.lanes|=t,yc|=t)}function nl(e,t){if(!sr)switch(e.tailMode){case"hidden":t=e.tail;for(var i=null;null!==t;)null!==t.alternate&&(i=t),t=t.sibling;null===i?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var n=null;null!==i;)null!==i.alternate&&(n=i),i=i.sibling;null===n?t||null===e.tail?e.tail=null:e.tail.sibling=null:n.sibling=null}}function rl(e){var t=null!==e.alternate&&e.alternate.child===e.child,i=0,n=0;if(t)for(var r=e.child;null!==r;)i|=r.lanes|r.childLanes,n|=65011712&r.subtreeFlags,n|=65011712&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)i|=r.lanes|r.childLanes,n|=r.subtreeFlags,n|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=n,e.childLanes=i,t}function ol(e,t,i){var n=t.pendingProps;switch(rr(t),t.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return rl(t),null;case 3:return i=t.stateNode,n=null,null!==e&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),wr(Mr),Z(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==e&&null!==e.child||(gr(t)?el(t):null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,mr())),rl(t),null;case 26:return i=t.memoizedState,null===e?(el(t),null!==i?(rl(t),tl(t,i)):(rl(t),t.flags&=-16777217)):i?i!==e.memoizedState?(el(t),rl(t),tl(t,i)):(rl(t),t.flags&=-16777217):(e.memoizedProps!==n&&el(t),rl(t),t.flags&=-16777217),null;case 27:J(t),i=Y.current;var r=t.type;if(null!==e&&null!=t.stateNode)e.memoizedProps!==n&&el(t);else{if(!n){if(null===t.stateNode)throw Error(a(166));return rl(t),null}e=z.current,gr(t)?dr(t):(e=wh(r,n,i),t.stateNode=e,el(t))}return rl(t),null;case 5:if(J(t),i=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==n&&el(t);else{if(!n){if(null===t.stateNode)throw Error(a(166));return rl(t),null}if(e=z.current,gr(t))dr(t);else{switch(r=oh(Y.current),e){case 1:e=r.createElementNS("http://www.w3.org/2000/svg",i);break;case 2:e=r.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;default:switch(i){case"svg":e=r.createElementNS("http://www.w3.org/2000/svg",i);break;case"math":e=r.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;case"script":(e=r.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild);break;case"select":e="string"===typeof n.is?r.createElement("select",{is:n.is}):r.createElement("select"),n.multiple?e.multiple=!0:n.size&&(e.size=n.size);break;default:e="string"===typeof n.is?r.createElement(i,{is:n.is}):r.createElement(i)}}e[Me]=t,e[Fe]=n;e:for(r=t.child;null!==r;){if(5===r.tag||6===r.tag)e.appendChild(r.stateNode);else if(4!==r.tag&&27!==r.tag&&null!==r.child){r.child.return=r,r=r.child;continue}if(r===t)break e;for(;null===r.sibling;){if(null===r.return||r.return===t)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}t.stateNode=e;e:switch(ih(e,i,n),i){case"button":case"input":case"select":case"textarea":e=!!n.autoFocus;break e;case"img":e=!0;break e;default:e=!1}e&&el(t)}}return rl(t),t.flags&=-16777217,null;case 6:if(e&&null!=t.stateNode)e.memoizedProps!==n&&el(t);else{if("string"!==typeof n&&null===t.stateNode)throw Error(a(166));if(e=Y.current,gr(t)){if(e=t.stateNode,i=t.memoizedProps,n=null,null!==(r=or))switch(r.tag){case 27:case 5:n=r.memoizedProps}e[Me]=t,(e=!!(e.nodeValue===i||null!==n&&!0===n.suppressHydrationWarning||Qu(e.nodeValue,i)))||hr(t)}else(e=oh(e).createTextNode(n))[Me]=t,t.stateNode=e}return rl(t),null;case 13:if(n=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(r=gr(t),null!==n&&null!==n.dehydrated){if(null===e){if(!r)throw Error(a(318));if(!(r=null!==(r=t.memoizedState)?r.dehydrated:null))throw Error(a(317));r[Me]=t}else pr(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;rl(t),r=!1}else r=mr(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=r),r=!0;if(!r)return 256&t.flags?(hs(t),t):(hs(t),null)}if(hs(t),0!==(128&t.flags))return t.lanes=i,t;if(i=null!==n,e=null!==e&&null!==e.memoizedState,i){r=null,null!==(n=t.child).alternate&&null!==n.alternate.memoizedState&&null!==n.alternate.memoizedState.cachePool&&(r=n.alternate.memoizedState.cachePool.pool);var o=null;null!==n.memoizedState&&null!==n.memoizedState.cachePool&&(o=n.memoizedState.cachePool.pool),o!==r&&(n.flags|=2048)}return i!==e&&i&&(t.child.flags|=8192),il(t,t.updateQueue),rl(t),null;case 4:return Z(),null===e&&Wu(t.stateNode.containerInfo),rl(t),null;case 10:return wr(t.type),rl(t),null;case 19:if(W(ds),null===(r=t.memoizedState))return rl(t),null;if(n=0!==(128&t.flags),null===(o=r.rendering))if(n)nl(r,!1);else{if(0!==gc||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(o=fs(e))){for(t.flags|=128,nl(r,!1),e=o.updateQueue,t.updateQueue=e,il(t,e),t.subtreeFlags=0,e=i,i=t.child;null!==i;)Vn(i,e),i=i.sibling;return G(ds,1&ds.current|2),t.child}e=e.sibling}null!==r.tail&&ne()>xc&&(t.flags|=128,n=!0,nl(r,!1),t.lanes=4194304)}else{if(!n)if(null!==(e=fs(o))){if(t.flags|=128,n=!0,e=e.updateQueue,t.updateQueue=e,il(t,e),nl(r,!0),null===r.tail&&"hidden"===r.tailMode&&!o.alternate&&!sr)return rl(t),null}else 2*ne()-r.renderingStartTime>xc&&536870912!==i&&(t.flags|=128,n=!0,nl(r,!1),t.lanes=4194304);r.isBackwards?(o.sibling=t.child,t.child=o):(null!==(e=r.last)?e.sibling=o:t.child=o,r.last=o)}return null!==r.tail?(t=r.tail,r.rendering=t,r.tail=t.sibling,r.renderingStartTime=ne(),t.sibling=null,e=ds.current,G(ds,n?1&e|2:1&e),t):(rl(t),null);case 22:case 23:return hs(t),bo(),n=null!==t.memoizedState,null!==e?null!==e.memoizedState!==n&&(t.flags|=8192):n&&(t.flags|=8192),n?0!==(536870912&i)&&0===(128&t.flags)&&(rl(t),6&t.subtreeFlags&&(t.flags|=8192)):rl(t),null!==(i=t.updateQueue)&&il(t,i.retryQueue),i=null,null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(i=e.memoizedState.cachePool.pool),n=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(n=t.memoizedState.cachePool.pool),n!==i&&(t.flags|=2048),null!==e&&W(Gr),null;case 24:return i=null,null!==e&&(i=e.memoizedState.cache),t.memoizedState.cache!==i&&(t.flags|=2048),wr(Mr),rl(t),null;case 25:case 30:return null}throw Error(a(156,t.tag))}function al(e,t){switch(rr(t),t.tag){case 1:return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return wr(Mr),Z(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 26:case 27:case 5:return J(t),null;case 13:if(hs(t),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(a(340));pr()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return W(ds),null;case 4:return Z(),null;case 10:return wr(t.type),null;case 22:case 23:return hs(t),bo(),null!==e&&W(Gr),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 24:return wr(Mr),null;default:return null}}function sl(e,t){switch(rr(t),t.tag){case 3:wr(Mr),Z();break;case 26:case 27:case 5:J(t);break;case 4:Z();break;case 13:hs(t);break;case 19:W(ds);break;case 10:wr(t.type);break;case 22:case 23:hs(t),bo(),null!==e&&W(Gr);break;case 24:wr(Mr)}}function ll(e,t){try{var i=t.updateQueue,n=null!==i?i.lastEffect:null;if(null!==n){var r=n.next;i=r;do{if((i.tag&e)===e){n=void 0;var o=i.create,a=i.inst;n=o(),a.destroy=n}i=i.next}while(i!==r)}}catch(s){du(t,t.return,s)}}function cl(e,t,i){try{var n=t.updateQueue,r=null!==n?n.lastEffect:null;if(null!==r){var o=r.next;n=o;do{if((n.tag&e)===e){var a=n.inst,s=a.destroy;if(void 0!==s){a.destroy=void 0,r=t;var l=i,c=s;try{c()}catch(u){du(r,l,u)}}}n=n.next}while(n!==o)}}catch(u){du(t,t.return,u)}}function ul(e){var t=e.updateQueue;if(null!==t){var i=e.stateNode;try{po(t,i)}catch(n){du(e,e.return,n)}}}function hl(e,t,i){i.props=vs(e.type,e.memoizedProps),i.state=e.memoizedState;try{i.componentWillUnmount()}catch(n){du(e,t,n)}}function dl(e,t){try{var i=e.ref;if(null!==i){switch(e.tag){case 26:case 27:case 5:var n=e.stateNode;break;default:n=e.stateNode}"function"===typeof i?e.refCleanup=i(n):i.current=n}}catch(r){du(e,t,r)}}function fl(e,t){var i=e.ref,n=e.refCleanup;if(null!==i)if("function"===typeof n)try{n()}catch(r){du(e,t,r)}finally{e.refCleanup=null,null!=(e=e.alternate)&&(e.refCleanup=null)}else if("function"===typeof i)try{i(null)}catch(o){du(e,t,o)}else i.current=null}function gl(e){var t=e.type,i=e.memoizedProps,n=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":i.autoFocus&&n.focus();break e;case"img":i.src?n.src=i.src:i.srcSet&&(n.srcset=i.srcSet)}}catch(r){du(e,e.return,r)}}function pl(e,t,i){try{var n=e.stateNode;!function(e,t,i,n){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var r=null,o=null,s=null,l=null,c=null,u=null,h=null;for(g in i){var d=i[g];if(i.hasOwnProperty(g)&&null!=d)switch(g){case"checked":case"value":break;case"defaultValue":c=d;default:n.hasOwnProperty(g)||eh(e,t,g,null,n,d)}}for(var f in n){var g=n[f];if(d=i[f],n.hasOwnProperty(f)&&(null!=g||null!=d))switch(f){case"type":o=g;break;case"name":r=g;break;case"checked":u=g;break;case"defaultChecked":h=g;break;case"value":s=g;break;case"defaultValue":l=g;break;case"children":case"dangerouslySetInnerHTML":if(null!=g)throw Error(a(137,t));break;default:g!==d&&eh(e,t,f,g,n,d)}}return void vt(e,s,l,c,u,h,o,r);case"select":for(o in g=s=l=f=null,i)if(c=i[o],i.hasOwnProperty(o)&&null!=c)switch(o){case"value":break;case"multiple":g=c;default:n.hasOwnProperty(o)||eh(e,t,o,null,n,c)}for(r in n)if(o=n[r],c=i[r],n.hasOwnProperty(r)&&(null!=o||null!=c))switch(r){case"value":f=o;break;case"defaultValue":l=o;break;case"multiple":s=o;default:o!==c&&eh(e,t,r,o,n,c)}return t=l,i=s,n=g,void(null!=f?St(e,!!i,f,!1):!!n!==!!i&&(null!=t?St(e,!!i,t,!0):St(e,!!i,i?[]:"",!1)));case"textarea":for(l in g=f=null,i)if(r=i[l],i.hasOwnProperty(l)&&null!=r&&!n.hasOwnProperty(l))switch(l){case"value":case"children":break;default:eh(e,t,l,null,n,r)}for(s in n)if(r=n[s],o=i[s],n.hasOwnProperty(s)&&(null!=r||null!=o))switch(s){case"value":f=r;break;case"defaultValue":g=r;break;case"children":break;case"dangerouslySetInnerHTML":if(null!=r)throw Error(a(91));break;default:r!==o&&eh(e,t,s,r,n,o)}return void wt(e,f,g);case"option":for(var p in i)if(f=i[p],i.hasOwnProperty(p)&&null!=f&&!n.hasOwnProperty(p))if("selected"===p)e.selected=!1;else eh(e,t,p,null,n,f);for(c in n)if(f=n[c],g=i[c],n.hasOwnProperty(c)&&f!==g&&(null!=f||null!=g))if("selected"===c)e.selected=f&&"function"!==typeof f&&"symbol"!==typeof f;else eh(e,t,c,f,n,g);return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var m in i)f=i[m],i.hasOwnProperty(m)&&null!=f&&!n.hasOwnProperty(m)&&eh(e,t,m,null,n,f);for(u in n)if(f=n[u],g=i[u],n.hasOwnProperty(u)&&f!==g&&(null!=f||null!=g))switch(u){case"children":case"dangerouslySetInnerHTML":if(null!=f)throw Error(a(137,t));break;default:eh(e,t,u,f,n,g)}return;default:if(Ot(t)){for(var _ in i)f=i[_],i.hasOwnProperty(_)&&void 0!==f&&!n.hasOwnProperty(_)&&th(e,t,_,void 0,n,f);for(h in n)f=n[h],g=i[h],!n.hasOwnProperty(h)||f===g||void 0===f&&void 0===g||th(e,t,h,f,n,g);return}}for(var v in i)f=i[v],i.hasOwnProperty(v)&&null!=f&&!n.hasOwnProperty(v)&&eh(e,t,v,null,n,f);for(d in n)f=n[d],g=i[d],!n.hasOwnProperty(d)||f===g||null==f&&null==g||eh(e,t,d,f,n,g)}(n,e.type,i,t),n[Fe]=t}catch(r){du(e,e.return,r)}}function ml(e){return 5===e.tag||3===e.tag||26===e.tag||27===e.tag&&ph(e.type)||4===e.tag}function _l(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||ml(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(27===e.tag&&ph(e.type))continue e;if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function vl(e,t,i){var n=e.tag;if(5===n||6===n)e=e.stateNode,t?(9===i.nodeType?i.body:"HTML"===i.nodeName?i.ownerDocument.body:i).insertBefore(e,t):((t=9===i.nodeType?i.body:"HTML"===i.nodeName?i.ownerDocument.body:i).appendChild(e),null!==(i=i._reactRootContainer)&&void 0!==i||null!==t.onclick||(t.onclick=$u));else if(4!==n&&(27===n&&ph(e.type)&&(i=e.stateNode,t=null),null!==(e=e.child)))for(vl(e,t,i),e=e.sibling;null!==e;)vl(e,t,i),e=e.sibling}function yl(e,t,i){var n=e.tag;if(5===n||6===n)e=e.stateNode,t?i.insertBefore(e,t):i.appendChild(e);else if(4!==n&&(27===n&&ph(e.type)&&(i=e.stateNode),null!==(e=e.child)))for(yl(e,t,i),e=e.sibling;null!==e;)yl(e,t,i),e=e.sibling}function bl(e){var t=e.stateNode,i=e.memoizedProps;try{for(var n=e.type,r=t.attributes;r.length;)t.removeAttributeNode(r[0]);ih(t,n,i),t[Me]=e,t[Fe]=i}catch(o){du(e,e.return,o)}}var Sl=!1,wl=!1,Cl=!1,xl="function"===typeof WeakSet?WeakSet:Set,Tl=null;function El(e,t,i){var n=i.flags;switch(i.tag){case 0:case 11:case 15:jl(e,i),4&n&&ll(5,i);break;case 1:if(jl(e,i),4&n)if(e=i.stateNode,null===t)try{e.componentDidMount()}catch(a){du(i,i.return,a)}else{var r=vs(i.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(r,t,e.__reactInternalSnapshotBeforeUpdate)}catch(s){du(i,i.return,s)}}64&n&&ul(i),512&n&&dl(i,i.return);break;case 3:if(jl(e,i),64&n&&null!==(e=i.updateQueue)){if(t=null,null!==i.child)switch(i.child.tag){case 27:case 5:case 1:t=i.child.stateNode}try{po(e,t)}catch(a){du(i,i.return,a)}}break;case 27:null===t&&4&n&&bl(i);case 26:case 5:jl(e,i),null===t&&4&n&&gl(i),512&n&&dl(i,i.return);break;case 12:jl(e,i);break;case 13:jl(e,i),4&n&&kl(e,i),64&n&&(null!==(e=i.memoizedState)&&(null!==(e=e.dehydrated)&&function(e,t){var i=e.ownerDocument;if("$?"!==e.data||"complete"===i.readyState)t();else{var n=function(){t(),i.removeEventListener("DOMContentLoaded",n)};i.addEventListener("DOMContentLoaded",n),e._reactRetry=n}}(e,i=mu.bind(null,i))));break;case 22:if(!(n=null!==i.memoizedState||Sl)){t=null!==t&&null!==t.memoizedState||wl,r=Sl;var o=wl;Sl=n,(wl=t)&&!o?Vl(e,i,0!==(8772&i.subtreeFlags)):jl(e,i),Sl=r,wl=o}break;case 30:break;default:jl(e,i)}}function Il(e){var t=e.alternate;null!==t&&(e.alternate=null,Il(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&We(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Ol=null,Al=!1;function Rl(e,t,i){for(i=i.child;null!==i;)Dl(e,t,i),i=i.sibling}function Dl(e,t,i){if(fe&&"function"===typeof fe.onCommitFiberUnmount)try{fe.onCommitFiberUnmount(de,i)}catch(o){}switch(i.tag){case 26:wl||fl(i,t),Rl(e,t,i),i.memoizedState?i.memoizedState.count--:i.stateNode&&(i=i.stateNode).parentNode.removeChild(i);break;case 27:wl||fl(i,t);var n=Ol,r=Al;ph(i.type)&&(Ol=i.stateNode,Al=!1),Rl(e,t,i),Ch(i.stateNode),Ol=n,Al=r;break;case 5:wl||fl(i,t);case 6:if(n=Ol,r=Al,Ol=null,Rl(e,t,i),Al=r,null!==(Ol=n))if(Al)try{(9===Ol.nodeType?Ol.body:"HTML"===Ol.nodeName?Ol.ownerDocument.body:Ol).removeChild(i.stateNode)}catch(a){du(i,t,a)}else try{Ol.removeChild(i.stateNode)}catch(a){du(i,t,a)}break;case 18:null!==Ol&&(Al?(mh(9===(e=Ol).nodeType?e.body:"HTML"===e.nodeName?e.ownerDocument.body:e,i.stateNode),Ad(e)):mh(Ol,i.stateNode));break;case 4:n=Ol,r=Al,Ol=i.stateNode.containerInfo,Al=!0,Rl(e,t,i),Ol=n,Al=r;break;case 0:case 11:case 14:case 15:wl||cl(2,i,t),wl||cl(4,i,t),Rl(e,t,i);break;case 1:wl||(fl(i,t),"function"===typeof(n=i.stateNode).componentWillUnmount&&hl(i,t,n)),Rl(e,t,i);break;case 21:Rl(e,t,i);break;case 22:wl=(n=wl)||null!==i.memoizedState,Rl(e,t,i),wl=n;break;default:Rl(e,t,i)}}function kl(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&(null!==(e=e.memoizedState)&&null!==(e=e.dehydrated))))try{Ad(e)}catch(i){du(t,t.return,i)}}function Ll(e,t){var i=function(e){switch(e.tag){case 13:case 19:var t=e.stateNode;return null===t&&(t=e.stateNode=new xl),t;case 22:return null===(t=(e=e.stateNode)._retryCache)&&(t=e._retryCache=new xl),t;default:throw Error(a(435,e.tag))}}(e);t.forEach((function(t){var n=_u.bind(null,e,t);i.has(t)||(i.add(t),t.then(n,n))}))}function Ml(e,t){var i=t.deletions;if(null!==i)for(var n=0;n<i.length;n++){var r=i[n],o=e,s=t,l=s;e:for(;null!==l;){switch(l.tag){case 27:if(ph(l.type)){Ol=l.stateNode,Al=!1;break e}break;case 5:Ol=l.stateNode,Al=!1;break e;case 3:case 4:Ol=l.stateNode.containerInfo,Al=!0;break e}l=l.return}if(null===Ol)throw Error(a(160));Dl(o,s,r),Ol=null,Al=!1,null!==(o=r.alternate)&&(o.return=null),r.return=null}if(13878&t.subtreeFlags)for(t=t.child;null!==t;)Pl(t,e),t=t.sibling}var Fl=null;function Pl(e,t){var i=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Ml(t,e),Bl(e),4&n&&(cl(3,e,e.return),ll(3,e),cl(5,e,e.return));break;case 1:Ml(t,e),Bl(e),512&n&&(wl||null===i||fl(i,i.return)),64&n&&Sl&&(null!==(e=e.updateQueue)&&(null!==(n=e.callbacks)&&(i=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=null===i?n:i.concat(n))));break;case 26:var r=Fl;if(Ml(t,e),Bl(e),512&n&&(wl||null===i||fl(i,i.return)),4&n){var o=null!==i?i.memoizedState:null;if(n=e.memoizedState,null===i)if(null===n)if(null===e.stateNode){e:{n=e.type,i=e.memoizedProps,r=r.ownerDocument||r;t:switch(n){case"title":(!(o=r.getElementsByTagName("title")[0])||o[Ve]||o[Me]||"http://www.w3.org/2000/svg"===o.namespaceURI||o.hasAttribute("itemprop"))&&(o=r.createElement(n),r.head.insertBefore(o,r.querySelector("head > title"))),ih(o,n,i),o[Me]=e,Xe(o),n=o;break e;case"link":var s=Vh("link","href",r).get(n+(i.href||""));if(s)for(var l=0;l<s.length;l++)if((o=s[l]).getAttribute("href")===(null==i.href||""===i.href?null:i.href)&&o.getAttribute("rel")===(null==i.rel?null:i.rel)&&o.getAttribute("title")===(null==i.title?null:i.title)&&o.getAttribute("crossorigin")===(null==i.crossOrigin?null:i.crossOrigin)){s.splice(l,1);break t}ih(o=r.createElement(n),n,i),r.head.appendChild(o);break;case"meta":if(s=Vh("meta","content",r).get(n+(i.content||"")))for(l=0;l<s.length;l++)if((o=s[l]).getAttribute("content")===(null==i.content?null:""+i.content)&&o.getAttribute("name")===(null==i.name?null:i.name)&&o.getAttribute("property")===(null==i.property?null:i.property)&&o.getAttribute("http-equiv")===(null==i.httpEquiv?null:i.httpEquiv)&&o.getAttribute("charset")===(null==i.charSet?null:i.charSet)){s.splice(l,1);break t}ih(o=r.createElement(n),n,i),r.head.appendChild(o);break;default:throw Error(a(468,n))}o[Me]=e,Xe(o),n=o}e.stateNode=n}else Wh(r,e.type,e.stateNode);else e.stateNode=Ph(r,n,e.memoizedProps);else o!==n?(null===o?null!==i.stateNode&&(i=i.stateNode).parentNode.removeChild(i):o.count--,null===n?Wh(r,e.type,e.stateNode):Ph(r,n,e.memoizedProps)):null===n&&null!==e.stateNode&&pl(e,e.memoizedProps,i.memoizedProps)}break;case 27:Ml(t,e),Bl(e),512&n&&(wl||null===i||fl(i,i.return)),null!==i&&4&n&&pl(e,e.memoizedProps,i.memoizedProps);break;case 5:if(Ml(t,e),Bl(e),512&n&&(wl||null===i||fl(i,i.return)),32&e.flags){r=e.stateNode;try{xt(r,"")}catch(g){du(e,e.return,g)}}4&n&&null!=e.stateNode&&pl(e,r=e.memoizedProps,null!==i?i.memoizedProps:r),1024&n&&(Cl=!0);break;case 6:if(Ml(t,e),Bl(e),4&n){if(null===e.stateNode)throw Error(a(162));n=e.memoizedProps,i=e.stateNode;try{i.nodeValue=n}catch(g){du(e,e.return,g)}}break;case 3:if(Uh=null,r=Fl,Fl=Eh(t.containerInfo),Ml(t,e),Fl=r,Bl(e),4&n&&null!==i&&i.memoizedState.isDehydrated)try{Ad(t.containerInfo)}catch(g){du(e,e.return,g)}Cl&&(Cl=!1,Nl(e));break;case 4:n=Fl,Fl=Eh(e.stateNode.containerInfo),Ml(t,e),Bl(e),Fl=n;break;case 12:default:Ml(t,e),Bl(e);break;case 13:Ml(t,e),Bl(e),8192&e.child.flags&&null!==e.memoizedState!==(null!==i&&null!==i.memoizedState)&&(Cc=ne()),4&n&&(null!==(n=e.updateQueue)&&(e.updateQueue=null,Ll(e,n)));break;case 22:r=null!==e.memoizedState;var c=null!==i&&null!==i.memoizedState,u=Sl,h=wl;if(Sl=u||r,wl=h||c,Ml(t,e),wl=h,Sl=u,Bl(e),8192&n)e:for(t=e.stateNode,t._visibility=r?-2&t._visibility:1|t._visibility,r&&(null===i||c||Sl||wl||Ul(e)),i=null,t=e;;){if(5===t.tag||26===t.tag){if(null===i){c=i=t;try{if(o=c.stateNode,r)"function"===typeof(s=o.style).setProperty?s.setProperty("display","none","important"):s.display="none";else{l=c.stateNode;var d=c.memoizedProps.style,f=void 0!==d&&null!==d&&d.hasOwnProperty("display")?d.display:null;l.style.display=null==f||"boolean"===typeof f?"":(""+f).trim()}}catch(g){du(c,c.return,g)}}}else if(6===t.tag){if(null===i){c=t;try{c.stateNode.nodeValue=r?"":c.memoizedProps}catch(g){du(c,c.return,g)}}}else if((22!==t.tag&&23!==t.tag||null===t.memoizedState||t===e)&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;null===t.sibling;){if(null===t.return||t.return===e)break e;i===t&&(i=null),t=t.return}i===t&&(i=null),t.sibling.return=t.return,t=t.sibling}4&n&&(null!==(n=e.updateQueue)&&(null!==(i=n.retryQueue)&&(n.retryQueue=null,Ll(e,i))));break;case 19:Ml(t,e),Bl(e),4&n&&(null!==(n=e.updateQueue)&&(e.updateQueue=null,Ll(e,n)));case 30:case 21:}}function Bl(e){var t=e.flags;if(2&t){try{for(var i,n=e.return;null!==n;){if(ml(n)){i=n;break}n=n.return}if(null==i)throw Error(a(160));switch(i.tag){case 27:var r=i.stateNode;yl(e,_l(e),r);break;case 5:var o=i.stateNode;32&i.flags&&(xt(o,""),i.flags&=-33),yl(e,_l(e),o);break;case 3:case 4:var s=i.stateNode.containerInfo;vl(e,_l(e),s);break;default:throw Error(a(161))}}catch(l){du(e,e.return,l)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function Nl(e){if(1024&e.subtreeFlags)for(e=e.child;null!==e;){var t=e;Nl(t),5===t.tag&&1024&t.flags&&t.stateNode.reset(),e=e.sibling}}function jl(e,t){if(8772&t.subtreeFlags)for(t=t.child;null!==t;)El(e,t.alternate,t),t=t.sibling}function Ul(e){for(e=e.child;null!==e;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:cl(4,t,t.return),Ul(t);break;case 1:fl(t,t.return);var i=t.stateNode;"function"===typeof i.componentWillUnmount&&hl(t,t.return,i),Ul(t);break;case 27:Ch(t.stateNode);case 26:case 5:fl(t,t.return),Ul(t);break;case 22:null===t.memoizedState&&Ul(t);break;default:Ul(t)}e=e.sibling}}function Vl(e,t,i){for(i=i&&0!==(8772&t.subtreeFlags),t=t.child;null!==t;){var n=t.alternate,r=e,o=t,a=o.flags;switch(o.tag){case 0:case 11:case 15:Vl(r,o,i),ll(4,o);break;case 1:if(Vl(r,o,i),"function"===typeof(r=(n=o).stateNode).componentDidMount)try{r.componentDidMount()}catch(c){du(n,n.return,c)}if(null!==(r=(n=o).updateQueue)){var s=n.stateNode;try{var l=r.shared.hiddenCallbacks;if(null!==l)for(r.shared.hiddenCallbacks=null,r=0;r<l.length;r++)go(l[r],s)}catch(c){du(n,n.return,c)}}i&&64&a&&ul(o),dl(o,o.return);break;case 27:bl(o);case 26:case 5:Vl(r,o,i),i&&null===n&&4&a&&gl(o),dl(o,o.return);break;case 12:Vl(r,o,i);break;case 13:Vl(r,o,i),i&&4&a&&kl(r,o);break;case 22:null===o.memoizedState&&Vl(r,o,i),dl(o,o.return);break;case 30:break;default:Vl(r,o,i)}t=t.sibling}}function Wl(e,t){var i=null;null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(i=e.memoizedState.cachePool.pool),e=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(e=t.memoizedState.cachePool.pool),e!==i&&(null!=e&&e.refCount++,null!=i&&Pr(i))}function Gl(e,t){e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Pr(e))}function zl(e,t,i,n){if(10256&t.subtreeFlags)for(t=t.child;null!==t;)Hl(e,t,i,n),t=t.sibling}function Hl(e,t,i,n){var r=t.flags;switch(t.tag){case 0:case 11:case 15:zl(e,t,i,n),2048&r&&ll(9,t);break;case 1:case 13:default:zl(e,t,i,n);break;case 3:zl(e,t,i,n),2048&r&&(e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Pr(e)));break;case 12:if(2048&r){zl(e,t,i,n),e=t.stateNode;try{var o=t.memoizedProps,a=o.id,s=o.onPostCommit;"function"===typeof s&&s(a,null===t.alternate?"mount":"update",e.passiveEffectDuration,-0)}catch(l){du(t,t.return,l)}}else zl(e,t,i,n);break;case 23:break;case 22:o=t.stateNode,a=t.alternate,null!==t.memoizedState?2&o._visibility?zl(e,t,i,n):Xl(e,t):2&o._visibility?zl(e,t,i,n):(o._visibility|=2,Yl(e,t,i,n,0!==(10256&t.subtreeFlags))),2048&r&&Wl(a,t);break;case 24:zl(e,t,i,n),2048&r&&Gl(t.alternate,t)}}function Yl(e,t,i,n,r){for(r=r&&0!==(10256&t.subtreeFlags),t=t.child;null!==t;){var o=e,a=t,s=i,l=n,c=a.flags;switch(a.tag){case 0:case 11:case 15:Yl(o,a,s,l,r),ll(8,a);break;case 23:break;case 22:var u=a.stateNode;null!==a.memoizedState?2&u._visibility?Yl(o,a,s,l,r):Xl(o,a):(u._visibility|=2,Yl(o,a,s,l,r)),r&&2048&c&&Wl(a.alternate,a);break;case 24:Yl(o,a,s,l,r),r&&2048&c&&Gl(a.alternate,a);break;default:Yl(o,a,s,l,r)}t=t.sibling}}function Xl(e,t){if(10256&t.subtreeFlags)for(t=t.child;null!==t;){var i=e,n=t,r=n.flags;switch(n.tag){case 22:Xl(i,n),2048&r&&Wl(n.alternate,n);break;case 24:Xl(i,n),2048&r&&Gl(n.alternate,n);break;default:Xl(i,n)}t=t.sibling}}var ql=8192;function Zl(e){if(e.subtreeFlags&ql)for(e=e.child;null!==e;)Kl(e),e=e.sibling}function Kl(e){switch(e.tag){case 26:Zl(e),e.flags&ql&&null!==e.memoizedState&&function(e,t,i){if(null===zh)throw Error(a(475));var n=zh;if("stylesheet"===t.type&&("string"!==typeof i.media||!1!==matchMedia(i.media).matches)&&0===(4&t.state.loading)){if(null===t.instance){var r=Dh(i.href),o=e.querySelector(kh(r));if(o)return null!==(e=o._p)&&"object"===typeof e&&"function"===typeof e.then&&(n.count++,n=Yh.bind(n),e.then(n,n)),t.state.loading|=4,t.instance=o,void Xe(o);o=e.ownerDocument||e,i=Lh(i),(r=xh.get(r))&&Nh(i,r),Xe(o=o.createElement("link"));var s=o;s._p=new Promise((function(e,t){s.onload=e,s.onerror=t})),ih(o,"link",i),t.instance=o}null===n.stylesheets&&(n.stylesheets=new Map),n.stylesheets.set(t,e),(e=t.state.preload)&&0===(3&t.state.loading)&&(n.count++,t=Yh.bind(n),e.addEventListener("load",t),e.addEventListener("error",t))}}(Fl,e.memoizedState,e.memoizedProps);break;case 5:default:Zl(e);break;case 3:case 4:var t=Fl;Fl=Eh(e.stateNode.containerInfo),Zl(e),Fl=t;break;case 22:null===e.memoizedState&&(null!==(t=e.alternate)&&null!==t.memoizedState?(t=ql,ql=16777216,Zl(e),ql=t):Zl(e))}}function Jl(e){var t=e.alternate;if(null!==t&&null!==(e=t.child)){t.child=null;do{t=e.sibling,e.sibling=null,e=t}while(null!==e)}}function Ql(e){var t=e.deletions;if(0!==(16&e.flags)){if(null!==t)for(var i=0;i<t.length;i++){var n=t[i];Tl=n,tc(n,e)}Jl(e)}if(10256&e.subtreeFlags)for(e=e.child;null!==e;)$l(e),e=e.sibling}function $l(e){switch(e.tag){case 0:case 11:case 15:Ql(e),2048&e.flags&&cl(9,e,e.return);break;case 3:case 12:default:Ql(e);break;case 22:var t=e.stateNode;null!==e.memoizedState&&2&t._visibility&&(null===e.return||13!==e.return.tag)?(t._visibility&=-3,ec(e)):Ql(e)}}function ec(e){var t=e.deletions;if(0!==(16&e.flags)){if(null!==t)for(var i=0;i<t.length;i++){var n=t[i];Tl=n,tc(n,e)}Jl(e)}for(e=e.child;null!==e;){switch((t=e).tag){case 0:case 11:case 15:cl(8,t,t.return),ec(t);break;case 22:2&(i=t.stateNode)._visibility&&(i._visibility&=-3,ec(t));break;default:ec(t)}e=e.sibling}}function tc(e,t){for(;null!==Tl;){var i=Tl;switch(i.tag){case 0:case 11:case 15:cl(8,i,t);break;case 23:case 22:if(null!==i.memoizedState&&null!==i.memoizedState.cachePool){var n=i.memoizedState.cachePool.pool;null!=n&&n.refCount++}break;case 24:Pr(i.memoizedState.cache)}if(null!==(n=i.child))n.return=i,Tl=n;else e:for(i=e;null!==Tl;){var r=(n=Tl).sibling,o=n.return;if(Il(n),n===i){Tl=null;break e}if(null!==r){r.return=o,Tl=r;break e}Tl=o}}}var ic={getCacheForType:function(e){var t=Or(Mr),i=t.data.get(e);return void 0===i&&(i=e(),t.data.set(e,i)),i}},nc="function"===typeof WeakMap?WeakMap:Map,rc=0,oc=null,ac=null,sc=0,lc=0,cc=null,uc=!1,hc=!1,dc=!1,fc=0,gc=0,pc=0,mc=0,_c=0,vc=0,yc=0,bc=null,Sc=null,wc=!1,Cc=0,xc=1/0,Tc=null,Ec=null,Ic=0,Oc=null,Ac=null,Rc=0,Dc=0,kc=null,Lc=null,Mc=0,Fc=null;function Pc(){if(0!==(2&rc)&&0!==sc)return sc&-sc;if(null!==F.T){return 0!==jr?jr:Du()}return ke()}function Bc(){0===vc&&(vc=0===(536870912&sc)||sr?xe():536870912);var e=as.current;return null!==e&&(e.flags|=32),vc}function Nc(e,t,i){(e!==oc||2!==lc&&9!==lc)&&null===e.cancelPendingCommit||(Hc(e,0),Wc(e,sc,vc,!1)),Ie(e,i),0!==(2&rc)&&e===oc||(e===oc&&(0===(2&rc)&&(mc|=i),4===gc&&Wc(e,sc,vc,!1)),xu(e))}function jc(e,t,i){if(0!==(6&rc))throw Error(a(327));for(var n=!i&&0===(124&t)&&0===(t&e.expiredLanes)||we(e,t),r=n?function(e,t){var i=rc;rc|=2;var n=Xc(),r=qc();oc!==e||sc!==t?(Tc=null,xc=ne()+500,Hc(e,t)):hc=we(e,t);e:for(;;)try{if(0!==lc&&null!==ac){t=ac;var o=cc;t:switch(lc){case 1:lc=0,cc=null,tu(e,t,o,1);break;case 2:case 9:if(Jr(o)){lc=0,cc=null,eu(t);break}t=function(){2!==lc&&9!==lc||oc!==e||(lc=7),xu(e)},o.then(t,t);break e;case 3:lc=7;break e;case 4:lc=5;break e;case 7:Jr(o)?(lc=0,cc=null,eu(t)):(lc=0,cc=null,tu(e,t,o,7));break;case 5:var s=null;switch(ac.tag){case 26:s=ac.memoizedState;case 5:case 27:var l=ac;if(!s||Gh(s)){lc=0,cc=null;var c=l.sibling;if(null!==c)ac=c;else{var u=l.return;null!==u?(ac=u,iu(u)):ac=null}break t}}lc=0,cc=null,tu(e,t,o,5);break;case 6:lc=0,cc=null,tu(e,t,o,6);break;case 8:zc(),gc=6;break e;default:throw Error(a(462))}}Qc();break}catch(h){Yc(e,h)}return br=yr=null,F.H=n,F.A=r,rc=i,null!==ac?0:(oc=null,sc=0,Rn(),gc)}(e,t):Kc(e,t,!0),o=n;;){if(0===r){hc&&!n&&Wc(e,t,0,!1);break}if(i=e.current.alternate,!o||Vc(i)){if(2===r){if(o=t,e.errorRecoveryDisabledLanes&o)var s=0;else s=0!==(s=-536870913&e.pendingLanes)?s:536870912&s?536870912:0;if(0!==s){t=s;e:{var l=e;r=bc;var c=l.current.memoizedState.isDehydrated;if(c&&(Hc(l,s).flags|=256),2!==(s=Kc(l,s,!1))){if(dc&&!c){l.errorRecoveryDisabledLanes|=o,mc|=o,r=4;break e}o=Sc,Sc=r,null!==o&&(null===Sc?Sc=o:Sc.push.apply(Sc,o))}r=s}if(o=!1,2!==r)continue}}if(1===r){Hc(e,0),Wc(e,t,0,!0);break}e:{switch(n=e,o=r){case 0:case 1:throw Error(a(345));case 4:if((4194048&t)!==t)break;case 6:Wc(n,t,vc,!uc);break e;case 2:Sc=null;break;case 3:case 5:break;default:throw Error(a(329))}if((62914560&t)===t&&10<(r=Cc+300-ne())){if(Wc(n,t,vc,!uc),0!==Se(n,0,!0))break e;n.timeoutHandle=uh(Uc.bind(null,n,i,Sc,Tc,wc,t,vc,mc,yc,uc,o,2,-0,0),r)}else Uc(n,i,Sc,Tc,wc,t,vc,mc,yc,uc,o,0,-0,0)}break}r=Kc(e,t,!1),o=!1}xu(e)}function Uc(e,t,i,n,r,o,s,l,c,u,h,d,f,g){if(e.timeoutHandle=-1,(8192&(d=t.subtreeFlags)||16785408===(16785408&d))&&(zh={stylesheets:null,count:0,unsuspend:Hh},Kl(t),null!==(d=function(){if(null===zh)throw Error(a(475));var e=zh;return e.stylesheets&&0===e.count&&qh(e,e.stylesheets),0<e.count?function(t){var i=setTimeout((function(){if(e.stylesheets&&qh(e,e.stylesheets),e.unsuspend){var t=e.unsuspend;e.unsuspend=null,t()}}),6e4);return e.unsuspend=t,function(){e.unsuspend=null,clearTimeout(i)}}:null}())))return e.cancelPendingCommit=d(ru.bind(null,e,t,o,i,n,r,s,l,c,h,1,f,g)),void Wc(e,o,s,!u);ru(e,t,o,i,n,r,s,l,c)}function Vc(e){for(var t=e;;){var i=t.tag;if((0===i||11===i||15===i)&&16384&t.flags&&(null!==(i=t.updateQueue)&&null!==(i=i.stores)))for(var n=0;n<i.length;n++){var r=i[n],o=r.getSnapshot;r=r.value;try{if(!Ki(o(),r))return!1}catch(a){return!1}}if(i=t.child,16384&t.subtreeFlags&&null!==i)i.return=t,t=i;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Wc(e,t,i,n){t&=~_c,t&=~mc,e.suspendedLanes|=t,e.pingedLanes&=~t,n&&(e.warmLanes|=t),n=e.expirationTimes;for(var r=t;0<r;){var o=31-pe(r),a=1<<o;n[o]=-1,r&=~a}0!==i&&Oe(e,i,t)}function Gc(){return 0!==(6&rc)||(Tu(0,!1),!1)}function zc(){if(null!==ac){if(0===lc)var e=ac.return;else br=yr=null,Uo(e=ac),Ja=null,Qa=0,e=ac;for(;null!==e;)sl(e.alternate,e),e=e.return;ac=null}}function Hc(e,t){var i=e.timeoutHandle;-1!==i&&(e.timeoutHandle=-1,hh(i)),null!==(i=e.cancelPendingCommit)&&(e.cancelPendingCommit=null,i()),zc(),oc=e,ac=i=Un(e.current,null),sc=t,lc=0,cc=null,uc=!1,hc=we(e,t),dc=!1,yc=vc=_c=mc=pc=gc=0,Sc=bc=null,wc=!1,0!==(8&t)&&(t|=32&t);var n=e.entangledLanes;if(0!==n)for(e=e.entanglements,n&=t;0<n;){var r=31-pe(n),o=1<<r;t|=e[r],n&=~o}return fc=t,Rn(),i}function Yc(e,t){wo=null,F.H=Xa,t===Xr||t===Zr?(t=to(),lc=3):t===qr?(t=to(),lc=4):lc=t===Os?8:null!==t&&"object"===typeof t&&"function"===typeof t.then?6:1,cc=t,null===ac&&(gc=1,Cs(e,En(t,e.current)))}function Xc(){var e=F.H;return F.H=Xa,null===e?Xa:e}function qc(){var e=F.A;return F.A=ic,e}function Zc(){gc=4,uc||(4194048&sc)!==sc&&null!==as.current||(hc=!0),0===(134217727&pc)&&0===(134217727&mc)||null===oc||Wc(oc,sc,vc,!1)}function Kc(e,t,i){var n=rc;rc|=2;var r=Xc(),o=qc();oc===e&&sc===t||(Tc=null,Hc(e,t)),t=!1;var a=gc;e:for(;;)try{if(0!==lc&&null!==ac){var s=ac,l=cc;switch(lc){case 8:zc(),a=6;break e;case 3:case 2:case 9:case 6:null===as.current&&(t=!0);var c=lc;if(lc=0,cc=null,tu(e,s,l,c),i&&hc){a=0;break e}break;default:c=lc,lc=0,cc=null,tu(e,s,l,c)}}Jc(),a=gc;break}catch(u){Yc(e,u)}return t&&e.shellSuspendCounter++,br=yr=null,rc=n,F.H=r,F.A=o,null===ac&&(oc=null,sc=0,Rn()),a}function Jc(){for(;null!==ac;)$c(ac)}function Qc(){for(;null!==ac&&!te();)$c(ac)}function $c(e){var t=$s(e.alternate,e,fc);e.memoizedProps=e.pendingProps,null===t?iu(e):ac=t}function eu(e){var t=e,i=t.alternate;switch(t.tag){case 15:case 0:t=Ns(i,t,t.pendingProps,t.type,void 0,sc);break;case 11:t=Ns(i,t,t.pendingProps,t.type.render,t.ref,sc);break;case 5:Uo(t);default:sl(i,t),t=$s(i,t=ac=Vn(t,fc),fc)}e.memoizedProps=e.pendingProps,null===t?iu(e):ac=t}function tu(e,t,i,n){br=yr=null,Uo(t),Ja=null,Qa=0;var r=t.return;try{if(function(e,t,i,n,r){if(i.flags|=32768,null!==n&&"object"===typeof n&&"function"===typeof n.then){if(null!==(t=i.alternate)&&Tr(t,i,r,!0),null!==(i=as.current)){switch(i.tag){case 13:return null===ss?Zc():null===i.alternate&&0===gc&&(gc=3),i.flags&=-257,i.flags|=65536,i.lanes=r,n===Kr?i.flags|=16384:(null===(t=i.updateQueue)?i.updateQueue=new Set([n]):t.add(n),fu(e,n,r)),!1;case 22:return i.flags|=65536,n===Kr?i.flags|=16384:(null===(t=i.updateQueue)?(t={transitions:null,markerInstances:null,retryQueue:new Set([n])},i.updateQueue=t):null===(i=t.retryQueue)?t.retryQueue=new Set([n]):i.add(n),fu(e,n,r)),!1}throw Error(a(435,i.tag))}return fu(e,n,r),Zc(),!1}if(sr)return null!==(t=as.current)?(0===(65536&t.flags)&&(t.flags|=256),t.flags|=65536,t.lanes=r,n!==ur&&_r(En(e=Error(a(422),{cause:n}),i))):(n!==ur&&_r(En(t=Error(a(423),{cause:n}),i)),(e=e.current.alternate).flags|=65536,r&=-r,e.lanes|=r,n=En(n,i),co(e,r=Ts(e.stateNode,n,r)),4!==gc&&(gc=2)),!1;var o=Error(a(520),{cause:n});if(o=En(o,i),null===bc?bc=[o]:bc.push(o),4!==gc&&(gc=2),null===t)return!0;n=En(n,i),i=t;do{switch(i.tag){case 3:return i.flags|=65536,e=r&-r,i.lanes|=e,co(i,e=Ts(i.stateNode,n,e)),!1;case 1:if(t=i.type,o=i.stateNode,0===(128&i.flags)&&("function"===typeof t.getDerivedStateFromError||null!==o&&"function"===typeof o.componentDidCatch&&(null===Ec||!Ec.has(o))))return i.flags|=65536,r&=-r,i.lanes|=r,Is(r=Es(r),e,i,n),co(i,r),!1}i=i.return}while(null!==i);return!1}(e,r,t,i,sc))return gc=1,Cs(e,En(i,e.current)),void(ac=null)}catch(o){if(null!==r)throw ac=r,o;return gc=1,Cs(e,En(i,e.current)),void(ac=null)}32768&t.flags?(sr||1===n?e=!0:hc||0!==(536870912&sc)?e=!1:(uc=e=!0,(2===n||9===n||3===n||6===n)&&(null!==(n=as.current)&&13===n.tag&&(n.flags|=16384))),nu(t,e)):iu(t)}function iu(e){var t=e;do{if(0!==(32768&t.flags))return void nu(t,uc);e=t.return;var i=ol(t.alternate,t,fc);if(null!==i)return void(ac=i);if(null!==(t=t.sibling))return void(ac=t);ac=t=e}while(null!==t);0===gc&&(gc=5)}function nu(e,t){do{var i=al(e.alternate,e);if(null!==i)return i.flags&=32767,void(ac=i);if(null!==(i=e.return)&&(i.flags|=32768,i.subtreeFlags=0,i.deletions=null),!t&&null!==(e=e.sibling))return void(ac=e);ac=e=i}while(null!==e);gc=6,ac=null}function ru(e,t,i,n,r,o,s,l,c){e.cancelPendingCommit=null;do{cu()}while(0!==Ic);if(0!==(6&rc))throw Error(a(327));if(null!==t){if(t===e.current)throw Error(a(177));if(o=t.lanes|t.childLanes,function(e,t,i,n,r,o){var a=e.pendingLanes;e.pendingLanes=i,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=i,e.entangledLanes&=i,e.errorRecoveryDisabledLanes&=i,e.shellSuspendCounter=0;var s=e.entanglements,l=e.expirationTimes,c=e.hiddenUpdates;for(i=a&~i;0<i;){var u=31-pe(i),h=1<<u;s[u]=0,l[u]=-1;var d=c[u];if(null!==d)for(c[u]=null,u=0;u<d.length;u++){var f=d[u];null!==f&&(f.lane&=-536870913)}i&=~h}0!==n&&Oe(e,n,0),0!==o&&0===r&&0!==e.tag&&(e.suspendedLanes|=o&~(a&~t))}(e,i,o|=An,s,l,c),e===oc&&(ac=oc=null,sc=0),Ac=t,Oc=e,Rc=i,Dc=o,kc=r,Lc=n,0!==(10256&t.subtreeFlags)||0!==(10256&t.flags)?(e.callbackNode=null,e.callbackPriority=0,$(se,(function(){return uu(),null}))):(e.callbackNode=null,e.callbackPriority=0),n=0!==(13878&t.flags),0!==(13878&t.subtreeFlags)||n){n=F.T,F.T=null,r=P.p,P.p=2,s=rc,rc|=4;try{!function(e,t){if(e=e.containerInfo,nh=rd,nn(e=tn(e))){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else e:{var n=(i=(i=e.ownerDocument)&&i.defaultView||window).getSelection&&i.getSelection();if(n&&0!==n.rangeCount){i=n.anchorNode;var r=n.anchorOffset,o=n.focusNode;n=n.focusOffset;try{i.nodeType,o.nodeType}catch(m){i=null;break e}var s=0,l=-1,c=-1,u=0,h=0,d=e,f=null;t:for(;;){for(var g;d!==i||0!==r&&3!==d.nodeType||(l=s+r),d!==o||0!==n&&3!==d.nodeType||(c=s+n),3===d.nodeType&&(s+=d.nodeValue.length),null!==(g=d.firstChild);)f=d,d=g;for(;;){if(d===e)break t;if(f===i&&++u===r&&(l=s),f===o&&++h===n&&(c=s),null!==(g=d.nextSibling))break;f=(d=f).parentNode}d=g}i=-1===l||-1===c?null:{start:l,end:c}}else i=null}i=i||{start:0,end:0}}else i=null;for(rh={focusedElem:e,selectionRange:i},rd=!1,Tl=t;null!==Tl;)if(e=(t=Tl).child,0!==(1024&t.subtreeFlags)&&null!==e)e.return=t,Tl=e;else for(;null!==Tl;){switch(o=(t=Tl).alternate,e=t.flags,t.tag){case 0:case 11:case 15:case 5:case 26:case 27:case 6:case 4:case 17:break;case 1:if(0!==(1024&e)&&null!==o){e=void 0,i=t,r=o.memoizedProps,o=o.memoizedState,n=i.stateNode;try{var p=vs(i.type,r,(i.elementType,i.type));e=n.getSnapshotBeforeUpdate(p,o),n.__reactInternalSnapshotBeforeUpdate=e}catch(_){du(i,i.return,_)}}break;case 3:if(0!==(1024&e))if(9===(i=(e=t.stateNode.containerInfo).nodeType))_h(e);else if(1===i)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":_h(e);break;default:e.textContent=""}break;default:if(0!==(1024&e))throw Error(a(163))}if(null!==(e=t.sibling)){e.return=t.return,Tl=e;break}Tl=t.return}}(e,t)}finally{rc=s,P.p=r,F.T=n}}Ic=1,ou(),au(),su()}}function ou(){if(1===Ic){Ic=0;var e=Oc,t=Ac,i=0!==(13878&t.flags);if(0!==(13878&t.subtreeFlags)||i){i=F.T,F.T=null;var n=P.p;P.p=2;var r=rc;rc|=4;try{Pl(t,e);var o=rh,a=tn(e.containerInfo),s=o.focusedElem,l=o.selectionRange;if(a!==s&&s&&s.ownerDocument&&en(s.ownerDocument.documentElement,s)){if(null!==l&&nn(s)){var c=l.start,u=l.end;if(void 0===u&&(u=c),"selectionStart"in s)s.selectionStart=c,s.selectionEnd=Math.min(u,s.value.length);else{var h=s.ownerDocument||document,d=h&&h.defaultView||window;if(d.getSelection){var f=d.getSelection(),g=s.textContent.length,p=Math.min(l.start,g),m=void 0===l.end?p:Math.min(l.end,g);!f.extend&&p>m&&(a=m,m=p,p=a);var _=$i(s,p),v=$i(s,m);if(_&&v&&(1!==f.rangeCount||f.anchorNode!==_.node||f.anchorOffset!==_.offset||f.focusNode!==v.node||f.focusOffset!==v.offset)){var y=h.createRange();y.setStart(_.node,_.offset),f.removeAllRanges(),p>m?(f.addRange(y),f.extend(v.node,v.offset)):(y.setEnd(v.node,v.offset),f.addRange(y))}}}}for(h=[],f=s;f=f.parentNode;)1===f.nodeType&&h.push({element:f,left:f.scrollLeft,top:f.scrollTop});for("function"===typeof s.focus&&s.focus(),s=0;s<h.length;s++){var b=h[s];b.element.scrollLeft=b.left,b.element.scrollTop=b.top}}rd=!!nh,rh=nh=null}finally{rc=r,P.p=n,F.T=i}}e.current=t,Ic=2}}function au(){if(2===Ic){Ic=0;var e=Oc,t=Ac,i=0!==(8772&t.flags);if(0!==(8772&t.subtreeFlags)||i){i=F.T,F.T=null;var n=P.p;P.p=2;var r=rc;rc|=4;try{El(e,t.alternate,t)}finally{rc=r,P.p=n,F.T=i}}Ic=3}}function su(){if(4===Ic||3===Ic){Ic=0,ie();var e=Oc,t=Ac,i=Rc,n=Lc;0!==(10256&t.subtreeFlags)||0!==(10256&t.flags)?Ic=5:(Ic=0,Ac=Oc=null,lu(e,e.pendingLanes));var r=e.pendingLanes;if(0===r&&(Ec=null),De(i),t=t.stateNode,fe&&"function"===typeof fe.onCommitFiberRoot)try{fe.onCommitFiberRoot(de,t,void 0,128===(128&t.current.flags))}catch(l){}if(null!==n){t=F.T,r=P.p,P.p=2,F.T=null;try{for(var o=e.onRecoverableError,a=0;a<n.length;a++){var s=n[a];o(s.value,{componentStack:s.stack})}}finally{F.T=t,P.p=r}}0!==(3&Rc)&&cu(),xu(e),r=e.pendingLanes,0!==(4194090&i)&&0!==(42&r)?e===Fc?Mc++:(Mc=0,Fc=e):Mc=0,Tu(0,!1)}}function lu(e,t){0===(e.pooledCacheLanes&=t)&&(null!=(t=e.pooledCache)&&(e.pooledCache=null,Pr(t)))}function cu(e){return ou(),au(),su(),uu()}function uu(){if(5!==Ic)return!1;var e=Oc,t=Dc;Dc=0;var i=De(Rc),n=F.T,r=P.p;try{P.p=32>i?32:i,F.T=null,i=kc,kc=null;var o=Oc,s=Rc;if(Ic=0,Ac=Oc=null,Rc=0,0!==(6&rc))throw Error(a(331));var l=rc;if(rc|=4,$l(o.current),Hl(o,o.current,s,i),rc=l,Tu(0,!1),fe&&"function"===typeof fe.onPostCommitFiberRoot)try{fe.onPostCommitFiberRoot(de,o)}catch(c){}return!0}finally{P.p=r,F.T=n,lu(e,t)}}function hu(e,t,i){t=En(i,t),null!==(e=so(e,t=Ts(e.stateNode,t,2),2))&&(Ie(e,2),xu(e))}function du(e,t,i){if(3===e.tag)hu(e,e,i);else for(;null!==t;){if(3===t.tag){hu(t,e,i);break}if(1===t.tag){var n=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof n.componentDidCatch&&(null===Ec||!Ec.has(n))){e=En(i,e),null!==(n=so(t,i=Es(2),2))&&(Is(i,n,t,e),Ie(n,2),xu(n));break}}t=t.return}}function fu(e,t,i){var n=e.pingCache;if(null===n){n=e.pingCache=new nc;var r=new Set;n.set(t,r)}else void 0===(r=n.get(t))&&(r=new Set,n.set(t,r));r.has(i)||(dc=!0,r.add(i),e=gu.bind(null,e,t,i),t.then(e,e))}function gu(e,t,i){var n=e.pingCache;null!==n&&n.delete(t),e.pingedLanes|=e.suspendedLanes&i,e.warmLanes&=~i,oc===e&&(sc&i)===i&&(4===gc||3===gc&&(62914560&sc)===sc&&300>ne()-Cc?0===(2&rc)&&Hc(e,0):_c|=i,yc===sc&&(yc=0)),xu(e)}function pu(e,t){0===t&&(t=Te()),null!==(e=Ln(e,t))&&(Ie(e,t),xu(e))}function mu(e){var t=e.memoizedState,i=0;null!==t&&(i=t.retryLane),pu(e,i)}function _u(e,t){var i=0;switch(e.tag){case 13:var n=e.stateNode,r=e.memoizedState;null!==r&&(i=r.retryLane);break;case 19:n=e.stateNode;break;case 22:n=e.stateNode._retryCache;break;default:throw Error(a(314))}null!==n&&n.delete(t),pu(e,i)}var vu=null,yu=null,bu=!1,Su=!1,wu=!1,Cu=0;function xu(e){e!==yu&&null===e.next&&(null===yu?vu=yu=e:yu=yu.next=e),Su=!0,bu||(bu=!0,fh((function(){0!==(6&rc)?$(oe,Eu):Iu()})))}function Tu(e,t){if(!wu&&Su){wu=!0;do{for(var i=!1,n=vu;null!==n;){if(!t)if(0!==e){var r=n.pendingLanes;if(0===r)var o=0;else{var a=n.suspendedLanes,s=n.pingedLanes;o=(1<<31-pe(42|e)+1)-1,o=201326741&(o&=r&~(a&~s))?201326741&o|1:o?2|o:0}0!==o&&(i=!0,Ru(n,o))}else o=sc,0===(3&(o=Se(n,n===oc?o:0,null!==n.cancelPendingCommit||-1!==n.timeoutHandle)))||we(n,o)||(i=!0,Ru(n,o));n=n.next}}while(i);wu=!1}}function Eu(){Iu()}function Iu(){Su=bu=!1;var e=0;0!==Cu&&(function(){var e=window.event;if(e&&"popstate"===e.type)return e!==ch&&(ch=e,!0);return ch=null,!1}()&&(e=Cu),Cu=0);for(var t=ne(),i=null,n=vu;null!==n;){var r=n.next,o=Ou(n,t);0===o?(n.next=null,null===i?vu=r:i.next=r,null===r&&(yu=i)):(i=n,(0!==e||0!==(3&o))&&(Su=!0)),n=r}Tu(e,!1)}function Ou(e,t){for(var i=e.suspendedLanes,n=e.pingedLanes,r=e.expirationTimes,o=-62914561&e.pendingLanes;0<o;){var a=31-pe(o),s=1<<a,l=r[a];-1===l?0!==(s&i)&&0===(s&n)||(r[a]=Ce(s,t)):l<=t&&(e.expiredLanes|=s),o&=~s}if(i=sc,i=Se(e,e===(t=oc)?i:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle),n=e.callbackNode,0===i||e===t&&(2===lc||9===lc)||null!==e.cancelPendingCommit)return null!==n&&null!==n&&ee(n),e.callbackNode=null,e.callbackPriority=0;if(0===(3&i)||we(e,i)){if((t=i&-i)===e.callbackPriority)return t;switch(null!==n&&ee(n),De(i)){case 2:case 8:i=ae;break;case 32:default:i=se;break;case 268435456:i=ce}return n=Au.bind(null,e),i=$(i,n),e.callbackPriority=t,e.callbackNode=i,t}return null!==n&&null!==n&&ee(n),e.callbackPriority=2,e.callbackNode=null,2}function Au(e,t){if(0!==Ic&&5!==Ic)return e.callbackNode=null,e.callbackPriority=0,null;var i=e.callbackNode;if(cu()&&e.callbackNode!==i)return null;var n=sc;return 0===(n=Se(e,e===oc?n:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle))?null:(jc(e,n,t),Ou(e,ne()),null!=e.callbackNode&&e.callbackNode===i?Au.bind(null,e):null)}function Ru(e,t){if(cu())return null;jc(e,t,!0)}function Du(){return 0===Cu&&(Cu=xe()),Cu}function ku(e){return null==e||"symbol"===typeof e||"boolean"===typeof e?null:"function"===typeof e?e:Dt(""+e)}function Lu(e,t){var i=t.ownerDocument.createElement("input");return i.name=t.name,i.value=t.value,e.id&&i.setAttribute("form",e.id),t.parentNode.insertBefore(i,t),e=new FormData(e),i.parentNode.removeChild(i),e}for(var Mu=0;Mu<Cn.length;Mu++){var Fu=Cn[Mu];xn(Fu.toLowerCase(),"on"+(Fu[0].toUpperCase()+Fu.slice(1)))}xn(pn,"onAnimationEnd"),xn(mn,"onAnimationIteration"),xn(_n,"onAnimationStart"),xn("dblclick","onDoubleClick"),xn("focusin","onFocus"),xn("focusout","onBlur"),xn(vn,"onTransitionRun"),xn(yn,"onTransitionStart"),xn(bn,"onTransitionCancel"),xn(Sn,"onTransitionEnd"),Je("onMouseEnter",["mouseout","mouseover"]),Je("onMouseLeave",["mouseout","mouseover"]),Je("onPointerEnter",["pointerout","pointerover"]),Je("onPointerLeave",["pointerout","pointerover"]),Ke("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ke("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ke("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ke("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ke("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ke("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Pu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Bu=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Pu));function Nu(e,t){t=0!==(4&t);for(var i=0;i<e.length;i++){var n=e[i],r=n.event;n=n.listeners;e:{var o=void 0;if(t)for(var a=n.length-1;0<=a;a--){var s=n[a],l=s.instance,c=s.currentTarget;if(s=s.listener,l!==o&&r.isPropagationStopped())break e;o=s,r.currentTarget=c;try{o(r)}catch(u){ys(u)}r.currentTarget=null,o=l}else for(a=0;a<n.length;a++){if(l=(s=n[a]).instance,c=s.currentTarget,s=s.listener,l!==o&&r.isPropagationStopped())break e;o=s,r.currentTarget=c;try{o(r)}catch(u){ys(u)}r.currentTarget=null,o=l}}}}function ju(e,t){var i=t[Be];void 0===i&&(i=t[Be]=new Set);var n=e+"__bubble";i.has(n)||(Gu(t,e,2,!1),i.add(n))}function Uu(e,t,i){var n=0;t&&(n|=4),Gu(i,e,n,t)}var Vu="_reactListening"+Math.random().toString(36).slice(2);function Wu(e){if(!e[Vu]){e[Vu]=!0,qe.forEach((function(t){"selectionchange"!==t&&(Bu.has(t)||Uu(t,!1,e),Uu(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Vu]||(t[Vu]=!0,Uu("selectionchange",!1,t))}}function Gu(e,t,i,n){switch(hd(t)){case 2:var r=od;break;case 8:r=ad;break;default:r=sd}i=r.bind(null,t,i,e),r=void 0,!Vt||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),n?void 0!==r?e.addEventListener(t,i,{capture:!0,passive:r}):e.addEventListener(t,i,!0):void 0!==r?e.addEventListener(t,i,{passive:r}):e.addEventListener(t,i,!1)}function zu(e,t,i,n,r){var o=n;if(0===(1&t)&&0===(2&t)&&null!==n)e:for(;;){if(null===n)return;var a=n.tag;if(3===a||4===a){var s=n.stateNode.containerInfo;if(s===r)break;if(4===a)for(a=n.return;null!==a;){var c=a.tag;if((3===c||4===c)&&a.stateNode.containerInfo===r)return;a=a.return}for(;null!==s;){if(null===(a=Ge(s)))return;if(5===(c=a.tag)||6===c||26===c||27===c){n=o=a;continue e}s=s.parentNode}}n=n.return}Nt((function(){var n=o,r=Lt(i),a=[];e:{var s=wn.get(e);if(void 0!==s){var c=ti,u=e;switch(e){case"keypress":if(0===Xt(i))break e;case"keydown":case"keyup":c=mi;break;case"focusin":u="focus",c=si;break;case"focusout":u="blur",c=si;break;case"beforeblur":case"afterblur":c=si;break;case"click":if(2===i.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=oi;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=ai;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=vi;break;case pn:case mn:case _n:c=li;break;case Sn:c=yi;break;case"scroll":case"scrollend":c=ni;break;case"wheel":c=bi;break;case"copy":case"cut":case"paste":c=ci;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=_i;break;case"toggle":case"beforetoggle":c=Si}var h=0!==(4&t),d=!h&&("scroll"===e||"scrollend"===e),f=h?null!==s?s+"Capture":null:s;h=[];for(var g,p=n;null!==p;){var m=p;if(g=m.stateNode,5!==(m=m.tag)&&26!==m&&27!==m||null===g||null===f||null!=(m=jt(p,f))&&h.push(Hu(p,m,g)),d)break;p=p.return}0<h.length&&(s=new c(s,u,null,i,r),a.push({event:s,listeners:h}))}}if(0===(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||i===kt||!(u=i.relatedTarget||i.fromElement)||!Ge(u)&&!u[Pe])&&(c||s)&&(s=r.window===r?r:(s=r.ownerDocument)?s.defaultView||s.parentWindow:window,c?(c=n,null!==(u=(u=i.relatedTarget||i.toElement)?Ge(u):null)&&(d=l(u),h=u.tag,u!==d||5!==h&&27!==h&&6!==h)&&(u=null)):(c=null,u=n),c!==u)){if(h=oi,m="onMouseLeave",f="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(h=_i,m="onPointerLeave",f="onPointerEnter",p="pointer"),d=null==c?s:He(c),g=null==u?s:He(u),(s=new h(m,p+"leave",c,i,r)).target=d,s.relatedTarget=g,m=null,Ge(r)===n&&((h=new h(f,p+"enter",u,i,r)).target=g,h.relatedTarget=d,m=h),d=m,c&&u)e:{for(f=u,p=0,g=h=c;g;g=Xu(g))p++;for(g=0,m=f;m;m=Xu(m))g++;for(;0<p-g;)h=Xu(h),p--;for(;0<g-p;)f=Xu(f),g--;for(;p--;){if(h===f||null!==f&&h===f.alternate)break e;h=Xu(h),f=Xu(f)}h=null}else h=null;null!==c&&qu(a,s,c,h,!1),null!==u&&null!==d&&qu(a,d,u,h,!0)}if("select"===(c=(s=n?He(n):window).nodeName&&s.nodeName.toLowerCase())||"input"===c&&"file"===s.type)var _=ji;else if(Li(s))if(Ui)_=Zi;else{_=Xi;var v=Yi}else!(c=s.nodeName)||"input"!==c.toLowerCase()||"checkbox"!==s.type&&"radio"!==s.type?n&&Ot(n.elementType)&&(_=ji):_=qi;switch(_&&(_=_(e,n))?Mi(a,_,i,r):(v&&v(e,s,n),"focusout"===e&&n&&"number"===s.type&&null!=n.memoizedProps.value&&bt(s,"number",s.value)),v=n?He(n):window,e){case"focusin":(Li(v)||"true"===v.contentEditable)&&(on=v,an=n,sn=null);break;case"focusout":sn=an=on=null;break;case"mousedown":ln=!0;break;case"contextmenu":case"mouseup":case"dragend":ln=!1,cn(a,i,r);break;case"selectionchange":if(rn)break;case"keydown":case"keyup":cn(a,i,r)}var y;if(Ci)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Di?Ai(e,i)&&(b="onCompositionEnd"):"keydown"===e&&229===i.keyCode&&(b="onCompositionStart");b&&(Ei&&"ko"!==i.locale&&(Di||"onCompositionStart"!==b?"onCompositionEnd"===b&&Di&&(y=Yt()):(zt="value"in(Gt=r)?Gt.value:Gt.textContent,Di=!0)),0<(v=Yu(n,b)).length&&(b=new ui(b,e,null,i,r),a.push({event:b,listeners:v}),y?b.data=y:null!==(y=Ri(i))&&(b.data=y))),(y=Ti?function(e,t){switch(e){case"compositionend":return Ri(t);case"keypress":return 32!==t.which?null:(Oi=!0,Ii);case"textInput":return(e=t.data)===Ii&&Oi?null:e;default:return null}}(e,i):function(e,t){if(Di)return"compositionend"===e||!Ci&&Ai(e,t)?(e=Yt(),Ht=zt=Gt=null,Di=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Ei&&"ko"!==t.locale?null:t.data}}(e,i))&&(0<(b=Yu(n,"onBeforeInput")).length&&(v=new ui("onBeforeInput","beforeinput",null,i,r),a.push({event:v,listeners:b}),v.data=y)),function(e,t,i,n,r){if("submit"===t&&i&&i.stateNode===r){var o=ku((r[Fe]||null).action),a=n.submitter;a&&null!==(t=(t=a[Fe]||null)?ku(t.formAction):a.getAttribute("formAction"))&&(o=t,a=null);var s=new ti("action","action",null,n,r);e.push({event:s,listeners:[{instance:null,listener:function(){if(n.defaultPrevented){if(0!==Cu){var e=a?Lu(r,a):new FormData(r);La(i,{pending:!0,data:e,method:r.method,action:o},null,e)}}else"function"===typeof o&&(s.preventDefault(),e=a?Lu(r,a):new FormData(r),La(i,{pending:!0,data:e,method:r.method,action:o},o,e))},currentTarget:r}]})}}(a,e,n,i,r)}Nu(a,t)}))}function Hu(e,t,i){return{instance:e,listener:t,currentTarget:i}}function Yu(e,t){for(var i=t+"Capture",n=[];null!==e;){var r=e,o=r.stateNode;if(5!==(r=r.tag)&&26!==r&&27!==r||null===o||(null!=(r=jt(e,i))&&n.unshift(Hu(e,r,o)),null!=(r=jt(e,t))&&n.push(Hu(e,r,o))),3===e.tag)return n;e=e.return}return[]}function Xu(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag&&27!==e.tag);return e||null}function qu(e,t,i,n,r){for(var o=t._reactName,a=[];null!==i&&i!==n;){var s=i,l=s.alternate,c=s.stateNode;if(s=s.tag,null!==l&&l===n)break;5!==s&&26!==s&&27!==s||null===c||(l=c,r?null!=(c=jt(i,o))&&a.unshift(Hu(i,c,l)):r||null!=(c=jt(i,o))&&a.push(Hu(i,c,l))),i=i.return}0!==a.length&&e.push({event:t,listeners:a})}var Zu=/\r\n?/g,Ku=/\u0000|\uFFFD/g;function Ju(e){return("string"===typeof e?e:""+e).replace(Zu,"\n").replace(Ku,"")}function Qu(e,t){return t=Ju(t),Ju(e)===t}function $u(){}function eh(e,t,i,n,r,o){switch(i){case"children":"string"===typeof n?"body"===t||"textarea"===t&&""===n||xt(e,n):("number"===typeof n||"bigint"===typeof n)&&"body"!==t&&xt(e,""+n);break;case"className":rt(e,"class",n);break;case"tabIndex":rt(e,"tabindex",n);break;case"dir":case"role":case"viewBox":case"width":case"height":rt(e,i,n);break;case"style":It(e,n,o);break;case"data":if("object"!==t){rt(e,"data",n);break}case"src":case"href":if(""===n&&("a"!==t||"href"!==i)){e.removeAttribute(i);break}if(null==n||"function"===typeof n||"symbol"===typeof n||"boolean"===typeof n){e.removeAttribute(i);break}n=Dt(""+n),e.setAttribute(i,n);break;case"action":case"formAction":if("function"===typeof n){e.setAttribute(i,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}if("function"===typeof o&&("formAction"===i?("input"!==t&&eh(e,t,"name",r.name,r,null),eh(e,t,"formEncType",r.formEncType,r,null),eh(e,t,"formMethod",r.formMethod,r,null),eh(e,t,"formTarget",r.formTarget,r,null)):(eh(e,t,"encType",r.encType,r,null),eh(e,t,"method",r.method,r,null),eh(e,t,"target",r.target,r,null))),null==n||"symbol"===typeof n||"boolean"===typeof n){e.removeAttribute(i);break}n=Dt(""+n),e.setAttribute(i,n);break;case"onClick":null!=n&&(e.onclick=$u);break;case"onScroll":null!=n&&ju("scroll",e);break;case"onScrollEnd":null!=n&&ju("scrollend",e);break;case"dangerouslySetInnerHTML":if(null!=n){if("object"!==typeof n||!("__html"in n))throw Error(a(61));if(null!=(i=n.__html)){if(null!=r.children)throw Error(a(60));e.innerHTML=i}}break;case"multiple":e.multiple=n&&"function"!==typeof n&&"symbol"!==typeof n;break;case"muted":e.muted=n&&"function"!==typeof n&&"symbol"!==typeof n;break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"autoFocus":break;case"xlinkHref":if(null==n||"function"===typeof n||"boolean"===typeof n||"symbol"===typeof n){e.removeAttribute("xlink:href");break}i=Dt(""+n),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",i);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":null!=n&&"function"!==typeof n&&"symbol"!==typeof n?e.setAttribute(i,""+n):e.removeAttribute(i);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":n&&"function"!==typeof n&&"symbol"!==typeof n?e.setAttribute(i,""):e.removeAttribute(i);break;case"capture":case"download":!0===n?e.setAttribute(i,""):!1!==n&&null!=n&&"function"!==typeof n&&"symbol"!==typeof n?e.setAttribute(i,n):e.removeAttribute(i);break;case"cols":case"rows":case"size":case"span":null!=n&&"function"!==typeof n&&"symbol"!==typeof n&&!isNaN(n)&&1<=n?e.setAttribute(i,n):e.removeAttribute(i);break;case"rowSpan":case"start":null==n||"function"===typeof n||"symbol"===typeof n||isNaN(n)?e.removeAttribute(i):e.setAttribute(i,n);break;case"popover":ju("beforetoggle",e),ju("toggle",e),nt(e,"popover",n);break;case"xlinkActuate":ot(e,"http://www.w3.org/1999/xlink","xlink:actuate",n);break;case"xlinkArcrole":ot(e,"http://www.w3.org/1999/xlink","xlink:arcrole",n);break;case"xlinkRole":ot(e,"http://www.w3.org/1999/xlink","xlink:role",n);break;case"xlinkShow":ot(e,"http://www.w3.org/1999/xlink","xlink:show",n);break;case"xlinkTitle":ot(e,"http://www.w3.org/1999/xlink","xlink:title",n);break;case"xlinkType":ot(e,"http://www.w3.org/1999/xlink","xlink:type",n);break;case"xmlBase":ot(e,"http://www.w3.org/XML/1998/namespace","xml:base",n);break;case"xmlLang":ot(e,"http://www.w3.org/XML/1998/namespace","xml:lang",n);break;case"xmlSpace":ot(e,"http://www.w3.org/XML/1998/namespace","xml:space",n);break;case"is":nt(e,"is",n);break;case"innerText":case"textContent":break;default:(!(2<i.length)||"o"!==i[0]&&"O"!==i[0]||"n"!==i[1]&&"N"!==i[1])&&nt(e,i=At.get(i)||i,n)}}function th(e,t,i,n,r,o){switch(i){case"style":It(e,n,o);break;case"dangerouslySetInnerHTML":if(null!=n){if("object"!==typeof n||!("__html"in n))throw Error(a(61));if(null!=(i=n.__html)){if(null!=r.children)throw Error(a(60));e.innerHTML=i}}break;case"children":"string"===typeof n?xt(e,n):("number"===typeof n||"bigint"===typeof n)&&xt(e,""+n);break;case"onScroll":null!=n&&ju("scroll",e);break;case"onScrollEnd":null!=n&&ju("scrollend",e);break;case"onClick":null!=n&&(e.onclick=$u);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":case"innerText":case"textContent":break;default:Ze.hasOwnProperty(i)||("o"!==i[0]||"n"!==i[1]||(r=i.endsWith("Capture"),t=i.slice(2,r?i.length-7:void 0),"function"===typeof(o=null!=(o=e[Fe]||null)?o[i]:null)&&e.removeEventListener(t,o,r),"function"!==typeof n)?i in e?e[i]=n:!0===n?e.setAttribute(i,""):nt(e,i,n):("function"!==typeof o&&null!==o&&(i in e?e[i]=null:e.hasAttribute(i)&&e.removeAttribute(i)),e.addEventListener(t,n,r)))}}function ih(e,t,i){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":ju("error",e),ju("load",e);var n,r=!1,o=!1;for(n in i)if(i.hasOwnProperty(n)){var s=i[n];if(null!=s)switch(n){case"src":r=!0;break;case"srcSet":o=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(a(137,t));default:eh(e,t,n,s,i,null)}}return o&&eh(e,t,"srcSet",i.srcSet,i,null),void(r&&eh(e,t,"src",i.src,i,null));case"input":ju("invalid",e);var l=n=s=o=null,c=null,u=null;for(r in i)if(i.hasOwnProperty(r)){var h=i[r];if(null!=h)switch(r){case"name":o=h;break;case"type":s=h;break;case"checked":c=h;break;case"defaultChecked":u=h;break;case"value":n=h;break;case"defaultValue":l=h;break;case"children":case"dangerouslySetInnerHTML":if(null!=h)throw Error(a(137,t));break;default:eh(e,t,r,h,i,null)}}return yt(e,n,l,c,u,s,o,!1),void ft(e);case"select":for(o in ju("invalid",e),r=s=n=null,i)if(i.hasOwnProperty(o)&&null!=(l=i[o]))switch(o){case"value":n=l;break;case"defaultValue":s=l;break;case"multiple":r=l;default:eh(e,t,o,l,i,null)}return t=n,i=s,e.multiple=!!r,void(null!=t?St(e,!!r,t,!1):null!=i&&St(e,!!r,i,!0));case"textarea":for(s in ju("invalid",e),n=o=r=null,i)if(i.hasOwnProperty(s)&&null!=(l=i[s]))switch(s){case"value":r=l;break;case"defaultValue":o=l;break;case"children":n=l;break;case"dangerouslySetInnerHTML":if(null!=l)throw Error(a(91));break;default:eh(e,t,s,l,i,null)}return Ct(e,r,o,n),void ft(e);case"option":for(c in i)if(i.hasOwnProperty(c)&&null!=(r=i[c]))if("selected"===c)e.selected=r&&"function"!==typeof r&&"symbol"!==typeof r;else eh(e,t,c,r,i,null);return;case"dialog":ju("beforetoggle",e),ju("toggle",e),ju("cancel",e),ju("close",e);break;case"iframe":case"object":ju("load",e);break;case"video":case"audio":for(r=0;r<Pu.length;r++)ju(Pu[r],e);break;case"image":ju("error",e),ju("load",e);break;case"details":ju("toggle",e);break;case"embed":case"source":case"link":ju("error",e),ju("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(u in i)if(i.hasOwnProperty(u)&&null!=(r=i[u]))switch(u){case"children":case"dangerouslySetInnerHTML":throw Error(a(137,t));default:eh(e,t,u,r,i,null)}return;default:if(Ot(t)){for(h in i)i.hasOwnProperty(h)&&(void 0!==(r=i[h])&&th(e,t,h,r,i,void 0));return}}for(l in i)i.hasOwnProperty(l)&&(null!=(r=i[l])&&eh(e,t,l,r,i,null))}var nh=null,rh=null;function oh(e){return 9===e.nodeType?e:e.ownerDocument}function ah(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function sh(e,t){if(0===e)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return 1===e&&"foreignObject"===t?0:e}function lh(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"bigint"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ch=null;var uh="function"===typeof setTimeout?setTimeout:void 0,hh="function"===typeof clearTimeout?clearTimeout:void 0,dh="function"===typeof Promise?Promise:void 0,fh="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof dh?function(e){return dh.resolve(null).then(e).catch(gh)}:uh;function gh(e){setTimeout((function(){throw e}))}function ph(e){return"head"===e}function mh(e,t){var i=t,n=0,r=0;do{var o=i.nextSibling;if(e.removeChild(i),o&&8===o.nodeType)if("/$"===(i=o.data)){if(0<n&&8>n){i=n;var a=e.ownerDocument;if(1&i&&Ch(a.documentElement),2&i&&Ch(a.body),4&i)for(Ch(i=a.head),a=i.firstChild;a;){var s=a.nextSibling,l=a.nodeName;a[Ve]||"SCRIPT"===l||"STYLE"===l||"LINK"===l&&"stylesheet"===a.rel.toLowerCase()||i.removeChild(a),a=s}}if(0===r)return e.removeChild(o),void Ad(t);r--}else"$"===i||"$?"===i||"$!"===i?r++:n=i.charCodeAt(0)-48;else n=0;i=o}while(i);Ad(t)}function _h(e){var t=e.firstChild;for(t&&10===t.nodeType&&(t=t.nextSibling);t;){var i=t;switch(t=t.nextSibling,i.nodeName){case"HTML":case"HEAD":case"BODY":_h(i),We(i);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if("stylesheet"===i.rel.toLowerCase())continue}e.removeChild(i)}}function vh(e){return"$!"===e.data||"$?"===e.data&&"complete"===e.ownerDocument.readyState}function yh(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t||"F!"===t||"F"===t)break;if("/$"===t)return null}}return e}var bh=null;function Sh(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var i=e.data;if("$"===i||"$!"===i||"$?"===i){if(0===t)return e;t--}else"/$"===i&&t++}e=e.previousSibling}return null}function wh(e,t,i){switch(t=oh(i),e){case"html":if(!(e=t.documentElement))throw Error(a(452));return e;case"head":if(!(e=t.head))throw Error(a(453));return e;case"body":if(!(e=t.body))throw Error(a(454));return e;default:throw Error(a(451))}}function Ch(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);We(e)}var xh=new Map,Th=new Set;function Eh(e){return"function"===typeof e.getRootNode?e.getRootNode():9===e.nodeType?e:e.ownerDocument}var Ih=P.d;P.d={f:function(){var e=Ih.f(),t=Gc();return e||t},r:function(e){var t=ze(e);null!==t&&5===t.tag&&"form"===t.type?Fa(t):Ih.r(e)},D:function(e){Ih.D(e),Ah("dns-prefetch",e,null)},C:function(e,t){Ih.C(e,t),Ah("preconnect",e,t)},L:function(e,t,i){Ih.L(e,t,i);var n=Oh;if(n&&e&&t){var r='link[rel="preload"][as="'+_t(t)+'"]';"image"===t&&i&&i.imageSrcSet?(r+='[imagesrcset="'+_t(i.imageSrcSet)+'"]',"string"===typeof i.imageSizes&&(r+='[imagesizes="'+_t(i.imageSizes)+'"]')):r+='[href="'+_t(e)+'"]';var o=r;switch(t){case"style":o=Dh(e);break;case"script":o=Mh(e)}xh.has(o)||(e=d({rel:"preload",href:"image"===t&&i&&i.imageSrcSet?void 0:e,as:t},i),xh.set(o,e),null!==n.querySelector(r)||"style"===t&&n.querySelector(kh(o))||"script"===t&&n.querySelector(Fh(o))||(ih(t=n.createElement("link"),"link",e),Xe(t),n.head.appendChild(t)))}},m:function(e,t){Ih.m(e,t);var i=Oh;if(i&&e){var n=t&&"string"===typeof t.as?t.as:"script",r='link[rel="modulepreload"][as="'+_t(n)+'"][href="'+_t(e)+'"]',o=r;switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":o=Mh(e)}if(!xh.has(o)&&(e=d({rel:"modulepreload",href:e},t),xh.set(o,e),null===i.querySelector(r))){switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(i.querySelector(Fh(o)))return}ih(n=i.createElement("link"),"link",e),Xe(n),i.head.appendChild(n)}}},X:function(e,t){Ih.X(e,t);var i=Oh;if(i&&e){var n=Ye(i).hoistableScripts,r=Mh(e),o=n.get(r);o||((o=i.querySelector(Fh(r)))||(e=d({src:e,async:!0},t),(t=xh.get(r))&&jh(e,t),Xe(o=i.createElement("script")),ih(o,"link",e),i.head.appendChild(o)),o={type:"script",instance:o,count:1,state:null},n.set(r,o))}},S:function(e,t,i){Ih.S(e,t,i);var n=Oh;if(n&&e){var r=Ye(n).hoistableStyles,o=Dh(e);t=t||"default";var a=r.get(o);if(!a){var s={loading:0,preload:null};if(a=n.querySelector(kh(o)))s.loading=5;else{e=d({rel:"stylesheet",href:e,"data-precedence":t},i),(i=xh.get(o))&&Nh(e,i);var l=a=n.createElement("link");Xe(l),ih(l,"link",e),l._p=new Promise((function(e,t){l.onload=e,l.onerror=t})),l.addEventListener("load",(function(){s.loading|=1})),l.addEventListener("error",(function(){s.loading|=2})),s.loading|=4,Bh(a,t,n)}a={type:"stylesheet",instance:a,count:1,state:s},r.set(o,a)}}},M:function(e,t){Ih.M(e,t);var i=Oh;if(i&&e){var n=Ye(i).hoistableScripts,r=Mh(e),o=n.get(r);o||((o=i.querySelector(Fh(r)))||(e=d({src:e,async:!0,type:"module"},t),(t=xh.get(r))&&jh(e,t),Xe(o=i.createElement("script")),ih(o,"link",e),i.head.appendChild(o)),o={type:"script",instance:o,count:1,state:null},n.set(r,o))}}};var Oh="undefined"===typeof document?null:document;function Ah(e,t,i){var n=Oh;if(n&&"string"===typeof t&&t){var r=_t(t);r='link[rel="'+e+'"][href="'+r+'"]',"string"===typeof i&&(r+='[crossorigin="'+i+'"]'),Th.has(r)||(Th.add(r),e={rel:e,crossOrigin:i,href:t},null===n.querySelector(r)&&(ih(t=n.createElement("link"),"link",e),Xe(t),n.head.appendChild(t)))}}function Rh(e,t,i,n){var r,o,s,l,c=(c=Y.current)?Eh(c):null;if(!c)throw Error(a(446));switch(e){case"meta":case"title":return null;case"style":return"string"===typeof i.precedence&&"string"===typeof i.href?(t=Dh(i.href),(n=(i=Ye(c).hoistableStyles).get(t))||(n={type:"style",instance:null,count:0,state:null},i.set(t,n)),n):{type:"void",instance:null,count:0,state:null};case"link":if("stylesheet"===i.rel&&"string"===typeof i.href&&"string"===typeof i.precedence){e=Dh(i.href);var u=Ye(c).hoistableStyles,h=u.get(e);if(h||(c=c.ownerDocument||c,h={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},u.set(e,h),(u=c.querySelector(kh(e)))&&!u._p&&(h.instance=u,h.state.loading=5),xh.has(e)||(i={rel:"preload",as:"style",href:i.href,crossOrigin:i.crossOrigin,integrity:i.integrity,media:i.media,hrefLang:i.hrefLang,referrerPolicy:i.referrerPolicy},xh.set(e,i),u||(r=c,o=e,s=i,l=h.state,r.querySelector('link[rel="preload"][as="style"]['+o+"]")?l.loading=1:(o=r.createElement("link"),l.preload=o,o.addEventListener("load",(function(){return l.loading|=1})),o.addEventListener("error",(function(){return l.loading|=2})),ih(o,"link",s),Xe(o),r.head.appendChild(o))))),t&&null===n)throw Error(a(528,""));return h}if(t&&null!==n)throw Error(a(529,""));return null;case"script":return t=i.async,"string"===typeof(i=i.src)&&t&&"function"!==typeof t&&"symbol"!==typeof t?(t=Mh(i),(n=(i=Ye(c).hoistableScripts).get(t))||(n={type:"script",instance:null,count:0,state:null},i.set(t,n)),n):{type:"void",instance:null,count:0,state:null};default:throw Error(a(444,e))}}function Dh(e){return'href="'+_t(e)+'"'}function kh(e){return'link[rel="stylesheet"]['+e+"]"}function Lh(e){return d({},e,{"data-precedence":e.precedence,precedence:null})}function Mh(e){return'[src="'+_t(e)+'"]'}function Fh(e){return"script[async]"+e}function Ph(e,t,i){if(t.count++,null===t.instance)switch(t.type){case"style":var n=e.querySelector('style[data-href~="'+_t(i.href)+'"]');if(n)return t.instance=n,Xe(n),n;var r=d({},i,{"data-href":i.href,"data-precedence":i.precedence,href:null,precedence:null});return Xe(n=(e.ownerDocument||e).createElement("style")),ih(n,"style",r),Bh(n,i.precedence,e),t.instance=n;case"stylesheet":r=Dh(i.href);var o=e.querySelector(kh(r));if(o)return t.state.loading|=4,t.instance=o,Xe(o),o;n=Lh(i),(r=xh.get(r))&&Nh(n,r),Xe(o=(e.ownerDocument||e).createElement("link"));var s=o;return s._p=new Promise((function(e,t){s.onload=e,s.onerror=t})),ih(o,"link",n),t.state.loading|=4,Bh(o,i.precedence,e),t.instance=o;case"script":return o=Mh(i.src),(r=e.querySelector(Fh(o)))?(t.instance=r,Xe(r),r):(n=i,(r=xh.get(o))&&jh(n=d({},i),r),Xe(r=(e=e.ownerDocument||e).createElement("script")),ih(r,"link",n),e.head.appendChild(r),t.instance=r);case"void":return null;default:throw Error(a(443,t.type))}else"stylesheet"===t.type&&0===(4&t.state.loading)&&(n=t.instance,t.state.loading|=4,Bh(n,i.precedence,e));return t.instance}function Bh(e,t,i){for(var n=i.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),r=n.length?n[n.length-1]:null,o=r,a=0;a<n.length;a++){var s=n[a];if(s.dataset.precedence===t)o=s;else if(o!==r)break}o?o.parentNode.insertBefore(e,o.nextSibling):(t=9===i.nodeType?i.head:i).insertBefore(e,t.firstChild)}function Nh(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.title&&(e.title=t.title)}function jh(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.integrity&&(e.integrity=t.integrity)}var Uh=null;function Vh(e,t,i){if(null===Uh){var n=new Map,r=Uh=new Map;r.set(i,n)}else(n=(r=Uh).get(i))||(n=new Map,r.set(i,n));if(n.has(e))return n;for(n.set(e,null),i=i.getElementsByTagName(e),r=0;r<i.length;r++){var o=i[r];if(!(o[Ve]||o[Me]||"link"===e&&"stylesheet"===o.getAttribute("rel"))&&"http://www.w3.org/2000/svg"!==o.namespaceURI){var a=o.getAttribute(t)||"";a=e+a;var s=n.get(a);s?s.push(o):n.set(a,[o])}}return n}function Wh(e,t,i){(e=e.ownerDocument||e).head.insertBefore(i,"title"===t?e.querySelector("head > title"):null)}function Gh(e){return"stylesheet"!==e.type||0!==(3&e.state.loading)}var zh=null;function Hh(){}function Yh(){if(this.count--,0===this.count)if(this.stylesheets)qh(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}var Xh=null;function qh(e,t){e.stylesheets=null,null!==e.unsuspend&&(e.count++,Xh=new Map,t.forEach(Zh,e),Xh=null,Yh.call(e))}function Zh(e,t){if(!(4&t.state.loading)){var i=Xh.get(e);if(i)var n=i.get(null);else{i=new Map,Xh.set(e,i);for(var r=e.querySelectorAll("link[data-precedence],style[data-precedence]"),o=0;o<r.length;o++){var a=r[o];"LINK"!==a.nodeName&&"not all"===a.getAttribute("media")||(i.set(a.dataset.precedence,a),n=a)}n&&i.set(null,n)}a=(r=t.instance).getAttribute("data-precedence"),(o=i.get(a)||n)===n&&i.set(null,r),i.set(a,r),this.count++,n=Yh.bind(this),r.addEventListener("load",n),r.addEventListener("error",n),o?o.parentNode.insertBefore(r,o.nextSibling):(e=9===e.nodeType?e.head:e).insertBefore(r,e.firstChild),t.state.loading|=4}}var Kh={$$typeof:w,Provider:null,Consumer:null,_currentValue:B,_currentValue2:B,_threadCount:0};function Jh(e,t,i,n,r,o,a,s){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ee(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ee(0),this.hiddenUpdates=Ee(null),this.identifierPrefix=n,this.onUncaughtError=r,this.onCaughtError=o,this.onRecoverableError=a,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=s,this.incompleteTransitions=new Map}function Qh(e,t,i,n,r,o,a,s,l,c,u,h){return e=new Jh(e,t,i,a,s,l,c,h),t=1,!0===o&&(t|=24),o=Nn(3,null,null,t),e.current=o,o.stateNode=e,(t=Fr()).refCount++,e.pooledCache=t,t.refCount++,o.memoizedState={element:n,isDehydrated:i,cache:t},ro(o),e}function $h(e){return e?e=Pn:Pn}function ed(e,t,i,n,r,o){r=$h(r),null===n.context?n.context=r:n.pendingContext=r,(n=ao(t)).payload={element:i},null!==(o=void 0===o?null:o)&&(n.callback=o),null!==(i=so(e,n,t))&&(Nc(i,0,t),lo(i,e,t))}function td(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var i=e.retryLane;e.retryLane=0!==i&&i<t?i:t}}function id(e,t){td(e,t),(e=e.alternate)&&td(e,t)}function nd(e){if(13===e.tag){var t=Ln(e,67108864);null!==t&&Nc(t,0,67108864),id(e,67108864)}}var rd=!0;function od(e,t,i,n){var r=F.T;F.T=null;var o=P.p;try{P.p=2,sd(e,t,i,n)}finally{P.p=o,F.T=r}}function ad(e,t,i,n){var r=F.T;F.T=null;var o=P.p;try{P.p=8,sd(e,t,i,n)}finally{P.p=o,F.T=r}}function sd(e,t,i,n){if(rd){var r=ld(n);if(null===r)zu(e,t,n,cd,i),bd(e,n);else if(function(e,t,i,n,r){switch(t){case"focusin":return fd=Sd(fd,e,t,i,n,r),!0;case"dragenter":return gd=Sd(gd,e,t,i,n,r),!0;case"mouseover":return pd=Sd(pd,e,t,i,n,r),!0;case"pointerover":var o=r.pointerId;return md.set(o,Sd(md.get(o)||null,e,t,i,n,r)),!0;case"gotpointercapture":return o=r.pointerId,_d.set(o,Sd(_d.get(o)||null,e,t,i,n,r)),!0}return!1}(r,e,t,i,n))n.stopPropagation();else if(bd(e,n),4&t&&-1<yd.indexOf(e)){for(;null!==r;){var o=ze(r);if(null!==o)switch(o.tag){case 3:if((o=o.stateNode).current.memoizedState.isDehydrated){var a=be(o.pendingLanes);if(0!==a){var s=o;for(s.pendingLanes|=2,s.entangledLanes|=2;a;){var l=1<<31-pe(a);s.entanglements[1]|=l,a&=~l}xu(o),0===(6&rc)&&(xc=ne()+500,Tu(0,!1))}}break;case 13:null!==(s=Ln(o,2))&&Nc(s,0,2),Gc(),id(o,2)}if(null===(o=ld(n))&&zu(e,t,n,cd,i),o===r)break;r=o}null!==r&&n.stopPropagation()}else zu(e,t,n,null,i)}}function ld(e){return ud(e=Lt(e))}var cd=null;function ud(e){if(cd=null,null!==(e=Ge(e))){var t=l(e);if(null===t)e=null;else{var i=t.tag;if(13===i){if(null!==(e=c(t)))return e;e=null}else if(3===i){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return cd=e,null}function hd(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(re()){case oe:return 2;case ae:return 8;case se:case le:return 32;case ce:return 268435456;default:return 32}default:return 32}}var dd=!1,fd=null,gd=null,pd=null,md=new Map,_d=new Map,vd=[],yd="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function bd(e,t){switch(e){case"focusin":case"focusout":fd=null;break;case"dragenter":case"dragleave":gd=null;break;case"mouseover":case"mouseout":pd=null;break;case"pointerover":case"pointerout":md.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":_d.delete(t.pointerId)}}function Sd(e,t,i,n,r,o){return null===e||e.nativeEvent!==o?(e={blockedOn:t,domEventName:i,eventSystemFlags:n,nativeEvent:o,targetContainers:[r]},null!==t&&(null!==(t=ze(t))&&nd(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function wd(e){var t=Ge(e.target);if(null!==t){var i=l(t);if(null!==i)if(13===(t=i.tag)){if(null!==(t=c(i)))return e.blockedOn=t,void function(e,t){var i=P.p;try{return P.p=e,t()}finally{P.p=i}}(e.priority,(function(){if(13===i.tag){var e=Pc();e=Re(e);var t=Ln(i,e);null!==t&&Nc(t,0,e),id(i,e)}}))}else if(3===t&&i.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===i.tag?i.stateNode.containerInfo:null)}e.blockedOn=null}function Cd(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var i=ld(e.nativeEvent);if(null!==i)return null!==(t=ze(i))&&nd(t),e.blockedOn=i,!1;var n=new(i=e.nativeEvent).constructor(i.type,i);kt=n,i.target.dispatchEvent(n),kt=null,t.shift()}return!0}function xd(e,t,i){Cd(e)&&i.delete(t)}function Td(){dd=!1,null!==fd&&Cd(fd)&&(fd=null),null!==gd&&Cd(gd)&&(gd=null),null!==pd&&Cd(pd)&&(pd=null),md.forEach(xd),_d.forEach(xd)}function Ed(e,t){e.blockedOn===t&&(e.blockedOn=null,dd||(dd=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,Td)))}var Id=null;function Od(e){Id!==e&&(Id=e,n.unstable_scheduleCallback(n.unstable_NormalPriority,(function(){Id===e&&(Id=null);for(var t=0;t<e.length;t+=3){var i=e[t],n=e[t+1],r=e[t+2];if("function"!==typeof n){if(null===ud(n||i))continue;break}var o=ze(i);null!==o&&(e.splice(t,3),t-=3,La(o,{pending:!0,data:r,method:i.method,action:n},n,r))}})))}function Ad(e){function t(t){return Ed(t,e)}null!==fd&&Ed(fd,e),null!==gd&&Ed(gd,e),null!==pd&&Ed(pd,e),md.forEach(t),_d.forEach(t);for(var i=0;i<vd.length;i++){var n=vd[i];n.blockedOn===e&&(n.blockedOn=null)}for(;0<vd.length&&null===(i=vd[0]).blockedOn;)wd(i),null===i.blockedOn&&vd.shift();if(null!=(i=(e.ownerDocument||e).$$reactFormReplay))for(n=0;n<i.length;n+=3){var r=i[n],o=i[n+1],a=r[Fe]||null;if("function"===typeof o)a||Od(i);else if(a){var s=null;if(o&&o.hasAttribute("formAction")){if(r=o,a=o[Fe]||null)s=a.formAction;else if(null!==ud(r))continue}else s=a.action;"function"===typeof s?i[n+1]=s:(i.splice(n,3),n-=3),Od(i)}}}function Rd(e){this._internalRoot=e}function Dd(e){this._internalRoot=e}Dd.prototype.render=Rd.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(a(409));ed(t.current,Pc(),e,t,null,null)},Dd.prototype.unmount=Rd.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;ed(e.current,2,null,e,null,null),Gc(),t[Pe]=null}},Dd.prototype.unstable_scheduleHydration=function(e){if(e){var t=ke();e={blockedOn:null,target:e,priority:t};for(var i=0;i<vd.length&&0!==t&&t<vd[i].priority;i++);vd.splice(i,0,e),0===i&&wd(e)}};var kd=r.version;if("19.1.0"!==kd)throw Error(a(527,kd,"19.1.0"));P.findDOMNode=function(e){var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}return e=function(e){var t=e.alternate;if(!t){if(null===(t=l(e)))throw Error(a(188));return t!==e?null:e}for(var i=e,n=t;;){var r=i.return;if(null===r)break;var o=r.alternate;if(null===o){if(null!==(n=r.return)){i=n;continue}break}if(r.child===o.child){for(o=r.child;o;){if(o===i)return u(r),e;if(o===n)return u(r),t;o=o.sibling}throw Error(a(188))}if(i.return!==n.return)i=r,n=o;else{for(var s=!1,c=r.child;c;){if(c===i){s=!0,i=r,n=o;break}if(c===n){s=!0,n=r,i=o;break}c=c.sibling}if(!s){for(c=o.child;c;){if(c===i){s=!0,i=o,n=r;break}if(c===n){s=!0,n=o,i=r;break}c=c.sibling}if(!s)throw Error(a(189))}}if(i.alternate!==n)throw Error(a(190))}if(3!==i.tag)throw Error(a(188));return i.stateNode.current===i?e:t}(t),e=null===(e=null!==e?h(e):null)?null:e.stateNode};var Ld={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:F,reconcilerVersion:"19.1.0"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var Md=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Md.isDisabled&&Md.supportsFiber)try{de=Md.inject(Ld),fe=Md}catch(Fd){}}t.createRoot=function(e,t){if(!s(e))throw Error(a(299));var i=!1,n="",r=bs,o=Ss,l=ws;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(i=!0),void 0!==t.identifierPrefix&&(n=t.identifierPrefix),void 0!==t.onUncaughtError&&(r=t.onUncaughtError),void 0!==t.onCaughtError&&(o=t.onCaughtError),void 0!==t.onRecoverableError&&(l=t.onRecoverableError),void 0!==t.unstable_transitionCallbacks&&t.unstable_transitionCallbacks),t=Qh(e,1,!1,null,0,i,n,r,o,l,0,null),e[Pe]=t.current,Wu(e),new Rd(t)},t.hydrateRoot=function(e,t,i){if(!s(e))throw Error(a(299));var n=!1,r="",o=bs,l=Ss,c=ws,u=null;return null!==i&&void 0!==i&&(!0===i.unstable_strictMode&&(n=!0),void 0!==i.identifierPrefix&&(r=i.identifierPrefix),void 0!==i.onUncaughtError&&(o=i.onUncaughtError),void 0!==i.onCaughtError&&(l=i.onCaughtError),void 0!==i.onRecoverableError&&(c=i.onRecoverableError),void 0!==i.unstable_transitionCallbacks&&i.unstable_transitionCallbacks,void 0!==i.formState&&(u=i.formState)),(t=Qh(e,1,!0,t,0,n,r,o,l,c,0,u)).context=$h(null),i=t.current,(r=ao(n=Re(n=Pc()))).callback=null,so(i,r,n),i=n,t.current.lanes=i,Ie(t,i),xu(t),e[Pe]=t.current,Wu(e),new Dd(t)},t.version="19.1.0"},119:(e,t,i)=>{!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=i(863)},340:(e,t,i)=>{e.exports=i(487)},352:(e,t,i)=>{!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=i(85)},414:(e,t,i)=>{e.exports=i(916)},487:(e,t)=>{function i(e,t){var i=e.length;e.push(t);e:for(;0<i;){var n=i-1>>>1,r=e[n];if(!(0<o(r,t)))break e;e[n]=t,e[i]=r,i=n}}function n(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],i=e.pop();if(i!==t){e[0]=i;e:for(var n=0,r=e.length,a=r>>>1;n<a;){var s=2*(n+1)-1,l=e[s],c=s+1,u=e[c];if(0>o(l,i))c<r&&0>o(u,l)?(e[n]=u,e[c]=i,n=c):(e[n]=l,e[s]=i,n=s);else{if(!(c<r&&0>o(u,i)))break e;e[n]=u,e[c]=i,n=c}}}return t}function o(e,t){var i=e.sortIndex-t.sortIndex;return 0!==i?i:e.id-t.id}if(t.unstable_now=void 0,"object"===typeof performance&&"function"===typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var s=Date,l=s.now();t.unstable_now=function(){return s.now()-l}}var c=[],u=[],h=1,d=null,f=3,g=!1,p=!1,m=!1,_=!1,v="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function S(e){for(var t=n(u);null!==t;){if(null===t.callback)r(u);else{if(!(t.startTime<=e))break;r(u),t.sortIndex=t.expirationTime,i(c,t)}t=n(u)}}function w(e){if(m=!1,S(e),!p)if(null!==n(c))p=!0,x||(x=!0,C());else{var t=n(u);null!==t&&k(w,t.startTime-e)}}var C,x=!1,T=-1,E=5,I=-1;function O(){return!!_||!(t.unstable_now()-I<E)}function A(){if(_=!1,x){var e=t.unstable_now();I=e;var i=!0;try{e:{p=!1,m&&(m=!1,y(T),T=-1),g=!0;var o=f;try{t:{for(S(e),d=n(c);null!==d&&!(d.expirationTime>e&&O());){var a=d.callback;if("function"===typeof a){d.callback=null,f=d.priorityLevel;var s=a(d.expirationTime<=e);if(e=t.unstable_now(),"function"===typeof s){d.callback=s,S(e),i=!0;break t}d===n(c)&&r(c),S(e)}else r(c);d=n(c)}if(null!==d)i=!0;else{var l=n(u);null!==l&&k(w,l.startTime-e),i=!1}}break e}finally{d=null,f=o,g=!1}i=void 0}}finally{i?C():x=!1}}}if("function"===typeof b)C=function(){b(A)};else if("undefined"!==typeof MessageChannel){var R=new MessageChannel,D=R.port2;R.port1.onmessage=A,C=function(){D.postMessage(null)}}else C=function(){v(A,0)};function k(e,i){T=v((function(){e(t.unstable_now())}),i)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var i=f;f=t;try{return e()}finally{f=i}},t.unstable_requestPaint=function(){_=!0},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var i=f;f=e;try{return t()}finally{f=i}},t.unstable_scheduleCallback=function(e,r,o){var a=t.unstable_now();switch("object"===typeof o&&null!==o?o="number"===typeof(o=o.delay)&&0<o?a+o:a:o=a,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:h++,callback:r,priorityLevel:e,startTime:o,expirationTime:s=o+s,sortIndex:-1},o>a?(e.sortIndex=o,i(u,e),null===n(c)&&e===n(u)&&(m?(y(T),T=-1):m=!0,k(w,o-a))):(e.sortIndex=s,i(c,e),p||g||(p=!0,x||(x=!0,C()))),e},t.unstable_shouldYield=O,t.unstable_wrapCallback=function(e){var t=f;return function(){var i=f;f=t;try{return e.apply(this,arguments)}finally{f=i}}}},863:(e,t,i)=>{var n=i(950);function r(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var i=2;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(){}var a={d:{f:o,r:function(){throw Error(r(522))},D:o,C:o,L:o,m:o,X:o,S:o,M:o},p:0,findDOMNode:null},s=Symbol.for("react.portal");var l=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(e,t){return"font"===e?"":"string"===typeof t?"use-credentials"===t?t:"":void 0}t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=a,t.createPortal=function(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType)throw Error(r(299));return function(e,t,i){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:s,key:null==n?null:""+n,children:e,containerInfo:t,implementation:i}}(e,t,null,i)},t.flushSync=function(e){var t=l.T,i=a.p;try{if(l.T=null,a.p=2,e)return e()}finally{l.T=t,a.p=i,a.d.f()}},t.preconnect=function(e,t){"string"===typeof e&&(t?t="string"===typeof(t=t.crossOrigin)?"use-credentials"===t?t:"":void 0:t=null,a.d.C(e,t))},t.prefetchDNS=function(e){"string"===typeof e&&a.d.D(e)},t.preinit=function(e,t){if("string"===typeof e&&t&&"string"===typeof t.as){var i=t.as,n=c(i,t.crossOrigin),r="string"===typeof t.integrity?t.integrity:void 0,o="string"===typeof t.fetchPriority?t.fetchPriority:void 0;"style"===i?a.d.S(e,"string"===typeof t.precedence?t.precedence:void 0,{crossOrigin:n,integrity:r,fetchPriority:o}):"script"===i&&a.d.X(e,{crossOrigin:n,integrity:r,fetchPriority:o,nonce:"string"===typeof t.nonce?t.nonce:void 0})}},t.preinitModule=function(e,t){if("string"===typeof e)if("object"===typeof t&&null!==t){if(null==t.as||"script"===t.as){var i=c(t.as,t.crossOrigin);a.d.M(e,{crossOrigin:i,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0})}}else null==t&&a.d.M(e)},t.preload=function(e,t){if("string"===typeof e&&"object"===typeof t&&null!==t&&"string"===typeof t.as){var i=t.as,n=c(i,t.crossOrigin);a.d.L(e,i,{crossOrigin:n,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0,type:"string"===typeof t.type?t.type:void 0,fetchPriority:"string"===typeof t.fetchPriority?t.fetchPriority:void 0,referrerPolicy:"string"===typeof t.referrerPolicy?t.referrerPolicy:void 0,imageSrcSet:"string"===typeof t.imageSrcSet?t.imageSrcSet:void 0,imageSizes:"string"===typeof t.imageSizes?t.imageSizes:void 0,media:"string"===typeof t.media?t.media:void 0})}},t.preloadModule=function(e,t){if("string"===typeof e)if(t){var i=c(t.as,t.crossOrigin);a.d.m(e,{as:"string"===typeof t.as&&"script"!==t.as?t.as:void 0,crossOrigin:i,integrity:"string"===typeof t.integrity?t.integrity:void 0})}else a.d.m(e)},t.requestFormReset=function(e){a.d.r(e)},t.unstable_batchedUpdates=function(e,t){return e(t)},t.useFormState=function(e,t,i){return l.H.useFormState(e,t,i)},t.useFormStatus=function(){return l.H.useHostTransitionStatus()},t.version="19.1.0"},916:(e,t)=>{var i=Symbol.for("react.transitional.element");function n(e,t,n){var r=null;if(void 0!==n&&(r=""+n),void 0!==t.key&&(r=""+t.key),"key"in t)for(var o in n={},t)"key"!==o&&(n[o]=t[o]);else n=t;return t=n.ref,{$$typeof:i,type:e,key:r,ref:void 0!==t?t:null,props:n}}Symbol.for("react.fragment"),t.jsx=n,t.jsxs=n},950:(e,t,i)=>{e.exports=i(983)},983:(e,t)=>{var i=Symbol.for("react.transitional.element"),n=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),f=Symbol.iterator;var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},p=Object.assign,m={};function _(e,t,i){this.props=e,this.context=t,this.refs=m,this.updater=i||g}function v(){}function y(e,t,i){this.props=e,this.context=t,this.refs=m,this.updater=i||g}_.prototype.isReactComponent={},_.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},_.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},v.prototype=_.prototype;var b=y.prototype=new v;b.constructor=y,p(b,_.prototype),b.isPureReactComponent=!0;var S=Array.isArray,w={H:null,A:null,T:null,S:null,V:null},C=Object.prototype.hasOwnProperty;function x(e,t,n,r,o,a){return n=a.ref,{$$typeof:i,type:e,key:t,ref:void 0!==n?n:null,props:a}}function T(e){return"object"===typeof e&&null!==e&&e.$$typeof===i}var E=/\/+/g;function I(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function O(){}function A(e,t,r,o,a){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var l,c,u=!1;if(null===e)u=!0;else switch(s){case"bigint":case"string":case"number":u=!0;break;case"object":switch(e.$$typeof){case i:case n:u=!0;break;case d:return A((u=e._init)(e._payload),t,r,o,a)}}if(u)return a=a(e),u=""===o?"."+I(e,0):o,S(a)?(r="",null!=u&&(r=u.replace(E,"$&/")+"/"),A(a,t,r,"",(function(e){return e}))):null!=a&&(T(a)&&(l=a,c=r+(null==a.key||e&&e.key===a.key?"":(""+a.key).replace(E,"$&/")+"/")+u,a=x(l.type,c,void 0,0,0,l.props)),t.push(a)),1;u=0;var h,g=""===o?".":o+":";if(S(e))for(var p=0;p<e.length;p++)u+=A(o=e[p],t,r,s=g+I(o,p),a);else if("function"===typeof(p=null===(h=e)||"object"!==typeof h?null:"function"===typeof(h=f&&h[f]||h["@@iterator"])?h:null))for(e=p.call(e),p=0;!(o=e.next()).done;)u+=A(o=o.value,t,r,s=g+I(o,p++),a);else if("object"===s){if("function"===typeof e.then)return A(function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch("string"===typeof e.status?e.then(O,O):(e.status="pending",e.then((function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)}),(function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)}))),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}(e),t,r,o,a);throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return u}function R(e,t,i){if(null==e)return e;var n=[],r=0;return A(e,n,"","",(function(e){return t.call(i,e,r++)})),n}function D(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var k="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)};function L(){}t.Children={map:R,forEach:function(e,t,i){R(e,(function(){t.apply(this,arguments)}),i)},count:function(e){var t=0;return R(e,(function(){t++})),t},toArray:function(e){return R(e,(function(e){return e}))||[]},only:function(e){if(!T(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=_,t.Fragment=r,t.Profiler=a,t.PureComponent=y,t.StrictMode=o,t.Suspense=u,t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=w,t.__COMPILER_RUNTIME={__proto__:null,c:function(e){return w.H.useMemoCache(e)}},t.cache=function(e){return function(){return e.apply(null,arguments)}},t.cloneElement=function(e,t,i){if(null===e||void 0===e)throw Error("The argument must be a React element, but you passed "+e+".");var n=p({},e.props),r=e.key;if(null!=t)for(o in void 0!==t.ref&&void 0,void 0!==t.key&&(r=""+t.key),t)!C.call(t,o)||"key"===o||"__self"===o||"__source"===o||"ref"===o&&void 0===t.ref||(n[o]=t[o]);var o=arguments.length-2;if(1===o)n.children=i;else if(1<o){for(var a=Array(o),s=0;s<o;s++)a[s]=arguments[s+2];n.children=a}return x(e.type,r,void 0,0,0,n)},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider=e,e.Consumer={$$typeof:s,_context:e},e},t.createElement=function(e,t,i){var n,r={},o=null;if(null!=t)for(n in void 0!==t.key&&(o=""+t.key),t)C.call(t,n)&&"key"!==n&&"__self"!==n&&"__source"!==n&&(r[n]=t[n]);var a=arguments.length-2;if(1===a)r.children=i;else if(1<a){for(var s=Array(a),l=0;l<a;l++)s[l]=arguments[l+2];r.children=s}if(e&&e.defaultProps)for(n in a=e.defaultProps)void 0===r[n]&&(r[n]=a[n]);return x(e,o,void 0,0,0,r)},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=T,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:D}},t.memo=function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=w.T,i={};w.T=i;try{var n=e(),r=w.S;null!==r&&r(i,n),"object"===typeof n&&null!==n&&"function"===typeof n.then&&n.then(L,k)}catch(o){k(o)}finally{w.T=t}},t.unstable_useCacheRefresh=function(){return w.H.useCacheRefresh()},t.use=function(e){return w.H.use(e)},t.useActionState=function(e,t,i){return w.H.useActionState(e,t,i)},t.useCallback=function(e,t){return w.H.useCallback(e,t)},t.useContext=function(e){return w.H.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e,t){return w.H.useDeferredValue(e,t)},t.useEffect=function(e,t,i){var n=w.H;if("function"===typeof i)throw Error("useEffect CRUD overload is not enabled in this build of React.");return n.useEffect(e,t)},t.useId=function(){return w.H.useId()},t.useImperativeHandle=function(e,t,i){return w.H.useImperativeHandle(e,t,i)},t.useInsertionEffect=function(e,t){return w.H.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return w.H.useLayoutEffect(e,t)},t.useMemo=function(e,t){return w.H.useMemo(e,t)},t.useOptimistic=function(e,t){return w.H.useOptimistic(e,t)},t.useReducer=function(e,t,i){return w.H.useReducer(e,t,i)},t.useRef=function(e){return w.H.useRef(e)},t.useState=function(e){return w.H.useState(e)},t.useSyncExternalStore=function(e,t,i){return w.H.useSyncExternalStore(e,t,i)},t.useTransition=function(){return w.H.useTransition()},t.version="19.1.0"}},t={};function i(n){var r=t[n];if(void 0!==r)return r.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,i),o.exports}i.m=e,i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.f={},i.e=e=>Promise.all(Object.keys(i.f).reduce(((t,n)=>(i.f[n](e,t),t)),[])),i.u=e=>"static/js/"+e+".cfe23212.chunk.js",i.miniCssF=e=>{},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="dawon-barcode:";i.l=(n,r,o,a)=>{if(e[n])e[n].push(r);else{var s,l;if(void 0!==o)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var h=c[u];if(h.getAttribute("src")==n||h.getAttribute("data-webpack")==t+o){s=h;break}}s||(l=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,i.nc&&s.setAttribute("nonce",i.nc),s.setAttribute("data-webpack",t+o),s.src=n),e[n]=[r];var d=(t,i)=>{s.onerror=s.onload=null,clearTimeout(f);var r=e[n];if(delete e[n],s.parentNode&&s.parentNode.removeChild(s),r&&r.forEach((e=>e(i))),t)return t(i)},f=setTimeout(d.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=d.bind(null,s.onerror),s.onload=d.bind(null,s.onload),l&&document.head.appendChild(s)}}})(),i.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.p="/",(()=>{var e={792:0};i.f.j=(t,n)=>{var r=i.o(e,t)?e[t]:void 0;if(0!==r)if(r)n.push(r[2]);else{var o=new Promise(((i,n)=>r=e[t]=[i,n]));n.push(r[2]=o);var a=i.p+i.u(t),s=new Error;i.l(a,(n=>{if(i.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var o=n&&("load"===n.type?"missing":n.type),a=n&&n.target&&n.target.src;s.message="Loading chunk "+t+" failed.\n("+o+": "+a+")",s.name="ChunkLoadError",s.type=o,s.request=a,r[1](s)}}),"chunk-"+t,t)}};var t=(t,n)=>{var r,o,a=n[0],s=n[1],l=n[2],c=0;if(a.some((t=>0!==e[t]))){for(r in s)i.o(s,r)&&(i.m[r]=s[r]);if(l)l(i)}for(t&&t(n);c<a.length;c++)o=a[c],i.o(e,o)&&e[o]&&e[o][0](),e[o]=0},n=self.webpackChunkdawon_barcode=self.webpackChunkdawon_barcode||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var n=i(950),r=i(352);var o=function(){this.init()};o.prototype={init:function(){var e=this||a;return e._counter=1e3,e._html5AudioPool=[],e.html5PoolSize=10,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator="undefined"!==typeof window&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.autoUnlock=!0,e._setup(),e},volume:function(e){var t=this||a;if(e=parseFloat(e),t.ctx||g(),"undefined"!==typeof e&&e>=0&&e<=1){if(t._volume=e,t._muted)return t;t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e,a.ctx.currentTime);for(var i=0;i<t._howls.length;i++)if(!t._howls[i]._webAudio)for(var n=t._howls[i]._getSoundIds(),r=0;r<n.length;r++){var o=t._howls[i]._soundById(n[r]);o&&o._node&&(o._node.volume=o._volume*e)}return t}return t._volume},mute:function(e){var t=this||a;t.ctx||g(),t._muted=e,t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e?0:t._volume,a.ctx.currentTime);for(var i=0;i<t._howls.length;i++)if(!t._howls[i]._webAudio)for(var n=t._howls[i]._getSoundIds(),r=0;r<n.length;r++){var o=t._howls[i]._soundById(n[r]);o&&o._node&&(o._node.muted=!!e||o._muted)}return t},stop:function(){for(var e=this||a,t=0;t<e._howls.length;t++)e._howls[t].stop();return e},unload:function(){for(var e=this||a,t=e._howls.length-1;t>=0;t--)e._howls[t].unload();return e.usingWebAudio&&e.ctx&&"undefined"!==typeof e.ctx.close&&(e.ctx.close(),e.ctx=null,g()),e},codecs:function(e){return(this||a)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||a;if(e.state=e.ctx&&e.ctx.state||"suspended",e._autoSuspend(),!e.usingWebAudio)if("undefined"!==typeof Audio)try{"undefined"===typeof(new Audio).oncanplaythrough&&(e._canPlayEvent="canplay")}catch(m){e.noAudio=!0}else e.noAudio=!0;try{(new Audio).muted&&(e.noAudio=!0)}catch(m){}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||a,t=null;try{t="undefined"!==typeof Audio?new Audio:null}catch(u){return e}if(!t||"function"!==typeof t.canPlayType)return e;var i=t.canPlayType("audio/mpeg;").replace(/^no$/,""),n=e._navigator?e._navigator.userAgent:"",r=n.match(/OPR\/([0-6].)/g),o=r&&parseInt(r[0].split("/")[1],10)<33,s=-1!==n.indexOf("Safari")&&-1===n.indexOf("Chrome"),l=n.match(/Version\/(.*?) /),c=s&&l&&parseInt(l[1],10)<15;return e._codecs={mp3:!(o||!i&&!t.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!i,opus:!!t.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(t.canPlayType('audio/wav; codecs="1"')||t.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!t.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!t.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/m4a;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(t.canPlayType("audio/x-m4b;")||t.canPlayType("audio/m4b;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(t.canPlayType("audio/x-mp4;")||t.canPlayType("audio/mp4;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!(c||!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!(c||!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!t.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(t.canPlayType("audio/x-flac;")||t.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_unlockAudio:function(){var e=this||a;if(!e._audioUnlocked&&e.ctx){e._audioUnlocked=!1,e.autoUnlock=!1,e._mobileUnloaded||44100===e.ctx.sampleRate||(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var t=function(i){for(;e._html5AudioPool.length<e.html5PoolSize;)try{var n=new Audio;n._unlocked=!0,e._releaseHtml5Audio(n)}catch(i){e.noAudio=!0;break}for(var r=0;r<e._howls.length;r++)if(!e._howls[r]._webAudio)for(var o=e._howls[r]._getSoundIds(),a=0;a<o.length;a++){var s=e._howls[r]._soundById(o[a]);s&&s._node&&!s._node._unlocked&&(s._node._unlocked=!0,s._node.load())}e._autoResume();var l=e.ctx.createBufferSource();l.buffer=e._scratchBuffer,l.connect(e.ctx.destination),"undefined"===typeof l.start?l.noteOn(0):l.start(0),"function"===typeof e.ctx.resume&&e.ctx.resume(),l.onended=function(){l.disconnect(0),e._audioUnlocked=!0,document.removeEventListener("touchstart",t,!0),document.removeEventListener("touchend",t,!0),document.removeEventListener("click",t,!0),document.removeEventListener("keydown",t,!0);for(var i=0;i<e._howls.length;i++)e._howls[i]._emit("unlock")}};return document.addEventListener("touchstart",t,!0),document.addEventListener("touchend",t,!0),document.addEventListener("click",t,!0),document.addEventListener("keydown",t,!0),e}},_obtainHtml5Audio:function(){var e=this||a;if(e._html5AudioPool.length)return e._html5AudioPool.pop();var t=(new Audio).play();return t&&"undefined"!==typeof Promise&&(t instanceof Promise||"function"===typeof t.then)&&t.catch((function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")})),new Audio},_releaseHtml5Audio:function(e){var t=this||a;return e._unlocked&&t._html5AudioPool.push(e),t},_autoSuspend:function(){var e=this;if(e.autoSuspend&&e.ctx&&"undefined"!==typeof e.ctx.suspend&&a.usingWebAudio){for(var t=0;t<e._howls.length;t++)if(e._howls[t]._webAudio)for(var i=0;i<e._howls[t]._sounds.length;i++)if(!e._howls[t]._sounds[i]._paused)return e;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout((function(){if(e.autoSuspend){e._suspendTimer=null,e.state="suspending";var t=function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())};e.ctx.suspend().then(t,t)}}),3e4),e}},_autoResume:function(){var e=this;if(e.ctx&&"undefined"!==typeof e.ctx.resume&&a.usingWebAudio)return"running"===e.state&&"interrupted"!==e.ctx.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):"suspended"===e.state||"running"===e.state&&"interrupted"===e.ctx.state?(e.ctx.resume().then((function(){e.state="running";for(var t=0;t<e._howls.length;t++)e._howls[t]._emit("resume")})),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):"suspending"===e.state&&(e._resumeAfterSuspend=!0),e}};var a=new o,s=function(e){e.src&&0!==e.src.length?this.init(e):console.error("An array of source files must be passed with any new Howl.")};s.prototype={init:function(e){var t=this;return a.ctx||g(),t._autoplay=e.autoplay||!1,t._format="string"!==typeof e.format?e.format:[e.format],t._html5=e.html5||!1,t._muted=e.mute||!1,t._loop=e.loop||!1,t._pool=e.pool||5,t._preload="boolean"!==typeof e.preload&&"metadata"!==e.preload||e.preload,t._rate=e.rate||1,t._sprite=e.sprite||{},t._src="string"!==typeof e.src?e.src:[e.src],t._volume=void 0!==e.volume?e.volume:1,t._xhr={method:e.xhr&&e.xhr.method?e.xhr.method:"GET",headers:e.xhr&&e.xhr.headers?e.xhr.headers:null,withCredentials:!(!e.xhr||!e.xhr.withCredentials)&&e.xhr.withCredentials},t._duration=0,t._state="unloaded",t._sounds=[],t._endTimers={},t._queue=[],t._playLock=!1,t._onend=e.onend?[{fn:e.onend}]:[],t._onfade=e.onfade?[{fn:e.onfade}]:[],t._onload=e.onload?[{fn:e.onload}]:[],t._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],t._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],t._onpause=e.onpause?[{fn:e.onpause}]:[],t._onplay=e.onplay?[{fn:e.onplay}]:[],t._onstop=e.onstop?[{fn:e.onstop}]:[],t._onmute=e.onmute?[{fn:e.onmute}]:[],t._onvolume=e.onvolume?[{fn:e.onvolume}]:[],t._onrate=e.onrate?[{fn:e.onrate}]:[],t._onseek=e.onseek?[{fn:e.onseek}]:[],t._onunlock=e.onunlock?[{fn:e.onunlock}]:[],t._onresume=[],t._webAudio=a.usingWebAudio&&!t._html5,"undefined"!==typeof a.ctx&&a.ctx&&a.autoUnlock&&a._unlockAudio(),a._howls.push(t),t._autoplay&&t._queue.push({event:"play",action:function(){t.play()}}),t._preload&&"none"!==t._preload&&t.load(),t},load:function(){var e=this,t=null;if(a.noAudio)e._emit("loaderror",null,"No audio support.");else{"string"===typeof e._src&&(e._src=[e._src]);for(var i=0;i<e._src.length;i++){var n,r;if(e._format&&e._format[i])n=e._format[i];else{if("string"!==typeof(r=e._src[i])){e._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(n=/^data:audio\/([^;,]+);/i.exec(r))||(n=/\.([^.]+)$/.exec(r.split("?",1)[0])),n&&(n=n[1].toLowerCase())}if(n||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),n&&a.codecs(n)){t=e._src[i];break}}if(t)return e._src=t,e._state="loading","https:"===window.location.protocol&&"http:"===t.slice(0,5)&&(e._html5=!0,e._webAudio=!1),new l(e),e._webAudio&&u(e),e;e._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(e,t){var i=this,n=null;if("number"===typeof e)n=e,e=null;else{if("string"===typeof e&&"loaded"===i._state&&!i._sprite[e])return null;if("undefined"===typeof e&&(e="__default",!i._playLock)){for(var r=0,o=0;o<i._sounds.length;o++)i._sounds[o]._paused&&!i._sounds[o]._ended&&(r++,n=i._sounds[o]._id);1===r?e=null:n=null}}var s=n?i._soundById(n):i._inactiveSound();if(!s)return null;if(n&&!e&&(e=s._sprite||"__default"),"loaded"!==i._state){s._sprite=e,s._ended=!1;var l=s._id;return i._queue.push({event:"play",action:function(){i.play(l)}}),l}if(n&&!s._paused)return t||i._loadQueue("play"),s._id;i._webAudio&&a._autoResume();var c=Math.max(0,s._seek>0?s._seek:i._sprite[e][0]/1e3),u=Math.max(0,(i._sprite[e][0]+i._sprite[e][1])/1e3-c),h=1e3*u/Math.abs(s._rate),d=i._sprite[e][0]/1e3,f=(i._sprite[e][0]+i._sprite[e][1])/1e3;s._sprite=e,s._ended=!1;var g=function(){s._paused=!1,s._seek=c,s._start=d,s._stop=f,s._loop=!(!s._loop&&!i._sprite[e][2])};if(!(c>=f)){var p=s._node;if(i._webAudio){var m=function(){i._playLock=!1,g(),i._refreshBuffer(s);var e=s._muted||i._muted?0:s._volume;p.gain.setValueAtTime(e,a.ctx.currentTime),s._playStart=a.ctx.currentTime,"undefined"===typeof p.bufferSource.start?s._loop?p.bufferSource.noteGrainOn(0,c,86400):p.bufferSource.noteGrainOn(0,c,u):s._loop?p.bufferSource.start(0,c,86400):p.bufferSource.start(0,c,u),h!==1/0&&(i._endTimers[s._id]=setTimeout(i._ended.bind(i,s),h)),t||setTimeout((function(){i._emit("play",s._id),i._loadQueue()}),0)};"running"===a.state&&"interrupted"!==a.ctx.state?m():(i._playLock=!0,i.once("resume",m),i._clearTimer(s._id))}else{var _=function(){p.currentTime=c,p.muted=s._muted||i._muted||a._muted||p.muted,p.volume=s._volume*a.volume(),p.playbackRate=s._rate;try{var n=p.play();if(n&&"undefined"!==typeof Promise&&(n instanceof Promise||"function"===typeof n.then)?(i._playLock=!0,g(),n.then((function(){i._playLock=!1,p._unlocked=!0,t?i._loadQueue():i._emit("play",s._id)})).catch((function(){i._playLock=!1,i._emit("playerror",s._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),s._ended=!0,s._paused=!0}))):t||(i._playLock=!1,g(),i._emit("play",s._id)),p.playbackRate=s._rate,p.paused)return void i._emit("playerror",s._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==e||s._loop?i._endTimers[s._id]=setTimeout(i._ended.bind(i,s),h):(i._endTimers[s._id]=function(){i._ended(s),p.removeEventListener("ended",i._endTimers[s._id],!1)},p.addEventListener("ended",i._endTimers[s._id],!1))}catch(r){i._emit("playerror",s._id,r)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===p.src&&(p.src=i._src,p.load());var v=window&&window.ejecta||!p.readyState&&a._navigator.isCocoonJS;if(p.readyState>=3||v)_();else{i._playLock=!0,i._state="loading";var y=function(){i._state="loaded",_(),p.removeEventListener(a._canPlayEvent,y,!1)};p.addEventListener(a._canPlayEvent,y,!1),i._clearTimer(s._id)}}return s._id}i._ended(s)},pause:function(e){var t=this;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"pause",action:function(){t.pause(e)}}),t;for(var i=t._getSoundIds(e),n=0;n<i.length;n++){t._clearTimer(i[n]);var r=t._soundById(i[n]);if(r&&!r._paused&&(r._seek=t.seek(i[n]),r._rateSeek=0,r._paused=!0,t._stopFade(i[n]),r._node))if(t._webAudio){if(!r._node.bufferSource)continue;"undefined"===typeof r._node.bufferSource.stop?r._node.bufferSource.noteOff(0):r._node.bufferSource.stop(0),t._cleanBuffer(r._node)}else isNaN(r._node.duration)&&r._node.duration!==1/0||r._node.pause();arguments[1]||t._emit("pause",r?r._id:null)}return t},stop:function(e,t){var i=this;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"stop",action:function(){i.stop(e)}}),i;for(var n=i._getSoundIds(e),r=0;r<n.length;r++){i._clearTimer(n[r]);var o=i._soundById(n[r]);o&&(o._seek=o._start||0,o._rateSeek=0,o._paused=!0,o._ended=!0,i._stopFade(n[r]),o._node&&(i._webAudio?o._node.bufferSource&&("undefined"===typeof o._node.bufferSource.stop?o._node.bufferSource.noteOff(0):o._node.bufferSource.stop(0),i._cleanBuffer(o._node)):isNaN(o._node.duration)&&o._node.duration!==1/0||(o._node.currentTime=o._start||0,o._node.pause(),o._node.duration===1/0&&i._clearSound(o._node))),t||i._emit("stop",o._id))}return i},mute:function(e,t){var i=this;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"mute",action:function(){i.mute(e,t)}}),i;if("undefined"===typeof t){if("boolean"!==typeof e)return i._muted;i._muted=e}for(var n=i._getSoundIds(t),r=0;r<n.length;r++){var o=i._soundById(n[r]);o&&(o._muted=e,o._interval&&i._stopFade(o._id),i._webAudio&&o._node?o._node.gain.setValueAtTime(e?0:o._volume,a.ctx.currentTime):o._node&&(o._node.muted=!!a._muted||e),i._emit("mute",o._id))}return i},volume:function(){var e,t,i,n=this,r=arguments;if(0===r.length)return n._volume;if(1===r.length||2===r.length&&"undefined"===typeof r[1]?n._getSoundIds().indexOf(r[0])>=0?t=parseInt(r[0],10):e=parseFloat(r[0]):r.length>=2&&(e=parseFloat(r[0]),t=parseInt(r[1],10)),!("undefined"!==typeof e&&e>=0&&e<=1))return(i=t?n._soundById(t):n._sounds[0])?i._volume:0;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"volume",action:function(){n.volume.apply(n,r)}}),n;"undefined"===typeof t&&(n._volume=e),t=n._getSoundIds(t);for(var o=0;o<t.length;o++)(i=n._soundById(t[o]))&&(i._volume=e,r[2]||n._stopFade(t[o]),n._webAudio&&i._node&&!i._muted?i._node.gain.setValueAtTime(e,a.ctx.currentTime):i._node&&!i._muted&&(i._node.volume=e*a.volume()),n._emit("volume",i._id));return n},fade:function(e,t,i,n){var r=this;if("loaded"!==r._state||r._playLock)return r._queue.push({event:"fade",action:function(){r.fade(e,t,i,n)}}),r;e=Math.min(Math.max(0,parseFloat(e)),1),t=Math.min(Math.max(0,parseFloat(t)),1),i=parseFloat(i),r.volume(e,n);for(var o=r._getSoundIds(n),s=0;s<o.length;s++){var l=r._soundById(o[s]);if(l){if(n||r._stopFade(o[s]),r._webAudio&&!l._muted){var c=a.ctx.currentTime,u=c+i/1e3;l._volume=e,l._node.gain.setValueAtTime(e,c),l._node.gain.linearRampToValueAtTime(t,u)}r._startFadeInterval(l,e,t,i,o[s],"undefined"===typeof n)}}return r},_startFadeInterval:function(e,t,i,n,r,o){var a=this,s=t,l=i-t,c=Math.abs(l/.01),u=Math.max(4,c>0?n/c:n),h=Date.now();e._fadeTo=i,e._interval=setInterval((function(){var r=(Date.now()-h)/n;h=Date.now(),s+=l*r,s=Math.round(100*s)/100,s=l<0?Math.max(i,s):Math.min(i,s),a._webAudio?e._volume=s:a.volume(s,e._id,!0),o&&(a._volume=s),(i<t&&s<=i||i>t&&s>=i)&&(clearInterval(e._interval),e._interval=null,e._fadeTo=null,a.volume(i,e._id),a._emit("fade",e._id))}),u)},_stopFade:function(e){var t=this,i=t._soundById(e);return i&&i._interval&&(t._webAudio&&i._node.gain.cancelScheduledValues(a.ctx.currentTime),clearInterval(i._interval),i._interval=null,t.volume(i._fadeTo,e),i._fadeTo=null,t._emit("fade",e)),t},loop:function(){var e,t,i,n=this,r=arguments;if(0===r.length)return n._loop;if(1===r.length){if("boolean"!==typeof r[0])return!!(i=n._soundById(parseInt(r[0],10)))&&i._loop;e=r[0],n._loop=e}else 2===r.length&&(e=r[0],t=parseInt(r[1],10));for(var o=n._getSoundIds(t),a=0;a<o.length;a++)(i=n._soundById(o[a]))&&(i._loop=e,n._webAudio&&i._node&&i._node.bufferSource&&(i._node.bufferSource.loop=e,e&&(i._node.bufferSource.loopStart=i._start||0,i._node.bufferSource.loopEnd=i._stop,n.playing(o[a])&&(n.pause(o[a],!0),n.play(o[a],!0)))));return n},rate:function(){var e,t,i,n=this,r=arguments;if(0===r.length)t=n._sounds[0]._id;else if(1===r.length){n._getSoundIds().indexOf(r[0])>=0?t=parseInt(r[0],10):e=parseFloat(r[0])}else 2===r.length&&(e=parseFloat(r[0]),t=parseInt(r[1],10));if("number"!==typeof e)return(i=n._soundById(t))?i._rate:n._rate;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"rate",action:function(){n.rate.apply(n,r)}}),n;"undefined"===typeof t&&(n._rate=e),t=n._getSoundIds(t);for(var o=0;o<t.length;o++)if(i=n._soundById(t[o])){n.playing(t[o])&&(i._rateSeek=n.seek(t[o]),i._playStart=n._webAudio?a.ctx.currentTime:i._playStart),i._rate=e,n._webAudio&&i._node&&i._node.bufferSource?i._node.bufferSource.playbackRate.setValueAtTime(e,a.ctx.currentTime):i._node&&(i._node.playbackRate=e);var s=n.seek(t[o]),l=1e3*((n._sprite[i._sprite][0]+n._sprite[i._sprite][1])/1e3-s)/Math.abs(i._rate);!n._endTimers[t[o]]&&i._paused||(n._clearTimer(t[o]),n._endTimers[t[o]]=setTimeout(n._ended.bind(n,i),l)),n._emit("rate",i._id)}return n},seek:function(){var e,t,i=this,n=arguments;if(0===n.length)i._sounds.length&&(t=i._sounds[0]._id);else if(1===n.length){i._getSoundIds().indexOf(n[0])>=0?t=parseInt(n[0],10):i._sounds.length&&(t=i._sounds[0]._id,e=parseFloat(n[0]))}else 2===n.length&&(e=parseFloat(n[0]),t=parseInt(n[1],10));if("undefined"===typeof t)return 0;if("number"===typeof e&&("loaded"!==i._state||i._playLock))return i._queue.push({event:"seek",action:function(){i.seek.apply(i,n)}}),i;var r=i._soundById(t);if(r){if(!("number"===typeof e&&e>=0)){if(i._webAudio){var o=i.playing(t)?a.ctx.currentTime-r._playStart:0,s=r._rateSeek?r._rateSeek-r._seek:0;return r._seek+(s+o*Math.abs(r._rate))}return r._node.currentTime}var l=i.playing(t);l&&i.pause(t,!0),r._seek=e,r._ended=!1,i._clearTimer(t),i._webAudio||!r._node||isNaN(r._node.duration)||(r._node.currentTime=e);var c=function(){l&&i.play(t,!0),i._emit("seek",t)};if(l&&!i._webAudio){var u=function(){i._playLock?setTimeout(u,0):c()};setTimeout(u,0)}else c()}return i},playing:function(e){var t=this;if("number"===typeof e){var i=t._soundById(e);return!!i&&!i._paused}for(var n=0;n<t._sounds.length;n++)if(!t._sounds[n]._paused)return!0;return!1},duration:function(e){var t=this,i=t._duration,n=t._soundById(e);return n&&(i=t._sprite[n._sprite][1]/1e3),i},state:function(){return this._state},unload:function(){for(var e=this,t=e._sounds,i=0;i<t.length;i++)t[i]._paused||e.stop(t[i]._id),e._webAudio||(e._clearSound(t[i]._node),t[i]._node.removeEventListener("error",t[i]._errorFn,!1),t[i]._node.removeEventListener(a._canPlayEvent,t[i]._loadFn,!1),t[i]._node.removeEventListener("ended",t[i]._endFn,!1),a._releaseHtml5Audio(t[i]._node)),delete t[i]._node,e._clearTimer(t[i]._id);var n=a._howls.indexOf(e);n>=0&&a._howls.splice(n,1);var r=!0;for(i=0;i<a._howls.length;i++)if(a._howls[i]._src===e._src||e._src.indexOf(a._howls[i]._src)>=0){r=!1;break}return c&&r&&delete c[e._src],a.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,t,i,n){var r=this["_on"+e];return"function"===typeof t&&r.push(n?{id:i,fn:t,once:n}:{id:i,fn:t}),this},off:function(e,t,i){var n=this,r=n["_on"+e],o=0;if("number"===typeof t&&(i=t,t=null),t||i)for(o=0;o<r.length;o++){var a=i===r[o].id;if(t===r[o].fn&&a||!t&&a){r.splice(o,1);break}}else if(e)n["_on"+e]=[];else{var s=Object.keys(n);for(o=0;o<s.length;o++)0===s[o].indexOf("_on")&&Array.isArray(n[s[o]])&&(n[s[o]]=[])}return n},once:function(e,t,i){return this.on(e,t,i,1),this},_emit:function(e,t,i){for(var n=this,r=n["_on"+e],o=r.length-1;o>=0;o--)r[o].id&&r[o].id!==t&&"load"!==e||(setTimeout(function(e){e.call(this,t,i)}.bind(n,r[o].fn),0),r[o].once&&n.off(e,r[o].fn,r[o].id));return n._loadQueue(e),n},_loadQueue:function(e){var t=this;if(t._queue.length>0){var i=t._queue[0];i.event===e&&(t._queue.shift(),t._loadQueue()),e||i.action()}return t},_ended:function(e){var t=this,i=e._sprite;if(!t._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop)return setTimeout(t._ended.bind(t,e),100),t;var n=!(!e._loop&&!t._sprite[i][2]);if(t._emit("end",e._id),!t._webAudio&&n&&t.stop(e._id,!0).play(e._id),t._webAudio&&n){t._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=a.ctx.currentTime;var r=1e3*(e._stop-e._start)/Math.abs(e._rate);t._endTimers[e._id]=setTimeout(t._ended.bind(t,e),r)}return t._webAudio&&!n&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,t._clearTimer(e._id),t._cleanBuffer(e._node),a._autoSuspend()),t._webAudio||n||t.stop(e._id,!0),t},_clearTimer:function(e){var t=this;if(t._endTimers[e]){if("function"!==typeof t._endTimers[e])clearTimeout(t._endTimers[e]);else{var i=t._soundById(e);i&&i._node&&i._node.removeEventListener("ended",t._endTimers[e],!1)}delete t._endTimers[e]}return t},_soundById:function(e){for(var t=this,i=0;i<t._sounds.length;i++)if(e===t._sounds[i]._id)return t._sounds[i];return null},_inactiveSound:function(){var e=this;e._drain();for(var t=0;t<e._sounds.length;t++)if(e._sounds[t]._ended)return e._sounds[t].reset();return new l(e)},_drain:function(){var e=this,t=e._pool,i=0,n=0;if(!(e._sounds.length<t)){for(n=0;n<e._sounds.length;n++)e._sounds[n]._ended&&i++;for(n=e._sounds.length-1;n>=0;n--){if(i<=t)return;e._sounds[n]._ended&&(e._webAudio&&e._sounds[n]._node&&e._sounds[n]._node.disconnect(0),e._sounds.splice(n,1),i--)}}},_getSoundIds:function(e){if("undefined"===typeof e){for(var t=[],i=0;i<this._sounds.length;i++)t.push(this._sounds[i]._id);return t}return[e]},_refreshBuffer:function(e){return e._node.bufferSource=a.ctx.createBufferSource(),e._node.bufferSource.buffer=c[this._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop||0),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,a.ctx.currentTime),this},_cleanBuffer:function(e){var t=a._navigator&&a._navigator.vendor.indexOf("Apple")>=0;if(!e.bufferSource)return this;if(a._scratchBuffer&&e.bufferSource&&(e.bufferSource.onended=null,e.bufferSource.disconnect(0),t))try{e.bufferSource.buffer=a._scratchBuffer}catch(m){}return e.bufferSource=null,this},_clearSound:function(e){/MSIE |Trident\//.test(a._navigator&&a._navigator.userAgent)||(e.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var l=function(e){this._parent=e,this.init()};l.prototype={init:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++a._counter,t._sounds.push(e),e.create(),e},create:function(){var e=this,t=e._parent,i=a._muted||e._muted||e._parent._muted?0:e._volume;return t._webAudio?(e._node="undefined"===typeof a.ctx.createGain?a.ctx.createGainNode():a.ctx.createGain(),e._node.gain.setValueAtTime(i,a.ctx.currentTime),e._node.paused=!0,e._node.connect(a.masterGain)):a.noAudio||(e._node=a._obtainHtml5Audio(),e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(a._canPlayEvent,e._loadFn,!1),e._endFn=e._endListener.bind(e),e._node.addEventListener("ended",e._endFn,!1),e._node.src=t._src,e._node.preload=!0===t._preload?"auto":t._preload,e._node.volume=i*a.volume(),e._node.load()),e},reset:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._rateSeek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++a._counter,e},_errorListener:function(){var e=this;e._parent._emit("loaderror",e._id,e._node.error?e._node.error.code:0),e._node.removeEventListener("error",e._errorFn,!1)},_loadListener:function(){var e=this,t=e._parent;t._duration=Math.ceil(10*e._node.duration)/10,0===Object.keys(t._sprite).length&&(t._sprite={__default:[0,1e3*t._duration]}),"loaded"!==t._state&&(t._state="loaded",t._emit("load"),t._loadQueue()),e._node.removeEventListener(a._canPlayEvent,e._loadFn,!1)},_endListener:function(){var e=this,t=e._parent;t._duration===1/0&&(t._duration=Math.ceil(10*e._node.duration)/10,t._sprite.__default[1]===1/0&&(t._sprite.__default[1]=1e3*t._duration),t._ended(e)),e._node.removeEventListener("ended",e._endFn,!1)}};var c={},u=function(e){var t=e._src;if(c[t])return e._duration=c[t].duration,void f(e);if(/^data:[^;]+;base64,/.test(t)){for(var i=atob(t.split(",")[1]),n=new Uint8Array(i.length),r=0;r<i.length;++r)n[r]=i.charCodeAt(r);d(n.buffer,e)}else{var o=new XMLHttpRequest;o.open(e._xhr.method,t,!0),o.withCredentials=e._xhr.withCredentials,o.responseType="arraybuffer",e._xhr.headers&&Object.keys(e._xhr.headers).forEach((function(t){o.setRequestHeader(t,e._xhr.headers[t])})),o.onload=function(){var t=(o.status+"")[0];"0"===t||"2"===t||"3"===t?d(o.response,e):e._emit("loaderror",null,"Failed loading audio file with status: "+o.status+".")},o.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete c[t],e.load())},h(o)}},h=function(e){try{e.send()}catch(m){e.onerror()}},d=function(e,t){var i=function(){t._emit("loaderror",null,"Decoding audio data failed.")},n=function(e){e&&t._sounds.length>0?(c[t._src]=e,f(t,e)):i()};"undefined"!==typeof Promise&&1===a.ctx.decodeAudioData.length?a.ctx.decodeAudioData(e).then(n).catch(i):a.ctx.decodeAudioData(e,n,i)},f=function(e,t){t&&!e._duration&&(e._duration=t.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},g=function(){if(a.usingWebAudio){try{"undefined"!==typeof AudioContext?a.ctx=new AudioContext:"undefined"!==typeof webkitAudioContext?a.ctx=new webkitAudioContext:a.usingWebAudio=!1}catch(m){a.usingWebAudio=!1}a.ctx||(a.usingWebAudio=!1);var e=/iP(hone|od|ad)/.test(a._navigator&&a._navigator.platform),t=a._navigator&&a._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),i=t?parseInt(t[1],10):null;if(e&&i&&i<9){var n=/safari/.test(a._navigator&&a._navigator.userAgent.toLowerCase());a._navigator&&!n&&(a.usingWebAudio=!1)}a.usingWebAudio&&(a.masterGain="undefined"===typeof a.ctx.createGain?a.ctx.createGainNode():a.ctx.createGain(),a.masterGain.gain.setValueAtTime(a._muted?0:a._volume,a.ctx.currentTime),a.masterGain.connect(a.ctx.destination)),a._setup()}};!function(e,t,i,n){var r;e.prototype._pos=[0,0,0],e.prototype._orientation=[0,0,-1,0,1,0],e.prototype.stereo=function(e){var t=this;if(!t.ctx||!t.ctx.listener)return t;for(var i=t._howls.length-1;i>=0;i--)t._howls[i].stereo(e);return t},e.prototype.pos=function(e,i,n){var r=this;return r.ctx&&r.ctx.listener?(i="number"!==typeof i?r._pos[1]:i,n="number"!==typeof n?r._pos[2]:n,"number"!==typeof e?r._pos:(r._pos=[e,i,n],"undefined"!==typeof r.ctx.listener.positionX?(r.ctx.listener.positionX.setTargetAtTime(r._pos[0],t.ctx.currentTime,.1),r.ctx.listener.positionY.setTargetAtTime(r._pos[1],t.ctx.currentTime,.1),r.ctx.listener.positionZ.setTargetAtTime(r._pos[2],t.ctx.currentTime,.1)):r.ctx.listener.setPosition(r._pos[0],r._pos[1],r._pos[2]),r)):r},e.prototype.orientation=function(e,i,n,r,o,a){var s=this;if(!s.ctx||!s.ctx.listener)return s;var l=s._orientation;return i="number"!==typeof i?l[1]:i,n="number"!==typeof n?l[2]:n,r="number"!==typeof r?l[3]:r,o="number"!==typeof o?l[4]:o,a="number"!==typeof a?l[5]:a,"number"!==typeof e?l:(s._orientation=[e,i,n,r,o,a],"undefined"!==typeof s.ctx.listener.forwardX?(s.ctx.listener.forwardX.setTargetAtTime(e,t.ctx.currentTime,.1),s.ctx.listener.forwardY.setTargetAtTime(i,t.ctx.currentTime,.1),s.ctx.listener.forwardZ.setTargetAtTime(n,t.ctx.currentTime,.1),s.ctx.listener.upX.setTargetAtTime(r,t.ctx.currentTime,.1),s.ctx.listener.upY.setTargetAtTime(o,t.ctx.currentTime,.1),s.ctx.listener.upZ.setTargetAtTime(a,t.ctx.currentTime,.1)):s.ctx.listener.setOrientation(e,i,n,r,o,a),s)},i.prototype.init=(r=i.prototype.init,function(e){var t=this;return t._orientation=e.orientation||[1,0,0],t._stereo=e.stereo||null,t._pos=e.pos||null,t._pannerAttr={coneInnerAngle:"undefined"!==typeof e.coneInnerAngle?e.coneInnerAngle:360,coneOuterAngle:"undefined"!==typeof e.coneOuterAngle?e.coneOuterAngle:360,coneOuterGain:"undefined"!==typeof e.coneOuterGain?e.coneOuterGain:0,distanceModel:"undefined"!==typeof e.distanceModel?e.distanceModel:"inverse",maxDistance:"undefined"!==typeof e.maxDistance?e.maxDistance:1e4,panningModel:"undefined"!==typeof e.panningModel?e.panningModel:"HRTF",refDistance:"undefined"!==typeof e.refDistance?e.refDistance:1,rolloffFactor:"undefined"!==typeof e.rolloffFactor?e.rolloffFactor:1},t._onstereo=e.onstereo?[{fn:e.onstereo}]:[],t._onpos=e.onpos?[{fn:e.onpos}]:[],t._onorientation=e.onorientation?[{fn:e.onorientation}]:[],r.call(this,e)}),i.prototype.stereo=function(e,i){var n=this;if(!n._webAudio)return n;if("loaded"!==n._state)return n._queue.push({event:"stereo",action:function(){n.stereo(e,i)}}),n;var r="undefined"===typeof t.ctx.createStereoPanner?"spatial":"stereo";if("undefined"===typeof i){if("number"!==typeof e)return n._stereo;n._stereo=e,n._pos=[e,0,0]}for(var a=n._getSoundIds(i),s=0;s<a.length;s++){var l=n._soundById(a[s]);if(l){if("number"!==typeof e)return l._stereo;l._stereo=e,l._pos=[e,0,0],l._node&&(l._pannerAttr.panningModel="equalpower",l._panner&&l._panner.pan||o(l,r),"spatial"===r?"undefined"!==typeof l._panner.positionX?(l._panner.positionX.setValueAtTime(e,t.ctx.currentTime),l._panner.positionY.setValueAtTime(0,t.ctx.currentTime),l._panner.positionZ.setValueAtTime(0,t.ctx.currentTime)):l._panner.setPosition(e,0,0):l._panner.pan.setValueAtTime(e,t.ctx.currentTime)),n._emit("stereo",l._id)}}return n},i.prototype.pos=function(e,i,n,r){var a=this;if(!a._webAudio)return a;if("loaded"!==a._state)return a._queue.push({event:"pos",action:function(){a.pos(e,i,n,r)}}),a;if(i="number"!==typeof i?0:i,n="number"!==typeof n?-.5:n,"undefined"===typeof r){if("number"!==typeof e)return a._pos;a._pos=[e,i,n]}for(var s=a._getSoundIds(r),l=0;l<s.length;l++){var c=a._soundById(s[l]);if(c){if("number"!==typeof e)return c._pos;c._pos=[e,i,n],c._node&&(c._panner&&!c._panner.pan||o(c,"spatial"),"undefined"!==typeof c._panner.positionX?(c._panner.positionX.setValueAtTime(e,t.ctx.currentTime),c._panner.positionY.setValueAtTime(i,t.ctx.currentTime),c._panner.positionZ.setValueAtTime(n,t.ctx.currentTime)):c._panner.setPosition(e,i,n)),a._emit("pos",c._id)}}return a},i.prototype.orientation=function(e,i,n,r){var a=this;if(!a._webAudio)return a;if("loaded"!==a._state)return a._queue.push({event:"orientation",action:function(){a.orientation(e,i,n,r)}}),a;if(i="number"!==typeof i?a._orientation[1]:i,n="number"!==typeof n?a._orientation[2]:n,"undefined"===typeof r){if("number"!==typeof e)return a._orientation;a._orientation=[e,i,n]}for(var s=a._getSoundIds(r),l=0;l<s.length;l++){var c=a._soundById(s[l]);if(c){if("number"!==typeof e)return c._orientation;c._orientation=[e,i,n],c._node&&(c._panner||(c._pos||(c._pos=a._pos||[0,0,-.5]),o(c,"spatial")),"undefined"!==typeof c._panner.orientationX?(c._panner.orientationX.setValueAtTime(e,t.ctx.currentTime),c._panner.orientationY.setValueAtTime(i,t.ctx.currentTime),c._panner.orientationZ.setValueAtTime(n,t.ctx.currentTime)):c._panner.setOrientation(e,i,n)),a._emit("orientation",c._id)}}return a},i.prototype.pannerAttr=function(){var e,t,i,n=this,r=arguments;if(!n._webAudio)return n;if(0===r.length)return n._pannerAttr;if(1===r.length){if("object"!==typeof r[0])return(i=n._soundById(parseInt(r[0],10)))?i._pannerAttr:n._pannerAttr;e=r[0],"undefined"===typeof t&&(e.pannerAttr||(e.pannerAttr={coneInnerAngle:e.coneInnerAngle,coneOuterAngle:e.coneOuterAngle,coneOuterGain:e.coneOuterGain,distanceModel:e.distanceModel,maxDistance:e.maxDistance,refDistance:e.refDistance,rolloffFactor:e.rolloffFactor,panningModel:e.panningModel}),n._pannerAttr={coneInnerAngle:"undefined"!==typeof e.pannerAttr.coneInnerAngle?e.pannerAttr.coneInnerAngle:n._coneInnerAngle,coneOuterAngle:"undefined"!==typeof e.pannerAttr.coneOuterAngle?e.pannerAttr.coneOuterAngle:n._coneOuterAngle,coneOuterGain:"undefined"!==typeof e.pannerAttr.coneOuterGain?e.pannerAttr.coneOuterGain:n._coneOuterGain,distanceModel:"undefined"!==typeof e.pannerAttr.distanceModel?e.pannerAttr.distanceModel:n._distanceModel,maxDistance:"undefined"!==typeof e.pannerAttr.maxDistance?e.pannerAttr.maxDistance:n._maxDistance,refDistance:"undefined"!==typeof e.pannerAttr.refDistance?e.pannerAttr.refDistance:n._refDistance,rolloffFactor:"undefined"!==typeof e.pannerAttr.rolloffFactor?e.pannerAttr.rolloffFactor:n._rolloffFactor,panningModel:"undefined"!==typeof e.pannerAttr.panningModel?e.pannerAttr.panningModel:n._panningModel})}else 2===r.length&&(e=r[0],t=parseInt(r[1],10));for(var a=n._getSoundIds(t),s=0;s<a.length;s++)if(i=n._soundById(a[s])){var l=i._pannerAttr;l={coneInnerAngle:"undefined"!==typeof e.coneInnerAngle?e.coneInnerAngle:l.coneInnerAngle,coneOuterAngle:"undefined"!==typeof e.coneOuterAngle?e.coneOuterAngle:l.coneOuterAngle,coneOuterGain:"undefined"!==typeof e.coneOuterGain?e.coneOuterGain:l.coneOuterGain,distanceModel:"undefined"!==typeof e.distanceModel?e.distanceModel:l.distanceModel,maxDistance:"undefined"!==typeof e.maxDistance?e.maxDistance:l.maxDistance,refDistance:"undefined"!==typeof e.refDistance?e.refDistance:l.refDistance,rolloffFactor:"undefined"!==typeof e.rolloffFactor?e.rolloffFactor:l.rolloffFactor,panningModel:"undefined"!==typeof e.panningModel?e.panningModel:l.panningModel};var c=i._panner;c||(i._pos||(i._pos=n._pos||[0,0,-.5]),o(i,"spatial"),c=i._panner),c.coneInnerAngle=l.coneInnerAngle,c.coneOuterAngle=l.coneOuterAngle,c.coneOuterGain=l.coneOuterGain,c.distanceModel=l.distanceModel,c.maxDistance=l.maxDistance,c.refDistance=l.refDistance,c.rolloffFactor=l.rolloffFactor,c.panningModel=l.panningModel}return n},n.prototype.init=function(e){return function(){var t=this,i=t._parent;t._orientation=i._orientation,t._stereo=i._stereo,t._pos=i._pos,t._pannerAttr=i._pannerAttr,e.call(this),t._stereo?i.stereo(t._stereo):t._pos&&i.pos(t._pos[0],t._pos[1],t._pos[2],t._id)}}(n.prototype.init),n.prototype.reset=function(e){return function(){var t=this,i=t._parent;return t._orientation=i._orientation,t._stereo=i._stereo,t._pos=i._pos,t._pannerAttr=i._pannerAttr,t._stereo?i.stereo(t._stereo):t._pos?i.pos(t._pos[0],t._pos[1],t._pos[2],t._id):t._panner&&(t._panner.disconnect(0),t._panner=void 0,i._refreshBuffer(t)),e.call(this)}}(n.prototype.reset);var o=function(e,i){"spatial"===(i=i||"spatial")?(e._panner=t.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,"undefined"!==typeof e._panner.positionX?(e._panner.positionX.setValueAtTime(e._pos[0],t.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],t.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],t.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),"undefined"!==typeof e._panner.orientationX?(e._panner.orientationX.setValueAtTime(e._orientation[0],t.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],t.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],t.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=t.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,t.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}}(o,a,s,l);const p="undefined"==typeof self;let m,_,v,y,b;if("undefined"!=typeof navigator&&(m=navigator,_=m.userAgent,v=m.platform,y=m.mediaDevices),!p){const e={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:m.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},t={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:v,search:"Win"},Mac:{str:v},Linux:{str:v}};let i="unknownBrowser",n=0,r="unknownOS";for(let o in e){const t=e[o]||{};let r=t.str||_,a=t.search||o,s=t.verStr||_,l=t.verSearch||o;if(l instanceof Array||(l=[l]),-1!=r.indexOf(a)){i=o;for(let e of l){let t=s.indexOf(e);if(-1!=t){n=parseFloat(s.substring(t+e.length+1));break}}break}}for(let o in t){const e=t[o]||{};let i=e.str||_,n=e.search||o;if(-1!=i.indexOf(n)){r=o;break}}"Linux"==r&&-1!=_.indexOf("Windows NT")&&(r="HarmonyOS"),b={browser:i,version:n,OS:r}}p&&(b={browser:"ssr",version:0,OS:"ssr"});const S="undefined"!=typeof WebAssembly&&_&&!(/Safari/.test(_)&&!/Chrome/.test(_)&&/\(.+\s11_2_([2-6]).*\)/.test(_)),w=!("undefined"==typeof Worker),C=!(!y||!y.getUserMedia),x=async()=>{let e=!1;if(C)try{(await y.getUserMedia({video:!0})).getTracks().forEach((e=>{e.stop()})),e=!0}catch(e){}return e};"Chrome"===b.browser&&b.version>66||"Safari"===b.browser&&b.version>13||"OPR"===b.browser&&b.version>43||"Edge"===b.browser&&b.version;const T=(()=>{if(!p&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"})();var E={653:(e,t,i)=>{var n,r,o,a,s,l,c,u,h,d,f,g,p,m,_,v,y,b,S,w,C,x=x||{version:"5.2.1"};if(t.fabric=x,"undefined"!=typeof document&&"undefined"!=typeof window)document instanceof("undefined"!=typeof HTMLDocument?HTMLDocument:Document)?x.document=document:x.document=document.implementation.createHTMLDocument(""),x.window=window;else{var T=new(i(192).JSDOM)(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;x.document=T.document,x.jsdomImplForWrapper=i(898).implForWrapper,x.nodeCanvas=i(245).Canvas,x.window=T,DOMParser=x.window.DOMParser}function E(e,t){var i=e.canvas,n=t.targetCanvas,r=n.getContext("2d");r.translate(0,n.height),r.scale(1,-1);var o=i.height-n.height;r.drawImage(i,0,o,n.width,n.height,0,0,n.width,n.height)}function I(e,t){var i=t.targetCanvas.getContext("2d"),n=t.destinationWidth,r=t.destinationHeight,o=n*r*4,a=new Uint8Array(this.imageBuffer,0,o),s=new Uint8ClampedArray(this.imageBuffer,0,o);e.readPixels(0,0,n,r,e.RGBA,e.UNSIGNED_BYTE,a);var l=new ImageData(s,n,r);i.putImageData(l,0,0)}x.isTouchSupported="ontouchstart"in x.window||"ontouchstart"in x.document||x.window&&x.window.navigator&&x.window.navigator.maxTouchPoints>0,x.isLikelyNode="undefined"!=typeof Buffer&&"undefined"==typeof window,x.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],x.DPI=96,x.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",x.commaWsp="(?:\\s+,?\\s*|,\\s*)",x.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/gi,x.reNonWord=/[ \n\.,;!\?\-]/,x.fontPaths={},x.iMatrix=[1,0,0,1,0,0],x.svgNS="http://www.w3.org/2000/svg",x.perfLimitSizeTotal=2097152,x.maxCacheSideLimit=4096,x.minCacheSideLimit=256,x.charWidthsCache={},x.textureSize=2048,x.disableStyleCopyPaste=!1,x.enableGLFiltering=!0,x.devicePixelRatio=x.window.devicePixelRatio||x.window.webkitDevicePixelRatio||x.window.mozDevicePixelRatio||1,x.browserShadowBlurConstant=1,x.arcToSegmentsCache={},x.boundsOfCurveCache={},x.cachesBoundsOfCurve=!0,x.forceGLPutImageData=!1,x.initFilterBackend=function(){return x.enableGLFiltering&&x.isWebglSupported&&x.isWebglSupported(x.textureSize)?(console.log("max texture size: "+x.maxTextureSize),new x.WebglFilterBackend({tileSize:x.textureSize})):x.Canvas2dFilterBackend?new x.Canvas2dFilterBackend:void 0},"undefined"!=typeof document&&"undefined"!=typeof window&&(window.fabric=x),function(){function e(e,t){if(this.__eventListeners[e]){var i=this.__eventListeners[e];t?i[i.indexOf(t)]=!1:x.util.array.fill(i,!1)}}function t(e,t){var i=function(){t.apply(this,arguments),this.off(e,i)}.bind(this);this.on(e,i)}x.Observable={fire:function(e,t){if(!this.__eventListeners)return this;var i=this.__eventListeners[e];if(!i)return this;for(var n=0,r=i.length;n<r;n++)i[n]&&i[n].call(this,t||{});return this.__eventListeners[e]=i.filter((function(e){return!1!==e})),this},on:function(e,t){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var i in e)this.on(i,e[i]);else this.__eventListeners[e]||(this.__eventListeners[e]=[]),this.__eventListeners[e].push(t);return this},once:function(e,i){if(1===arguments.length)for(var n in e)t.call(this,n,e[n]);else t.call(this,e,i);return this},off:function(t,i){if(!this.__eventListeners)return this;if(0===arguments.length)for(t in this.__eventListeners)e.call(this,t);else if(1===arguments.length&&"object"==typeof arguments[0])for(var n in t)e.call(this,n,t[n]);else e.call(this,t,i);return this}}}(),x.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var e=0,t=arguments.length;e<t;e++)this._onObjectAdded(arguments[e]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(e,t,i){var n=this._objects;return i?n[t]=e:n.splice(t,0,e),this._onObjectAdded&&this._onObjectAdded(e),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var e,t=this._objects,i=!1,n=0,r=arguments.length;n<r;n++)-1!==(e=t.indexOf(arguments[n]))&&(i=!0,t.splice(e,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[n]));return this.renderOnAddRemove&&i&&this.requestRenderAll(),this},forEachObject:function(e,t){for(var i=this.getObjects(),n=0,r=i.length;n<r;n++)e.call(t,i[n],n,i);return this},getObjects:function(e){return void 0===e?this._objects.concat():this._objects.filter((function(t){return t.type===e}))},item:function(e){return this._objects[e]},isEmpty:function(){return 0===this._objects.length},size:function(){return this._objects.length},contains:function(e,t){return this._objects.indexOf(e)>-1||!!t&&this._objects.some((function(t){return"function"==typeof t.contains&&t.contains(e,!0)}))},complexity:function(){return this._objects.reduce((function(e,t){return e+(t.complexity?t.complexity():0)}),0)}},x.CommonMethods={_setOptions:function(e){for(var t in e)this.set(t,e[t])},_initGradient:function(e,t){!e||!e.colorStops||e instanceof x.Gradient||this.set(t,new x.Gradient(e))},_initPattern:function(e,t,i){!e||!e.source||e instanceof x.Pattern?i&&i():this.set(t,new x.Pattern(e,i))},_setObject:function(e){for(var t in e)this._set(t,e[t])},set:function(e,t){return"object"==typeof e?this._setObject(e):this._set(e,t),this},_set:function(e,t){this[e]=t},toggle:function(e){var t=this.get(e);return"boolean"==typeof t&&this.set(e,!t),this},get:function(e){return this[e]}},n=t,r=Math.sqrt,o=Math.atan2,a=Math.pow,s=Math.PI/180,l=Math.PI/2,x.util={cos:function(e){if(0===e)return 1;switch(e<0&&(e=-e),e/l){case 1:case 3:return 0;case 2:return-1}return Math.cos(e)},sin:function(e){if(0===e)return 0;var t=1;switch(e<0&&(t=-1),e/l){case 1:return t;case 2:return 0;case 3:return-t}return Math.sin(e)},removeFromArray:function(e,t){var i=e.indexOf(t);return-1!==i&&e.splice(i,1),e},getRandomInt:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},degreesToRadians:function(e){return e*s},radiansToDegrees:function(e){return e/s},rotatePoint:function(e,t,i){var n=new x.Point(e.x-t.x,e.y-t.y),r=x.util.rotateVector(n,i);return new x.Point(r.x,r.y).addEquals(t)},rotateVector:function(e,t){var i=x.util.sin(t),n=x.util.cos(t);return{x:e.x*n-e.y*i,y:e.x*i+e.y*n}},createVector:function(e,t){return new x.Point(t.x-e.x,t.y-e.y)},calcAngleBetweenVectors:function(e,t){return Math.acos((e.x*t.x+e.y*t.y)/(Math.hypot(e.x,e.y)*Math.hypot(t.x,t.y)))},getHatVector:function(e){return new x.Point(e.x,e.y).multiply(1/Math.hypot(e.x,e.y))},getBisector:function(e,t,i){var n=x.util.createVector(e,t),r=x.util.createVector(e,i),o=x.util.calcAngleBetweenVectors(n,r),a=o*(0===x.util.calcAngleBetweenVectors(x.util.rotateVector(n,o),r)?1:-1)/2;return{vector:x.util.getHatVector(x.util.rotateVector(n,a)),angle:o}},projectStrokeOnPoints:function(e,t,i){var n=[],r=t.strokeWidth/2,o=t.strokeUniform?new x.Point(1/t.scaleX,1/t.scaleY):new x.Point(1,1),a=function(e){var t=r/Math.hypot(e.x,e.y);return new x.Point(e.x*t*o.x,e.y*t*o.y)};return e.length<=1||e.forEach((function(s,l){var c,u,h=new x.Point(s.x,s.y);0===l?(u=e[l+1],c=i?a(x.util.createVector(u,h)).addEquals(h):e[e.length-1]):l===e.length-1?(c=e[l-1],u=i?a(x.util.createVector(c,h)).addEquals(h):e[0]):(c=e[l-1],u=e[l+1]);var d,f,g=x.util.getBisector(h,c,u),p=g.vector,m=g.angle;if("miter"===t.strokeLineJoin&&(d=-r/Math.sin(m/2),f=new x.Point(p.x*d*o.x,p.y*d*o.y),Math.hypot(f.x,f.y)/r<=t.strokeMiterLimit))return n.push(h.add(f)),void n.push(h.subtract(f));d=-r*Math.SQRT2,f=new x.Point(p.x*d*o.x,p.y*d*o.y),n.push(h.add(f)),n.push(h.subtract(f))})),n},transformPoint:function(e,t,i){return i?new x.Point(t[0]*e.x+t[2]*e.y,t[1]*e.x+t[3]*e.y):new x.Point(t[0]*e.x+t[2]*e.y+t[4],t[1]*e.x+t[3]*e.y+t[5])},makeBoundingBoxFromPoints:function(e,t){if(t)for(var i=0;i<e.length;i++)e[i]=x.util.transformPoint(e[i],t);var n=[e[0].x,e[1].x,e[2].x,e[3].x],r=x.util.array.min(n),o=x.util.array.max(n)-r,a=[e[0].y,e[1].y,e[2].y,e[3].y],s=x.util.array.min(a);return{left:r,top:s,width:o,height:x.util.array.max(a)-s}},invertTransform:function(e){var t=1/(e[0]*e[3]-e[1]*e[2]),i=[t*e[3],-t*e[1],-t*e[2],t*e[0]],n=x.util.transformPoint({x:e[4],y:e[5]},i,!0);return i[4]=-n.x,i[5]=-n.y,i},toFixed:function(e,t){return parseFloat(Number(e).toFixed(t))},parseUnit:function(e,t){var i=/\D{0,2}$/.exec(e),n=parseFloat(e);switch(t||(t=x.Text.DEFAULT_SVG_FONT_SIZE),i[0]){case"mm":return n*x.DPI/25.4;case"cm":return n*x.DPI/2.54;case"in":return n*x.DPI;case"pt":return n*x.DPI/72;case"pc":return n*x.DPI/72*12;case"em":return n*t;default:return n}},falseFunction:function(){return!1},getKlass:function(e,t){return e=x.util.string.camelize(e.charAt(0).toUpperCase()+e.slice(1)),x.util.resolveNamespace(t)[e]},getSvgAttributes:function(e){var t=["instantiated_by_use","style","id","class"];switch(e){case"linearGradient":t=t.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":t=t.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":t=t.concat(["offset","stop-color","stop-opacity"])}return t},resolveNamespace:function(e){if(!e)return x;var t,i=e.split("."),r=i.length,o=n||x.window;for(t=0;t<r;++t)o=o[i[t]];return o},loadImage:function(e,t,i,n){if(e){var r=x.util.createImage(),o=function(){t&&t.call(i,r,!1),r=r.onload=r.onerror=null};r.onload=o,r.onerror=function(){x.log("Error loading "+r.src),t&&t.call(i,null,!0),r=r.onload=r.onerror=null},0!==e.indexOf("data")&&null!=n&&(r.crossOrigin=n),"data:image/svg"===e.substring(0,14)&&(r.onload=null,x.util.loadImageInDom(r,o)),r.src=e}else t&&t.call(i,e)},loadImageInDom:function(e,t){var i=x.document.createElement("div");i.style.width=i.style.height="1px",i.style.left=i.style.top="-100%",i.style.position="absolute",i.appendChild(e),x.document.querySelector("body").appendChild(i),e.onload=function(){t(),i.parentNode.removeChild(i),i=null}},enlivenObjects:function(e,t,i,n){var r=[],o=0,a=(e=e||[]).length;function s(){++o===a&&t&&t(r.filter((function(e){return e})))}a?e.forEach((function(e,t){e&&e.type?x.util.getKlass(e.type,i).fromObject(e,(function(i,o){o||(r[t]=i),n&&n(e,i,o),s()})):s()})):t&&t(r)},enlivenObjectEnlivables:function(e,t,i){var n=x.Object.ENLIVEN_PROPS.filter((function(t){return!!e[t]}));x.util.enlivenObjects(n.map((function(t){return e[t]})),(function(e){var r={};n.forEach((function(i,n){r[i]=e[n],t&&(t[i]=e[n])})),i&&i(r)}))},enlivenPatterns:function(e,t){function i(){++r===o&&t&&t(n)}var n=[],r=0,o=(e=e||[]).length;o?e.forEach((function(e,t){e&&e.source?new x.Pattern(e,(function(e){n[t]=e,i()})):(n[t]=e,i())})):t&&t(n)},groupSVGElements:function(e,t,i){var n;return e&&1===e.length?e[0]:(t&&(t.width&&t.height?t.centerPoint={x:t.width/2,y:t.height/2}:(delete t.width,delete t.height)),n=new x.Group(e,t),void 0!==i&&(n.sourcePath=i),n)},populateWithProperties:function(e,t,i){if(i&&Array.isArray(i))for(var n=0,r=i.length;n<r;n++)i[n]in e&&(t[i[n]]=e[i[n]])},createCanvasElement:function(){return x.document.createElement("canvas")},copyCanvasElement:function(e){var t=x.util.createCanvasElement();return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t},toDataURL:function(e,t,i){return e.toDataURL("image/"+t,i)},createImage:function(){return x.document.createElement("img")},multiplyTransformMatrices:function(e,t,i){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],i?0:e[0]*t[4]+e[2]*t[5]+e[4],i?0:e[1]*t[4]+e[3]*t[5]+e[5]]},qrDecompose:function(e){var t=o(e[1],e[0]),i=a(e[0],2)+a(e[1],2),n=r(i),l=(e[0]*e[3]-e[2]*e[1])/n,c=o(e[0]*e[2]+e[1]*e[3],i);return{angle:t/s,scaleX:n,scaleY:l,skewX:c/s,skewY:0,translateX:e[4],translateY:e[5]}},calcRotateMatrix:function(e){if(!e.angle)return x.iMatrix.concat();var t=x.util.degreesToRadians(e.angle),i=x.util.cos(t),n=x.util.sin(t);return[i,n,-n,i,0,0]},calcDimensionsMatrix:function(e){var t=void 0===e.scaleX?1:e.scaleX,i=void 0===e.scaleY?1:e.scaleY,n=[e.flipX?-t:t,0,0,e.flipY?-i:i,0,0],r=x.util.multiplyTransformMatrices,o=x.util.degreesToRadians;return e.skewX&&(n=r(n,[1,0,Math.tan(o(e.skewX)),1],!0)),e.skewY&&(n=r(n,[1,Math.tan(o(e.skewY)),0,1],!0)),n},composeMatrix:function(e){var t=[1,0,0,1,e.translateX||0,e.translateY||0],i=x.util.multiplyTransformMatrices;return e.angle&&(t=i(t,x.util.calcRotateMatrix(e))),(1!==e.scaleX||1!==e.scaleY||e.skewX||e.skewY||e.flipX||e.flipY)&&(t=i(t,x.util.calcDimensionsMatrix(e))),t},resetObjectTransform:function(e){e.scaleX=1,e.scaleY=1,e.skewX=0,e.skewY=0,e.flipX=!1,e.flipY=!1,e.rotate(0)},saveObjectTransform:function(e){return{scaleX:e.scaleX,scaleY:e.scaleY,skewX:e.skewX,skewY:e.skewY,angle:e.angle,left:e.left,flipX:e.flipX,flipY:e.flipY,top:e.top}},isTransparent:function(e,t,i,n){n>0&&(t>n?t-=n:t=0,i>n?i-=n:i=0);var r,o=!0,a=e.getImageData(t,i,2*n||1,2*n||1),s=a.data.length;for(r=3;r<s&&0!=(o=a.data[r]<=0);r+=4);return a=null,o},parsePreserveAspectRatioAttribute:function(e){var t,i="meet",n=e.split(" ");return n&&n.length&&("meet"!==(i=n.pop())&&"slice"!==i?(t=i,i="meet"):n.length&&(t=n.pop())),{meetOrSlice:i,alignX:"none"!==t?t.slice(1,4):"none",alignY:"none"!==t?t.slice(5,8):"none"}},clearFabricFontCache:function(e){(e=(e||"").toLowerCase())?x.charWidthsCache[e]&&delete x.charWidthsCache[e]:x.charWidthsCache={}},limitDimsByArea:function(e,t){var i=Math.sqrt(t*e),n=Math.floor(t/i);return{x:Math.floor(i),y:n}},capValue:function(e,t,i){return Math.max(e,Math.min(t,i))},findScaleToFit:function(e,t){return Math.min(t.width/e.width,t.height/e.height)},findScaleToCover:function(e,t){return Math.max(t.width/e.width,t.height/e.height)},matrixToSVG:function(e){return"matrix("+e.map((function(e){return x.util.toFixed(e,x.Object.NUM_FRACTION_DIGITS)})).join(" ")+")"},removeTransformFromObject:function(e,t){var i=x.util.invertTransform(t),n=x.util.multiplyTransformMatrices(i,e.calcOwnMatrix());x.util.applyTransformToObject(e,n)},addTransformToObject:function(e,t){x.util.applyTransformToObject(e,x.util.multiplyTransformMatrices(t,e.calcOwnMatrix()))},applyTransformToObject:function(e,t){var i=x.util.qrDecompose(t),n=new x.Point(i.translateX,i.translateY);e.flipX=!1,e.flipY=!1,e.set("scaleX",i.scaleX),e.set("scaleY",i.scaleY),e.skewX=i.skewX,e.skewY=i.skewY,e.angle=i.angle,e.setPositionByOrigin(n,"center","center")},sizeAfterTransform:function(e,t,i){var n=e/2,r=t/2,o=[{x:-n,y:-r},{x:n,y:-r},{x:-n,y:r},{x:n,y:r}],a=x.util.calcDimensionsMatrix(i),s=x.util.makeBoundingBoxFromPoints(o,a);return{x:s.width,y:s.height}},mergeClipPaths:function(e,t){var i=e,n=t;i.inverted&&!n.inverted&&(i=t,n=e),x.util.applyTransformToObject(n,x.util.multiplyTransformMatrices(x.util.invertTransform(i.calcTransformMatrix()),n.calcTransformMatrix()));var r=i.inverted&&n.inverted;return r&&(i.inverted=n.inverted=!1),new x.Group([i],{clipPath:n,inverted:r})}},function(){var e=Array.prototype.join,t={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},i={m:"l",M:"L"};function n(e,t,i,n,r,o,a,s,l,c,u){var h=x.util.cos(e),d=x.util.sin(e),f=x.util.cos(t),g=x.util.sin(t),p=i*r*f-n*o*g+a,m=n*r*f+i*o*g+s;return["C",c+l*(-i*r*d-n*o*h),u+l*(-n*r*d+i*o*h),p+l*(i*r*g+n*o*f),m+l*(n*r*g-i*o*f),p,m]}function r(e,t,i,n){var r=Math.atan2(t,e),o=Math.atan2(n,i);return o>=r?o-r:2*Math.PI-(r-o)}function o(e,t,i){for(var o=i[1],a=i[2],s=i[3],l=i[4],c=i[5],u=function(e,t,i,o,a,s,l){var c=Math.PI,u=l*c/180,h=x.util.sin(u),d=x.util.cos(u),f=0,g=0,p=-d*e*.5-h*t*.5,m=-d*t*.5+h*e*.5,_=(i=Math.abs(i))*i,v=(o=Math.abs(o))*o,y=m*m,b=p*p,S=_*v-_*y-v*b,w=0;if(S<0){var C=Math.sqrt(1-S/(_*v));i*=C,o*=C}else w=(a===s?-1:1)*Math.sqrt(S/(_*y+v*b));var T=w*i*m/o,E=-w*o*p/i,I=d*T-h*E+.5*e,O=h*T+d*E+.5*t,A=r(1,0,(p-T)/i,(m-E)/o),R=r((p-T)/i,(m-E)/o,(-p-T)/i,(-m-E)/o);0===s&&R>0?R-=2*c:1===s&&R<0&&(R+=2*c);for(var D=Math.ceil(Math.abs(R/c*2)),k=[],L=R/D,M=8/3*Math.sin(L/4)*Math.sin(L/4)/Math.sin(L/2),F=A+L,P=0;P<D;P++)k[P]=n(A,F,d,h,i,o,I,O,M,f,g),f=k[P][5],g=k[P][6],A=F,F+=L;return k}(i[6]-e,i[7]-t,o,a,l,c,s),h=0,d=u.length;h<d;h++)u[h][1]+=e,u[h][2]+=t,u[h][3]+=e,u[h][4]+=t,u[h][5]+=e,u[h][6]+=t;return u}function a(e,t,i,n){return Math.sqrt((i-e)*(i-e)+(n-t)*(n-t))}function s(e,t,i,n,r,o,a,s){return function(l){var c,u=(c=l)*c*c,h=function(e){return 3*e*e*(1-e)}(l),d=function(e){return 3*e*(1-e)*(1-e)}(l),f=function(e){return(1-e)*(1-e)*(1-e)}(l);return{x:a*u+r*h+i*d+e*f,y:s*u+o*h+n*d+t*f}}}function l(e,t,i,n,r,o,a,s){return function(l){var c=1-l,u=3*c*c*(i-e)+6*c*l*(r-i)+3*l*l*(a-r),h=3*c*c*(n-t)+6*c*l*(o-n)+3*l*l*(s-o);return Math.atan2(h,u)}}function c(e,t,i,n,r,o){return function(a){var s,l=(s=a)*s,c=function(e){return 2*e*(1-e)}(a),u=function(e){return(1-e)*(1-e)}(a);return{x:r*l+i*c+e*u,y:o*l+n*c+t*u}}}function u(e,t,i,n,r,o){return function(a){var s=1-a,l=2*s*(i-e)+2*a*(r-i),c=2*s*(n-t)+2*a*(o-n);return Math.atan2(c,l)}}function h(e,t,i){var n,r,o={x:t,y:i},s=0;for(r=1;r<=100;r+=1)n=e(r/100),s+=a(o.x,o.y,n.x,n.y),o=n;return s}function d(e){for(var t,i,n,r,o=0,d=e.length,f=0,g=0,p=0,m=0,_=[],v=0;v<d;v++){switch(n={x:f,y:g,command:(t=e[v])[0]},t[0]){case"M":n.length=0,p=f=t[1],m=g=t[2];break;case"L":n.length=a(f,g,t[1],t[2]),f=t[1],g=t[2];break;case"C":i=s(f,g,t[1],t[2],t[3],t[4],t[5],t[6]),r=l(f,g,t[1],t[2],t[3],t[4],t[5],t[6]),n.iterator=i,n.angleFinder=r,n.length=h(i,f,g),f=t[5],g=t[6];break;case"Q":i=c(f,g,t[1],t[2],t[3],t[4]),r=u(f,g,t[1],t[2],t[3],t[4]),n.iterator=i,n.angleFinder=r,n.length=h(i,f,g),f=t[3],g=t[4];break;case"Z":case"z":n.destX=p,n.destY=m,n.length=a(f,g,p,m),f=p,g=m}o+=n.length,_.push(n)}return _.push({length:o,x:f,y:g}),_}x.util.joinPath=function(e){return e.map((function(e){return e.join(" ")})).join(" ")},x.util.parsePath=function(e){var n,r,o,a,s,l=[],c=[],u=x.rePathCommand,h="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",d="("+h+")"+x.commaWsp,f="([01])"+x.commaWsp+"?",g=new RegExp(d+"?"+d+"?"+d+f+f+d+"?("+h+")","g");if(!e||!e.match)return l;for(var p,m=0,_=(s=e.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi)).length;m<_;m++){a=(n=s[m]).slice(1).trim(),c.length=0;var v=n.charAt(0);if(p=[v],"a"===v.toLowerCase())for(var y;y=g.exec(a);)for(var b=1;b<y.length;b++)c.push(y[b]);else for(;o=u.exec(a);)c.push(o[0]);b=0;for(var S=c.length;b<S;b++)r=parseFloat(c[b]),isNaN(r)||p.push(r);var w=t[v.toLowerCase()],C=i[v]||v;if(p.length-1>w)for(var T=1,E=p.length;T<E;T+=w)l.push([v].concat(p.slice(T,T+w))),v=C;else l.push(p)}return l},x.util.makePathSimpler=function(e){var t,i,n,r,a,s,l=0,c=0,u=e.length,h=0,d=0,f=[];for(i=0;i<u;++i){switch(n=!1,(t=e[i].slice(0))[0]){case"l":t[0]="L",t[1]+=l,t[2]+=c;case"L":l=t[1],c=t[2];break;case"h":t[1]+=l;case"H":t[0]="L",t[2]=c,l=t[1];break;case"v":t[1]+=c;case"V":t[0]="L",c=t[1],t[1]=l,t[2]=c;break;case"m":t[0]="M",t[1]+=l,t[2]+=c;case"M":l=t[1],c=t[2],h=t[1],d=t[2];break;case"c":t[0]="C",t[1]+=l,t[2]+=c,t[3]+=l,t[4]+=c,t[5]+=l,t[6]+=c;case"C":a=t[3],s=t[4],l=t[5],c=t[6];break;case"s":t[0]="S",t[1]+=l,t[2]+=c,t[3]+=l,t[4]+=c;case"S":"C"===r?(a=2*l-a,s=2*c-s):(a=l,s=c),l=t[3],c=t[4],t[0]="C",t[5]=t[3],t[6]=t[4],t[3]=t[1],t[4]=t[2],t[1]=a,t[2]=s,a=t[3],s=t[4];break;case"q":t[0]="Q",t[1]+=l,t[2]+=c,t[3]+=l,t[4]+=c;case"Q":a=t[1],s=t[2],l=t[3],c=t[4];break;case"t":t[0]="T",t[1]+=l,t[2]+=c;case"T":"Q"===r?(a=2*l-a,s=2*c-s):(a=l,s=c),t[0]="Q",l=t[1],c=t[2],t[1]=a,t[2]=s,t[3]=l,t[4]=c;break;case"a":t[0]="A",t[6]+=l,t[7]+=c;case"A":n=!0,f=f.concat(o(l,c,t)),l=t[6],c=t[7];break;case"z":case"Z":l=h,c=d}n||f.push(t),r=t[0]}return f},x.util.getSmoothPathFromPoints=function(e,t){var i,n=[],r=new x.Point(e[0].x,e[0].y),o=new x.Point(e[1].x,e[1].y),a=e.length,s=1,l=0,c=a>2;for(t=t||0,c&&(s=e[2].x<o.x?-1:e[2].x===o.x?0:1,l=e[2].y<o.y?-1:e[2].y===o.y?0:1),n.push(["M",r.x-s*t,r.y-l*t]),i=1;i<a;i++){if(!r.eq(o)){var u=r.midPointFrom(o);n.push(["Q",r.x,r.y,u.x,u.y])}r=e[i],i+1<e.length&&(o=e[i+1])}return c&&(s=r.x>e[i-2].x?1:r.x===e[i-2].x?0:-1,l=r.y>e[i-2].y?1:r.y===e[i-2].y?0:-1),n.push(["L",r.x+s*t,r.y+l*t]),n},x.util.getPathSegmentsInfo=d,x.util.getBoundsOfCurve=function(t,i,n,r,o,a,s,l){var c;if(x.cachesBoundsOfCurve&&(c=e.call(arguments),x.boundsOfCurveCache[c]))return x.boundsOfCurveCache[c];var u,h,d,f,g,p,m,_,v=Math.sqrt,y=Math.min,b=Math.max,S=Math.abs,w=[],C=[[],[]];h=6*t-12*n+6*o,u=-3*t+9*n-9*o+3*s,d=3*n-3*t;for(var T=0;T<2;++T)if(T>0&&(h=6*i-12*r+6*a,u=-3*i+9*r-9*a+3*l,d=3*r-3*i),S(u)<1e-12){if(S(h)<1e-12)continue;0<(f=-d/h)&&f<1&&w.push(f)}else(m=h*h-4*d*u)<0||(0<(g=(-h+(_=v(m)))/(2*u))&&g<1&&w.push(g),0<(p=(-h-_)/(2*u))&&p<1&&w.push(p));for(var E,I,O,A=w.length,R=A;A--;)E=(O=1-(f=w[A]))*O*O*t+3*O*O*f*n+3*O*f*f*o+f*f*f*s,C[0][A]=E,I=O*O*O*i+3*O*O*f*r+3*O*f*f*a+f*f*f*l,C[1][A]=I;C[0][R]=t,C[1][R]=i,C[0][R+1]=s,C[1][R+1]=l;var D=[{x:y.apply(null,C[0]),y:y.apply(null,C[1])},{x:b.apply(null,C[0]),y:b.apply(null,C[1])}];return x.cachesBoundsOfCurve&&(x.boundsOfCurveCache[c]=D),D},x.util.getPointOnPath=function(e,t,i){i||(i=d(e));for(var n=0;t-i[n].length>0&&n<i.length-2;)t-=i[n].length,n++;var r,o=i[n],s=t/o.length,l=o.command,c=e[n];switch(l){case"M":return{x:o.x,y:o.y,angle:0};case"Z":case"z":return(r=new x.Point(o.x,o.y).lerp(new x.Point(o.destX,o.destY),s)).angle=Math.atan2(o.destY-o.y,o.destX-o.x),r;case"L":return(r=new x.Point(o.x,o.y).lerp(new x.Point(c[1],c[2]),s)).angle=Math.atan2(c[2]-o.y,c[1]-o.x),r;case"C":case"Q":return function(e,t){for(var i,n,r,o=0,s=0,l=e.iterator,c={x:e.x,y:e.y},u=.01,h=e.angleFinder;s<t&&u>1e-4;)i=l(o),r=o,(n=a(c.x,c.y,i.x,i.y))+s>t?(o-=u,u/=2):(c=i,o+=u,s+=n);return i.angle=h(r),i}(o,t)}},x.util.transformPath=function(e,t,i){return i&&(t=x.util.multiplyTransformMatrices(t,[1,0,0,1,-i.x,-i.y])),e.map((function(e){for(var i=e.slice(0),n={},r=1;r<e.length-1;r+=2)n.x=e[r],n.y=e[r+1],n=x.util.transformPoint(n,t),i[r]=n.x,i[r+1]=n.y;return i}))}}(),function(){var e=Array.prototype.slice;function t(e,t,i){if(e&&0!==e.length){var n=e.length-1,r=t?e[n][t]:e[n];if(t)for(;n--;)i(e[n][t],r)&&(r=e[n][t]);else for(;n--;)i(e[n],r)&&(r=e[n]);return r}}x.util.array={fill:function(e,t){for(var i=e.length;i--;)e[i]=t;return e},invoke:function(t,i){for(var n=e.call(arguments,2),r=[],o=0,a=t.length;o<a;o++)r[o]=n.length?t[o][i].apply(t[o],n):t[o][i].call(t[o]);return r},min:function(e,i){return t(e,i,(function(e,t){return e<t}))},max:function(e,i){return t(e,i,(function(e,t){return e>=t}))}}}(),function(){function e(t,i,n){if(n)if(!x.isLikelyNode&&i instanceof Element)t=i;else if(i instanceof Array){t=[];for(var r=0,o=i.length;r<o;r++)t[r]=e({},i[r],n)}else if(i&&"object"==typeof i)for(var a in i)"canvas"===a||"group"===a?t[a]=null:i.hasOwnProperty(a)&&(t[a]=e({},i[a],n));else t=i;else for(var a in i)t[a]=i[a];return t}x.util.object={extend:e,clone:function(t,i){return e({},t,i)}},x.util.object.extend(x.util,x.Observable)}(),function(){function e(e,t){var i=e.charCodeAt(t);if(isNaN(i))return"";if(i<55296||i>57343)return e.charAt(t);if(55296<=i&&i<=56319){if(e.length<=t+1)throw"High surrogate without following low surrogate";var n=e.charCodeAt(t+1);if(56320>n||n>57343)throw"High surrogate without following low surrogate";return e.charAt(t)+e.charAt(t+1)}if(0===t)throw"Low surrogate without preceding high surrogate";var r=e.charCodeAt(t-1);if(55296>r||r>56319)throw"Low surrogate without preceding high surrogate";return!1}x.util.string={camelize:function(e){return e.replace(/-+(.)?/g,(function(e,t){return t?t.toUpperCase():""}))},capitalize:function(e,t){return e.charAt(0).toUpperCase()+(t?e.slice(1):e.slice(1).toLowerCase())},escapeXml:function(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},graphemeSplit:function(t){var i,n=0,r=[];for(n=0;n<t.length;n++)!1!==(i=e(t,n))&&r.push(i);return r}}}(),function(){var e=Array.prototype.slice,t=function(){},i=function(){for(var e in{toString:1})if("toString"===e)return!1;return!0}(),n=function(e,t,n){for(var r in t)r in e.prototype&&"function"==typeof e.prototype[r]&&(t[r]+"").indexOf("callSuper")>-1?e.prototype[r]=function(e){return function(){var i=this.constructor.superclass;this.constructor.superclass=n;var r=t[e].apply(this,arguments);if(this.constructor.superclass=i,"initialize"!==e)return r}}(r):e.prototype[r]=t[r],i&&(t.toString!==Object.prototype.toString&&(e.prototype.toString=t.toString),t.valueOf!==Object.prototype.valueOf&&(e.prototype.valueOf=t.valueOf))};function r(){}function o(t){for(var i=null,n=this;n.constructor.superclass;){var r=n.constructor.superclass.prototype[t];if(n[t]!==r){i=r;break}n=n.constructor.superclass.prototype}return i?arguments.length>1?i.apply(this,e.call(arguments,1)):i.call(this):console.log("tried to callSuper "+t+", method not found in prototype chain",this)}x.util.createClass=function(){var i=null,a=e.call(arguments,0);function s(){this.initialize.apply(this,arguments)}"function"==typeof a[0]&&(i=a.shift()),s.superclass=i,s.subclasses=[],i&&(r.prototype=i.prototype,s.prototype=new r,i.subclasses.push(s));for(var l=0,c=a.length;l<c;l++)n(s,a[l],i);return s.prototype.initialize||(s.prototype.initialize=t),s.prototype.constructor=s,s.prototype.callSuper=o,s}}(),c=!!x.document.createElement("div").attachEvent,u=["touchstart","touchmove","touchend"],x.util.addListener=function(e,t,i,n){e&&e.addEventListener(t,i,!c&&n)},x.util.removeListener=function(e,t,i,n){e&&e.removeEventListener(t,i,!c&&n)},x.util.getPointer=function(e){var t=e.target,i=x.util.getScrollLeftTop(t),n=function(e){var t=e.changedTouches;return t&&t[0]?t[0]:e}(e);return{x:n.clientX+i.left,y:n.clientY+i.top}},x.util.isTouchEvent=function(e){return u.indexOf(e.type)>-1||"touch"===e.pointerType},d="string"==typeof(h=x.document.createElement("div")).style.opacity,f="string"==typeof h.style.filter,g=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,p=function(e){return e},d?p=function(e,t){return e.style.opacity=t,e}:f&&(p=function(e,t){var i=e.style;return e.currentStyle&&!e.currentStyle.hasLayout&&(i.zoom=1),g.test(i.filter)?(t=t>=.9999?"":"alpha(opacity="+100*t+")",i.filter=i.filter.replace(g,t)):i.filter+=" alpha(opacity="+100*t+")",e}),x.util.setStyle=function(e,t){var i=e.style;if(!i)return e;if("string"==typeof t)return e.style.cssText+=";"+t,t.indexOf("opacity")>-1?p(e,t.match(/opacity:\s*(\d?\.?\d*)/)[1]):e;for(var n in t)"opacity"===n?p(e,t[n]):i["float"===n||"cssFloat"===n?void 0===i.styleFloat?"cssFloat":"styleFloat":n]=t[n];return e},function(){var e,t,i,n,r=Array.prototype.slice,o=function(e){return r.call(e,0)};try{e=o(x.document.childNodes)instanceof Array}catch(e){}function a(e,t){var i=x.document.createElement(e);for(var n in t)"class"===n?i.className=t[n]:"for"===n?i.htmlFor=t[n]:i.setAttribute(n,t[n]);return i}function s(e){for(var t=0,i=0,n=x.document.documentElement,r=x.document.body||{scrollLeft:0,scrollTop:0};e&&(e.parentNode||e.host)&&((e=e.parentNode||e.host)===x.document?(t=r.scrollLeft||n.scrollLeft||0,i=r.scrollTop||n.scrollTop||0):(t+=e.scrollLeft||0,i+=e.scrollTop||0),1!==e.nodeType||"fixed"!==e.style.position););return{left:t,top:i}}e||(o=function(e){for(var t=new Array(e.length),i=e.length;i--;)t[i]=e[i];return t}),t=x.document.defaultView&&x.document.defaultView.getComputedStyle?function(e,t){var i=x.document.defaultView.getComputedStyle(e,null);return i?i[t]:void 0}:function(e,t){var i=e.style[t];return!i&&e.currentStyle&&(i=e.currentStyle[t]),i},i=x.document.documentElement.style,n="userSelect"in i?"userSelect":"MozUserSelect"in i?"MozUserSelect":"WebkitUserSelect"in i?"WebkitUserSelect":"KhtmlUserSelect"in i?"KhtmlUserSelect":"",x.util.makeElementUnselectable=function(e){return void 0!==e.onselectstart&&(e.onselectstart=x.util.falseFunction),n?e.style[n]="none":"string"==typeof e.unselectable&&(e.unselectable="on"),e},x.util.makeElementSelectable=function(e){return void 0!==e.onselectstart&&(e.onselectstart=null),n?e.style[n]="":"string"==typeof e.unselectable&&(e.unselectable=""),e},x.util.setImageSmoothing=function(e,t){e.imageSmoothingEnabled=e.imageSmoothingEnabled||e.webkitImageSmoothingEnabled||e.mozImageSmoothingEnabled||e.msImageSmoothingEnabled||e.oImageSmoothingEnabled,e.imageSmoothingEnabled=t},x.util.getById=function(e){return"string"==typeof e?x.document.getElementById(e):e},x.util.toArray=o,x.util.addClass=function(e,t){e&&-1===(" "+e.className+" ").indexOf(" "+t+" ")&&(e.className+=(e.className?" ":"")+t)},x.util.makeElement=a,x.util.wrapElement=function(e,t,i){return"string"==typeof t&&(t=a(t,i)),e.parentNode&&e.parentNode.replaceChild(t,e),t.appendChild(e),t},x.util.getScrollLeftTop=s,x.util.getElementOffset=function(e){var i,n,r=e&&e.ownerDocument,o={left:0,top:0},a={left:0,top:0},l={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!r)return a;for(var c in l)a[l[c]]+=parseInt(t(e,c),10)||0;return i=r.documentElement,void 0!==e.getBoundingClientRect&&(o=e.getBoundingClientRect()),n=s(e),{left:o.left+n.left-(i.clientLeft||0)+a.left,top:o.top+n.top-(i.clientTop||0)+a.top}},x.util.getNodeCanvas=function(e){var t=x.jsdomImplForWrapper(e);return t._canvas||t._image},x.util.cleanUpJsdomNode=function(e){if(x.isLikelyNode){var t=x.jsdomImplForWrapper(e);t&&(t._image=null,t._canvas=null,t._currentSrc=null,t._attributes=null,t._classList=null)}}}(),function(){function e(){}x.util.request=function(t,i){i||(i={});var n=i.method?i.method.toUpperCase():"GET",r=i.onComplete||function(){},o=new x.window.XMLHttpRequest,a=i.body||i.parameters;return o.onreadystatechange=function(){4===o.readyState&&(r(o),o.onreadystatechange=e)},"GET"===n&&(a=null,"string"==typeof i.parameters&&(t=function(e,t){return e+(/\?/.test(e)?"&":"?")+t}(t,i.parameters))),o.open(n,t,!0),"POST"!==n&&"PUT"!==n||o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send(a),o}}(),x.log=console.log,x.warn=console.warn,function(){var e=x.util.object.extend,t=x.util.object.clone,i=[];function n(){return!1}function r(e,t,i,n){return-i*Math.cos(e/n*(Math.PI/2))+i+t}x.util.object.extend(i,{cancelAll:function(){var e=this.splice(0);return e.forEach((function(e){e.cancel()})),e},cancelByCanvas:function(e){if(!e)return[];var t=this.filter((function(t){return"object"==typeof t.target&&t.target.canvas===e}));return t.forEach((function(e){e.cancel()})),t},cancelByTarget:function(e){var t=this.findAnimationsByTarget(e);return t.forEach((function(e){e.cancel()})),t},findAnimationIndex:function(e){return this.indexOf(this.findAnimation(e))},findAnimation:function(e){return this.find((function(t){return t.cancel===e}))},findAnimationsByTarget:function(e){return e?this.filter((function(t){return t.target===e})):[]}});var o=x.window.requestAnimationFrame||x.window.webkitRequestAnimationFrame||x.window.mozRequestAnimationFrame||x.window.oRequestAnimationFrame||x.window.msRequestAnimationFrame||function(e){return x.window.setTimeout(e,1e3/60)},a=x.window.cancelAnimationFrame||x.window.clearTimeout;function s(){return o.apply(x.window,arguments)}x.util.animate=function(i){i||(i={});var o,a=!1,l=function(){var e=x.runningAnimations.indexOf(o);return e>-1&&x.runningAnimations.splice(e,1)[0]};return o=e(t(i),{cancel:function(){return a=!0,l()},currentValue:"startValue"in i?i.startValue:0,completionRate:0,durationRate:0}),x.runningAnimations.push(o),s((function(e){var t,c=e||+new Date,u=i.duration||500,h=c+u,d=i.onChange||n,f=i.abort||n,g=i.onComplete||n,p=i.easing||r,m="startValue"in i&&i.startValue.length>0,_="startValue"in i?i.startValue:0,v="endValue"in i?i.endValue:100,y=i.byValue||(m?_.map((function(e,t){return v[t]-_[t]})):v-_);i.onStart&&i.onStart(),function e(i){var n=(t=i||+new Date)>h?u:t-c,r=n/u,b=m?_.map((function(e,t){return p(n,_[t],y[t],u)})):p(n,_,y,u),S=m?Math.abs((b[0]-_[0])/y[0]):Math.abs((b-_)/y);if(o.currentValue=m?b.slice():b,o.completionRate=S,o.durationRate=r,!a){if(!f(b,S,r))return t>h?(o.currentValue=m?v.slice():v,o.completionRate=1,o.durationRate=1,d(m?v.slice():v,1,1),g(v,1,1),void l()):(d(b,S,r),void s(e));l()}}(c)})),o.cancel},x.util.requestAnimFrame=s,x.util.cancelAnimFrame=function(){return a.apply(x.window,arguments)},x.runningAnimations=i}(),function(){function e(e,t,i){var n="rgba("+parseInt(e[0]+i*(t[0]-e[0]),10)+","+parseInt(e[1]+i*(t[1]-e[1]),10)+","+parseInt(e[2]+i*(t[2]-e[2]),10);return(n+=","+(e&&t?parseFloat(e[3]+i*(t[3]-e[3])):1))+")"}x.util.animateColor=function(t,i,n,r){var o=new x.Color(t).getSource(),a=new x.Color(i).getSource(),s=r.onComplete,l=r.onChange;return r=r||{},x.util.animate(x.util.object.extend(r,{duration:n||500,startValue:o,endValue:a,byValue:a,easing:function(t,i,n,o){return e(i,n,r.colorEasing?r.colorEasing(t,o):1-Math.cos(t/o*(Math.PI/2)))},onComplete:function(t,i,n){if(s)return s(e(a,a,0),i,n)},onChange:function(t,i,n){if(l){if(Array.isArray(t))return l(e(t,t,0),i,n);l(t,i,n)}}}))}}(),function(){function e(e,t,i,n){return e<Math.abs(t)?(e=t,n=i/4):n=0===t&&0===e?i/(2*Math.PI)*Math.asin(1):i/(2*Math.PI)*Math.asin(t/e),{a:e,c:t,p:i,s:n}}function t(e,t,i){return e.a*Math.pow(2,10*(t-=1))*Math.sin((t*i-e.s)*(2*Math.PI)/e.p)}function i(e,t,i,r){return i-n(r-e,0,i,r)+t}function n(e,t,i,n){return(e/=n)<1/2.75?i*(7.5625*e*e)+t:e<2/2.75?i*(7.5625*(e-=1.5/2.75)*e+.75)+t:e<2.5/2.75?i*(7.5625*(e-=2.25/2.75)*e+.9375)+t:i*(7.5625*(e-=2.625/2.75)*e+.984375)+t}x.util.ease={easeInQuad:function(e,t,i,n){return i*(e/=n)*e+t},easeOutQuad:function(e,t,i,n){return-i*(e/=n)*(e-2)+t},easeInOutQuad:function(e,t,i,n){return(e/=n/2)<1?i/2*e*e+t:-i/2*(--e*(e-2)-1)+t},easeInCubic:function(e,t,i,n){return i*(e/=n)*e*e+t},easeOutCubic:function(e,t,i,n){return i*((e=e/n-1)*e*e+1)+t},easeInOutCubic:function(e,t,i,n){return(e/=n/2)<1?i/2*e*e*e+t:i/2*((e-=2)*e*e+2)+t},easeInQuart:function(e,t,i,n){return i*(e/=n)*e*e*e+t},easeOutQuart:function(e,t,i,n){return-i*((e=e/n-1)*e*e*e-1)+t},easeInOutQuart:function(e,t,i,n){return(e/=n/2)<1?i/2*e*e*e*e+t:-i/2*((e-=2)*e*e*e-2)+t},easeInQuint:function(e,t,i,n){return i*(e/=n)*e*e*e*e+t},easeOutQuint:function(e,t,i,n){return i*((e=e/n-1)*e*e*e*e+1)+t},easeInOutQuint:function(e,t,i,n){return(e/=n/2)<1?i/2*e*e*e*e*e+t:i/2*((e-=2)*e*e*e*e+2)+t},easeInSine:function(e,t,i,n){return-i*Math.cos(e/n*(Math.PI/2))+i+t},easeOutSine:function(e,t,i,n){return i*Math.sin(e/n*(Math.PI/2))+t},easeInOutSine:function(e,t,i,n){return-i/2*(Math.cos(Math.PI*e/n)-1)+t},easeInExpo:function(e,t,i,n){return 0===e?t:i*Math.pow(2,10*(e/n-1))+t},easeOutExpo:function(e,t,i,n){return e===n?t+i:i*(1-Math.pow(2,-10*e/n))+t},easeInOutExpo:function(e,t,i,n){return 0===e?t:e===n?t+i:(e/=n/2)<1?i/2*Math.pow(2,10*(e-1))+t:i/2*(2-Math.pow(2,-10*--e))+t},easeInCirc:function(e,t,i,n){return-i*(Math.sqrt(1-(e/=n)*e)-1)+t},easeOutCirc:function(e,t,i,n){return i*Math.sqrt(1-(e=e/n-1)*e)+t},easeInOutCirc:function(e,t,i,n){return(e/=n/2)<1?-i/2*(Math.sqrt(1-e*e)-1)+t:i/2*(Math.sqrt(1-(e-=2)*e)+1)+t},easeInElastic:function(i,n,r,o){var a=0;return 0===i?n:1==(i/=o)?n+r:(a||(a=.3*o),-t(e(r,r,a,1.70158),i,o)+n)},easeOutElastic:function(t,i,n,r){var o=0;if(0===t)return i;if(1==(t/=r))return i+n;o||(o=.3*r);var a=e(n,n,o,1.70158);return a.a*Math.pow(2,-10*t)*Math.sin((t*r-a.s)*(2*Math.PI)/a.p)+a.c+i},easeInOutElastic:function(i,n,r,o){var a=0;if(0===i)return n;if(2==(i/=o/2))return n+r;a||(a=o*(.3*1.5));var s=e(r,r,a,1.70158);return i<1?-.5*t(s,i,o)+n:s.a*Math.pow(2,-10*(i-=1))*Math.sin((i*o-s.s)*(2*Math.PI)/s.p)*.5+s.c+n},easeInBack:function(e,t,i,n,r){return void 0===r&&(r=1.70158),i*(e/=n)*e*((r+1)*e-r)+t},easeOutBack:function(e,t,i,n,r){return void 0===r&&(r=1.70158),i*((e=e/n-1)*e*((r+1)*e+r)+1)+t},easeInOutBack:function(e,t,i,n,r){return void 0===r&&(r=1.70158),(e/=n/2)<1?i/2*(e*e*((1+(r*=1.525))*e-r))+t:i/2*((e-=2)*e*((1+(r*=1.525))*e+r)+2)+t},easeInBounce:i,easeOutBounce:n,easeInOutBounce:function(e,t,r,o){return e<o/2?.5*i(2*e,0,r,o)+t:.5*n(2*e-o,0,r,o)+.5*r+t}}}(),function(e){var t=e.fabric||(e.fabric={}),i=t.util.object.extend,n=t.util.object.clone,r=t.util.toFixed,o=t.util.parseUnit,a=t.util.multiplyTransformMatrices,s={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},l={stroke:"strokeOpacity",fill:"fillOpacity"},c="font-size",u="clip-path";function h(e){return e in s?s[e]:e}function d(e,i,n,r){var s,l=Array.isArray(i);if("fill"!==e&&"stroke"!==e||"none"!==i){if("strokeUniform"===e)return"non-scaling-stroke"===i;if("strokeDashArray"===e)i="none"===i?null:i.replace(/,/g," ").split(/\s+/).map(parseFloat);else if("transformMatrix"===e)i=n&&n.transformMatrix?a(n.transformMatrix,t.parseTransformAttribute(i)):t.parseTransformAttribute(i);else if("visible"===e)i="none"!==i&&"hidden"!==i,n&&!1===n.visible&&(i=!1);else if("opacity"===e)i=parseFloat(i),n&&void 0!==n.opacity&&(i*=n.opacity);else if("textAnchor"===e)i="start"===i?"left":"end"===i?"right":"center";else if("charSpacing"===e)s=o(i,r)/r*1e3;else if("paintFirst"===e){var c=i.indexOf("fill"),u=i.indexOf("stroke");i="fill",(c>-1&&u>-1&&u<c||-1===c&&u>-1)&&(i="stroke")}else{if("href"===e||"xlink:href"===e||"font"===e)return i;if("imageSmoothing"===e)return"optimizeQuality"===i;s=l?i.map(o):o(i,r)}}else i="";return!l&&isNaN(s)?i:s}function f(e){return new RegExp("^("+e.join("|")+")\\b","i")}function g(e,t){var i,n,r,o,a=[];for(r=0,o=t.length;r<o;r++)i=t[r],n=e.getElementsByTagName(i),a=a.concat(Array.prototype.slice.call(n));return a}function p(e,t){var i,n=!0;return(i=m(e,t.pop()))&&t.length&&(n=function(e,t){for(var i,n=!0;e.parentNode&&1===e.parentNode.nodeType&&t.length;)n&&(i=t.pop()),n=m(e=e.parentNode,i);return 0===t.length}(e,t)),i&&n&&0===t.length}function m(e,t){var i,n,r=e.nodeName,o=e.getAttribute("class"),a=e.getAttribute("id");if(i=new RegExp("^"+r,"i"),t=t.replace(i,""),a&&t.length&&(i=new RegExp("#"+a+"(?![a-zA-Z\\-]+)","i"),t=t.replace(i,"")),o&&t.length)for(n=(o=o.split(" ")).length;n--;)i=new RegExp("\\."+o[n]+"(?![a-zA-Z\\-]+)","i"),t=t.replace(i,"");return 0===t.length}function _(e,t){var i;if(e.getElementById&&(i=e.getElementById(t)),i)return i;var n,r,o,a=e.getElementsByTagName("*");for(r=0,o=a.length;r<o;r++)if(t===(n=a[r]).getAttribute("id"))return n}t.svgValidTagNamesRegEx=f(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),t.svgViewBoxElementsRegEx=f(["symbol","image","marker","pattern","view","svg"]),t.svgInvalidAncestorsRegEx=f(["pattern","defs","symbol","metadata","clipPath","mask","desc"]),t.svgValidParentsRegEx=f(["symbol","g","a","svg","clipPath","defs"]),t.cssRules={},t.gradientDefs={},t.clipPaths={},t.parseTransformAttribute=function(){function e(e,i,n){e[n]=Math.tan(t.util.degreesToRadians(i[0]))}var i=t.iMatrix,n=t.reNum,r=t.commaWsp,o="(?:(?:(matrix)\\s*\\(\\s*("+n+")"+r+"("+n+")"+r+"("+n+")"+r+"("+n+")"+r+"("+n+")"+r+"("+n+")\\s*\\))|(?:(translate)\\s*\\(\\s*("+n+")(?:"+r+"("+n+"))?\\s*\\))|(?:(scale)\\s*\\(\\s*("+n+")(?:"+r+"("+n+"))?\\s*\\))|(?:(rotate)\\s*\\(\\s*("+n+")(?:"+r+"("+n+")"+r+"("+n+"))?\\s*\\))|(?:(skewX)\\s*\\(\\s*("+n+")\\s*\\))|(?:(skewY)\\s*\\(\\s*("+n+")\\s*\\)))",a=new RegExp("^\\s*(?:(?:"+o+"(?:"+r+"*"+o+")*)?)\\s*$"),s=new RegExp(o,"g");return function(n){var r=i.concat(),l=[];if(!n||n&&!a.test(n))return r;n.replace(s,(function(n){var a=new RegExp(o).exec(n).filter((function(e){return!!e})),s=a[1],c=a.slice(2).map(parseFloat);switch(s){case"translate":!function(e,t){e[4]=t[0],2===t.length&&(e[5]=t[1])}(r,c);break;case"rotate":c[0]=t.util.degreesToRadians(c[0]),function(e,i){var n=t.util.cos(i[0]),r=t.util.sin(i[0]),o=0,a=0;3===i.length&&(o=i[1],a=i[2]),e[0]=n,e[1]=r,e[2]=-r,e[3]=n,e[4]=o-(n*o-r*a),e[5]=a-(r*o+n*a)}(r,c);break;case"scale":!function(e,t){var i=t[0],n=2===t.length?t[1]:t[0];e[0]=i,e[3]=n}(r,c);break;case"skewX":e(r,c,2);break;case"skewY":e(r,c,1);break;case"matrix":r=c}l.push(r.concat()),r=i.concat()}));for(var c=l[0];l.length>1;)l.shift(),c=t.util.multiplyTransformMatrices(c,l[0]);return c}}();var v=new RegExp("^\\s*("+t.reNum+"+)\\s*,?\\s*("+t.reNum+"+)\\s*,?\\s*("+t.reNum+"+)\\s*,?\\s*("+t.reNum+"+)\\s*$");function y(e){if(!t.svgViewBoxElementsRegEx.test(e.nodeName))return{};var i,n,r,a,s,l,c=e.getAttribute("viewBox"),u=1,h=1,d=e.getAttribute("width"),f=e.getAttribute("height"),g=e.getAttribute("x")||0,p=e.getAttribute("y")||0,m=e.getAttribute("preserveAspectRatio")||"",_=!c||!(c=c.match(v)),y=!d||!f||"100%"===d||"100%"===f,b=_&&y,S={},w="",C=0,x=0;if(S.width=0,S.height=0,S.toBeParsed=b,_&&(g||p)&&e.parentNode&&"#document"!==e.parentNode.nodeName&&(w=" translate("+o(g)+" "+o(p)+") ",s=(e.getAttribute("transform")||"")+w,e.setAttribute("transform",s),e.removeAttribute("x"),e.removeAttribute("y")),b)return S;if(_)return S.width=o(d),S.height=o(f),S;if(i=-parseFloat(c[1]),n=-parseFloat(c[2]),r=parseFloat(c[3]),a=parseFloat(c[4]),S.minX=i,S.minY=n,S.viewBoxWidth=r,S.viewBoxHeight=a,y?(S.width=r,S.height=a):(S.width=o(d),S.height=o(f),u=S.width/r,h=S.height/a),"none"!==(m=t.util.parsePreserveAspectRatioAttribute(m)).alignX&&("meet"===m.meetOrSlice&&(h=u=u>h?h:u),"slice"===m.meetOrSlice&&(h=u=u>h?u:h),C=S.width-r*u,x=S.height-a*u,"Mid"===m.alignX&&(C/=2),"Mid"===m.alignY&&(x/=2),"Min"===m.alignX&&(C=0),"Min"===m.alignY&&(x=0)),1===u&&1===h&&0===i&&0===n&&0===g&&0===p)return S;if((g||p)&&"#document"!==e.parentNode.nodeName&&(w=" translate("+o(g)+" "+o(p)+") "),s=w+" matrix("+u+" 0 0 "+h+" "+(i*u+C)+" "+(n*h+x)+") ","svg"===e.nodeName){for(l=e.ownerDocument.createElementNS(t.svgNS,"g");e.firstChild;)l.appendChild(e.firstChild);e.appendChild(l)}else(l=e).removeAttribute("x"),l.removeAttribute("y"),s=l.getAttribute("transform")+s;return l.setAttribute("transform",s),S}function b(e,t){var i="xlink:href",n=_(e,t.getAttribute(i).slice(1));if(n&&n.getAttribute(i)&&b(e,n),["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"].forEach((function(e){n&&!t.hasAttribute(e)&&n.hasAttribute(e)&&t.setAttribute(e,n.getAttribute(e))})),!t.children.length)for(var r=n.cloneNode(!0);r.firstChild;)t.appendChild(r.firstChild);t.removeAttribute(i)}t.parseSVGDocument=function(e,i,r,o){if(e){!function(e){for(var i=g(e,["use","svg:use"]),n=0;i.length&&n<i.length;){var r=i[n],o=r.getAttribute("xlink:href")||r.getAttribute("href");if(null===o)return;var a,s,l,c,u=o.slice(1),h=r.getAttribute("x")||0,d=r.getAttribute("y")||0,f=_(e,u).cloneNode(!0),p=(f.getAttribute("transform")||"")+" translate("+h+", "+d+")",m=i.length,v=t.svgNS;if(y(f),/^svg$/i.test(f.nodeName)){var b=f.ownerDocument.createElementNS(v,"g");for(s=0,c=(l=f.attributes).length;s<c;s++)a=l.item(s),b.setAttributeNS(v,a.nodeName,a.nodeValue);for(;f.firstChild;)b.appendChild(f.firstChild);f=b}for(s=0,c=(l=r.attributes).length;s<c;s++)"x"!==(a=l.item(s)).nodeName&&"y"!==a.nodeName&&"xlink:href"!==a.nodeName&&"href"!==a.nodeName&&("transform"===a.nodeName?p=a.nodeValue+" "+p:f.setAttribute(a.nodeName,a.nodeValue));f.setAttribute("transform",p),f.setAttribute("instantiated_by_use","1"),f.removeAttribute("id"),r.parentNode.replaceChild(f,r),i.length===m&&n++}}(e);var a,s,l=t.Object.__uid++,c=y(e),u=t.util.toArray(e.getElementsByTagName("*"));if(c.crossOrigin=o&&o.crossOrigin,c.svgUid=l,0===u.length&&t.isLikelyNode){var h=[];for(a=0,s=(u=e.selectNodes('//*[name(.)!="svg"]')).length;a<s;a++)h[a]=u[a];u=h}var d=u.filter((function(e){return y(e),t.svgValidTagNamesRegEx.test(e.nodeName.replace("svg:",""))&&!function(e,t){for(;e&&(e=e.parentNode);)if(e.nodeName&&t.test(e.nodeName.replace("svg:",""))&&!e.getAttribute("instantiated_by_use"))return!0;return!1}(e,t.svgInvalidAncestorsRegEx)}));if(!d||d&&!d.length)i&&i([],{});else{var f={};u.filter((function(e){return"clipPath"===e.nodeName.replace("svg:","")})).forEach((function(e){var i=e.getAttribute("id");f[i]=t.util.toArray(e.getElementsByTagName("*")).filter((function(e){return t.svgValidTagNamesRegEx.test(e.nodeName.replace("svg:",""))}))})),t.gradientDefs[l]=t.getGradientDefs(e),t.cssRules[l]=t.getCSSRules(e),t.clipPaths[l]=f,t.parseElements(d,(function(e,n){i&&(i(e,c,n,u),delete t.gradientDefs[l],delete t.cssRules[l],delete t.clipPaths[l])}),n(c),r,o)}}};var S=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+t.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+t.reNum+"))?\\s+(.*)");i(t,{parseFontDeclaration:function(e,t){var i=e.match(S);if(i){var n=i[1],r=i[3],a=i[4],s=i[5],l=i[6];n&&(t.fontStyle=n),r&&(t.fontWeight=isNaN(parseFloat(r))?r:parseFloat(r)),a&&(t.fontSize=o(a)),l&&(t.fontFamily=l),s&&(t.lineHeight="normal"===s?1:s)}},getGradientDefs:function(e){var t,i=g(e,["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"]),n=0,r={};for(n=i.length;n--;)(t=i[n]).getAttribute("xlink:href")&&b(e,t),r[t.getAttribute("id")]=t;return r},parseAttributes:function(e,n,a){if(e){var s,f,g,m={};void 0===a&&(a=e.getAttribute("svgUid")),e.parentNode&&t.svgValidParentsRegEx.test(e.parentNode.nodeName)&&(m=t.parseAttributes(e.parentNode,n,a));var _=n.reduce((function(t,i){return(s=e.getAttribute(i))&&(t[i]=s),t}),{}),v=i(function(e,i){var n={};for(var r in t.cssRules[i])if(p(e,r.split(" ")))for(var o in t.cssRules[i][r])n[o]=t.cssRules[i][r][o];return n}(e,a),t.parseStyleAttribute(e));_=i(_,v),v[u]&&e.setAttribute(u,v[u]),f=g=m.fontSize||t.Text.DEFAULT_SVG_FONT_SIZE,_[c]&&(_[c]=f=o(_[c],g));var y,b,S={};for(var w in _)b=d(y=h(w),_[w],m,f),S[y]=b;S&&S.font&&t.parseFontDeclaration(S.font,S);var C=i(m,S);return t.svgValidParentsRegEx.test(e.nodeName)?C:function(e){for(var i in l)if(void 0!==e[l[i]]&&""!==e[i]){if(void 0===e[i]){if(!t.Object.prototype[i])continue;e[i]=t.Object.prototype[i]}if(0!==e[i].indexOf("url(")){var n=new t.Color(e[i]);e[i]=n.setAlpha(r(n.getAlpha()*e[l[i]],2)).toRgba()}}return e}(C)}},parseElements:function(e,i,n,r,o){new t.ElementsParser(e,i,n,r,o).parse()},parseStyleAttribute:function(e){var t={},i=e.getAttribute("style");return i?("string"==typeof i?function(e,t){var i,n;e.replace(/;\s*$/,"").split(";").forEach((function(e){var r=e.split(":");i=r[0].trim().toLowerCase(),n=r[1].trim(),t[i]=n}))}(i,t):function(e,t){var i,n;for(var r in e)void 0!==e[r]&&(i=r.toLowerCase(),n=e[r],t[i]=n)}(i,t),t):t},parsePointsAttribute:function(e){if(!e)return null;var t,i,n=[];for(t=0,i=(e=(e=e.replace(/,/g," ").trim()).split(/\s+/)).length;t<i;t+=2)n.push({x:parseFloat(e[t]),y:parseFloat(e[t+1])});return n},getCSSRules:function(e){var i,n,r=e.getElementsByTagName("style"),o={};for(i=0,n=r.length;i<n;i++){var a=r[i].textContent;""!==(a=a.replace(/\/\*[\s\S]*?\*\//g,"")).trim()&&a.split("}").filter((function(e){return e.trim()})).forEach((function(e){var r=e.split("{"),a={},s=r[1].trim().split(";").filter((function(e){return e.trim()}));for(i=0,n=s.length;i<n;i++){var l=s[i].split(":"),c=l[0].trim(),u=l[1].trim();a[c]=u}(e=r[0].trim()).split(",").forEach((function(e){""!==(e=e.replace(/^svg/i,"").trim())&&(o[e]?t.util.object.extend(o[e],a):o[e]=t.util.object.clone(a))}))}))}return o},loadSVGFromURL:function(e,i,n,r){e=e.replace(/^\n\s*/,"").trim(),new t.util.request(e,{method:"get",onComplete:function(e){var o=e.responseXML;if(!o||!o.documentElement)return i&&i(null),!1;t.parseSVGDocument(o.documentElement,(function(e,t,n,r){i&&i(e,t,n,r)}),n,r)}})},loadSVGFromString:function(e,i,n,r){var o=(new t.window.DOMParser).parseFromString(e.trim(),"text/xml");t.parseSVGDocument(o.documentElement,(function(e,t,n,r){i(e,t,n,r)}),n,r)}})}(t),x.ElementsParser=function(e,t,i,n,r,o){this.elements=e,this.callback=t,this.options=i,this.reviver=n,this.svgUid=i&&i.svgUid||0,this.parsingOptions=r,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=o},(m=x.ElementsParser.prototype).parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},m.createObjects=function(){var e=this;this.elements.forEach((function(t,i){t.setAttribute("svgUid",e.svgUid),e.createObject(t,i)}))},m.findTag=function(e){return x[x.util.string.capitalize(e.tagName.replace("svg:",""))]},m.createObject=function(e,t){var i=this.findTag(e);if(i&&i.fromElement)try{i.fromElement(e,this.createCallback(t,e),this.options)}catch(e){x.log(e)}else this.checkIfDone()},m.createCallback=function(e,t){var i=this;return function(n){var r;i.resolveGradient(n,t,"fill"),i.resolveGradient(n,t,"stroke"),n instanceof x.Image&&n._originalElement&&(r=n.parsePreserveAspectRatioAttribute(t)),n._removeTransformMatrix(r),i.resolveClipPath(n,t),i.reviver&&i.reviver(t,n),i.instances[e]=n,i.checkIfDone()}},m.extractPropertyDefinition=function(e,t,i){var n=e[t],r=this.regexUrl;if(r.test(n)){r.lastIndex=0;var o=r.exec(n)[1];return r.lastIndex=0,x[i][this.svgUid][o]}},m.resolveGradient=function(e,t,i){var n=this.extractPropertyDefinition(e,i,"gradientDefs");if(n){var r=t.getAttribute(i+"-opacity"),o=x.Gradient.fromElement(n,e,r,this.options);e.set(i,o)}},m.createClipPathCallback=function(e,t){return function(e){e._removeTransformMatrix(),e.fillRule=e.clipRule,t.push(e)}},m.resolveClipPath=function(e,t){var i,n,r,o,a=this.extractPropertyDefinition(e,"clipPath","clipPaths");if(a){r=[],n=x.util.invertTransform(e.calcTransformMatrix());for(var s=a[0].parentNode,l=t;l.parentNode&&l.getAttribute("clip-path")!==e.clipPath;)l=l.parentNode;l.parentNode.appendChild(s);for(var c=0;c<a.length;c++)i=a[c],this.findTag(i).fromElement(i,this.createClipPathCallback(e,r),this.options);a=1===r.length?r[0]:new x.Group(r),o=x.util.multiplyTransformMatrices(n,a.calcTransformMatrix()),a.clipPath&&this.resolveClipPath(a,l);var u=x.util.qrDecompose(o);a.flipX=!1,a.flipY=!1,a.set("scaleX",u.scaleX),a.set("scaleY",u.scaleY),a.angle=u.angle,a.skewX=u.skewX,a.skewY=0,a.setPositionByOrigin({x:u.translateX,y:u.translateY},"center","center"),e.clipPath=a}else delete e.clipPath},m.checkIfDone=function(){0==--this.numElements&&(this.instances=this.instances.filter((function(e){return null!=e})),this.callback(this.instances,this.elements))},function(e){var t=e.fabric||(e.fabric={});function i(e,t){this.x=e,this.y=t}t.Point?t.warn("fabric.Point is already defined"):(t.Point=i,i.prototype={type:"point",constructor:i,add:function(e){return new i(this.x+e.x,this.y+e.y)},addEquals:function(e){return this.x+=e.x,this.y+=e.y,this},scalarAdd:function(e){return new i(this.x+e,this.y+e)},scalarAddEquals:function(e){return this.x+=e,this.y+=e,this},subtract:function(e){return new i(this.x-e.x,this.y-e.y)},subtractEquals:function(e){return this.x-=e.x,this.y-=e.y,this},scalarSubtract:function(e){return new i(this.x-e,this.y-e)},scalarSubtractEquals:function(e){return this.x-=e,this.y-=e,this},multiply:function(e){return new i(this.x*e,this.y*e)},multiplyEquals:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return new i(this.x/e,this.y/e)},divideEquals:function(e){return this.x/=e,this.y/=e,this},eq:function(e){return this.x===e.x&&this.y===e.y},lt:function(e){return this.x<e.x&&this.y<e.y},lte:function(e){return this.x<=e.x&&this.y<=e.y},gt:function(e){return this.x>e.x&&this.y>e.y},gte:function(e){return this.x>=e.x&&this.y>=e.y},lerp:function(e,t){return void 0===t&&(t=.5),t=Math.max(Math.min(1,t),0),new i(this.x+(e.x-this.x)*t,this.y+(e.y-this.y)*t)},distanceFrom:function(e){var t=this.x-e.x,i=this.y-e.y;return Math.sqrt(t*t+i*i)},midPointFrom:function(e){return this.lerp(e)},min:function(e){return new i(Math.min(this.x,e.x),Math.min(this.y,e.y))},max:function(e){return new i(Math.max(this.x,e.x),Math.max(this.y,e.y))},toString:function(){return this.x+","+this.y},setXY:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setFromPoint:function(e){return this.x=e.x,this.y=e.y,this},swap:function(e){var t=this.x,i=this.y;this.x=e.x,this.y=e.y,e.x=t,e.y=i},clone:function(){return new i(this.x,this.y)}})}(t),function(e){var t=e.fabric||(e.fabric={});function i(e){this.status=e,this.points=[]}t.Intersection?t.warn("fabric.Intersection is already defined"):(t.Intersection=i,t.Intersection.prototype={constructor:i,appendPoint:function(e){return this.points.push(e),this},appendPoints:function(e){return this.points=this.points.concat(e),this}},t.Intersection.intersectLineLine=function(e,n,r,o){var a,s=(o.x-r.x)*(e.y-r.y)-(o.y-r.y)*(e.x-r.x),l=(n.x-e.x)*(e.y-r.y)-(n.y-e.y)*(e.x-r.x),c=(o.y-r.y)*(n.x-e.x)-(o.x-r.x)*(n.y-e.y);if(0!==c){var u=s/c,h=l/c;0<=u&&u<=1&&0<=h&&h<=1?(a=new i("Intersection")).appendPoint(new t.Point(e.x+u*(n.x-e.x),e.y+u*(n.y-e.y))):a=new i}else a=new i(0===s||0===l?"Coincident":"Parallel");return a},t.Intersection.intersectLinePolygon=function(e,t,n){var r,o,a,s,l=new i,c=n.length;for(s=0;s<c;s++)r=n[s],o=n[(s+1)%c],a=i.intersectLineLine(e,t,r,o),l.appendPoints(a.points);return l.points.length>0&&(l.status="Intersection"),l},t.Intersection.intersectPolygonPolygon=function(e,t){var n,r=new i,o=e.length;for(n=0;n<o;n++){var a=e[n],s=e[(n+1)%o],l=i.intersectLinePolygon(a,s,t);r.appendPoints(l.points)}return r.points.length>0&&(r.status="Intersection"),r},t.Intersection.intersectPolygonRectangle=function(e,n,r){var o=n.min(r),a=n.max(r),s=new t.Point(a.x,o.y),l=new t.Point(o.x,a.y),c=i.intersectLinePolygon(o,s,e),u=i.intersectLinePolygon(s,a,e),h=i.intersectLinePolygon(a,l,e),d=i.intersectLinePolygon(l,o,e),f=new i;return f.appendPoints(c.points),f.appendPoints(u.points),f.appendPoints(h.points),f.appendPoints(d.points),f.points.length>0&&(f.status="Intersection"),f})}(t),function(e){var t=e.fabric||(e.fabric={});function i(e){e?this._tryParsingColor(e):this.setSource([0,0,0,1])}function n(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e}t.Color?t.warn("fabric.Color is already defined."):(t.Color=i,t.Color.prototype={_tryParsingColor:function(e){var t;e in i.colorNameMap&&(e=i.colorNameMap[e]),"transparent"===e&&(t=[255,255,255,0]),t||(t=i.sourceFromHex(e)),t||(t=i.sourceFromRgb(e)),t||(t=i.sourceFromHsl(e)),t||(t=[0,0,0,1]),t&&this.setSource(t)},_rgbToHsl:function(e,i,n){e/=255,i/=255,n/=255;var r,o,a,s=t.util.array.max([e,i,n]),l=t.util.array.min([e,i,n]);if(a=(s+l)/2,s===l)r=o=0;else{var c=s-l;switch(o=a>.5?c/(2-s-l):c/(s+l),s){case e:r=(i-n)/c+(i<n?6:0);break;case i:r=(n-e)/c+2;break;case n:r=(e-i)/c+4}r/=6}return[Math.round(360*r),Math.round(100*o),Math.round(100*a)]},getSource:function(){return this._source},setSource:function(e){this._source=e},toRgb:function(){var e=this.getSource();return"rgb("+e[0]+","+e[1]+","+e[2]+")"},toRgba:function(){var e=this.getSource();return"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")"},toHsl:function(){var e=this.getSource(),t=this._rgbToHsl(e[0],e[1],e[2]);return"hsl("+t[0]+","+t[1]+"%,"+t[2]+"%)"},toHsla:function(){var e=this.getSource(),t=this._rgbToHsl(e[0],e[1],e[2]);return"hsla("+t[0]+","+t[1]+"%,"+t[2]+"%,"+e[3]+")"},toHex:function(){var e,t,i,n=this.getSource();return e=1===(e=n[0].toString(16)).length?"0"+e:e,t=1===(t=n[1].toString(16)).length?"0"+t:t,i=1===(i=n[2].toString(16)).length?"0"+i:i,e.toUpperCase()+t.toUpperCase()+i.toUpperCase()},toHexa:function(){var e,t=this.getSource();return e=1===(e=(e=Math.round(255*t[3])).toString(16)).length?"0"+e:e,this.toHex()+e.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(e){var t=this.getSource();return t[3]=e,this.setSource(t),this},toGrayscale:function(){var e=this.getSource(),t=parseInt((.3*e[0]+.59*e[1]+.11*e[2]).toFixed(0),10),i=e[3];return this.setSource([t,t,t,i]),this},toBlackWhite:function(e){var t=this.getSource(),i=(.3*t[0]+.59*t[1]+.11*t[2]).toFixed(0),n=t[3];return e=e||127,i=Number(i)<Number(e)?0:255,this.setSource([i,i,i,n]),this},overlayWith:function(e){e instanceof i||(e=new i(e));var t,n=[],r=this.getAlpha(),o=this.getSource(),a=e.getSource();for(t=0;t<3;t++)n.push(Math.round(.5*o[t]+.5*a[t]));return n[3]=r,this.setSource(n),this}},t.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,t.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,t.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,t.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},t.Color.fromRgb=function(e){return i.fromSource(i.sourceFromRgb(e))},t.Color.sourceFromRgb=function(e){var t=e.match(i.reRGBa);if(t){var n=parseInt(t[1],10)/(/%$/.test(t[1])?100:1)*(/%$/.test(t[1])?255:1),r=parseInt(t[2],10)/(/%$/.test(t[2])?100:1)*(/%$/.test(t[2])?255:1),o=parseInt(t[3],10)/(/%$/.test(t[3])?100:1)*(/%$/.test(t[3])?255:1);return[parseInt(n,10),parseInt(r,10),parseInt(o,10),t[4]?parseFloat(t[4]):1]}},t.Color.fromRgba=i.fromRgb,t.Color.fromHsl=function(e){return i.fromSource(i.sourceFromHsl(e))},t.Color.sourceFromHsl=function(e){var t=e.match(i.reHSLa);if(t){var r,o,a,s=(parseFloat(t[1])%360+360)%360/360,l=parseFloat(t[2])/(/%$/.test(t[2])?100:1),c=parseFloat(t[3])/(/%$/.test(t[3])?100:1);if(0===l)r=o=a=c;else{var u=c<=.5?c*(l+1):c+l-c*l,h=2*c-u;r=n(h,u,s+1/3),o=n(h,u,s),a=n(h,u,s-1/3)}return[Math.round(255*r),Math.round(255*o),Math.round(255*a),t[4]?parseFloat(t[4]):1]}},t.Color.fromHsla=i.fromHsl,t.Color.fromHex=function(e){return i.fromSource(i.sourceFromHex(e))},t.Color.sourceFromHex=function(e){if(e.match(i.reHex)){var t=e.slice(e.indexOf("#")+1),n=3===t.length||4===t.length,r=8===t.length||4===t.length,o=n?t.charAt(0)+t.charAt(0):t.substring(0,2),a=n?t.charAt(1)+t.charAt(1):t.substring(2,4),s=n?t.charAt(2)+t.charAt(2):t.substring(4,6),l=r?n?t.charAt(3)+t.charAt(3):t.substring(6,8):"FF";return[parseInt(o,16),parseInt(a,16),parseInt(s,16),parseFloat((parseInt(l,16)/255).toFixed(2))]}},t.Color.fromSource=function(e){var t=new i;return t.setSource(e),t})}(t),function(e){var t=e.fabric||(e.fabric={}),i=["e","se","s","sw","w","nw","n","ne","e"],n=["ns","nesw","ew","nwse"],r={},o="left",a="top",s="right",l="bottom",c="center",u={top:l,bottom:a,left:s,right:o,center:c},h=t.util.radiansToDegrees,d=Math.sign||function(e){return(e>0)-(e<0)||+e};function f(e,t){var i=e.angle+h(Math.atan2(t.y,t.x))+360;return Math.round(i%360/45)}function g(e,i){var n=i.transform.target,r=n.canvas,o=t.util.object.clone(i);o.target=n,r&&r.fire("object:"+e,o),n.fire(e,i)}function p(e,t){var i=t.canvas,n=e[i.uniScaleKey];return i.uniformScaling&&!n||!i.uniformScaling&&n}function m(e){return e.originX===c&&e.originY===c}function _(e,t,i){var n=e.lockScalingX,r=e.lockScalingY;return!((!n||!r)&&(t||!n&&!r||!i)&&(!n||"x"!==t)&&(!r||"y"!==t))}function v(e,t,i,n){return{e:e,transform:t,pointer:{x:i,y:n}}}function y(e){return function(t,i,n,r){var o=i.target,a=o.getCenterPoint(),s=o.translateToOriginPoint(a,i.originX,i.originY),l=e(t,i,n,r);return o.setPositionByOrigin(s,i.originX,i.originY),l}}function b(e,t){return function(i,n,r,o){var a=t(i,n,r,o);return a&&g(e,v(i,n,r,o)),a}}function S(e,i,n,r,o){var a=e.target,s=a.controls[e.corner],l=a.canvas.getZoom(),c=a.padding/l,u=a.toLocalPoint(new t.Point(r,o),i,n);return u.x>=c&&(u.x-=c),u.x<=-c&&(u.x+=c),u.y>=c&&(u.y-=c),u.y<=c&&(u.y+=c),u.x-=s.offsetX,u.y-=s.offsetY,u}function w(e){return e.flipX!==e.flipY}function C(e,t,i,n,r){if(0!==e[t]){var o=r/e._getTransformedDimensions()[n]*e[i];e.set(i,o)}}function x(e,t,i,n){var r,c=t.target,u=c._getTransformedDimensions(0,c.skewY),d=S(t,t.originX,t.originY,i,n),f=Math.abs(2*d.x)-u.x,g=c.skewX;f<2?r=0:(r=h(Math.atan2(f/c.scaleX,u.y/c.scaleY)),t.originX===o&&t.originY===l&&(r=-r),t.originX===s&&t.originY===a&&(r=-r),w(c)&&(r=-r));var p=g!==r;if(p){var m=c._getTransformedDimensions().y;c.set("skewX",r),C(c,"skewY","scaleY","y",m)}return p}function T(e,t,i,n){var r,c=t.target,u=c._getTransformedDimensions(c.skewX,0),d=S(t,t.originX,t.originY,i,n),f=Math.abs(2*d.y)-u.y,g=c.skewY;f<2?r=0:(r=h(Math.atan2(f/c.scaleY,u.x/c.scaleX)),t.originX===o&&t.originY===l&&(r=-r),t.originX===s&&t.originY===a&&(r=-r),w(c)&&(r=-r));var p=g!==r;if(p){var m=c._getTransformedDimensions().x;c.set("skewY",r),C(c,"skewX","scaleX","x",m)}return p}function E(e,t,i,n,r){r=r||{};var o,a,s,l,c,h,f=t.target,g=f.lockScalingX,v=f.lockScalingY,y=r.by,b=p(e,f),w=_(f,y,b),C=t.gestureScale;if(w)return!1;if(C)a=t.scaleX*C,s=t.scaleY*C;else{if(o=S(t,t.originX,t.originY,i,n),c="y"!==y?d(o.x):1,h="x"!==y?d(o.y):1,t.signX||(t.signX=c),t.signY||(t.signY=h),f.lockScalingFlip&&(t.signX!==c||t.signY!==h))return!1;if(l=f._getTransformedDimensions(),b&&!y){var x=Math.abs(o.x)+Math.abs(o.y),T=t.original,E=x/(Math.abs(l.x*T.scaleX/f.scaleX)+Math.abs(l.y*T.scaleY/f.scaleY));a=T.scaleX*E,s=T.scaleY*E}else a=Math.abs(o.x*f.scaleX/l.x),s=Math.abs(o.y*f.scaleY/l.y);m(t)&&(a*=2,s*=2),t.signX!==c&&"y"!==y&&(t.originX=u[t.originX],a*=-1,t.signX=c),t.signY!==h&&"x"!==y&&(t.originY=u[t.originY],s*=-1,t.signY=h)}var I=f.scaleX,O=f.scaleY;return y?("x"===y&&f.set("scaleX",a),"y"===y&&f.set("scaleY",s)):(!g&&f.set("scaleX",a),!v&&f.set("scaleY",s)),I!==f.scaleX||O!==f.scaleY}r.scaleCursorStyleHandler=function(e,t,n){var r=p(e,n),o="";if(0!==t.x&&0===t.y?o="x":0===t.x&&0!==t.y&&(o="y"),_(n,o,r))return"not-allowed";var a=f(n,t);return i[a]+"-resize"},r.skewCursorStyleHandler=function(e,t,i){var r="not-allowed";if(0!==t.x&&i.lockSkewingY)return r;if(0!==t.y&&i.lockSkewingX)return r;var o=f(i,t)%4;return n[o]+"-resize"},r.scaleSkewCursorStyleHandler=function(e,t,i){return e[i.canvas.altActionKey]?r.skewCursorStyleHandler(e,t,i):r.scaleCursorStyleHandler(e,t,i)},r.rotationWithSnapping=b("rotating",y((function(e,t,i,n){var r=t,o=r.target,a=o.translateToOriginPoint(o.getCenterPoint(),r.originX,r.originY);if(o.lockRotation)return!1;var s,l=Math.atan2(r.ey-a.y,r.ex-a.x),c=Math.atan2(n-a.y,i-a.x),u=h(c-l+r.theta);if(o.snapAngle>0){var d=o.snapAngle,f=o.snapThreshold||d,g=Math.ceil(u/d)*d,p=Math.floor(u/d)*d;Math.abs(u-p)<f?u=p:Math.abs(u-g)<f&&(u=g)}return u<0&&(u=360+u),u%=360,s=o.angle!==u,o.angle=u,s}))),r.scalingEqually=b("scaling",y((function(e,t,i,n){return E(e,t,i,n)}))),r.scalingX=b("scaling",y((function(e,t,i,n){return E(e,t,i,n,{by:"x"})}))),r.scalingY=b("scaling",y((function(e,t,i,n){return E(e,t,i,n,{by:"y"})}))),r.scalingYOrSkewingX=function(e,t,i,n){return e[t.target.canvas.altActionKey]?r.skewHandlerX(e,t,i,n):r.scalingY(e,t,i,n)},r.scalingXOrSkewingY=function(e,t,i,n){return e[t.target.canvas.altActionKey]?r.skewHandlerY(e,t,i,n):r.scalingX(e,t,i,n)},r.changeWidth=b("resizing",y((function(e,t,i,n){var r=t.target,o=S(t,t.originX,t.originY,i,n),a=r.strokeWidth/(r.strokeUniform?r.scaleX:1),s=m(t)?2:1,l=r.width,c=Math.abs(o.x*s/r.scaleX)-a;return r.set("width",Math.max(c,0)),l!==c}))),r.skewHandlerX=function(e,t,i,n){var r,l=t.target,u=l.skewX,h=t.originY;return!l.lockSkewingX&&(0===u?r=S(t,c,c,i,n).x>0?o:s:(u>0&&(r=h===a?o:s),u<0&&(r=h===a?s:o),w(l)&&(r=r===o?s:o)),t.originX=r,b("skewing",y(x))(e,t,i,n))},r.skewHandlerY=function(e,t,i,n){var r,s=t.target,u=s.skewY,h=t.originX;return!s.lockSkewingY&&(0===u?r=S(t,c,c,i,n).y>0?a:l:(u>0&&(r=h===o?a:l),u<0&&(r=h===o?l:a),w(s)&&(r=r===a?l:a)),t.originY=r,b("skewing",y(T))(e,t,i,n))},r.dragHandler=function(e,t,i,n){var r=t.target,o=i-t.offsetX,a=n-t.offsetY,s=!r.get("lockMovementX")&&r.left!==o,l=!r.get("lockMovementY")&&r.top!==a;return s&&r.set("left",o),l&&r.set("top",a),(s||l)&&g("moving",v(e,t,i,n)),s||l},r.scaleOrSkewActionName=function(e,t,i){var n=e[i.canvas.altActionKey];return 0===t.x?n?"skewX":"scaleY":0===t.y?n?"skewY":"scaleX":void 0},r.rotationStyleHandler=function(e,t,i){return i.lockRotation?"not-allowed":t.cursorStyle},r.fireEvent=g,r.wrapWithFixedAnchor=y,r.wrapWithFireEvent=b,r.getLocalPoint=S,t.controlsUtils=r}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.util.degreesToRadians,n=t.controlsUtils;n.renderCircleControl=function(e,t,i,n,r){n=n||{};var o,a=this.sizeX||n.cornerSize||r.cornerSize,s=this.sizeY||n.cornerSize||r.cornerSize,l=void 0!==n.transparentCorners?n.transparentCorners:r.transparentCorners,c=l?"stroke":"fill",u=!l&&(n.cornerStrokeColor||r.cornerStrokeColor),h=t,d=i;e.save(),e.fillStyle=n.cornerColor||r.cornerColor,e.strokeStyle=n.cornerStrokeColor||r.cornerStrokeColor,a>s?(o=a,e.scale(1,s/a),d=i*a/s):s>a?(o=s,e.scale(a/s,1),h=t*s/a):o=a,e.lineWidth=1,e.beginPath(),e.arc(h,d,o/2,0,2*Math.PI,!1),e[c](),u&&e.stroke(),e.restore()},n.renderSquareControl=function(e,t,n,r,o){r=r||{};var a=this.sizeX||r.cornerSize||o.cornerSize,s=this.sizeY||r.cornerSize||o.cornerSize,l=void 0!==r.transparentCorners?r.transparentCorners:o.transparentCorners,c=l?"stroke":"fill",u=!l&&(r.cornerStrokeColor||o.cornerStrokeColor),h=a/2,d=s/2;e.save(),e.fillStyle=r.cornerColor||o.cornerColor,e.strokeStyle=r.cornerStrokeColor||o.cornerStrokeColor,e.lineWidth=1,e.translate(t,n),e.rotate(i(o.angle)),e[c+"Rect"](-h,-d,a,s),u&&e.strokeRect(-h,-d,a,s),e.restore()}}(t),function(e){var t=e.fabric||(e.fabric={});t.Control=function(e){for(var t in e)this[t]=e[t]},t.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(e,t){return t.cursorStyle},getActionName:function(e,t){return t.actionName},getVisibility:function(e,t){var i=e._controlsVisibility;return i&&void 0!==i[t]?i[t]:this.visible},setVisibility:function(e){this.visible=e},positionHandler:function(e,i){return t.util.transformPoint({x:this.x*e.x+this.offsetX,y:this.y*e.y+this.offsetY},i)},calcCornerCoords:function(e,i,n,r,o){var a,s,l,c,u=o?this.touchSizeX:this.sizeX,h=o?this.touchSizeY:this.sizeY;if(u&&h&&u!==h){var d=Math.atan2(h,u),f=Math.sqrt(u*u+h*h)/2,g=d-t.util.degreesToRadians(e),p=Math.PI/2-d-t.util.degreesToRadians(e);a=f*t.util.cos(g),s=f*t.util.sin(g),l=f*t.util.cos(p),c=f*t.util.sin(p)}else f=.7071067812*(u&&h?u:i),g=t.util.degreesToRadians(45-e),a=l=f*t.util.cos(g),s=c=f*t.util.sin(g);return{tl:{x:n-c,y:r-l},tr:{x:n+a,y:r-s},bl:{x:n-a,y:r+s},br:{x:n+c,y:r+l}}},render:function(e,i,n,r,o){"circle"===((r=r||{}).cornerStyle||o.cornerStyle)?t.controlsUtils.renderCircleControl.call(this,e,i,n,r,o):t.controlsUtils.renderSquareControl.call(this,e,i,n,r,o)}}}(t),function(){function e(e,t){var i,n,r,o,a=e.getAttribute("style"),s=e.getAttribute("offset")||0;if(s=(s=parseFloat(s)/(/%$/.test(s)?100:1))<0?0:s>1?1:s,a){var l=a.split(/\s*;\s*/);for(""===l[l.length-1]&&l.pop(),o=l.length;o--;){var c=l[o].split(/\s*:\s*/),u=c[0].trim(),h=c[1].trim();"stop-color"===u?i=h:"stop-opacity"===u&&(r=h)}}return i||(i=e.getAttribute("stop-color")||"rgb(0,0,0)"),r||(r=e.getAttribute("stop-opacity")),n=(i=new x.Color(i)).getAlpha(),r=isNaN(parseFloat(r))?1:parseFloat(r),r*=n*t,{offset:s,color:i.toRgb(),opacity:r}}var t=x.util.object.clone;x.Gradient=x.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(e){e||(e={}),e.coords||(e.coords={});var t,i=this;Object.keys(e).forEach((function(t){i[t]=e[t]})),this.id?this.id+="_"+x.Object.__uid++:this.id=x.Object.__uid++,t={x1:e.coords.x1||0,y1:e.coords.y1||0,x2:e.coords.x2||0,y2:e.coords.y2||0},"radial"===this.type&&(t.r1=e.coords.r1||0,t.r2=e.coords.r2||0),this.coords=t,this.colorStops=e.colorStops.slice()},addColorStop:function(e){for(var t in e){var i=new x.Color(e[t]);this.colorStops.push({offset:parseFloat(t),color:i.toRgb(),opacity:i.getAlpha()})}return this},toObject:function(e){var t={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return x.util.populateWithProperties(this,t,e),t},toSVG:function(e,i){var n,r,o,a,s=t(this.coords,!0),l=(i=i||{},t(this.colorStops,!0)),c=s.r1>s.r2,u=this.gradientTransform?this.gradientTransform.concat():x.iMatrix.concat(),h=-this.offsetX,d=-this.offsetY,f=!!i.additionalTransform,g="pixels"===this.gradientUnits?"userSpaceOnUse":"objectBoundingBox";if(l.sort((function(e,t){return e.offset-t.offset})),"objectBoundingBox"===g?(h/=e.width,d/=e.height):(h+=e.width/2,d+=e.height/2),"path"===e.type&&"percentage"!==this.gradientUnits&&(h-=e.pathOffset.x,d-=e.pathOffset.y),u[4]-=h,u[5]-=d,a='id="SVGID_'+this.id+'" gradientUnits="'+g+'"',a+=' gradientTransform="'+(f?i.additionalTransform+" ":"")+x.util.matrixToSVG(u)+'" ',"linear"===this.type?o=["<linearGradient ",a,' x1="',s.x1,'" y1="',s.y1,'" x2="',s.x2,'" y2="',s.y2,'">\n']:"radial"===this.type&&(o=["<radialGradient ",a,' cx="',c?s.x1:s.x2,'" cy="',c?s.y1:s.y2,'" r="',c?s.r1:s.r2,'" fx="',c?s.x2:s.x1,'" fy="',c?s.y2:s.y1,'">\n']),"radial"===this.type){if(c)for((l=l.concat()).reverse(),n=0,r=l.length;n<r;n++)l[n].offset=1-l[n].offset;var p=Math.min(s.r1,s.r2);if(p>0){var m=p/Math.max(s.r1,s.r2);for(n=0,r=l.length;n<r;n++)l[n].offset+=m*(1-l[n].offset)}}for(n=0,r=l.length;n<r;n++){var _=l[n];o.push("<stop ",'offset="',100*_.offset+"%",'" style="stop-color:',_.color,void 0!==_.opacity?";stop-opacity: "+_.opacity:";",'"/>\n')}return o.push("linear"===this.type?"</linearGradient>\n":"</radialGradient>\n"),o.join("")},toLive:function(e){var t,i,n,r=x.util.object.clone(this.coords);if(this.type){for("linear"===this.type?t=e.createLinearGradient(r.x1,r.y1,r.x2,r.y2):"radial"===this.type&&(t=e.createRadialGradient(r.x1,r.y1,r.r1,r.x2,r.y2,r.r2)),i=0,n=this.colorStops.length;i<n;i++){var o=this.colorStops[i].color,a=this.colorStops[i].opacity,s=this.colorStops[i].offset;void 0!==a&&(o=new x.Color(o).setAlpha(a).toRgba()),t.addColorStop(s,o)}return t}}}),x.util.object.extend(x.Gradient,{fromElement:function(t,i,n,r){var o=parseFloat(n)/(/%$/.test(n)?100:1);o=o<0?0:o>1?1:o,isNaN(o)&&(o=1);var a,s,l,c,u=t.getElementsByTagName("stop"),h="userSpaceOnUse"===t.getAttribute("gradientUnits")?"pixels":"percentage",d=t.getAttribute("gradientTransform")||"",f=[],g=0,p=0;for("linearGradient"===t.nodeName||"LINEARGRADIENT"===t.nodeName?(a="linear",s=function(e){return{x1:e.getAttribute("x1")||0,y1:e.getAttribute("y1")||0,x2:e.getAttribute("x2")||"100%",y2:e.getAttribute("y2")||0}}(t)):(a="radial",s=function(e){return{x1:e.getAttribute("fx")||e.getAttribute("cx")||"50%",y1:e.getAttribute("fy")||e.getAttribute("cy")||"50%",r1:0,x2:e.getAttribute("cx")||"50%",y2:e.getAttribute("cy")||"50%",r2:e.getAttribute("r")||"50%"}}(t)),l=u.length;l--;)f.push(e(u[l],o));return c=x.parseTransformAttribute(d),function(e,t,i,n){var r,o;Object.keys(t).forEach((function(e){"Infinity"===(r=t[e])?o=1:"-Infinity"===r?o=0:(o=parseFloat(t[e],10),"string"==typeof r&&/^(\d+\.\d+)%|(\d+)%$/.test(r)&&(o*=.01,"pixels"===n&&("x1"!==e&&"x2"!==e&&"r2"!==e||(o*=i.viewBoxWidth||i.width),"y1"!==e&&"y2"!==e||(o*=i.viewBoxHeight||i.height)))),t[e]=o}))}(0,s,r,h),"pixels"===h&&(g=-i.left,p=-i.top),new x.Gradient({id:t.getAttribute("id"),type:a,coords:s,colorStops:f,gradientUnits:h,gradientTransform:c,offsetX:g,offsetY:p})}})}(),_=x.util.toFixed,x.Pattern=x.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(e,t){if(e||(e={}),this.id=x.Object.__uid++,this.setOptions(e),!e.source||e.source&&"string"!=typeof e.source)t&&t(this);else{var i=this;this.source=x.util.createImage(),x.util.loadImage(e.source,(function(e,n){i.source=e,t&&t(i,n)}),null,this.crossOrigin)}},toObject:function(e){var t,i,n=x.Object.NUM_FRACTION_DIGITS;return"string"==typeof this.source.src?t=this.source.src:"object"==typeof this.source&&this.source.toDataURL&&(t=this.source.toDataURL()),i={type:"pattern",source:t,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:_(this.offsetX,n),offsetY:_(this.offsetY,n),patternTransform:this.patternTransform?this.patternTransform.concat():null},x.util.populateWithProperties(this,i,e),i},toSVG:function(e){var t="function"==typeof this.source?this.source():this.source,i=t.width/e.width,n=t.height/e.height,r=this.offsetX/e.width,o=this.offsetY/e.height,a="";return"repeat-x"!==this.repeat&&"no-repeat"!==this.repeat||(n=1,o&&(n+=Math.abs(o))),"repeat-y"!==this.repeat&&"no-repeat"!==this.repeat||(i=1,r&&(i+=Math.abs(r))),t.src?a=t.src:t.toDataURL&&(a=t.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+r+'" y="'+o+'" width="'+i+'" height="'+n+'">\n<image x="0" y="0" width="'+t.width+'" height="'+t.height+'" xlink:href="'+a+'"></image>\n</pattern>\n'},setOptions:function(e){for(var t in e)this[t]=e[t]},toLive:function(e){var t=this.source;if(!t)return"";if(void 0!==t.src){if(!t.complete)return"";if(0===t.naturalWidth||0===t.naturalHeight)return""}return e.createPattern(t,this.repeat)}}),function(e){var t=e.fabric||(e.fabric={}),i=t.util.toFixed;t.Shadow?t.warn("fabric.Shadow is already defined."):(t.Shadow=t.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(e){for(var i in"string"==typeof e&&(e=this._parseShadow(e)),e)this[i]=e[i];this.id=t.Object.__uid++},_parseShadow:function(e){var i=e.trim(),n=t.Shadow.reOffsetsAndBlur.exec(i)||[];return{color:(i.replace(t.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseFloat(n[1],10)||0,offsetY:parseFloat(n[2],10)||0,blur:parseFloat(n[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(e){var n=40,r=40,o=t.Object.NUM_FRACTION_DIGITS,a=t.util.rotateVector({x:this.offsetX,y:this.offsetY},t.util.degreesToRadians(-e.angle)),s=new t.Color(this.color);return e.width&&e.height&&(n=100*i((Math.abs(a.x)+this.blur)/e.width,o)+20,r=100*i((Math.abs(a.y)+this.blur)/e.height,o)+20),e.flipX&&(a.x*=-1),e.flipY&&(a.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+r+'%" height="'+(100+2*r)+'%" x="-'+n+'%" width="'+(100+2*n)+'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="'+i(this.blur?this.blur/2:0,o)+'"></feGaussianBlur>\n\t<feOffset dx="'+i(a.x,o)+'" dy="'+i(a.y,o)+'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="'+s.toRgb()+'" flood-opacity="'+s.getAlpha()+'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var e={},i=t.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach((function(t){this[t]!==i[t]&&(e[t]=this[t])}),this),e}}),t.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/)}(t),function(){if(x.StaticCanvas)x.warn("fabric.StaticCanvas is already defined.");else{var e=x.util.object.extend,t=x.util.getElementOffset,i=x.util.removeFromArray,n=x.util.toFixed,r=x.util.transformPoint,o=x.util.invertTransform,a=x.util.getNodeCanvas,s=x.util.createCanvasElement,l=new Error("Could not initialize `canvas` element");x.StaticCanvas=x.util.createClass(x.CommonMethods,{initialize:function(e,t){t||(t={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(e,t)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:x.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(e,t){var i=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(e),this._initOptions(t),this.interactive||this._initRetinaScaling(),t.overlayImage&&this.setOverlayImage(t.overlayImage,i),t.backgroundImage&&this.setBackgroundImage(t.backgroundImage,i),t.backgroundColor&&this.setBackgroundColor(t.backgroundColor,i),t.overlayColor&&this.setOverlayColor(t.overlayColor,i),this.calcOffset()},_isRetinaScaling:function(){return x.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,x.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var e=x.devicePixelRatio;this.__initRetinaScaling(e,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(e,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(e,t,i){t.setAttribute("width",this.width*e),t.setAttribute("height",this.height*e),i.scale(e,e)},calcOffset:function(){return this._offset=t(this.lowerCanvasEl),this},setOverlayImage:function(e,t,i){return this.__setBgOverlayImage("overlayImage",e,t,i)},setBackgroundImage:function(e,t,i){return this.__setBgOverlayImage("backgroundImage",e,t,i)},setOverlayColor:function(e,t){return this.__setBgOverlayColor("overlayColor",e,t)},setBackgroundColor:function(e,t){return this.__setBgOverlayColor("backgroundColor",e,t)},__setBgOverlayImage:function(e,t,i,n){return"string"==typeof t?x.util.loadImage(t,(function(t,r){if(t){var o=new x.Image(t,n);this[e]=o,o.canvas=this}i&&i(t,r)}),this,n&&n.crossOrigin):(n&&t.setOptions(n),this[e]=t,t&&(t.canvas=this),i&&i(t,!1)),this},__setBgOverlayColor:function(e,t,i){return this[e]=t,this._initGradient(t,e),this._initPattern(t,e,i),this},_createCanvasElement:function(){var e=s();if(!e)throw l;if(e.style||(e.style={}),void 0===e.getContext)throw l;return e},_initOptions:function(e){var t=this.lowerCanvasEl;this._setOptions(e),this.width=this.width||parseInt(t.width,10)||0,this.height=this.height||parseInt(t.height,10)||0,this.lowerCanvasEl.style&&(t.width=this.width,t.height=this.height,t.style.width=this.width+"px",t.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(e){e&&e.getContext?this.lowerCanvasEl=e:this.lowerCanvasEl=x.util.getById(e)||this._createCanvasElement(),x.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(e,t){return this.setDimensions({width:e},t)},setHeight:function(e,t){return this.setDimensions({height:e},t)},setDimensions:function(e,t){var i;for(var n in t=t||{},e)i=e[n],t.cssOnly||(this._setBackstoreDimension(n,e[n]),i+="px",this.hasLostContext=!0),t.backstoreOnly||this._setCssDimension(n,i);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),t.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(e,t){return this.lowerCanvasEl[e]=t,this.upperCanvasEl&&(this.upperCanvasEl[e]=t),this.cacheCanvasEl&&(this.cacheCanvasEl[e]=t),this[e]=t,this},_setCssDimension:function(e,t){return this.lowerCanvasEl.style[e]=t,this.upperCanvasEl&&(this.upperCanvasEl.style[e]=t),this.wrapperEl&&(this.wrapperEl.style[e]=t),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(e){var t,i,n,r=this._activeObject,o=this.backgroundImage,a=this.overlayImage;for(this.viewportTransform=e,i=0,n=this._objects.length;i<n;i++)(t=this._objects[i]).group||t.setCoords(!0);return r&&r.setCoords(),o&&o.setCoords(!0),a&&a.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(e,t){var i=e,n=this.viewportTransform.slice(0);e=r(e,o(this.viewportTransform)),n[0]=t,n[3]=t;var a=r(e,n);return n[4]+=i.x-a.x,n[5]+=i.y-a.y,this.setViewportTransform(n)},setZoom:function(e){return this.zoomToPoint(new x.Point(0,0),e),this},absolutePan:function(e){var t=this.viewportTransform.slice(0);return t[4]=-e.x,t[5]=-e.y,this.setViewportTransform(t)},relativePan:function(e){return this.absolutePan(new x.Point(-e.x-this.viewportTransform[4],-e.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(e){this.stateful&&e.setupState(),e._set("canvas",this),e.setCoords(),this.fire("object:added",{target:e}),e.fire("added")},_onObjectRemoved:function(e){this.fire("object:removed",{target:e}),e.fire("removed"),delete e.canvas},clearContext:function(e){return e.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var e=this.contextContainer;return this.renderCanvas(e,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=x.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var e={},t=this.width,i=this.height,n=o(this.viewportTransform);return e.tl=r({x:0,y:0},n),e.br=r({x:t,y:i},n),e.tr=new x.Point(e.br.x,e.tl.y),e.bl=new x.Point(e.tl.x,e.br.y),this.vptCoords=e,e},cancelRequestedRender:function(){this.isRendering&&(x.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(e,t){var i=this.viewportTransform,n=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(e),x.util.setImageSmoothing(e,this.imageSmoothingEnabled),this.fire("before:render",{ctx:e}),this._renderBackground(e),e.save(),e.transform(i[0],i[1],i[2],i[3],i[4],i[5]),this._renderObjects(e,t),e.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(e),n&&(n.canvas=this,n.shouldCache(),n._transformDone=!0,n.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(e)),this._renderOverlay(e),this.controlsAboveOverlay&&this.interactive&&this.drawControls(e),this.fire("after:render",{ctx:e})},drawClipPathOnCanvas:function(e){var t=this.viewportTransform,i=this.clipPath;e.save(),e.transform(t[0],t[1],t[2],t[3],t[4],t[5]),e.globalCompositeOperation="destination-in",i.transform(e),e.scale(1/i.zoomX,1/i.zoomY),e.drawImage(i._cacheCanvas,-i.cacheTranslationX,-i.cacheTranslationY),e.restore()},_renderObjects:function(e,t){var i,n;for(i=0,n=t.length;i<n;++i)t[i]&&t[i].render(e)},_renderBackgroundOrOverlay:function(e,t){var i=this[t+"Color"],n=this[t+"Image"],r=this.viewportTransform,o=this[t+"Vpt"];if(i||n){if(i){e.save(),e.beginPath(),e.moveTo(0,0),e.lineTo(this.width,0),e.lineTo(this.width,this.height),e.lineTo(0,this.height),e.closePath(),e.fillStyle=i.toLive?i.toLive(e,this):i,o&&e.transform(r[0],r[1],r[2],r[3],r[4],r[5]),e.transform(1,0,0,1,i.offsetX||0,i.offsetY||0);var a=i.gradientTransform||i.patternTransform;a&&e.transform(a[0],a[1],a[2],a[3],a[4],a[5]),e.fill(),e.restore()}n&&(e.save(),o&&e.transform(r[0],r[1],r[2],r[3],r[4],r[5]),n.render(e),e.restore())}},_renderBackground:function(e){this._renderBackgroundOrOverlay(e,"background")},_renderOverlay:function(e){this._renderBackgroundOrOverlay(e,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new x.Point(this.width/2,this.height/2)},centerObjectH:function(e){return this._centerObject(e,new x.Point(this.getCenterPoint().x,e.getCenterPoint().y))},centerObjectV:function(e){return this._centerObject(e,new x.Point(e.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(e){var t=this.getCenterPoint();return this._centerObject(e,t)},viewportCenterObject:function(e){var t=this.getVpCenter();return this._centerObject(e,t)},viewportCenterObjectH:function(e){var t=this.getVpCenter();return this._centerObject(e,new x.Point(t.x,e.getCenterPoint().y)),this},viewportCenterObjectV:function(e){var t=this.getVpCenter();return this._centerObject(e,new x.Point(e.getCenterPoint().x,t.y))},getVpCenter:function(){var e=this.getCenterPoint(),t=o(this.viewportTransform);return r(e,t)},_centerObject:function(e,t){return e.setPositionByOrigin(t,"center","center"),e.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(e){return this.toDatalessObject(e)},toObject:function(e){return this._toObjectMethod("toObject",e)},toDatalessObject:function(e){return this._toObjectMethod("toDatalessObject",e)},_toObjectMethod:function(t,i){var n=this.clipPath,r={version:x.version,objects:this._toObjects(t,i)};return n&&!n.excludeFromExport&&(r.clipPath=this._toObject(this.clipPath,t,i)),e(r,this.__serializeBgOverlay(t,i)),x.util.populateWithProperties(this,r,i),r},_toObjects:function(e,t){return this._objects.filter((function(e){return!e.excludeFromExport})).map((function(i){return this._toObject(i,e,t)}),this)},_toObject:function(e,t,i){var n;this.includeDefaultValues||(n=e.includeDefaultValues,e.includeDefaultValues=!1);var r=e[t](i);return this.includeDefaultValues||(e.includeDefaultValues=n),r},__serializeBgOverlay:function(e,t){var i={},n=this.backgroundImage,r=this.overlayImage,o=this.backgroundColor,a=this.overlayColor;return o&&o.toObject?o.excludeFromExport||(i.background=o.toObject(t)):o&&(i.background=o),a&&a.toObject?a.excludeFromExport||(i.overlay=a.toObject(t)):a&&(i.overlay=a),n&&!n.excludeFromExport&&(i.backgroundImage=this._toObject(n,e,t)),r&&!r.excludeFromExport&&(i.overlayImage=this._toObject(r,e,t)),i},svgViewportTransformation:!0,toSVG:function(e,t){e||(e={}),e.reviver=t;var i=[];return this._setSVGPreamble(i,e),this._setSVGHeader(i,e),this.clipPath&&i.push('<g clip-path="url(#'+this.clipPath.clipPathId+')" >\n'),this._setSVGBgOverlayColor(i,"background"),this._setSVGBgOverlayImage(i,"backgroundImage",t),this._setSVGObjects(i,t),this.clipPath&&i.push("</g>\n"),this._setSVGBgOverlayColor(i,"overlay"),this._setSVGBgOverlayImage(i,"overlayImage",t),i.push("</svg>"),i.join("")},_setSVGPreamble:function(e,t){t.suppressPreamble||e.push('<?xml version="1.0" encoding="',t.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(e,t){var i,r=t.width||this.width,o=t.height||this.height,a='viewBox="0 0 '+this.width+" "+this.height+'" ',s=x.Object.NUM_FRACTION_DIGITS;t.viewBox?a='viewBox="'+t.viewBox.x+" "+t.viewBox.y+" "+t.viewBox.width+" "+t.viewBox.height+'" ':this.svgViewportTransformation&&(i=this.viewportTransform,a='viewBox="'+n(-i[4]/i[0],s)+" "+n(-i[5]/i[3],s)+" "+n(this.width/i[0],s)+" "+n(this.height/i[3],s)+'" '),e.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',r,'" ','height="',o,'" ',a,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",x.version,"</desc>\n","<defs>\n",this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(t),"</defs>\n")},createSVGClipPathMarkup:function(e){var t=this.clipPath;return t?(t.clipPathId="CLIPPATH_"+x.Object.__uid++,'<clipPath id="'+t.clipPathId+'" >\n'+this.clipPath.toClipPathSVG(e.reviver)+"</clipPath>\n"):""},createSVGRefElementsMarkup:function(){var e=this;return["background","overlay"].map((function(t){var i=e[t+"Color"];if(i&&i.toLive){var n=e[t+"Vpt"],r=e.viewportTransform,o={width:e.width/(n?r[0]:1),height:e.height/(n?r[3]:1)};return i.toSVG(o,{additionalTransform:n?x.util.matrixToSVG(r):""})}})).join("")},createSVGFontFacesMarkup:function(){var e,t,i,n,r,o,a,s,l="",c={},u=x.fontPaths,h=[];for(this._objects.forEach((function e(t){h.push(t),t._objects&&t._objects.forEach(e)})),a=0,s=h.length;a<s;a++)if(t=(e=h[a]).fontFamily,-1!==e.type.indexOf("text")&&!c[t]&&u[t]&&(c[t]=!0,e.styles))for(r in i=e.styles)for(o in n=i[r])!c[t=n[o].fontFamily]&&u[t]&&(c[t]=!0);for(var d in c)l+=["\t\t@font-face {\n","\t\t\tfont-family: '",d,"';\n","\t\t\tsrc: url('",u[d],"');\n","\t\t}\n"].join("");return l&&(l=['\t<style type="text/css">',"<![CDATA[\n",l,"]]>","</style>\n"].join("")),l},_setSVGObjects:function(e,t){var i,n,r,o=this._objects;for(n=0,r=o.length;n<r;n++)(i=o[n]).excludeFromExport||this._setSVGObject(e,i,t)},_setSVGObject:function(e,t,i){e.push(t.toSVG(i))},_setSVGBgOverlayImage:function(e,t,i){this[t]&&!this[t].excludeFromExport&&this[t].toSVG&&e.push(this[t].toSVG(i))},_setSVGBgOverlayColor:function(e,t){var i=this[t+"Color"],n=this.viewportTransform,r=this.width,o=this.height;if(i)if(i.toLive){var a=i.repeat,s=x.util.invertTransform(n),l=this[t+"Vpt"]?x.util.matrixToSVG(s):"";e.push('<rect transform="'+l+" translate(",r/2,",",o/2,')"',' x="',i.offsetX-r/2,'" y="',i.offsetY-o/2,'" ','width="',"repeat-y"===a||"no-repeat"===a?i.source.width:r,'" height="',"repeat-x"===a||"no-repeat"===a?i.source.height:o,'" fill="url(#SVGID_'+i.id+')"',"></rect>\n")}else e.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',i,'"',"></rect>\n")},sendToBack:function(e){if(!e)return this;var t,n,r,o=this._activeObject;if(e===o&&"activeSelection"===e.type)for(t=(r=o._objects).length;t--;)n=r[t],i(this._objects,n),this._objects.unshift(n);else i(this._objects,e),this._objects.unshift(e);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(e){if(!e)return this;var t,n,r,o=this._activeObject;if(e===o&&"activeSelection"===e.type)for(r=o._objects,t=0;t<r.length;t++)n=r[t],i(this._objects,n),this._objects.push(n);else i(this._objects,e),this._objects.push(e);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(e,t){if(!e)return this;var n,r,o,a,s,l=this._activeObject,c=0;if(e===l&&"activeSelection"===e.type)for(s=l._objects,n=0;n<s.length;n++)r=s[n],(o=this._objects.indexOf(r))>0+c&&(a=o-1,i(this._objects,r),this._objects.splice(a,0,r)),c++;else 0!==(o=this._objects.indexOf(e))&&(a=this._findNewLowerIndex(e,o,t),i(this._objects,e),this._objects.splice(a,0,e));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(e,t,i){var n,r;if(i){for(n=t,r=t-1;r>=0;--r)if(e.intersectsWithObject(this._objects[r])||e.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(e)){n=r;break}}else n=t-1;return n},bringForward:function(e,t){if(!e)return this;var n,r,o,a,s,l=this._activeObject,c=0;if(e===l&&"activeSelection"===e.type)for(n=(s=l._objects).length;n--;)r=s[n],(o=this._objects.indexOf(r))<this._objects.length-1-c&&(a=o+1,i(this._objects,r),this._objects.splice(a,0,r)),c++;else(o=this._objects.indexOf(e))!==this._objects.length-1&&(a=this._findNewUpperIndex(e,o,t),i(this._objects,e),this._objects.splice(a,0,e));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(e,t,i){var n,r,o;if(i){for(n=t,r=t+1,o=this._objects.length;r<o;++r)if(e.intersectsWithObject(this._objects[r])||e.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(e)){n=r;break}}else n=t+1;return n},moveTo:function(e,t){return i(this._objects,e),this._objects.splice(t,0,e),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(x.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject((function(e){e.dispose&&e.dispose()})),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),x.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),x.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),e(x.StaticCanvas.prototype,x.Observable),e(x.StaticCanvas.prototype,x.Collection),e(x.StaticCanvas.prototype,x.DataURLExporter),e(x.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(e){var t=s();if(!t||!t.getContext)return null;var i=t.getContext("2d");return i&&"setLineDash"===e?void 0!==i.setLineDash:null}}),x.StaticCanvas.prototype.toJSON=x.StaticCanvas.prototype.toObject,x.isLikelyNode&&(x.StaticCanvas.prototype.createPNGStream=function(){var e=a(this.lowerCanvasEl);return e&&e.createPNGStream()},x.StaticCanvas.prototype.createJPEGStream=function(e){var t=a(this.lowerCanvasEl);return t&&t.createJPEGStream(e)})}}(),x.BaseBrush=x.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(e){e.strokeStyle=this.color,e.lineWidth=this.width,e.lineCap=this.strokeLineCap,e.miterLimit=this.strokeMiterLimit,e.lineJoin=this.strokeLineJoin,e.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(e){var t=this.canvas.viewportTransform;e.save(),e.transform(t[0],t[1],t[2],t[3],t[4],t[5])},_setShadow:function(){if(this.shadow){var e=this.canvas,t=this.shadow,i=e.contextTop,n=e.getZoom();e&&e._isRetinaScaling()&&(n*=x.devicePixelRatio),i.shadowColor=t.color,i.shadowBlur=t.blur*n,i.shadowOffsetX=t.offsetX*n,i.shadowOffsetY=t.offsetY*n}},needsFullRender:function(){return new x.Color(this.color).getAlpha()<1||!!this.shadow},_resetShadow:function(){var e=this.canvas.contextTop;e.shadowColor="",e.shadowBlur=e.shadowOffsetX=e.shadowOffsetY=0},_isOutSideCanvas:function(e){return e.x<0||e.x>this.canvas.getWidth()||e.y<0||e.y>this.canvas.getHeight()}}),x.PencilBrush=x.util.createClass(x.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(e){this.canvas=e,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(e,t,i){var n=t.midPointFrom(i);return e.quadraticCurveTo(t.x,t.y,n.x,n.y),n},onMouseDown:function(e,t){this.canvas._isMainEvent(t.e)&&(this.drawStraightLine=t.e[this.straightLineKey],this._prepareForDrawing(e),this._captureDrawingPath(e),this._render())},onMouseMove:function(e,t){if(this.canvas._isMainEvent(t.e)&&(this.drawStraightLine=t.e[this.straightLineKey],(!0!==this.limitedToCanvasSize||!this._isOutSideCanvas(e))&&this._captureDrawingPath(e)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var i=this._points,n=i.length,r=this.canvas.contextTop;this._saveAndTransform(r),this.oldEnd&&(r.beginPath(),r.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(r,i[n-2],i[n-1],!0),r.stroke(),r.restore()}},onMouseUp:function(e){return!this.canvas._isMainEvent(e.e)||(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1)},_prepareForDrawing:function(e){var t=new x.Point(e.x,e.y);this._reset(),this._addPoint(t),this.canvas.contextTop.moveTo(t.x,t.y)},_addPoint:function(e){return!(this._points.length>1&&e.eq(this._points[this._points.length-1])||(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(e),0))},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(e){var t=new x.Point(e.x,e.y);return this._addPoint(t)},_render:function(e){var t,i,n=this._points[0],r=this._points[1];if(e=e||this.canvas.contextTop,this._saveAndTransform(e),e.beginPath(),2===this._points.length&&n.x===r.x&&n.y===r.y){var o=this.width/1e3;n=new x.Point(n.x,n.y),r=new x.Point(r.x,r.y),n.x-=o,r.x+=o}for(e.moveTo(n.x,n.y),t=1,i=this._points.length;t<i;t++)this._drawSegment(e,n,r),n=this._points[t],r=this._points[t+1];e.lineTo(n.x,n.y),e.stroke(),e.restore()},convertPointsToSVGPath:function(e){var t=this.width/1e3;return x.util.getSmoothPathFromPoints(e,t)},_isEmptySVGPath:function(e){return"M 0 0 Q 0 0 0 0 L 0 0"===x.util.joinPath(e)},createPath:function(e){var t=new x.Path(e,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,t.shadow=new x.Shadow(this.shadow)),t},decimatePoints:function(e,t){if(e.length<=2)return e;var i,n=this.canvas.getZoom(),r=Math.pow(t/n,2),o=e.length-1,a=e[0],s=[a];for(i=1;i<o-1;i++)Math.pow(a.x-e[i].x,2)+Math.pow(a.y-e[i].y,2)>=r&&(a=e[i],s.push(a));return s.push(e[o]),s},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var e=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(e))this.canvas.requestRenderAll();else{var t=this.createPath(e);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:t}),this.canvas.add(t),this.canvas.requestRenderAll(),t.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:t})}}}),x.CircleBrush=x.util.createClass(x.BaseBrush,{width:10,initialize:function(e){this.canvas=e,this.points=[]},drawDot:function(e){var t=this.addPoint(e),i=this.canvas.contextTop;this._saveAndTransform(i),this.dot(i,t),i.restore()},dot:function(e,t){e.fillStyle=t.fill,e.beginPath(),e.arc(t.x,t.y,t.radius,0,2*Math.PI,!1),e.closePath(),e.fill()},onMouseDown:function(e){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(e)},_render:function(){var e,t,i=this.canvas.contextTop,n=this.points;for(this._saveAndTransform(i),e=0,t=n.length;e<t;e++)this.dot(i,n[e]);i.restore()},onMouseMove:function(e){!0===this.limitedToCanvasSize&&this._isOutSideCanvas(e)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(e),this._render()):this.drawDot(e))},onMouseUp:function(){var e,t,i=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;var n=[];for(e=0,t=this.points.length;e<t;e++){var r=this.points[e],o=new x.Circle({radius:r.radius,left:r.x,top:r.y,originX:"center",originY:"center",fill:r.fill});this.shadow&&(o.shadow=new x.Shadow(this.shadow)),n.push(o)}var a=new x.Group(n);a.canvas=this.canvas,this.canvas.fire("before:path:created",{path:a}),this.canvas.add(a),this.canvas.fire("path:created",{path:a}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=i,this.canvas.requestRenderAll()},addPoint:function(e){var t=new x.Point(e.x,e.y),i=x.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,n=new x.Color(this.color).setAlpha(x.util.getRandomInt(0,100)/100).toRgba();return t.radius=i,t.fill=n,this.points.push(t),t}}),x.SprayBrush=x.util.createClass(x.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(e){this.canvas=e,this.sprayChunks=[]},onMouseDown:function(e){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(e),this.render(this.sprayChunkPoints)},onMouseMove:function(e){!0===this.limitedToCanvasSize&&this._isOutSideCanvas(e)||(this.addSprayChunk(e),this.render(this.sprayChunkPoints))},onMouseUp:function(){var e=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var t=[],i=0,n=this.sprayChunks.length;i<n;i++)for(var r=this.sprayChunks[i],o=0,a=r.length;o<a;o++){var s=new x.Rect({width:r[o].width,height:r[o].width,left:r[o].x+1,top:r[o].y+1,originX:"center",originY:"center",fill:this.color});t.push(s)}this.optimizeOverlapping&&(t=this._getOptimizedRects(t));var l=new x.Group(t);this.shadow&&l.set("shadow",new x.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:l}),this.canvas.add(l),this.canvas.fire("path:created",{path:l}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=e,this.canvas.requestRenderAll()},_getOptimizedRects:function(e){var t,i,n,r={};for(i=0,n=e.length;i<n;i++)r[t=e[i].left+""+e[i].top]||(r[t]=e[i]);var o=[];for(t in r)o.push(r[t]);return o},render:function(e){var t,i,n=this.canvas.contextTop;for(n.fillStyle=this.color,this._saveAndTransform(n),t=0,i=e.length;t<i;t++){var r=e[t];void 0!==r.opacity&&(n.globalAlpha=r.opacity),n.fillRect(r.x,r.y,r.width,r.width)}n.restore()},_render:function(){var e,t,i=this.canvas.contextTop;for(i.fillStyle=this.color,this._saveAndTransform(i),e=0,t=this.sprayChunks.length;e<t;e++)this.render(this.sprayChunks[e]);i.restore()},addSprayChunk:function(e){this.sprayChunkPoints=[];var t,i,n,r,o=this.width/2;for(r=0;r<this.density;r++){t=x.util.getRandomInt(e.x-o,e.x+o),i=x.util.getRandomInt(e.y-o,e.y+o),n=this.dotWidthVariance?x.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var a=new x.Point(t,i);a.width=n,this.randomOpacity&&(a.opacity=x.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(a)}this.sprayChunks.push(this.sprayChunkPoints)}}),x.PatternBrush=x.util.createClass(x.PencilBrush,{getPatternSrc:function(){var e=x.util.createCanvasElement(),t=e.getContext("2d");return e.width=e.height=25,t.fillStyle=this.color,t.beginPath(),t.arc(10,10,10,0,2*Math.PI,!1),t.closePath(),t.fill(),e},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(e){return e.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(e){this.callSuper("_setBrushStyles",e),e.strokeStyle=this.getPattern(e)},createPath:function(e){var t=this.callSuper("createPath",e),i=t._getLeftTopCoords().scalarAdd(t.strokeWidth/2);return t.stroke=new x.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-i.x,offsetY:-i.y}),t}}),function(){var e=x.util.getPointer,t=x.util.degreesToRadians,i=x.util.isTouchEvent;for(var n in x.Canvas=x.util.createClass(x.StaticCanvas,{initialize:function(e,t){t||(t={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(e,t),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=x.PencilBrush&&new x.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var e,t,i,n=this.getActiveObjects();if(n.length>0&&!this.preserveObjectStacking){t=[],i=[];for(var r=0,o=this._objects.length;r<o;r++)e=this._objects[r],-1===n.indexOf(e)?t.push(e):i.push(e);n.length>1&&(this._activeObject._objects=i),t.push.apply(t,i)}else t=this._objects;return t},renderAll:function(){!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1);var e=this.contextContainer;return this.renderCanvas(e,this._chooseObjectsToRender()),this},renderTopLayer:function(e){e.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(e),this.contextTopDirty=!0),e.restore()},renderTop:function(){var e=this.contextTop;return this.clearContext(e),this.renderTopLayer(e),this.fire("after:render"),this},_normalizePointer:function(e,t){var i=e.calcTransformMatrix(),n=x.util.invertTransform(i),r=this.restorePointerVpt(t);return x.util.transformPoint(r,n)},isTargetTransparent:function(e,t,i){if(e.shouldCache()&&e._cacheCanvas&&e!==this._activeObject){var n=this._normalizePointer(e,{x:t,y:i}),r=Math.max(e.cacheTranslationX+n.x*e.zoomX,0),o=Math.max(e.cacheTranslationY+n.y*e.zoomY,0);return x.util.isTransparent(e._cacheContext,Math.round(r),Math.round(o),this.targetFindTolerance)}var a=this.contextCache,s=e.selectionBackgroundColor,l=this.viewportTransform;return e.selectionBackgroundColor="",this.clearContext(a),a.save(),a.transform(l[0],l[1],l[2],l[3],l[4],l[5]),e.render(a),a.restore(),e.selectionBackgroundColor=s,x.util.isTransparent(a,t,i,this.targetFindTolerance)},_isSelectionKeyPressed:function(e){return Array.isArray(this.selectionKey)?!!this.selectionKey.find((function(t){return!0===e[t]})):e[this.selectionKey]},_shouldClearSelection:function(e,t){var i=this.getActiveObjects(),n=this._activeObject;return!t||t&&n&&i.length>1&&-1===i.indexOf(t)&&n!==t&&!this._isSelectionKeyPressed(e)||t&&!t.evented||t&&!t.selectable&&n&&n!==t},_shouldCenterTransform:function(e,t,i){var n;if(e)return"scale"===t||"scaleX"===t||"scaleY"===t||"resizing"===t?n=this.centeredScaling||e.centeredScaling:"rotate"===t&&(n=this.centeredRotation||e.centeredRotation),n?!i:i},_getOriginFromCorner:function(e,t){var i={x:e.originX,y:e.originY};return"ml"===t||"tl"===t||"bl"===t?i.x="right":"mr"!==t&&"tr"!==t&&"br"!==t||(i.x="left"),"tl"===t||"mt"===t||"tr"===t?i.y="bottom":"bl"!==t&&"mb"!==t&&"br"!==t||(i.y="top"),i},_getActionFromCorner:function(e,t,i,n){if(!t||!e)return"drag";var r=n.controls[t];return r.getActionName(i,r,n)},_setupCurrentTransform:function(e,i,n){if(i){var r=this.getPointer(e),o=i.__corner,a=i.controls[o],s=n&&o?a.getActionHandler(e,i,a):x.controlsUtils.dragHandler,l=this._getActionFromCorner(n,o,e,i),c=this._getOriginFromCorner(i,o),u=e[this.centeredKey],h={target:i,action:l,actionHandler:s,corner:o,scaleX:i.scaleX,scaleY:i.scaleY,skewX:i.skewX,skewY:i.skewY,offsetX:r.x-i.left,offsetY:r.y-i.top,originX:c.x,originY:c.y,ex:r.x,ey:r.y,lastX:r.x,lastY:r.y,theta:t(i.angle),width:i.width*i.scaleX,shiftKey:e.shiftKey,altKey:u,original:x.util.saveObjectTransform(i)};this._shouldCenterTransform(i,l,u)&&(h.originX="center",h.originY="center"),h.original.originX=c.x,h.original.originY=c.y,this._currentTransform=h,this._beforeTransform(e)}},setCursor:function(e){this.upperCanvasEl.style.cursor=e},_drawSelection:function(e){var t=this._groupSelector,i=new x.Point(t.ex,t.ey),n=x.util.transformPoint(i,this.viewportTransform),r=new x.Point(t.ex+t.left,t.ey+t.top),o=x.util.transformPoint(r,this.viewportTransform),a=Math.min(n.x,o.x),s=Math.min(n.y,o.y),l=Math.max(n.x,o.x),c=Math.max(n.y,o.y),u=this.selectionLineWidth/2;this.selectionColor&&(e.fillStyle=this.selectionColor,e.fillRect(a,s,l-a,c-s)),this.selectionLineWidth&&this.selectionBorderColor&&(e.lineWidth=this.selectionLineWidth,e.strokeStyle=this.selectionBorderColor,a+=u,s+=u,l-=u,c-=u,x.Object.prototype._setLineDash.call(this,e,this.selectionDashArray),e.strokeRect(a,s,l-a,c-s))},findTarget:function(e,t){if(!this.skipTargetFind){var n,r,o=this.getPointer(e,!0),a=this._activeObject,s=this.getActiveObjects(),l=i(e),c=s.length>1&&!t||1===s.length;if(this.targets=[],c&&a._findTargetCorner(o,l))return a;if(s.length>1&&!t&&a===this._searchPossibleTargets([a],o))return a;if(1===s.length&&a===this._searchPossibleTargets([a],o)){if(!this.preserveObjectStacking)return a;n=a,r=this.targets,this.targets=[]}var u=this._searchPossibleTargets(this._objects,o);return e[this.altSelectionKey]&&u&&n&&u!==n&&(u=n,this.targets=r),u}},_checkTarget:function(e,t,i){if(t&&t.visible&&t.evented&&t.containsPoint(e)){if(!this.perPixelTargetFind&&!t.perPixelTargetFind||t.isEditing)return!0;if(!this.isTargetTransparent(t,i.x,i.y))return!0}},_searchPossibleTargets:function(e,t){for(var i,n,r=e.length;r--;){var o=e[r],a=o.group?this._normalizePointer(o.group,t):t;if(this._checkTarget(a,o,t)){(i=e[r]).subTargetCheck&&i instanceof x.Group&&(n=this._searchPossibleTargets(i._objects,t))&&this.targets.push(n);break}}return i},restorePointerVpt:function(e){return x.util.transformPoint(e,x.util.invertTransform(this.viewportTransform))},getPointer:function(t,i){if(this._absolutePointer&&!i)return this._absolutePointer;if(this._pointer&&i)return this._pointer;var n,r=e(t),o=this.upperCanvasEl,a=o.getBoundingClientRect(),s=a.width||0,l=a.height||0;s&&l||("top"in a&&"bottom"in a&&(l=Math.abs(a.top-a.bottom)),"right"in a&&"left"in a&&(s=Math.abs(a.right-a.left))),this.calcOffset(),r.x=r.x-this._offset.left,r.y=r.y-this._offset.top,i||(r=this.restorePointerVpt(r));var c=this.getRetinaScaling();return 1!==c&&(r.x/=c,r.y/=c),n=0===s||0===l?{width:1,height:1}:{width:o.width/s,height:o.height/l},{x:r.x*n.width,y:r.y*n.height}},_createUpperCanvas:function(){var e=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),t=this.lowerCanvasEl,i=this.upperCanvasEl;i?i.className="":(i=this._createCanvasElement(),this.upperCanvasEl=i),x.util.addClass(i,"upper-canvas "+e),this.wrapperEl.appendChild(i),this._copyCanvasStyle(t,i),this._applyCanvasStyle(i),this.contextTop=i.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=x.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),x.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),x.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(e){var t=this.width||e.width,i=this.height||e.height;x.util.setStyle(e,{position:"absolute",width:t+"px",height:i+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),e.width=t,e.height=i,x.util.makeElementUnselectable(e)},_copyCanvasStyle:function(e,t){t.style.cssText=e.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var e=this._activeObject;return e?"activeSelection"===e.type&&e._objects?e._objects.slice(0):[e]:[]},_onObjectRemoved:function(e){e===this._activeObject&&(this.fire("before:selection:cleared",{target:e}),this._discardActiveObject(),this.fire("selection:cleared",{target:e}),e.fire("deselected")),e===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",e)},_fireSelectionEvents:function(e,t){var i=!1,n=this.getActiveObjects(),r=[],o=[];e.forEach((function(e){-1===n.indexOf(e)&&(i=!0,e.fire("deselected",{e:t,target:e}),o.push(e))})),n.forEach((function(n){-1===e.indexOf(n)&&(i=!0,n.fire("selected",{e:t,target:n}),r.push(n))})),e.length>0&&n.length>0?i&&this.fire("selection:updated",{e:t,selected:r,deselected:o}):n.length>0?this.fire("selection:created",{e:t,selected:r}):e.length>0&&this.fire("selection:cleared",{e:t,deselected:o})},setActiveObject:function(e,t){var i=this.getActiveObjects();return this._setActiveObject(e,t),this._fireSelectionEvents(i,t),this},_setActiveObject:function(e,t){return this._activeObject!==e&&!!this._discardActiveObject(t,e)&&!e.onSelect({e:t})&&(this._activeObject=e,!0)},_discardActiveObject:function(e,t){var i=this._activeObject;if(i){if(i.onDeselect({e:e,object:t}))return!1;this._activeObject=null}return!0},discardActiveObject:function(e){var t=this.getActiveObjects(),i=this.getActiveObject();return t.length&&this.fire("before:selection:cleared",{target:i,e:e}),this._discardActiveObject(e),this._fireSelectionEvents(t,e),this},dispose:function(){var e=this.wrapperEl;return this.removeListeners(),e.removeChild(this.upperCanvasEl),e.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(e){x.util.cleanUpJsdomNode(this[e]),this[e]=void 0}.bind(this)),e.parentNode&&e.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,x.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(e){var t=this._activeObject;t&&t._renderControls(e)},_toObject:function(e,t,i){var n=this._realizeGroupTransformOnObject(e),r=this.callSuper("_toObject",e,t,i);return this._unwindGroupTransformOnObject(e,n),r},_realizeGroupTransformOnObject:function(e){if(e.group&&"activeSelection"===e.group.type&&this._activeObject===e.group){var t={};return["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"].forEach((function(i){t[i]=e[i]})),x.util.addTransformToObject(e,this._activeObject.calcOwnMatrix()),t}return null},_unwindGroupTransformOnObject:function(e,t){t&&e.set(t)},_setSVGObject:function(e,t,i){var n=this._realizeGroupTransformOnObject(t);this.callSuper("_setSVGObject",e,t,i),this._unwindGroupTransformOnObject(t,n)},setViewportTransform:function(e){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),x.StaticCanvas.prototype.setViewportTransform.call(this,e)}}),x.StaticCanvas)"prototype"!==n&&(x.Canvas[n]=x.StaticCanvas[n])}(),function(){var e=x.util.addListener,t=x.util.removeListener,i={passive:!1};function n(e,t){return e.button&&e.button===t-1}x.util.object.extend(x.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(e,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(e,t){var n=this.upperCanvasEl,r=this._getEventPrefix();e(x.window,"resize",this._onResize),e(n,r+"down",this._onMouseDown),e(n,r+"move",this._onMouseMove,i),e(n,r+"out",this._onMouseOut),e(n,r+"enter",this._onMouseEnter),e(n,"wheel",this._onMouseWheel),e(n,"contextmenu",this._onContextMenu),e(n,"dblclick",this._onDoubleClick),e(n,"dragover",this._onDragOver),e(n,"dragenter",this._onDragEnter),e(n,"dragleave",this._onDragLeave),e(n,"drop",this._onDrop),this.enablePointerEvents||e(n,"touchstart",this._onTouchStart,i),"undefined"!=typeof eventjs&&t in eventjs&&(eventjs[t](n,"gesture",this._onGesture),eventjs[t](n,"drag",this._onDrag),eventjs[t](n,"orientation",this._onOrientationChange),eventjs[t](n,"shake",this._onShake),eventjs[t](n,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(t,"remove");var e=this._getEventPrefix();t(x.document,e+"up",this._onMouseUp),t(x.document,"touchend",this._onTouchEnd,i),t(x.document,e+"move",this._onMouseMove,i),t(x.document,"touchmove",this._onMouseMove,i)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(e,t){this.__onTransformGesture&&this.__onTransformGesture(e,t)},_onDrag:function(e,t){this.__onDrag&&this.__onDrag(e,t)},_onMouseWheel:function(e){this.__onMouseWheel(e)},_onMouseOut:function(e){var t=this._hoveredTarget;this.fire("mouse:out",{target:t,e:e}),this._hoveredTarget=null,t&&t.fire("mouseout",{e:e});var i=this;this._hoveredTargets.forEach((function(n){i.fire("mouse:out",{target:t,e:e}),n&&t.fire("mouseout",{e:e})})),this._hoveredTargets=[],this._iTextInstances&&this._iTextInstances.forEach((function(e){e.isEditing&&e.hiddenTextarea.focus()}))},_onMouseEnter:function(e){this._currentTransform||this.findTarget(e)||(this.fire("mouse:over",{target:null,e:e}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(e,t){this.__onOrientationChange&&this.__onOrientationChange(e,t)},_onShake:function(e,t){this.__onShake&&this.__onShake(e,t)},_onLongPress:function(e,t){this.__onLongPress&&this.__onLongPress(e,t)},_onDragOver:function(e){e.preventDefault();var t=this._simpleEventHandler("dragover",e);this._fireEnterLeaveEvents(t,e)},_onDrop:function(e){return this._simpleEventHandler("drop:before",e),this._simpleEventHandler("drop",e)},_onContextMenu:function(e){return this.stopContextMenu&&(e.stopPropagation(),e.preventDefault()),!1},_onDoubleClick:function(e){this._cacheTransformEventData(e),this._handleEvent(e,"dblclick"),this._resetTransformEventData(e)},getPointerId:function(e){var t=e.changedTouches;return t?t[0]&&t[0].identifier:this.enablePointerEvents?e.pointerId:-1},_isMainEvent:function(e){return!0===e.isPrimary||!1!==e.isPrimary&&("touchend"===e.type&&0===e.touches.length||!e.changedTouches||e.changedTouches[0].identifier===this.mainTouchId)},_onTouchStart:function(n){n.preventDefault(),null===this.mainTouchId&&(this.mainTouchId=this.getPointerId(n)),this.__onMouseDown(n),this._resetTransformEventData();var r=this.upperCanvasEl,o=this._getEventPrefix();e(x.document,"touchend",this._onTouchEnd,i),e(x.document,"touchmove",this._onMouseMove,i),t(r,o+"down",this._onMouseDown)},_onMouseDown:function(n){this.__onMouseDown(n),this._resetTransformEventData();var r=this.upperCanvasEl,o=this._getEventPrefix();t(r,o+"move",this._onMouseMove,i),e(x.document,o+"up",this._onMouseUp),e(x.document,o+"move",this._onMouseMove,i)},_onTouchEnd:function(n){if(!(n.touches.length>0)){this.__onMouseUp(n),this._resetTransformEventData(),this.mainTouchId=null;var r=this._getEventPrefix();t(x.document,"touchend",this._onTouchEnd,i),t(x.document,"touchmove",this._onMouseMove,i);var o=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout((function(){e(o.upperCanvasEl,r+"down",o._onMouseDown),o._willAddMouseDown=0}),400)}},_onMouseUp:function(n){this.__onMouseUp(n),this._resetTransformEventData();var r=this.upperCanvasEl,o=this._getEventPrefix();this._isMainEvent(n)&&(t(x.document,o+"up",this._onMouseUp),t(x.document,o+"move",this._onMouseMove,i),e(r,o+"move",this._onMouseMove,i))},_onMouseMove:function(e){!this.allowTouchScrolling&&e.preventDefault&&e.preventDefault(),this.__onMouseMove(e)},_onResize:function(){this.calcOffset()},_shouldRender:function(e){var t=this._activeObject;return!!(!!t!=!!e||t&&e&&t!==e)||(t&&t.isEditing,!1)},__onMouseUp:function(e){var t,i=this._currentTransform,r=this._groupSelector,o=!1,a=!r||0===r.left&&0===r.top;if(this._cacheTransformEventData(e),t=this._target,this._handleEvent(e,"up:before"),n(e,3))this.fireRightClick&&this._handleEvent(e,"up",3,a);else{if(n(e,2))return this.fireMiddleClick&&this._handleEvent(e,"up",2,a),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(e);else if(this._isMainEvent(e)){if(i&&(this._finalizeCurrentTransform(e),o=i.actionPerformed),!a){var s=t===this._activeObject;this._maybeGroupObjects(e),o||(o=this._shouldRender(t)||!s&&t===this._activeObject)}var l,c;if(t){if(l=t._findTargetCorner(this.getPointer(e,!0),x.util.isTouchEvent(e)),t.selectable&&t!==this._activeObject&&"up"===t.activeOn)this.setActiveObject(t,e),o=!0;else{var u=t.controls[l],h=u&&u.getMouseUpHandler(e,t,u);h&&h(e,i,(c=this.getPointer(e)).x,c.y)}t.isMoving=!1}if(i&&(i.target!==t||i.corner!==l)){var d=i.target&&i.target.controls[i.corner],f=d&&d.getMouseUpHandler(e,t,u);c=c||this.getPointer(e),f&&f(e,i,c.x,c.y)}this._setCursorFromEvent(e,t),this._handleEvent(e,"up",1,a),this._groupSelector=null,this._currentTransform=null,t&&(t.__corner=0),o?this.requestRenderAll():a||this.renderTop()}}},_simpleEventHandler:function(e,t){var i=this.findTarget(t),n=this.targets,r={e:t,target:i,subTargets:n};if(this.fire(e,r),i&&i.fire(e,r),!n)return i;for(var o=0;o<n.length;o++)n[o].fire(e,r);return i},_handleEvent:function(e,t,i,n){var r=this._target,o=this.targets||[],a={e:e,target:r,subTargets:o,button:i||1,isClick:n||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};"up"===t&&(a.currentTarget=this.findTarget(e),a.currentSubTargets=this.targets),this.fire("mouse:"+t,a),r&&r.fire("mouse"+t,a);for(var s=0;s<o.length;s++)o[s].fire("mouse"+t,a)},_finalizeCurrentTransform:function(e){var t=this._currentTransform,i=t.target,n={e:e,target:i,transform:t,action:t.action};i._scaling&&(i._scaling=!1),i.setCoords(),(t.actionPerformed||this.stateful&&i.hasStateChanged())&&this._fire("modified",n)},_onMouseDownInDrawingMode:function(e){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(e).requestRenderAll();var t=this.getPointer(e);this.freeDrawingBrush.onMouseDown(t,{e:e,pointer:t}),this._handleEvent(e,"down")},_onMouseMoveInDrawingMode:function(e){if(this._isCurrentlyDrawing){var t=this.getPointer(e);this.freeDrawingBrush.onMouseMove(t,{e:e,pointer:t})}this.setCursor(this.freeDrawingCursor),this._handleEvent(e,"move")},_onMouseUpInDrawingMode:function(e){var t=this.getPointer(e);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:e,pointer:t}),this._handleEvent(e,"up")},__onMouseDown:function(e){this._cacheTransformEventData(e),this._handleEvent(e,"down:before");var t=this._target;if(n(e,3))this.fireRightClick&&this._handleEvent(e,"down",3);else if(n(e,2))this.fireMiddleClick&&this._handleEvent(e,"down",2);else if(this.isDrawingMode)this._onMouseDownInDrawingMode(e);else if(this._isMainEvent(e)&&!this._currentTransform){var i=this._pointer;this._previousPointer=i;var r=this._shouldRender(t),o=this._shouldGroup(e,t);if(this._shouldClearSelection(e,t)?this.discardActiveObject(e):o&&(this._handleGrouping(e,t),t=this._activeObject),!this.selection||t&&(t.selectable||t.isEditing||t===this._activeObject)||(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),t){var a=t===this._activeObject;t.selectable&&"down"===t.activeOn&&this.setActiveObject(t,e);var s=t._findTargetCorner(this.getPointer(e,!0),x.util.isTouchEvent(e));if(t.__corner=s,t===this._activeObject&&(s||!o)){this._setupCurrentTransform(e,t,a);var l=t.controls[s],c=(i=this.getPointer(e),l&&l.getMouseDownHandler(e,t,l));c&&c(e,this._currentTransform,i.x,i.y)}}this._handleEvent(e,"down"),(r||o)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(e){this._resetTransformEventData(),this._pointer=this.getPointer(e,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(e)||null},_beforeTransform:function(e){var t=this._currentTransform;this.stateful&&t.target.saveState(),this.fire("before:transform",{e:e,transform:t})},__onMouseMove:function(e){var t,i;if(this._handleEvent(e,"move:before"),this._cacheTransformEventData(e),this.isDrawingMode)this._onMouseMoveInDrawingMode(e);else if(this._isMainEvent(e)){var n=this._groupSelector;n?(i=this._absolutePointer,n.left=i.x-n.ex,n.top=i.y-n.ey,this.renderTop()):this._currentTransform?this._transformObject(e):(t=this.findTarget(e)||null,this._setCursorFromEvent(e,t),this._fireOverOutEvents(t,e)),this._handleEvent(e,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(e,t){var i=this._hoveredTarget,n=this._hoveredTargets,r=this.targets,o=Math.max(n.length,r.length);this.fireSyntheticInOutEvents(e,t,{oldTarget:i,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var a=0;a<o;a++)this.fireSyntheticInOutEvents(r[a],t,{oldTarget:n[a],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=e,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(e,t){var i=this._draggedoverTarget,n=this._hoveredTargets,r=this.targets,o=Math.max(n.length,r.length);this.fireSyntheticInOutEvents(e,t,{oldTarget:i,evtOut:"dragleave",evtIn:"dragenter"});for(var a=0;a<o;a++)this.fireSyntheticInOutEvents(r[a],t,{oldTarget:n[a],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=e},fireSyntheticInOutEvents:function(e,t,i){var n,r,o,a=i.oldTarget,s=a!==e,l=i.canvasEvtIn,c=i.canvasEvtOut;s&&(n={e:t,target:e,previousTarget:a},r={e:t,target:a,nextTarget:e}),o=e&&s,a&&s&&(c&&this.fire(c,r),a.fire(i.evtOut,r)),o&&(l&&this.fire(l,n),e.fire(i.evtIn,n))},__onMouseWheel:function(e){this._cacheTransformEventData(e),this._handleEvent(e,"wheel"),this._resetTransformEventData()},_transformObject:function(e){var t=this.getPointer(e),i=this._currentTransform;i.reset=!1,i.shiftKey=e.shiftKey,i.altKey=e[this.centeredKey],this._performTransformAction(e,i,t),i.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(e,t,i){var n=i.x,r=i.y,o=t.action,a=!1,s=t.actionHandler;s&&(a=s(e,t,n,r)),"drag"===o&&a&&(t.target.isMoving=!0,this.setCursor(t.target.moveCursor||this.moveCursor)),t.actionPerformed=t.actionPerformed||a},_fire:x.controlsUtils.fireEvent,_setCursorFromEvent:function(e,t){if(!t)return this.setCursor(this.defaultCursor),!1;var i=t.hoverCursor||this.hoverCursor,n=this._activeObject&&"activeSelection"===this._activeObject.type?this._activeObject:null,r=(!n||!n.contains(t))&&t._findTargetCorner(this.getPointer(e,!0));r?this.setCursor(this.getCornerCursor(r,t,e)):(t.subTargetCheck&&this.targets.concat().reverse().map((function(e){i=e.hoverCursor||i})),this.setCursor(i))},getCornerCursor:function(e,t,i){var n=t.controls[e];return n.cursorStyleHandler(i,n,t)}})}(),v=Math.min,y=Math.max,x.util.object.extend(x.Canvas.prototype,{_shouldGroup:function(e,t){var i=this._activeObject;return i&&this._isSelectionKeyPressed(e)&&t&&t.selectable&&this.selection&&(i!==t||"activeSelection"===i.type)&&!t.onSelect({e:e})},_handleGrouping:function(e,t){var i=this._activeObject;i.__corner||(t!==i||(t=this.findTarget(e,!0))&&t.selectable)&&(i&&"activeSelection"===i.type?this._updateActiveSelection(t,e):this._createActiveSelection(t,e))},_updateActiveSelection:function(e,t){var i=this._activeObject,n=i._objects.slice(0);i.contains(e)?(i.removeWithUpdate(e),this._hoveredTarget=e,this._hoveredTargets=this.targets.concat(),1===i.size()&&this._setActiveObject(i.item(0),t)):(i.addWithUpdate(e),this._hoveredTarget=i,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(n,t)},_createActiveSelection:function(e,t){var i=this.getActiveObjects(),n=this._createGroup(e);this._hoveredTarget=n,this._setActiveObject(n,t),this._fireSelectionEvents(i,t)},_createGroup:function(e){var t=this._objects,i=t.indexOf(this._activeObject)<t.indexOf(e)?[this._activeObject,e]:[e,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new x.ActiveSelection(i,{canvas:this})},_groupSelectedObjects:function(e){var t,i=this._collectObjects(e);1===i.length?this.setActiveObject(i[0],e):i.length>1&&(t=new x.ActiveSelection(i.reverse(),{canvas:this}),this.setActiveObject(t,e))},_collectObjects:function(e){for(var t,i=[],n=this._groupSelector.ex,r=this._groupSelector.ey,o=n+this._groupSelector.left,a=r+this._groupSelector.top,s=new x.Point(v(n,o),v(r,a)),l=new x.Point(y(n,o),y(r,a)),c=!this.selectionFullyContained,u=n===o&&r===a,h=this._objects.length;h--&&!((t=this._objects[h])&&t.selectable&&t.visible&&(c&&t.intersectsWithRect(s,l,!0)||t.isContainedWithinRect(s,l,!0)||c&&t.containsPoint(s,null,!0)||c&&t.containsPoint(l,null,!0))&&(i.push(t),u)););return i.length>1&&(i=i.filter((function(t){return!t.onSelect({e:e})}))),i},_maybeGroupObjects:function(e){this.selection&&this._groupSelector&&this._groupSelectedObjects(e),this.setCursor(this.defaultCursor),this._groupSelector=null}}),x.util.object.extend(x.StaticCanvas.prototype,{toDataURL:function(e){e||(e={});var t=e.format||"png",i=e.quality||1,n=(e.multiplier||1)*(e.enableRetinaScaling?this.getRetinaScaling():1),r=this.toCanvasElement(n,e);return x.util.toDataURL(r,t,i)},toCanvasElement:function(e,t){e=e||1;var i=((t=t||{}).width||this.width)*e,n=(t.height||this.height)*e,r=this.getZoom(),o=this.width,a=this.height,s=r*e,l=this.viewportTransform,c=(l[4]-(t.left||0))*e,u=(l[5]-(t.top||0))*e,h=this.interactive,d=[s,0,0,s,c,u],f=this.enableRetinaScaling,g=x.util.createCanvasElement(),p=this.contextTop;return g.width=i,g.height=n,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=d,this.width=i,this.height=n,this.calcViewportBoundaries(),this.renderCanvas(g.getContext("2d"),this._objects),this.viewportTransform=l,this.width=o,this.height=a,this.calcViewportBoundaries(),this.interactive=h,this.enableRetinaScaling=f,this.contextTop=p,g}}),x.util.object.extend(x.StaticCanvas.prototype,{loadFromJSON:function(e,t,i){if(e){var n="string"==typeof e?JSON.parse(e):x.util.object.clone(e),r=this,o=n.clipPath,a=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete n.clipPath,this._enlivenObjects(n.objects,(function(e){r.clear(),r._setBgOverlay(n,(function(){o?r._enlivenObjects([o],(function(i){r.clipPath=i[0],r.__setupCanvas.call(r,n,e,a,t)})):r.__setupCanvas.call(r,n,e,a,t)}))}),i),this}},__setupCanvas:function(e,t,i,n){var r=this;t.forEach((function(e,t){r.insertAt(e,t)})),this.renderOnAddRemove=i,delete e.objects,delete e.backgroundImage,delete e.overlayImage,delete e.background,delete e.overlay,this._setOptions(e),this.renderAll(),n&&n()},_setBgOverlay:function(e,t){var i={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(e.backgroundImage||e.overlayImage||e.background||e.overlay){var n=function(){i.backgroundImage&&i.overlayImage&&i.backgroundColor&&i.overlayColor&&t&&t()};this.__setBgOverlay("backgroundImage",e.backgroundImage,i,n),this.__setBgOverlay("overlayImage",e.overlayImage,i,n),this.__setBgOverlay("backgroundColor",e.background,i,n),this.__setBgOverlay("overlayColor",e.overlay,i,n)}else t&&t()},__setBgOverlay:function(e,t,i,n){var r=this;if(!t)return i[e]=!0,void(n&&n());"backgroundImage"===e||"overlayImage"===e?x.util.enlivenObjects([t],(function(t){r[e]=t[0],i[e]=!0,n&&n()})):this["set"+x.util.string.capitalize(e,!0)](t,(function(){i[e]=!0,n&&n()}))},_enlivenObjects:function(e,t,i){e&&0!==e.length?x.util.enlivenObjects(e,(function(e){t&&t(e)}),null,i):t&&t([])},_toDataURL:function(e,t){this.clone((function(i){t(i.toDataURL(e))}))},_toDataURLWithMultiplier:function(e,t,i){this.clone((function(n){i(n.toDataURLWithMultiplier(e,t))}))},clone:function(e,t){var i=JSON.stringify(this.toJSON(t));this.cloneWithoutData((function(t){t.loadFromJSON(i,(function(){e&&e(t)}))}))},cloneWithoutData:function(e){var t=x.util.createCanvasElement();t.width=this.width,t.height=this.height;var i=new x.Canvas(t);this.backgroundImage?(i.setBackgroundImage(this.backgroundImage.src,(function(){i.renderAll(),e&&e(i)})),i.backgroundImageOpacity=this.backgroundImageOpacity,i.backgroundImageStretch=this.backgroundImageStretch):e&&e(i)}}),function(e){var t=e.fabric||(e.fabric={}),i=t.util.object.extend,n=t.util.object.clone,r=t.util.toFixed,o=t.util.string.capitalize,a=t.util.degreesToRadians,s=!t.isLikelyNode;t.Object||(t.Object=t.util.createClass(t.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:s,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(e){e&&this.setOptions(e)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=t.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(e){var i=t.perfLimitSizeTotal,n=e.width,r=e.height,o=t.maxCacheSideLimit,a=t.minCacheSideLimit;if(n<=o&&r<=o&&n*r<=i)return n<a&&(e.width=a),r<a&&(e.height=a),e;var s=n/r,l=t.util.limitDimsByArea(s,i),c=t.util.capValue,u=c(a,l.x,o),h=c(a,l.y,o);return n>u&&(e.zoomX/=n/u,e.width=u,e.capped=!0),r>h&&(e.zoomY/=r/h,e.height=h,e.capped=!0),e},_getCacheCanvasDimensions:function(){var e=this.getTotalObjectScaling(),t=this._getTransformedDimensions(0,0),i=t.x*e.scaleX/this.scaleX,n=t.y*e.scaleY/this.scaleY;return{width:i+2,height:n+2,zoomX:e.scaleX,zoomY:e.scaleY,x:i,y:n}},_updateCacheCanvas:function(){var e=this.canvas;if(this.noScaleCache&&e&&e._currentTransform){var i=e._currentTransform.target,n=e._currentTransform.action;if(this===i&&n.slice&&"scale"===n.slice(0,5))return!1}var r,o,a=this._cacheCanvas,s=this._limitCacheSize(this._getCacheCanvasDimensions()),l=t.minCacheSideLimit,c=s.width,u=s.height,h=s.zoomX,d=s.zoomY,f=c!==this.cacheWidth||u!==this.cacheHeight,g=this.zoomX!==h||this.zoomY!==d,p=f||g,m=0,_=0,v=!1;if(f){var y=this._cacheCanvas.width,b=this._cacheCanvas.height,S=c>y||u>b;v=S||(c<.9*y||u<.9*b)&&y>l&&b>l,S&&!s.capped&&(c>l||u>l)&&(m=.1*c,_=.1*u)}return this instanceof t.Text&&this.path&&(p=!0,v=!0,m+=this.getHeightOfLine(0)*this.zoomX,_+=this.getHeightOfLine(0)*this.zoomY),!!p&&(v?(a.width=Math.ceil(c+m),a.height=Math.ceil(u+_)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,a.width,a.height)),r=s.x/2,o=s.y/2,this.cacheTranslationX=Math.round(a.width/2-r)+r,this.cacheTranslationY=Math.round(a.height/2-o)+o,this.cacheWidth=c,this.cacheHeight=u,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(h,d),this.zoomX=h,this.zoomY=d,!0)},setOptions:function(e){this._setOptions(e),this._initGradient(e.fill,"fill"),this._initGradient(e.stroke,"stroke"),this._initPattern(e.fill,"fill"),this._initPattern(e.stroke,"stroke")},transform:function(e){var t=this.group&&!this.group._transformDone||this.group&&this.canvas&&e===this.canvas.contextTop,i=this.calcTransformMatrix(!t);e.transform(i[0],i[1],i[2],i[3],i[4],i[5])},toObject:function(e){var i=t.Object.NUM_FRACTION_DIGITS,n={type:this.type,version:t.version,originX:this.originX,originY:this.originY,left:r(this.left,i),top:r(this.top,i),width:r(this.width,i),height:r(this.height,i),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:r(this.strokeWidth,i),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:r(this.strokeMiterLimit,i),scaleX:r(this.scaleX,i),scaleY:r(this.scaleY,i),angle:r(this.angle,i),flipX:this.flipX,flipY:this.flipY,opacity:r(this.opacity,i),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:r(this.skewX,i),skewY:r(this.skewY,i)};return this.clipPath&&!this.clipPath.excludeFromExport&&(n.clipPath=this.clipPath.toObject(e),n.clipPath.inverted=this.clipPath.inverted,n.clipPath.absolutePositioned=this.clipPath.absolutePositioned),t.util.populateWithProperties(this,n,e),this.includeDefaultValues||(n=this._removeDefaultValues(n)),n},toDatalessObject:function(e){return this.toObject(e)},_removeDefaultValues:function(e){var i=t.util.getKlass(e.type).prototype;return i.stateProperties.forEach((function(t){"left"!==t&&"top"!==t&&(e[t]===i[t]&&delete e[t],Array.isArray(e[t])&&Array.isArray(i[t])&&0===e[t].length&&0===i[t].length&&delete e[t])})),e},toString:function(){return"#<fabric."+o(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var e=t.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(e.scaleX),scaleY:Math.abs(e.scaleY)}},getTotalObjectScaling:function(){var e=this.getObjectScaling(),t=e.scaleX,i=e.scaleY;if(this.canvas){var n=this.canvas.getZoom(),r=this.canvas.getRetinaScaling();t*=n*r,i*=n*r}return{scaleX:t,scaleY:i}},getObjectOpacity:function(){var e=this.opacity;return this.group&&(e*=this.group.getObjectOpacity()),e},_set:function(e,i){var n="scaleX"===e||"scaleY"===e,r=this[e]!==i,o=!1;return n&&(i=this._constrainScale(i)),"scaleX"===e&&i<0?(this.flipX=!this.flipX,i*=-1):"scaleY"===e&&i<0?(this.flipY=!this.flipY,i*=-1):"shadow"!==e||!i||i instanceof t.Shadow?"dirty"===e&&this.group&&this.group.set("dirty",i):i=new t.Shadow(i),this[e]=i,r&&(o=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(e)>-1?(this.dirty=!0,o&&this.group.set("dirty",!0)):o&&this.stateProperties.indexOf(e)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:t.iMatrix.concat()},isNotVisible:function(){return 0===this.opacity||!this.width&&!this.height&&0===this.strokeWidth||!this.visible},render:function(e){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(e.save(),this._setupCompositeOperation(e),this.drawSelectionBackground(e),this.transform(e),this._setOpacity(e),this._setShadow(e,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(e)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(e),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),e.restore())},renderCache:function(e){e=e||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,e.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&"transparent"!==this.stroke&&0!==this.strokeWidth},hasFill:function(){return this.fill&&"transparent"!==this.fill},needsItsOwnCache:function(){return!("stroke"!==this.paintFirst||!this.hasFill()||!this.hasStroke()||"object"!=typeof this.shadow)||!!this.clipPath},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(0!==this.shadow.offsetX||0!==this.shadow.offsetY)},drawClipPathOnCache:function(e,i){if(e.save(),i.inverted?e.globalCompositeOperation="destination-out":e.globalCompositeOperation="destination-in",i.absolutePositioned){var n=t.util.invertTransform(this.calcTransformMatrix());e.transform(n[0],n[1],n[2],n[3],n[4],n[5])}i.transform(e),e.scale(1/i.zoomX,1/i.zoomY),e.drawImage(i._cacheCanvas,-i.cacheTranslationX,-i.cacheTranslationY),e.restore()},drawObject:function(e,t){var i=this.fill,n=this.stroke;t?(this.fill="black",this.stroke="",this._setClippingProperties(e)):this._renderBackground(e),this._render(e),this._drawClipPath(e,this.clipPath),this.fill=i,this.stroke=n},_drawClipPath:function(e,t){t&&(t.canvas=this.canvas,t.shouldCache(),t._transformDone=!0,t.renderCache({forClipping:!0}),this.drawClipPathOnCache(e,t))},drawCacheOnCanvas:function(e){e.scale(1/this.zoomX,1/this.zoomY),e.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(e){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!e&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!e){var t=this.cacheWidth/this.zoomX,i=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-t/2,-i/2,t,i)}return!0}return!1},_renderBackground:function(e){if(this.backgroundColor){var t=this._getNonTransformedDimensions();e.fillStyle=this.backgroundColor,e.fillRect(-t.x/2,-t.y/2,t.x,t.y),this._removeShadow(e)}},_setOpacity:function(e){this.group&&!this.group._transformDone?e.globalAlpha=this.getObjectOpacity():e.globalAlpha*=this.opacity},_setStrokeStyles:function(e,t){var i=t.stroke;i&&(e.lineWidth=t.strokeWidth,e.lineCap=t.strokeLineCap,e.lineDashOffset=t.strokeDashOffset,e.lineJoin=t.strokeLineJoin,e.miterLimit=t.strokeMiterLimit,i.toLive?"percentage"===i.gradientUnits||i.gradientTransform||i.patternTransform?this._applyPatternForTransformedGradient(e,i):(e.strokeStyle=i.toLive(e,this),this._applyPatternGradientTransform(e,i)):e.strokeStyle=t.stroke)},_setFillStyles:function(e,t){var i=t.fill;i&&(i.toLive?(e.fillStyle=i.toLive(e,this),this._applyPatternGradientTransform(e,t.fill)):e.fillStyle=i)},_setClippingProperties:function(e){e.globalAlpha=1,e.strokeStyle="transparent",e.fillStyle="#000000"},_setLineDash:function(e,t){t&&0!==t.length&&(1&t.length&&t.push.apply(t,t),e.setLineDash(t))},_renderControls:function(e,i){var n,r,o,s=this.getViewportTransform(),l=this.calcTransformMatrix();r=void 0!==(i=i||{}).hasBorders?i.hasBorders:this.hasBorders,o=void 0!==i.hasControls?i.hasControls:this.hasControls,l=t.util.multiplyTransformMatrices(s,l),n=t.util.qrDecompose(l),e.save(),e.translate(n.translateX,n.translateY),e.lineWidth=1*this.borderScaleFactor,this.group||(e.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(n.angle-=180),e.rotate(a(this.group?n.angle:this.angle)),i.forActiveSelection||this.group?r&&this.drawBordersInGroup(e,n,i):r&&this.drawBorders(e,i),o&&this.drawControls(e,i),e.restore()},_setShadow:function(e){if(this.shadow){var i,n=this.shadow,r=this.canvas,o=r&&r.viewportTransform[0]||1,a=r&&r.viewportTransform[3]||1;i=n.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),r&&r._isRetinaScaling()&&(o*=t.devicePixelRatio,a*=t.devicePixelRatio),e.shadowColor=n.color,e.shadowBlur=n.blur*t.browserShadowBlurConstant*(o+a)*(i.scaleX+i.scaleY)/4,e.shadowOffsetX=n.offsetX*o*i.scaleX,e.shadowOffsetY=n.offsetY*a*i.scaleY}},_removeShadow:function(e){this.shadow&&(e.shadowColor="",e.shadowBlur=e.shadowOffsetX=e.shadowOffsetY=0)},_applyPatternGradientTransform:function(e,t){if(!t||!t.toLive)return{offsetX:0,offsetY:0};var i=t.gradientTransform||t.patternTransform,n=-this.width/2+t.offsetX||0,r=-this.height/2+t.offsetY||0;return"percentage"===t.gradientUnits?e.transform(this.width,0,0,this.height,n,r):e.transform(1,0,0,1,n,r),i&&e.transform(i[0],i[1],i[2],i[3],i[4],i[5]),{offsetX:n,offsetY:r}},_renderPaintInOrder:function(e){"stroke"===this.paintFirst?(this._renderStroke(e),this._renderFill(e)):(this._renderFill(e),this._renderStroke(e))},_render:function(){},_renderFill:function(e){this.fill&&(e.save(),this._setFillStyles(e,this),"evenodd"===this.fillRule?e.fill("evenodd"):e.fill(),e.restore())},_renderStroke:function(e){if(this.stroke&&0!==this.strokeWidth){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(e),e.save(),this.strokeUniform&&this.group){var t=this.getObjectScaling();e.scale(1/t.scaleX,1/t.scaleY)}else this.strokeUniform&&e.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(e,this.strokeDashArray),this._setStrokeStyles(e,this),e.stroke(),e.restore()}},_applyPatternForTransformedGradient:function(e,i){var n,r=this._limitCacheSize(this._getCacheCanvasDimensions()),o=t.util.createCanvasElement(),a=this.canvas.getRetinaScaling(),s=r.x/this.scaleX/a,l=r.y/this.scaleY/a;o.width=s,o.height=l,(n=o.getContext("2d")).beginPath(),n.moveTo(0,0),n.lineTo(s,0),n.lineTo(s,l),n.lineTo(0,l),n.closePath(),n.translate(s/2,l/2),n.scale(r.zoomX/this.scaleX/a,r.zoomY/this.scaleY/a),this._applyPatternGradientTransform(n,i),n.fillStyle=i.toLive(e),n.fill(),e.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),e.scale(a*this.scaleX/r.zoomX,a*this.scaleY/r.zoomY),e.strokeStyle=n.createPattern(o,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var e=t.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",e.scaleX),this.set("scaleY",e.scaleY),this.angle=e.angle,this.skewX=e.skewX,this.skewY=0}},_removeTransformMatrix:function(e){var i=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),i=t.util.transformPoint(i,this.transformMatrix)),this.transformMatrix=null,e&&(this.scaleX*=e.scaleX,this.scaleY*=e.scaleY,this.cropX=e.cropX,this.cropY=e.cropY,i.x+=e.offsetLeft,i.y+=e.offsetTop,this.width=e.width,this.height=e.height),this.setPositionByOrigin(i,"center","center")},clone:function(e,i){var n=this.toObject(i);this.constructor.fromObject?this.constructor.fromObject(n,e):t.Object._fromObject("Object",n,e)},cloneAsImage:function(e,i){var n=this.toCanvasElement(i);return e&&e(new t.Image(n)),this},toCanvasElement:function(e){e||(e={});var i=t.util,n=i.saveObjectTransform(this),r=this.group,o=this.shadow,a=Math.abs,s=(e.multiplier||1)*(e.enableRetinaScaling?t.devicePixelRatio:1);delete this.group,e.withoutTransform&&i.resetObjectTransform(this),e.withoutShadow&&(this.shadow=null);var l,c,u,h,d=t.util.createCanvasElement(),f=this.getBoundingRect(!0,!0),g=this.shadow,p={x:0,y:0};g&&(c=g.blur,l=g.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),p.x=2*Math.round(a(g.offsetX)+c)*a(l.scaleX),p.y=2*Math.round(a(g.offsetY)+c)*a(l.scaleY)),u=f.width+p.x,h=f.height+p.y,d.width=Math.ceil(u),d.height=Math.ceil(h);var m=new t.StaticCanvas(d,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});"jpeg"===e.format&&(m.backgroundColor="#fff"),this.setPositionByOrigin(new t.Point(m.width/2,m.height/2),"center","center");var _=this.canvas;m.add(this);var v=m.toCanvasElement(s||1,e);return this.shadow=o,this.set("canvas",_),r&&(this.group=r),this.set(n).setCoords(),m._objects=[],m.dispose(),m=null,v},toDataURL:function(e){return e||(e={}),t.util.toDataURL(this.toCanvasElement(e),e.format||"png",e.quality||1)},isType:function(e){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===e},complexity:function(){return 1},toJSON:function(e){return this.toObject(e)},rotate:function(e){var t=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;return t&&this._setOriginToCenter(),this.set("angle",e),t&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(e,i){i=i||this.canvas.getPointer(e);var n=new t.Point(i.x,i.y),r=this._getLeftTopCoords();return this.angle&&(n=t.util.rotatePoint(n,r,a(-this.angle))),{x:n.x-r.x,y:n.y-r.y}},_setupCompositeOperation:function(e){this.globalCompositeOperation&&(e.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){t.runningAnimations&&t.runningAnimations.cancelByTarget(this)}}),t.util.createAccessors&&t.util.createAccessors(t.Object),i(t.Object.prototype,t.Observable),t.Object.NUM_FRACTION_DIGITS=2,t.Object.ENLIVEN_PROPS=["clipPath"],t.Object._fromObject=function(e,i,r,o){var a=t[e];i=n(i,!0),t.util.enlivenPatterns([i.fill,i.stroke],(function(e){void 0!==e[0]&&(i.fill=e[0]),void 0!==e[1]&&(i.stroke=e[1]),t.util.enlivenObjectEnlivables(i,i,(function(){var e=o?new a(i[o],i):new a(i);r&&r(e)}))}))},t.Object.__uid=0)}(t),b=x.util.degreesToRadians,S={left:-.5,center:0,right:.5},w={top:-.5,center:0,bottom:.5},x.util.object.extend(x.Object.prototype,{translateToGivenOrigin:function(e,t,i,n,r){var o,a,s,l=e.x,c=e.y;return"string"==typeof t?t=S[t]:t-=.5,"string"==typeof n?n=S[n]:n-=.5,"string"==typeof i?i=w[i]:i-=.5,"string"==typeof r?r=w[r]:r-=.5,a=r-i,((o=n-t)||a)&&(s=this._getTransformedDimensions(),l=e.x+o*s.x,c=e.y+a*s.y),new x.Point(l,c)},translateToCenterPoint:function(e,t,i){var n=this.translateToGivenOrigin(e,t,i,"center","center");return this.angle?x.util.rotatePoint(n,e,b(this.angle)):n},translateToOriginPoint:function(e,t,i){var n=this.translateToGivenOrigin(e,"center","center",t,i);return this.angle?x.util.rotatePoint(n,e,b(this.angle)):n},getCenterPoint:function(){var e=new x.Point(this.left,this.top);return this.translateToCenterPoint(e,this.originX,this.originY)},getPointByOrigin:function(e,t){var i=this.getCenterPoint();return this.translateToOriginPoint(i,e,t)},toLocalPoint:function(e,t,i){var n,r,o=this.getCenterPoint();return n=void 0!==t&&void 0!==i?this.translateToGivenOrigin(o,"center","center",t,i):new x.Point(this.left,this.top),r=new x.Point(e.x,e.y),this.angle&&(r=x.util.rotatePoint(r,o,-b(this.angle))),r.subtractEquals(n)},setPositionByOrigin:function(e,t,i){var n=this.translateToCenterPoint(e,t,i),r=this.translateToOriginPoint(n,this.originX,this.originY);this.set("left",r.x),this.set("top",r.y)},adjustPosition:function(e){var t,i,n=b(this.angle),r=this.getScaledWidth(),o=x.util.cos(n)*r,a=x.util.sin(n)*r;t="string"==typeof this.originX?S[this.originX]:this.originX-.5,i="string"==typeof e?S[e]:e-.5,this.left+=o*(i-t),this.top+=a*(i-t),this.setCoords(),this.originX=e},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var e=this.getCenterPoint();this.originX="center",this.originY="center",this.left=e.x,this.top=e.y},_resetOrigin:function(){var e=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=e.x,this.top=e.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}}),function(){var e=x.util,t=e.degreesToRadians,i=e.multiplyTransformMatrices,n=e.transformPoint;e.object.extend(x.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(e,t){return t?e?this.calcACoords():this.calcLineCoords():(this.aCoords&&this.lineCoords||this.setCoords(!0),e?this.aCoords:this.lineCoords)},getCoords:function(e,t){return i=this._getCoords(e,t),[new x.Point(i.tl.x,i.tl.y),new x.Point(i.tr.x,i.tr.y),new x.Point(i.br.x,i.br.y),new x.Point(i.bl.x,i.bl.y)];var i},intersectsWithRect:function(e,t,i,n){var r=this.getCoords(i,n);return"Intersection"===x.Intersection.intersectPolygonRectangle(r,e,t).status},intersectsWithObject:function(e,t,i){return"Intersection"===x.Intersection.intersectPolygonPolygon(this.getCoords(t,i),e.getCoords(t,i)).status||e.isContainedWithinObject(this,t,i)||this.isContainedWithinObject(e,t,i)},isContainedWithinObject:function(e,t,i){for(var n=this.getCoords(t,i),r=t?e.aCoords:e.lineCoords,o=0,a=e._getImageLines(r);o<4;o++)if(!e.containsPoint(n[o],a))return!1;return!0},isContainedWithinRect:function(e,t,i,n){var r=this.getBoundingRect(i,n);return r.left>=e.x&&r.left+r.width<=t.x&&r.top>=e.y&&r.top+r.height<=t.y},containsPoint:function(e,t,i,n){var r=this._getCoords(i,n),o=(t=t||this._getImageLines(r),this._findCrossPoints(e,t));return 0!==o&&o%2==1},isOnScreen:function(e){if(!this.canvas)return!1;var t=this.canvas.vptCoords.tl,i=this.canvas.vptCoords.br;return!!this.getCoords(!0,e).some((function(e){return e.x<=i.x&&e.x>=t.x&&e.y<=i.y&&e.y>=t.y}))||!!this.intersectsWithRect(t,i,!0,e)||this._containsCenterOfCanvas(t,i,e)},_containsCenterOfCanvas:function(e,t,i){var n={x:(e.x+t.x)/2,y:(e.y+t.y)/2};return!!this.containsPoint(n,null,!0,i)},isPartiallyOnScreen:function(e){if(!this.canvas)return!1;var t=this.canvas.vptCoords.tl,i=this.canvas.vptCoords.br;return!!this.intersectsWithRect(t,i,!0,e)||this.getCoords(!0,e).every((function(e){return(e.x>=i.x||e.x<=t.x)&&(e.y>=i.y||e.y<=t.y)}))&&this._containsCenterOfCanvas(t,i,e)},_getImageLines:function(e){return{topline:{o:e.tl,d:e.tr},rightline:{o:e.tr,d:e.br},bottomline:{o:e.br,d:e.bl},leftline:{o:e.bl,d:e.tl}}},_findCrossPoints:function(e,t){var i,n,r,o=0;for(var a in t)if(!((r=t[a]).o.y<e.y&&r.d.y<e.y||r.o.y>=e.y&&r.d.y>=e.y||(r.o.x===r.d.x&&r.o.x>=e.x?n=r.o.x:(i=(r.d.y-r.o.y)/(r.d.x-r.o.x),n=-(e.y-0*e.x-(r.o.y-i*r.o.x))/(0-i)),n>=e.x&&(o+=1),2!==o)))break;return o},getBoundingRect:function(t,i){var n=this.getCoords(t,i);return e.makeBoundingBoxFromPoints(n)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(e){return Math.abs(e)<this.minScaleLimit?e<0?-this.minScaleLimit:this.minScaleLimit:0===e?1e-4:e},scale:function(e){return this._set("scaleX",e),this._set("scaleY",e),this.setCoords()},scaleToWidth:function(e,t){var i=this.getBoundingRect(t).width/this.getScaledWidth();return this.scale(e/this.width/i)},scaleToHeight:function(e,t){var i=this.getBoundingRect(t).height/this.getScaledHeight();return this.scale(e/this.height/i)},calcLineCoords:function(){var i=this.getViewportTransform(),r=this.padding,o=t(this.angle),a=e.cos(o)*r,s=e.sin(o)*r,l=a+s,c=a-s,u=this.calcACoords(),h={tl:n(u.tl,i),tr:n(u.tr,i),bl:n(u.bl,i),br:n(u.br,i)};return r&&(h.tl.x-=c,h.tl.y-=l,h.tr.x+=l,h.tr.y-=c,h.bl.x-=l,h.bl.y+=c,h.br.x+=c,h.br.y+=l),h},calcOCoords:function(){var e=this._calcRotateMatrix(),t=this._calcTranslateMatrix(),n=this.getViewportTransform(),r=i(n,t),o=i(r,e),a=(o=i(o,[1/n[0],0,0,1/n[3],0,0]),this._calculateCurrentDimensions()),s={};return this.forEachControl((function(e,t,i){s[t]=e.positionHandler(a,o,i)})),s},calcACoords:function(){var e=this._calcRotateMatrix(),t=this._calcTranslateMatrix(),r=i(t,e),o=this._getTransformedDimensions(),a=o.x/2,s=o.y/2;return{tl:n({x:-a,y:-s},r),tr:n({x:a,y:-s},r),bl:n({x:-a,y:s},r),br:n({x:a,y:s},r)}},setCoords:function(e){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),e||(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords()),this},_calcRotateMatrix:function(){return e.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var e=this.getCenterPoint();return[1,0,0,1,e.x,e.y]},transformMatrixKey:function(e){var t="_",i="";return!e&&this.group&&(i=this.group.transformMatrixKey(e)+t),i+this.top+t+this.left+t+this.scaleX+t+this.scaleY+t+this.skewX+t+this.skewY+t+this.angle+t+this.originX+t+this.originY+t+this.width+t+this.height+t+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(e){var t=this.calcOwnMatrix();if(e||!this.group)return t;var n=this.transformMatrixKey(e),r=this.matrixCache||(this.matrixCache={});return r.key===n?r.value:(this.group&&(t=i(this.group.calcTransformMatrix(!1),t)),r.key=n,r.value=t,t)},calcOwnMatrix:function(){var t=this.transformMatrixKey(!0),i=this.ownMatrixCache||(this.ownMatrixCache={});if(i.key===t)return i.value;var n=this._calcTranslateMatrix(),r={angle:this.angle,translateX:n[4],translateY:n[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return i.key=t,i.value=e.composeMatrix(r),i.value},_getNonTransformedDimensions:function(){var e=this.strokeWidth;return{x:this.width+e,y:this.height+e}},_getTransformedDimensions:function(t,i){void 0===t&&(t=this.skewX),void 0===i&&(i=this.skewY);var n,r,o,a=0===t&&0===i;if(this.strokeUniform?(r=this.width,o=this.height):(r=(n=this._getNonTransformedDimensions()).x,o=n.y),a)return this._finalizeDimensions(r*this.scaleX,o*this.scaleY);var s=e.sizeAfterTransform(r,o,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:t,skewY:i});return this._finalizeDimensions(s.x,s.y)},_finalizeDimensions:function(e,t){return this.strokeUniform?{x:e+this.strokeWidth,y:t+this.strokeWidth}:{x:e,y:t}},_calculateCurrentDimensions:function(){var e=this.getViewportTransform(),t=this._getTransformedDimensions();return n(t,e,!0).scalarAdd(2*this.padding)}})}(),x.util.object.extend(x.Object.prototype,{sendToBack:function(){return this.group?x.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?x.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(e){return this.group?x.StaticCanvas.prototype.sendBackwards.call(this.group,this,e):this.canvas&&this.canvas.sendBackwards(this,e),this},bringForward:function(e){return this.group?x.StaticCanvas.prototype.bringForward.call(this.group,this,e):this.canvas&&this.canvas.bringForward(this,e),this},moveTo:function(e){return this.group&&"activeSelection"!==this.group.type?x.StaticCanvas.prototype.moveTo.call(this.group,this,e):this.canvas&&this.canvas.moveTo(this,e),this}}),function(){function e(e,t){if(t){if(t.toLive)return e+": url(#SVGID_"+t.id+"); ";var i=new x.Color(t),n=e+": "+i.toRgb()+"; ",r=i.getAlpha();return 1!==r&&(n+=e+"-opacity: "+r.toString()+"; "),n}return e+": none; "}var t=x.util.toFixed;x.util.object.extend(x.Object.prototype,{getSvgStyles:function(t){var i=this.fillRule?this.fillRule:"nonzero",n=this.strokeWidth?this.strokeWidth:"0",r=this.strokeDashArray?this.strokeDashArray.join(" "):"none",o=this.strokeDashOffset?this.strokeDashOffset:"0",a=this.strokeLineCap?this.strokeLineCap:"butt",s=this.strokeLineJoin?this.strokeLineJoin:"miter",l=this.strokeMiterLimit?this.strokeMiterLimit:"4",c=void 0!==this.opacity?this.opacity:"1",u=this.visible?"":" visibility: hidden;",h=t?"":this.getSvgFilter(),d=e("fill",this.fill);return[e("stroke",this.stroke),"stroke-width: ",n,"; ","stroke-dasharray: ",r,"; ","stroke-linecap: ",a,"; ","stroke-dashoffset: ",o,"; ","stroke-linejoin: ",s,"; ","stroke-miterlimit: ",l,"; ",d,"fill-rule: ",i,"; ","opacity: ",c,";",h,u].join("")},getSvgSpanStyles:function(t,i){var n="; ",r=t.fontFamily?"font-family: "+(-1===t.fontFamily.indexOf("'")&&-1===t.fontFamily.indexOf('"')?"'"+t.fontFamily+"'":t.fontFamily)+n:"",o=t.strokeWidth?"stroke-width: "+t.strokeWidth+n:"",a=t.fontSize?"font-size: "+t.fontSize+"px"+n:"",s=t.fontStyle?"font-style: "+t.fontStyle+n:"",l=t.fontWeight?"font-weight: "+t.fontWeight+n:"",c=t.fill?e("fill",t.fill):"",u=t.stroke?e("stroke",t.stroke):"",h=this.getSvgTextDecoration(t);return h&&(h="text-decoration: "+h+n),[u,o,r,a,s,l,h,c,t.deltaY?"baseline-shift: "+-t.deltaY+"; ":"",i?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(e){return["overline","underline","line-through"].filter((function(t){return e[t.replace("-","")]})).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(e,t){var i=e?this.calcTransformMatrix():this.calcOwnMatrix();return'transform="'+x.util.matrixToSVG(i)+(t||"")+'" '},_setSVGBg:function(e){if(this.backgroundColor){var i=x.Object.NUM_FRACTION_DIGITS;e.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',t(-this.width/2,i),'" y="',t(-this.height/2,i),'" width="',t(this.width,i),'" height="',t(this.height,i),'"></rect>\n')}},toSVG:function(e){return this._createBaseSVGMarkup(this._toSVG(e),{reviver:e})},toClipPathSVG:function(e){return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(e),{reviver:e})},_createBaseClipPathSVGMarkup:function(e,t){var i=(t=t||{}).reviver,n=t.additionalTransform||"",r=[this.getSvgTransform(!0,n),this.getSvgCommons()].join(""),o=e.indexOf("COMMON_PARTS");return e[o]=r,i?i(e.join("")):e.join("")},_createBaseSVGMarkup:function(e,t){var i,n,r=(t=t||{}).noStyle,o=t.reviver,a=r?"":'style="'+this.getSvgStyles()+'" ',s=t.withShadow?'style="'+this.getSvgFilter()+'" ':"",l=this.clipPath,c=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",u=l&&l.absolutePositioned,h=this.stroke,d=this.fill,f=this.shadow,g=[],p=e.indexOf("COMMON_PARTS"),m=t.additionalTransform;return l&&(l.clipPathId="CLIPPATH_"+x.Object.__uid++,n='<clipPath id="'+l.clipPathId+'" >\n'+l.toClipPathSVG(o)+"</clipPath>\n"),u&&g.push("<g ",s,this.getSvgCommons()," >\n"),g.push("<g ",this.getSvgTransform(!1),u?"":s+this.getSvgCommons()," >\n"),i=[a,c,r?"":this.addPaintOrder()," ",m?'transform="'+m+'" ':""].join(""),e[p]=i,d&&d.toLive&&g.push(d.toSVG(this)),h&&h.toLive&&g.push(h.toSVG(this)),f&&g.push(f.toSVG(this)),l&&g.push(n),g.push(e.join("")),g.push("</g>\n"),u&&g.push("</g>\n"),o?o(g.join("")):g.join("")},addPaintOrder:function(){return"fill"!==this.paintFirst?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var e=x.util.object.extend,t="stateProperties";function i(t,i,n){var r={};n.forEach((function(e){r[e]=t[e]})),e(t[i],r,!0)}function n(e,t,i){if(e===t)return!0;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(var r=0,o=e.length;r<o;r++)if(!n(e[r],t[r]))return!1;return!0}if(e&&"object"==typeof e){var a,s=Object.keys(e);if(!t||"object"!=typeof t||!i&&s.length!==Object.keys(t).length)return!1;for(r=0,o=s.length;r<o;r++)if("canvas"!==(a=s[r])&&"group"!==a&&!n(e[a],t[a]))return!1;return!0}}x.util.object.extend(x.Object.prototype,{hasStateChanged:function(e){var i="_"+(e=e||t);return Object.keys(this[i]).length<this[e].length||!n(this[i],this,!0)},saveState:function(e){var n=e&&e.propertySet||t,r="_"+n;return this[r]?(i(this,r,this[n]),e&&e.stateProperties&&i(this,r,e.stateProperties),this):this.setupState(e)},setupState:function(e){var i=(e=e||{}).propertySet||t;return e.propertySet=i,this["_"+i]={},this.saveState(e),this}})}(),function(){var e=x.util.degreesToRadians;x.util.object.extend(x.Object.prototype,{_findTargetCorner:function(e,t){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var i,n,r,o=e.x,a=e.y,s=Object.keys(this.oCoords),l=s.length-1;for(this.__corner=0;l>=0;l--)if(r=s[l],this.isControlVisible(r)&&(n=this._getImageLines(t?this.oCoords[r].touchCorner:this.oCoords[r].corner),0!==(i=this._findCrossPoints({x:o,y:a},n))&&i%2==1))return this.__corner=r,r;return!1},forEachControl:function(e){for(var t in this.controls)e(this.controls[t],t,this)},_setCornerCoords:function(){var e=this.oCoords;for(var t in e){var i=this.controls[t];e[t].corner=i.calcCornerCoords(this.angle,this.cornerSize,e[t].x,e[t].y,!1),e[t].touchCorner=i.calcCornerCoords(this.angle,this.touchCornerSize,e[t].x,e[t].y,!0)}},drawSelectionBackground:function(t){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;t.save();var i=this.getCenterPoint(),n=this._calculateCurrentDimensions(),r=this.canvas.viewportTransform;return t.translate(i.x,i.y),t.scale(1/r[0],1/r[3]),t.rotate(e(this.angle)),t.fillStyle=this.selectionBackgroundColor,t.fillRect(-n.x/2,-n.y/2,n.x,n.y),t.restore(),this},drawBorders:function(e,t){t=t||{};var i=this._calculateCurrentDimensions(),n=this.borderScaleFactor,r=i.x+n,o=i.y+n,a=void 0!==t.hasControls?t.hasControls:this.hasControls,s=!1;return e.save(),e.strokeStyle=t.borderColor||this.borderColor,this._setLineDash(e,t.borderDashArray||this.borderDashArray),e.strokeRect(-r/2,-o/2,r,o),a&&(e.beginPath(),this.forEachControl((function(t,i,n){t.withConnection&&t.getVisibility(n,i)&&(s=!0,e.moveTo(t.x*r,t.y*o),e.lineTo(t.x*r+t.offsetX,t.y*o+t.offsetY))})),s&&e.stroke()),e.restore(),this},drawBordersInGroup:function(e,t,i){i=i||{};var n=x.util.sizeAfterTransform(this.width,this.height,t),r=this.strokeWidth,o=this.strokeUniform,a=this.borderScaleFactor,s=n.x+r*(o?this.canvas.getZoom():t.scaleX)+a,l=n.y+r*(o?this.canvas.getZoom():t.scaleY)+a;return e.save(),this._setLineDash(e,i.borderDashArray||this.borderDashArray),e.strokeStyle=i.borderColor||this.borderColor,e.strokeRect(-s/2,-l/2,s,l),e.restore(),this},drawControls:function(e,t){t=t||{},e.save();var i,n,r=this.canvas.getRetinaScaling();return e.setTransform(r,0,0,r,0,0),e.strokeStyle=e.fillStyle=t.cornerColor||this.cornerColor,this.transparentCorners||(e.strokeStyle=t.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(e,t.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(i=this.group.calcTransformMatrix()),this.forEachControl((function(r,o,a){n=a.oCoords[o],r.getVisibility(a,o)&&(i&&(n=x.util.transformPoint(n,i)),r.render(e,n.x,n.y,t,a))})),e.restore(),this},isControlVisible:function(e){return this.controls[e]&&this.controls[e].getVisibility(this,e)},setControlVisible:function(e,t){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[e]=t,this},setControlsVisibility:function(e){for(var t in e||(e={}),e)this.setControlVisible(t,e[t]);return this},onDeselect:function(){},onSelect:function(){}})}(),x.util.object.extend(x.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(e,t){var i=function(){},n=(t=t||{}).onComplete||i,r=t.onChange||i,o=this;return x.util.animate({target:this,startValue:e.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(t){e.set("left",t),o.requestRenderAll(),r()},onComplete:function(){e.setCoords(),n()}})},fxCenterObjectV:function(e,t){var i=function(){},n=(t=t||{}).onComplete||i,r=t.onChange||i,o=this;return x.util.animate({target:this,startValue:e.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(t){e.set("top",t),o.requestRenderAll(),r()},onComplete:function(){e.setCoords(),n()}})},fxRemove:function(e,t){var i=function(){},n=(t=t||{}).onComplete||i,r=t.onChange||i,o=this;return x.util.animate({target:this,startValue:e.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(t){e.set("opacity",t),o.requestRenderAll(),r()},onComplete:function(){o.remove(e),n()}})}}),x.util.object.extend(x.Object.prototype,{animate:function(){if(arguments[0]&&"object"==typeof arguments[0]){var e,t,i=[],n=[];for(e in arguments[0])i.push(e);for(var r=0,o=i.length;r<o;r++)e=i[r],t=r!==o-1,n.push(this._animate(e,arguments[0][e],arguments[1],t));return n}return this._animate.apply(this,arguments)},_animate:function(e,t,i,n){var r,o=this;t=t.toString(),i=i?x.util.object.clone(i):{},~e.indexOf(".")&&(r=e.split("."));var a=o.colorProperties.indexOf(e)>-1||r&&o.colorProperties.indexOf(r[1])>-1,s=r?this.get(r[0])[r[1]]:this.get(e);"from"in i||(i.from=s),a||(t=~t.indexOf("=")?s+parseFloat(t.replace("=","")):parseFloat(t));var l={target:this,startValue:i.from,endValue:t,byValue:i.by,easing:i.easing,duration:i.duration,abort:i.abort&&function(e,t,n){return i.abort.call(o,e,t,n)},onChange:function(t,a,s){r?o[r[0]][r[1]]=t:o.set(e,t),n||i.onChange&&i.onChange(t,a,s)},onComplete:function(e,t,r){n||(o.setCoords(),i.onComplete&&i.onComplete(e,t,r))}};return a?x.util.animateColor(l.startValue,l.endValue,l.duration,l):x.util.animate(l)}}),function(e){var t=e.fabric||(e.fabric={}),i=t.util.object.extend,n=t.util.object.clone,r={x1:1,x2:1,y1:1,y2:1};function o(e,t){var i=e.origin,n=e.axis1,r=e.axis2,o=e.dimension,a=t.nearest,s=t.center,l=t.farthest;return function(){switch(this.get(i)){case a:return Math.min(this.get(n),this.get(r));case s:return Math.min(this.get(n),this.get(r))+.5*this.get(o);case l:return Math.max(this.get(n),this.get(r))}}}t.Line?t.warn("fabric.Line is already defined"):(t.Line=t.util.createClass(t.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:t.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(e,t){e||(e=[0,0,0,0]),this.callSuper("initialize",t),this.set("x1",e[0]),this.set("y1",e[1]),this.set("x2",e[2]),this.set("y2",e[3]),this._setWidthHeight(t)},_setWidthHeight:function(e){e||(e={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in e?e.left:this._getLeftToOriginX(),this.top="top"in e?e.top:this._getTopToOriginY()},_set:function(e,t){return this.callSuper("_set",e,t),void 0!==r[e]&&this._setWidthHeight(),this},_getLeftToOriginX:o({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:o({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(e){e.beginPath();var t=this.calcLinePoints();e.moveTo(t.x1,t.y1),e.lineTo(t.x2,t.y2),e.lineWidth=this.strokeWidth;var i=e.strokeStyle;e.strokeStyle=this.stroke||e.fillStyle,this.stroke&&this._renderStroke(e),e.strokeStyle=i},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(e){return i(this.callSuper("toObject",e),this.calcLinePoints())},_getNonTransformedDimensions:function(){var e=this.callSuper("_getNonTransformedDimensions");return"butt"===this.strokeLineCap&&(0===this.width&&(e.y-=this.strokeWidth),0===this.height&&(e.x-=this.strokeWidth)),e},calcLinePoints:function(){var e=this.x1<=this.x2?-1:1,t=this.y1<=this.y2?-1:1,i=e*this.width*.5,n=t*this.height*.5;return{x1:i,x2:e*this.width*-.5,y1:n,y2:t*this.height*-.5}},_toSVG:function(){var e=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',e.x1,'" y1="',e.y1,'" x2="',e.x2,'" y2="',e.y2,'" />\n']}}),t.Line.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),t.Line.fromElement=function(e,n,r){r=r||{};var o=t.parseAttributes(e,t.Line.ATTRIBUTE_NAMES),a=[o.x1||0,o.y1||0,o.x2||0,o.y2||0];n(new t.Line(a,i(o,r)))},t.Line.fromObject=function(e,i){var r=n(e,!0);r.points=[e.x1,e.y1,e.x2,e.y2],t.Object._fromObject("Line",r,(function(e){delete e.points,i&&i(e)}),"points")})}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.util.degreesToRadians;t.Circle?t.warn("fabric.Circle is already defined."):(t.Circle=t.util.createClass(t.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:t.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(e,t){return this.callSuper("_set",e,t),"radius"===e&&this.setRadius(t),this},toObject:function(e){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(e))},_toSVG:function(){var e,n=(this.endAngle-this.startAngle)%360;if(0===n)e=["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',this.radius,'" />\n'];else{var r=i(this.startAngle),o=i(this.endAngle),a=this.radius;e=['<path d="M '+t.util.cos(r)*a+" "+t.util.sin(r)*a," A "+a+" "+a," 0 ",+(n>180?"1":"0")+" 1"," "+t.util.cos(o)*a+" "+t.util.sin(o)*a,'" ',"COMMON_PARTS"," />\n"]}return e},_render:function(e){e.beginPath(),e.arc(0,0,this.radius,i(this.startAngle),i(this.endAngle),!1),this._renderPaintInOrder(e)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(e){return this.radius=e,this.set("width",2*e).set("height",2*e)}}),t.Circle.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),t.Circle.fromElement=function(e,i){var n,r=t.parseAttributes(e,t.Circle.ATTRIBUTE_NAMES);if(!("radius"in(n=r)&&n.radius>=0))throw new Error("value of `r` attribute is required and can not be negative");r.left=(r.left||0)-r.radius,r.top=(r.top||0)-r.radius,i(new t.Circle(r))},t.Circle.fromObject=function(e,i){t.Object._fromObject("Circle",e,i)})}(t),function(e){var t=e.fabric||(e.fabric={});t.Triangle?t.warn("fabric.Triangle is already defined"):(t.Triangle=t.util.createClass(t.Object,{type:"triangle",width:100,height:100,_render:function(e){var t=this.width/2,i=this.height/2;e.beginPath(),e.moveTo(-t,i),e.lineTo(0,-i),e.lineTo(t,i),e.closePath(),this._renderPaintInOrder(e)},_toSVG:function(){var e=this.width/2,t=this.height/2;return["<polygon ","COMMON_PARTS",'points="',[-e+" "+t,"0 "+-t,e+" "+t].join(","),'" />']}}),t.Triangle.fromObject=function(e,i){return t.Object._fromObject("Triangle",e,i)})}(t),function(e){var t=e.fabric||(e.fabric={}),i=2*Math.PI;t.Ellipse?t.warn("fabric.Ellipse is already defined."):(t.Ellipse=t.util.createClass(t.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:t.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(e){this.callSuper("initialize",e),this.set("rx",e&&e.rx||0),this.set("ry",e&&e.ry||0)},_set:function(e,t){switch(this.callSuper("_set",e,t),e){case"rx":this.rx=t,this.set("width",2*t);break;case"ry":this.ry=t,this.set("height",2*t)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(e){return this.callSuper("toObject",["rx","ry"].concat(e))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,'" />\n']},_render:function(e){e.beginPath(),e.save(),e.transform(1,0,0,this.ry/this.rx,0,0),e.arc(0,0,this.rx,0,i,!1),e.restore(),this._renderPaintInOrder(e)}}),t.Ellipse.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),t.Ellipse.fromElement=function(e,i){var n=t.parseAttributes(e,t.Ellipse.ATTRIBUTE_NAMES);n.left=(n.left||0)-n.rx,n.top=(n.top||0)-n.ry,i(new t.Ellipse(n))},t.Ellipse.fromObject=function(e,i){t.Object._fromObject("Ellipse",e,i)})}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.util.object.extend;t.Rect?t.warn("fabric.Rect is already defined"):(t.Rect=t.util.createClass(t.Object,{stateProperties:t.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:t.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(e){this.callSuper("initialize",e),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(e){var t=this.rx?Math.min(this.rx,this.width/2):0,i=this.ry?Math.min(this.ry,this.height/2):0,n=this.width,r=this.height,o=-this.width/2,a=-this.height/2,s=0!==t||0!==i,l=.4477152502;e.beginPath(),e.moveTo(o+t,a),e.lineTo(o+n-t,a),s&&e.bezierCurveTo(o+n-l*t,a,o+n,a+l*i,o+n,a+i),e.lineTo(o+n,a+r-i),s&&e.bezierCurveTo(o+n,a+r-l*i,o+n-l*t,a+r,o+n-t,a+r),e.lineTo(o+t,a+r),s&&e.bezierCurveTo(o+l*t,a+r,o,a+r-l*i,o,a+r-i),e.lineTo(o,a+i),s&&e.bezierCurveTo(o,a+l*i,o+l*t,a,o+t,a),e.closePath(),this._renderPaintInOrder(e)},toObject:function(e){return this.callSuper("toObject",["rx","ry"].concat(e))},_toSVG:function(){return["<rect ","COMMON_PARTS",'x="',-this.width/2,'" y="',-this.height/2,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,'" />\n']}}),t.Rect.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),t.Rect.fromElement=function(e,n,r){if(!e)return n(null);r=r||{};var o=t.parseAttributes(e,t.Rect.ATTRIBUTE_NAMES);o.left=o.left||0,o.top=o.top||0,o.height=o.height||0,o.width=o.width||0;var a=new t.Rect(i(r?t.util.object.clone(r):{},o));a.visible=a.visible&&a.width>0&&a.height>0,n(a)},t.Rect.fromObject=function(e,i){return t.Object._fromObject("Rect",e,i)})}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.util.object.extend,n=t.util.array.min,r=t.util.array.max,o=t.util.toFixed,a=t.util.projectStrokeOnPoints;t.Polyline?t.warn("fabric.Polyline is already defined"):(t.Polyline=t.util.createClass(t.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:t.Object.prototype.cacheProperties.concat("points"),initialize:function(e,t){t=t||{},this.points=e||[],this.callSuper("initialize",t),this._setPositionDimensions(t)},_projectStrokeOnPoints:function(){return a(this.points,this,!0)},_setPositionDimensions:function(e){var t,i=this._calcDimensions(e),n=this.exactBoundingBox?this.strokeWidth:0;this.width=i.width-n,this.height=i.height-n,e.fromSVG||(t=this.translateToGivenOrigin({x:i.left-this.strokeWidth/2+n/2,y:i.top-this.strokeWidth/2+n/2},"left","top",this.originX,this.originY)),void 0===e.left&&(this.left=e.fromSVG?i.left:t.x),void 0===e.top&&(this.top=e.fromSVG?i.top:t.y),this.pathOffset={x:i.left+this.width/2+n/2,y:i.top+this.height/2+n/2}},_calcDimensions:function(){var e=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,t=n(e,"x")||0,i=n(e,"y")||0;return{left:t,top:i,width:(r(e,"x")||0)-t,height:(r(e,"y")||0)-i}},toObject:function(e){return i(this.callSuper("toObject",e),{points:this.points.concat()})},_toSVG:function(){for(var e=[],i=this.pathOffset.x,n=this.pathOffset.y,r=t.Object.NUM_FRACTION_DIGITS,a=0,s=this.points.length;a<s;a++)e.push(o(this.points[a].x-i,r),",",o(this.points[a].y-n,r)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',e.join(""),'" />\n']},commonRender:function(e){var t,i=this.points.length,n=this.pathOffset.x,r=this.pathOffset.y;if(!i||isNaN(this.points[i-1].y))return!1;e.beginPath(),e.moveTo(this.points[0].x-n,this.points[0].y-r);for(var o=0;o<i;o++)t=this.points[o],e.lineTo(t.x-n,t.y-r);return!0},_render:function(e){this.commonRender(e)&&this._renderPaintInOrder(e)},complexity:function(){return this.get("points").length}}),t.Polyline.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat(),t.Polyline.fromElementGenerator=function(e){return function(n,r,o){if(!n)return r(null);o||(o={});var a=t.parsePointsAttribute(n.getAttribute("points")),s=t.parseAttributes(n,t[e].ATTRIBUTE_NAMES);s.fromSVG=!0,r(new t[e](a,i(s,o)))}},t.Polyline.fromElement=t.Polyline.fromElementGenerator("Polyline"),t.Polyline.fromObject=function(e,i){return t.Object._fromObject("Polyline",e,i,"points")})}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.util.projectStrokeOnPoints;t.Polygon?t.warn("fabric.Polygon is already defined"):(t.Polygon=t.util.createClass(t.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return i(this.points,this)},_render:function(e){this.commonRender(e)&&(e.closePath(),this._renderPaintInOrder(e))}}),t.Polygon.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat(),t.Polygon.fromElement=t.Polyline.fromElementGenerator("Polygon"),t.Polygon.fromObject=function(e,i){t.Object._fromObject("Polygon",e,i,"points")})}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.util.array.min,n=t.util.array.max,r=t.util.object.extend,o=t.util.object.clone,a=t.util.toFixed;t.Path?t.warn("fabric.Path is already defined"):(t.Path=t.util.createClass(t.Object,{type:"path",path:null,cacheProperties:t.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:t.Object.prototype.stateProperties.concat("path"),initialize:function(e,t){delete(t=o(t||{})).path,this.callSuper("initialize",t),this._setPath(e||[],t)},_setPath:function(e,i){this.path=t.util.makePathSimpler(Array.isArray(e)?e:t.util.parsePath(e)),t.Polyline.prototype._setPositionDimensions.call(this,i||{})},_renderPathCommands:function(e){var t,i=0,n=0,r=0,o=0,a=0,s=0,l=-this.pathOffset.x,c=-this.pathOffset.y;e.beginPath();for(var u=0,h=this.path.length;u<h;++u)switch((t=this.path[u])[0]){case"L":r=t[1],o=t[2],e.lineTo(r+l,o+c);break;case"M":i=r=t[1],n=o=t[2],e.moveTo(r+l,o+c);break;case"C":r=t[5],o=t[6],a=t[3],s=t[4],e.bezierCurveTo(t[1]+l,t[2]+c,a+l,s+c,r+l,o+c);break;case"Q":e.quadraticCurveTo(t[1]+l,t[2]+c,t[3]+l,t[4]+c),r=t[3],o=t[4],a=t[1],s=t[2];break;case"z":case"Z":r=i,o=n,e.closePath()}},_render:function(e){this._renderPathCommands(e),this._renderPaintInOrder(e)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(e){return r(this.callSuper("toObject",e),{path:this.path.map((function(e){return e.slice()}))})},toDatalessObject:function(e){var t=this.toObject(["sourcePath"].concat(e));return t.sourcePath&&delete t.path,t},_toSVG:function(){return["<path ","COMMON_PARTS",'d="',t.util.joinPath(this.path),'" stroke-linecap="round" ',"/>\n"]},_getOffsetTransform:function(){var e=t.Object.NUM_FRACTION_DIGITS;return" translate("+a(-this.pathOffset.x,e)+", "+a(-this.pathOffset.y,e)+")"},toClipPathSVG:function(e){var t=this._getOffsetTransform();return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:e,additionalTransform:t})},toSVG:function(e){var t=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:e,additionalTransform:t})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var e,r,o=[],a=[],s=0,l=0,c=0,u=0,h=0,d=this.path.length;h<d;++h){switch((e=this.path[h])[0]){case"L":c=e[1],u=e[2],r=[];break;case"M":s=c=e[1],l=u=e[2],r=[];break;case"C":r=t.util.getBoundsOfCurve(c,u,e[1],e[2],e[3],e[4],e[5],e[6]),c=e[5],u=e[6];break;case"Q":r=t.util.getBoundsOfCurve(c,u,e[1],e[2],e[1],e[2],e[3],e[4]),c=e[3],u=e[4];break;case"z":case"Z":c=s,u=l}r.forEach((function(e){o.push(e.x),a.push(e.y)})),o.push(c),a.push(u)}var f=i(o)||0,g=i(a)||0;return{left:f,top:g,width:(n(o)||0)-f,height:(n(a)||0)-g}}}),t.Path.fromObject=function(e,i){if("string"==typeof e.sourcePath){var n=e.sourcePath;t.loadSVGFromURL(n,(function(t){var n=t[0];n.setOptions(e),i&&i(n)}))}else t.Object._fromObject("Path",e,i,"path")},t.Path.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat(["d"]),t.Path.fromElement=function(e,i,n){var o=t.parseAttributes(e,t.Path.ATTRIBUTE_NAMES);o.fromSVG=!0,i(new t.Path(o.d,r(o,n)))})}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.util.array.min,n=t.util.array.max;t.Group||(t.Group=t.util.createClass(t.Object,t.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(e,t,i){t=t||{},this._objects=[],i&&this.callSuper("initialize",t),this._objects=e||[];for(var n=this._objects.length;n--;)this._objects[n].group=this;if(i)this._updateObjectsACoords();else{var r=t&&t.centerPoint;void 0!==t.originX&&(this.originX=t.originX),void 0!==t.originY&&(this.originY=t.originY),r||this._calcBounds(),this._updateObjectsCoords(r),delete t.centerPoint,this.callSuper("initialize",t)}this.setCoords()},_updateObjectsACoords:function(){for(var e=this._objects.length;e--;)this._objects[e].setCoords(!0)},_updateObjectsCoords:function(e){e=e||this.getCenterPoint();for(var t=this._objects.length;t--;)this._updateObjectCoords(this._objects[t],e)},_updateObjectCoords:function(e,t){var i=e.left,n=e.top;e.set({left:i-t.x,top:n-t.y}),e.group=this,e.setCoords(!0)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(e){var i=!!this.group;return this._restoreObjectsState(),t.util.resetObjectTransform(this),e&&(i&&t.util.removeTransformFromObject(e,this.group.calcTransformMatrix()),this._objects.push(e),e.group=this,e._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,i?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(e){return this._restoreObjectsState(),t.util.resetObjectTransform(this),this.remove(e),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(e){this.dirty=!0,e.group=this,e._set("canvas",this.canvas)},_onObjectRemoved:function(e){this.dirty=!0,delete e.group},_set:function(e,i){var n=this._objects.length;if(this.useSetOnGroup)for(;n--;)this._objects[n].setOnGroup(e,i);if("canvas"===e)for(;n--;)this._objects[n]._set(e,i);t.Object.prototype._set.call(this,e,i)},toObject:function(e){var i=this.includeDefaultValues,n=this._objects.filter((function(e){return!e.excludeFromExport})).map((function(t){var n=t.includeDefaultValues;t.includeDefaultValues=i;var r=t.toObject(e);return t.includeDefaultValues=n,r})),r=t.Object.prototype.toObject.call(this,e);return r.objects=n,r},toDatalessObject:function(e){var i,n=this.sourcePath;if(n)i=n;else{var r=this.includeDefaultValues;i=this._objects.map((function(t){var i=t.includeDefaultValues;t.includeDefaultValues=r;var n=t.toDatalessObject(e);return t.includeDefaultValues=i,n}))}var o=t.Object.prototype.toDatalessObject.call(this,e);return o.objects=i,o},render:function(e){this._transformDone=!0,this.callSuper("render",e),this._transformDone=!1},shouldCache:function(){var e=t.Object.prototype.shouldCache.call(this);if(e)for(var i=0,n=this._objects.length;i<n;i++)if(this._objects[i].willDrawShadow())return this.ownCaching=!1,!1;return e},willDrawShadow:function(){if(t.Object.prototype.willDrawShadow.call(this))return!0;for(var e=0,i=this._objects.length;e<i;e++)if(this._objects[e].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(e){for(var t=0,i=this._objects.length;t<i;t++)this._objects[t].render(e);this._drawClipPath(e,this.clipPath)},isCacheDirty:function(e){if(this.callSuper("isCacheDirty",e))return!0;if(!this.statefullCache)return!1;for(var t=0,i=this._objects.length;t<i;t++)if(this._objects[t].isCacheDirty(!0)){if(this._cacheCanvas){var n=this.cacheWidth/this.zoomX,r=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-n/2,-r/2,n,r)}return!0}return!1},_restoreObjectsState:function(){var e=this.calcOwnMatrix();return this._objects.forEach((function(i){t.util.addTransformToObject(i,e),delete i.group,i.setCoords()})),this},destroy:function(){return this._objects.forEach((function(e){e.set("dirty",!0)})),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject((function(e){e.dispose&&e.dispose()})),this._objects=[]},toActiveSelection:function(){if(this.canvas){var e=this._objects,i=this.canvas;this._objects=[];var n=this.toObject();delete n.objects;var r=new t.ActiveSelection([]);return r.set(n),r.type="activeSelection",i.remove(this),e.forEach((function(e){e.group=r,e.dirty=!0,i.add(e)})),r.canvas=i,r._objects=e,i._activeObject=r,r.setCoords(),r}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){return this.forEachObject((function(e){e.setCoords(!0)})),this},_calcBounds:function(e){for(var t,i,n,r,o=[],a=[],s=["tr","br","bl","tl"],l=0,c=this._objects.length,u=s.length;l<c;++l){for(n=(t=this._objects[l]).calcACoords(),r=0;r<u;r++)i=s[r],o.push(n[i].x),a.push(n[i].y);t.aCoords=n}this._getBounds(o,a,e)},_getBounds:function(e,r,o){var a=new t.Point(i(e),i(r)),s=new t.Point(n(e),n(r)),l=a.y||0,c=a.x||0,u=s.x-a.x||0,h=s.y-a.y||0;this.width=u,this.height=h,o||this.setPositionByOrigin({x:c,y:l},"left","top")},_toSVG:function(e){for(var t=["<g ","COMMON_PARTS"," >\n"],i=0,n=this._objects.length;i<n;i++)t.push("\t\t",this._objects[i].toSVG(e));return t.push("</g>\n"),t},getSvgStyles:function(){var e=void 0!==this.opacity&&1!==this.opacity?"opacity: "+this.opacity+";":"",t=this.visible?"":" visibility: hidden;";return[e,this.getSvgFilter(),t].join("")},toClipPathSVG:function(e){for(var t=[],i=0,n=this._objects.length;i<n;i++)t.push("\t",this._objects[i].toClipPathSVG(e));return this._createBaseClipPathSVGMarkup(t,{reviver:e})}}),t.Group.fromObject=function(e,i){var n=e.objects,r=t.util.object.clone(e,!0);delete r.objects,"string"!=typeof n?t.util.enlivenObjects(n,(function(n){var r=t.util.object.clone(e,!0);delete r.objects,t.util.enlivenObjectEnlivables(e,r,(function(){i&&i(new t.Group(n,r,!0))}))})):t.loadSVGFromURL(n,(function(o){var a=t.util.groupSVGElements(o,e,n);a.set(r),i&&i(a)}))})}(t),function(e){var t=e.fabric||(e.fabric={});t.ActiveSelection||(t.ActiveSelection=t.util.createClass(t.Group,{type:"activeSelection",initialize:function(e,i){i=i||{},this._objects=e||[];for(var n=this._objects.length;n--;)this._objects[n].group=this;i.originX&&(this.originX=i.originX),i.originY&&(this.originY=i.originY),this._calcBounds(),this._updateObjectsCoords(),t.Object.prototype.initialize.call(this,i),this.setCoords()},toGroup:function(){var e=this._objects.concat();this._objects=[];var i=t.Object.prototype.toObject.call(this),n=new t.Group([]);if(delete i.type,n.set(i),e.forEach((function(e){e.canvas.remove(e),e.group=n})),n._objects=e,!this.canvas)return n;var r=this.canvas;return r.add(n),r._activeObject=n,n.setCoords(),n},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(e,t,i){e.save(),e.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",e,t),void 0===(i=i||{}).hasControls&&(i.hasControls=!1),i.forActiveSelection=!0;for(var n=0,r=this._objects.length;n<r;n++)this._objects[n]._renderControls(e,i);e.restore()}}),t.ActiveSelection.fromObject=function(e,i){t.util.enlivenObjects(e.objects,(function(n){delete e.objects,i&&i(new t.ActiveSelection(n,e,!0))}))})}(t),function(e){var t=x.util.object.extend;e.fabric||(e.fabric={}),e.fabric.Image?x.warn("fabric.Image is already defined."):(x.Image=x.util.createClass(x.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:x.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:x.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(e,t){t||(t={}),this.filters=[],this.cacheKey="texture"+x.Object.__uid++,this.callSuper("initialize",t),this._initElement(e,t)},getElement:function(){return this._element||{}},setElement:function(e,t){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=e,this._originalElement=e,this._initConfig(t),0!==this.filters.length&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(e){var t=x.filterBackend;t&&t.evictCachesForKey&&t.evictCachesForKey(e)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(e){x.util.cleanUpJsdomNode(this[e]),this[e]=void 0}.bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var e=this.getElement();return{width:e.naturalWidth||e.width,height:e.naturalHeight||e.height}},_stroke:function(e){if(this.stroke&&0!==this.strokeWidth){var t=this.width/2,i=this.height/2;e.beginPath(),e.moveTo(-t,-i),e.lineTo(t,-i),e.lineTo(t,i),e.lineTo(-t,i),e.lineTo(-t,-i),e.closePath()}},toObject:function(e){var i=[];this.filters.forEach((function(e){e&&i.push(e.toObject())}));var n=t(this.callSuper("toObject",["cropX","cropY"].concat(e)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:i});return this.resizeFilter&&(n.resizeFilter=this.resizeFilter.toObject()),n},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var e,t=[],i=[],n=this._element,r=-this.width/2,o=-this.height/2,a="",s="";if(!n)return[];if(this.hasCrop()){var l=x.Object.__uid++;t.push('<clipPath id="imageCrop_'+l+'">\n','\t<rect x="'+r+'" y="'+o+'" width="'+this.width+'" height="'+this.height+'" />\n',"</clipPath>\n"),a=' clip-path="url(#imageCrop_'+l+')" '}if(this.imageSmoothing||(s='" image-rendering="optimizeSpeed'),i.push("\t<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',r-this.cropX,'" y="',o-this.cropY,'" width="',n.width||n.naturalWidth,'" height="',n.height||n.height,s,'"',a,"></image>\n"),this.stroke||this.strokeDashArray){var c=this.fill;this.fill=null,e=["\t<rect ",'x="',r,'" y="',o,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'],this.fill=c}return"fill"!==this.paintFirst?t.concat(e,i):t.concat(i,e)},getSrc:function(e){var t=e?this._element:this._originalElement;return t?t.toDataURL?t.toDataURL():this.srcFromAttribute?t.getAttribute("src"):t.src:this.src||""},setSrc:function(e,t,i){return x.util.loadImage(e,(function(e,n){this.setElement(e,i),this._setWidthHeight(),t&&t(this,n)}),this,i&&i.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var e=this.resizeFilter,t=this.minimumScaleTrigger,i=this.getTotalObjectScaling(),n=i.scaleX,r=i.scaleY,o=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!e||n>t&&r>t)return this._element=o,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=n,void(this._lastScaleY=r);x.filterBackend||(x.filterBackend=x.initFilterBackend());var a=x.util.createCanvasElement(),s=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,l=o.width,c=o.height;a.width=l,a.height=c,this._element=a,this._lastScaleX=e.scaleX=n,this._lastScaleY=e.scaleY=r,x.filterBackend.applyFilters([e],o,l,c,this._element,s),this._filterScalingX=a.width/this._originalElement.width,this._filterScalingY=a.height/this._originalElement.height},applyFilters:function(e){if(e=(e=e||this.filters||[]).filter((function(e){return e&&!e.isNeutralState()})),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),0===e.length)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var t=this._originalElement,i=t.naturalWidth||t.width,n=t.naturalHeight||t.height;if(this._element===this._originalElement){var r=x.util.createCanvasElement();r.width=i,r.height=n,this._element=r,this._filteredEl=r}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,i,n),this._lastScaleX=1,this._lastScaleY=1;return x.filterBackend||(x.filterBackend=x.initFilterBackend()),x.filterBackend.applyFilters(e,this._originalElement,i,n,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(e){x.util.setImageSmoothing(e,this.imageSmoothing),!0!==this.isMoving&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(e),this._renderPaintInOrder(e)},drawCacheOnCanvas:function(e){x.util.setImageSmoothing(e,this.imageSmoothing),x.Object.prototype.drawCacheOnCanvas.call(this,e)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(e){var t=this._element;if(t){var i=this._filterScalingX,n=this._filterScalingY,r=this.width,o=this.height,a=Math.min,s=Math.max,l=s(this.cropX,0),c=s(this.cropY,0),u=t.naturalWidth||t.width,h=t.naturalHeight||t.height,d=l*i,f=c*n,g=a(r*i,u-d),p=a(o*n,h-f),m=-r/2,_=-o/2,v=a(r,u/i-l),y=a(o,h/n-c);t&&e.drawImage(t,d,f,g,p,m,_,v,y)}},_needsResize:function(){var e=this.getTotalObjectScaling();return e.scaleX!==this._lastScaleX||e.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(e,t){this.setElement(x.util.getById(e),t),x.util.addClass(this.getElement(),x.Image.CSS_CANVAS)},_initConfig:function(e){e||(e={}),this.setOptions(e),this._setWidthHeight(e)},_initFilters:function(e,t){e&&e.length?x.util.enlivenObjects(e,(function(e){t&&t(e)}),"fabric.Image.filters"):t&&t()},_setWidthHeight:function(e){e||(e={});var t=this.getElement();this.width=e.width||t.naturalWidth||t.width||0,this.height=e.height||t.naturalHeight||t.height||0},parsePreserveAspectRatioAttribute:function(){var e,t=x.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),i=this._element.width,n=this._element.height,r=1,o=1,a=0,s=0,l=0,c=0,u=this.width,h=this.height,d={width:u,height:h};return!t||"none"===t.alignX&&"none"===t.alignY?(r=u/i,o=h/n):("meet"===t.meetOrSlice&&(e=(u-i*(r=o=x.util.findScaleToFit(this._element,d)))/2,"Min"===t.alignX&&(a=-e),"Max"===t.alignX&&(a=e),e=(h-n*o)/2,"Min"===t.alignY&&(s=-e),"Max"===t.alignY&&(s=e)),"slice"===t.meetOrSlice&&(e=i-u/(r=o=x.util.findScaleToCover(this._element,d)),"Mid"===t.alignX&&(l=e/2),"Max"===t.alignX&&(l=e),e=n-h/o,"Mid"===t.alignY&&(c=e/2),"Max"===t.alignY&&(c=e),i=u/r,n=h/o)),{width:i,height:n,scaleX:r,scaleY:o,offsetLeft:a,offsetTop:s,cropX:l,cropY:c}}}),x.Image.CSS_CANVAS="canvas-img",x.Image.prototype.getSvgSrc=x.Image.prototype.getSrc,x.Image.fromObject=function(e,t){var i=x.util.object.clone(e);x.util.loadImage(i.src,(function(e,n){n?t&&t(null,!0):x.Image.prototype._initFilters.call(i,i.filters,(function(n){i.filters=n||[],x.Image.prototype._initFilters.call(i,[i.resizeFilter],(function(n){i.resizeFilter=n[0],x.util.enlivenObjectEnlivables(i,i,(function(){var n=new x.Image(e,i);t(n,!1)}))}))}))}),null,i.crossOrigin)},x.Image.fromURL=function(e,t,i){x.util.loadImage(e,(function(e,n){t&&t(new x.Image(e,i),n)}),null,i&&i.crossOrigin)},x.Image.ATTRIBUTE_NAMES=x.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),x.Image.fromElement=function(e,i,n){var r=x.parseAttributes(e,x.Image.ATTRIBUTE_NAMES);x.Image.fromURL(r["xlink:href"],i,t(n?x.util.object.clone(n):{},r))})}(t),x.util.object.extend(x.Object.prototype,{_getAngleValueForStraighten:function(){var e=this.angle%360;return e>0?90*Math.round((e-1)/90):90*Math.round(e/90)},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(e){var t=function(){},i=(e=e||{}).onComplete||t,n=e.onChange||t,r=this;return x.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(e){r.rotate(e),n()},onComplete:function(){r.setCoords(),i()}})}}),x.util.object.extend(x.StaticCanvas.prototype,{straightenObject:function(e){return e.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(e){return e.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function e(e,t){var i="precision "+t+" float;\nvoid main(){}",n=e.createShader(e.FRAGMENT_SHADER);return e.shaderSource(n,i),e.compileShader(n),!!e.getShaderParameter(n,e.COMPILE_STATUS)}function t(e){e&&e.tileSize&&(this.tileSize=e.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}x.isWebglSupported=function(t){if(x.isLikelyNode)return!1;t=t||x.WebglFilterBackend.prototype.tileSize;var i=document.createElement("canvas"),n=i.getContext("webgl")||i.getContext("experimental-webgl"),r=!1;if(n){x.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),r=x.maxTextureSize>=t;for(var o=["highp","mediump","lowp"],a=0;a<3;a++)if(e(n,o[a])){x.webGlPrecision=o[a];break}}return this.isSupported=r,r},x.WebglFilterBackend=t,t.prototype={tileSize:2048,resources:{},setupGLContext:function(e,t){this.dispose(),this.createWebGLCanvas(e,t),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(e,t)},chooseFastestCopyGLTo2DMethod:function(e,t){var i,n=void 0!==window.performance;try{new ImageData(1,1),i=!0}catch(e){i=!1}var r="undefined"!=typeof ArrayBuffer,o="undefined"!=typeof Uint8ClampedArray;if(n&&i&&r&&o){var a=x.util.createCanvasElement(),s=new ArrayBuffer(e*t*4);if(x.forceGLPutImageData)return this.imageBuffer=s,void(this.copyGLTo2D=I);var l,c,u={imageBuffer:s,destinationWidth:e,destinationHeight:t,targetCanvas:a};a.width=e,a.height=t,l=window.performance.now(),E.call(u,this.gl,u),c=window.performance.now()-l,l=window.performance.now(),I.call(u,this.gl,u),c>window.performance.now()-l?(this.imageBuffer=s,this.copyGLTo2D=I):this.copyGLTo2D=E}},createWebGLCanvas:function(e,t){var i=x.util.createCanvasElement();i.width=e,i.height=t;var n={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},r=i.getContext("webgl",n);r||(r=i.getContext("experimental-webgl",n)),r&&(r.clearColor(0,0,0,0),this.canvas=i,this.gl=r)},applyFilters:function(e,t,i,n,r,o){var a,s=this.gl;o&&(a=this.getCachedTexture(o,t));var l={originalWidth:t.width||t.originalWidth,originalHeight:t.height||t.originalHeight,sourceWidth:i,sourceHeight:n,destinationWidth:i,destinationHeight:n,context:s,sourceTexture:this.createTexture(s,i,n,!a&&t),targetTexture:this.createTexture(s,i,n),originalTexture:a||this.createTexture(s,i,n,!a&&t),passes:e.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:r},c=s.createFramebuffer();return s.bindFramebuffer(s.FRAMEBUFFER,c),e.forEach((function(e){e&&e.applyTo(l)})),function(e){var t=e.targetCanvas,i=t.width,n=t.height,r=e.destinationWidth,o=e.destinationHeight;i===r&&n===o||(t.width=r,t.height=o)}(l),this.copyGLTo2D(s,l),s.bindTexture(s.TEXTURE_2D,null),s.deleteTexture(l.sourceTexture),s.deleteTexture(l.targetTexture),s.deleteFramebuffer(c),r.getContext("2d").setTransform(1,0,0,1,0,0),l},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(e,t,i,n){var r=e.createTexture();return e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),n?e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n):e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,i,0,e.RGBA,e.UNSIGNED_BYTE,null),r},getCachedTexture:function(e,t){if(this.textureCache[e])return this.textureCache[e];var i=this.createTexture(this.gl,t.width,t.height,t);return this.textureCache[e]=i,i},evictCachesForKey:function(e){this.textureCache[e]&&(this.gl.deleteTexture(this.textureCache[e]),delete this.textureCache[e])},copyGLTo2D:E,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var e=this.gl,t={renderer:"",vendor:""};if(!e)return t;var i=e.getExtension("WEBGL_debug_renderer_info");if(i){var n=e.getParameter(i.UNMASKED_RENDERER_WEBGL),r=e.getParameter(i.UNMASKED_VENDOR_WEBGL);n&&(t.renderer=n.toLowerCase()),r&&(t.vendor=r.toLowerCase())}return this.gpuInfo=t,t}}}(),function(){var e=function(){};function t(){}x.Canvas2dFilterBackend=t,t.prototype={evictCachesForKey:e,dispose:e,clearWebGLCaches:e,resources:{},applyFilters:function(e,t,i,n,r){var o=r.getContext("2d");o.drawImage(t,0,0,i,n);var a={sourceWidth:i,sourceHeight:n,imageData:o.getImageData(0,0,i,n),originalEl:t,originalImageData:o.getImageData(0,0,i,n),canvasEl:r,ctx:o,filterBackend:this};return e.forEach((function(e){e.applyTo(a)})),a.imageData.width===i&&a.imageData.height===n||(r.width=a.imageData.width,r.height=a.imageData.height),o.putImageData(a.imageData,0,0),a}}}(),x.Image=x.Image||{},x.Image.filters=x.Image.filters||{},x.Image.filters.BaseFilter=x.util.createClass({type:"BaseFilter",vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvoid main() {\nvTexCoord = aPosition;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:"precision highp float;\nvarying vec2 vTexCoord;\nuniform sampler2D uTexture;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\n}",initialize:function(e){e&&this.setOptions(e)},setOptions:function(e){for(var t in e)this[t]=e[t]},createProgram:function(e,t,i){t=t||this.fragmentSource,i=i||this.vertexSource,"highp"!==x.webGlPrecision&&(t=t.replace(/precision highp float/g,"precision "+x.webGlPrecision+" float"));var n=e.createShader(e.VERTEX_SHADER);if(e.shaderSource(n,i),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+e.getShaderInfoLog(n));var r=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(r,t),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+e.getShaderInfoLog(r));var o=e.createProgram();if(e.attachShader(o,n),e.attachShader(o,r),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+e.getProgramInfoLog(o));var a=this.getAttributeLocations(e,o),s=this.getUniformLocations(e,o)||{};return s.uStepW=e.getUniformLocation(o,"uStepW"),s.uStepH=e.getUniformLocation(o,"uStepH"),{program:o,attributeLocations:a,uniformLocations:s}},getAttributeLocations:function(e,t){return{aPosition:e.getAttribLocation(t,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(e,t,i){var n=t.aPosition,r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.enableVertexAttribArray(n),e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0),e.bufferData(e.ARRAY_BUFFER,i,e.STATIC_DRAW)},_setupFrameBuffer:function(e){var t,i,n=e.context;e.passes>1?(t=e.destinationWidth,i=e.destinationHeight,e.sourceWidth===t&&e.sourceHeight===i||(n.deleteTexture(e.targetTexture),e.targetTexture=e.filterBackend.createTexture(n,t,i)),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e.targetTexture,0)):(n.bindFramebuffer(n.FRAMEBUFFER,null),n.finish())},_swapTextures:function(e){e.passes--,e.pass++;var t=e.targetTexture;e.targetTexture=e.sourceTexture,e.sourceTexture=t},isNeutralState:function(){var e=this.mainParameter,t=x.Image.filters[this.type].prototype;if(e){if(Array.isArray(t[e])){for(var i=t[e].length;i--;)if(this[e][i]!==t[e][i])return!1;return!0}return t[e]===this[e]}return!1},applyTo:function(e){e.webgl?(this._setupFrameBuffer(e),this.applyToWebGL(e),this._swapTextures(e)):this.applyTo2d(e)},retrieveShader:function(e){return e.programCache.hasOwnProperty(this.type)||(e.programCache[this.type]=this.createProgram(e.context)),e.programCache[this.type]},applyToWebGL:function(e){var t=e.context,i=this.retrieveShader(e);0===e.pass&&e.originalTexture?t.bindTexture(t.TEXTURE_2D,e.originalTexture):t.bindTexture(t.TEXTURE_2D,e.sourceTexture),t.useProgram(i.program),this.sendAttributeData(t,i.attributeLocations,e.aPosition),t.uniform1f(i.uniformLocations.uStepW,1/e.sourceWidth),t.uniform1f(i.uniformLocations.uStepH,1/e.sourceHeight),this.sendUniformData(t,i.uniformLocations),t.viewport(0,0,e.destinationWidth,e.destinationHeight),t.drawArrays(t.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(e,t,i){e.activeTexture(i),e.bindTexture(e.TEXTURE_2D,t),e.activeTexture(e.TEXTURE0)},unbindAdditionalTexture:function(e,t){e.activeTexture(t),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(e){this[this.mainParameter]=e},sendUniformData:function(){},createHelpLayer:function(e){if(!e.helpLayer){var t=document.createElement("canvas");t.width=e.sourceWidth,t.height=e.sourceHeight,e.helpLayer=t}},toObject:function(){var e={type:this.type},t=this.mainParameter;return t&&(e[t]=this[t]),e},toJSON:function(){return this.toObject()}}),x.Image.filters.BaseFilter.fromObject=function(e,t){var i=new x.Image.filters[e.type](e);return t&&t(i),i},function(e){var t=e.fabric||(e.fabric={}),i=t.Image.filters,n=t.util.createClass;i.ColorMatrix=n(i.BaseFilter,{type:"ColorMatrix",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nuniform mat4 uColorMatrix;\nuniform vec4 uConstants;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor *= uColorMatrix;\ncolor += uConstants;\ngl_FragColor = color;\n}",matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(e){this.callSuper("initialize",e),this.matrix=this.matrix.slice(0)},applyTo2d:function(e){var t,i,n,r,o,a=e.imageData.data,s=a.length,l=this.matrix,c=this.colorsOnly;for(o=0;o<s;o+=4)t=a[o],i=a[o+1],n=a[o+2],c?(a[o]=t*l[0]+i*l[1]+n*l[2]+255*l[4],a[o+1]=t*l[5]+i*l[6]+n*l[7]+255*l[9],a[o+2]=t*l[10]+i*l[11]+n*l[12]+255*l[14]):(r=a[o+3],a[o]=t*l[0]+i*l[1]+n*l[2]+r*l[3]+255*l[4],a[o+1]=t*l[5]+i*l[6]+n*l[7]+r*l[8]+255*l[9],a[o+2]=t*l[10]+i*l[11]+n*l[12]+r*l[13]+255*l[14],a[o+3]=t*l[15]+i*l[16]+n*l[17]+r*l[18]+255*l[19])},getUniformLocations:function(e,t){return{uColorMatrix:e.getUniformLocation(t,"uColorMatrix"),uConstants:e.getUniformLocation(t,"uConstants")}},sendUniformData:function(e,t){var i=this.matrix,n=[i[0],i[1],i[2],i[3],i[5],i[6],i[7],i[8],i[10],i[11],i[12],i[13],i[15],i[16],i[17],i[18]],r=[i[4],i[9],i[14],i[19]];e.uniformMatrix4fv(t.uColorMatrix,!1,n),e.uniform4fv(t.uConstants,r)}}),t.Image.filters.ColorMatrix.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.Image.filters,n=t.util.createClass;i.Brightness=n(i.BaseFilter,{type:"Brightness",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBrightness;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += uBrightness;\ngl_FragColor = color;\n}",brightness:0,mainParameter:"brightness",applyTo2d:function(e){if(0!==this.brightness){var t,i=e.imageData.data,n=i.length,r=Math.round(255*this.brightness);for(t=0;t<n;t+=4)i[t]=i[t]+r,i[t+1]=i[t+1]+r,i[t+2]=i[t+2]+r}},getUniformLocations:function(e,t){return{uBrightness:e.getUniformLocation(t,"uBrightness")}},sendUniformData:function(e,t){e.uniform1f(t.uBrightness,this.brightness)}}),t.Image.filters.Brightness.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.util.object.extend,n=t.Image.filters,r=t.util.createClass;n.Convolute=r(n.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_3_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_5_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_5_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_7_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_7_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_9_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_9_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}"},retrieveShader:function(e){var t=Math.sqrt(this.matrix.length),i=this.type+"_"+t+"_"+(this.opaque?1:0),n=this.fragmentSource[i];return e.programCache.hasOwnProperty(i)||(e.programCache[i]=this.createProgram(e.context,n)),e.programCache[i]},applyTo2d:function(e){var t,i,n,r,o,a,s,l,c,u,h,d,f,g=e.imageData,p=g.data,m=this.matrix,_=Math.round(Math.sqrt(m.length)),v=Math.floor(_/2),y=g.width,b=g.height,S=e.ctx.createImageData(y,b),w=S.data,C=this.opaque?1:0;for(h=0;h<b;h++)for(u=0;u<y;u++){for(o=4*(h*y+u),t=0,i=0,n=0,r=0,f=0;f<_;f++)for(d=0;d<_;d++)a=u+d-v,(s=h+f-v)<0||s>=b||a<0||a>=y||(l=4*(s*y+a),c=m[f*_+d],t+=p[l]*c,i+=p[l+1]*c,n+=p[l+2]*c,C||(r+=p[l+3]*c));w[o]=t,w[o+1]=i,w[o+2]=n,w[o+3]=C?p[o+3]:r}e.imageData=S},getUniformLocations:function(e,t){return{uMatrix:e.getUniformLocation(t,"uMatrix"),uOpaque:e.getUniformLocation(t,"uOpaque"),uHalfSize:e.getUniformLocation(t,"uHalfSize"),uSize:e.getUniformLocation(t,"uSize")}},sendUniformData:function(e,t){e.uniform1fv(t.uMatrix,this.matrix)},toObject:function(){return i(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),t.Image.filters.Convolute.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.Image.filters,n=t.util.createClass;i.Grayscale=n(i.BaseFilter,{type:"Grayscale",fragmentSource:{average:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat average = (color.r + color.b + color.g) / 3.0;\ngl_FragColor = vec4(average, average, average, color.a);\n}",lightness:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\ngl_FragColor = vec4(average, average, average, col.a);\n}",luminosity:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\ngl_FragColor = vec4(average, average, average, col.a);\n}"},mode:"average",mainParameter:"mode",applyTo2d:function(e){var t,i,n=e.imageData.data,r=n.length,o=this.mode;for(t=0;t<r;t+=4)"average"===o?i=(n[t]+n[t+1]+n[t+2])/3:"lightness"===o?i=(Math.min(n[t],n[t+1],n[t+2])+Math.max(n[t],n[t+1],n[t+2]))/2:"luminosity"===o&&(i=.21*n[t]+.72*n[t+1]+.07*n[t+2]),n[t]=i,n[t+1]=i,n[t+2]=i},retrieveShader:function(e){var t=this.type+"_"+this.mode;if(!e.programCache.hasOwnProperty(t)){var i=this.fragmentSource[this.mode];e.programCache[t]=this.createProgram(e.context,i)}return e.programCache[t]},getUniformLocations:function(e,t){return{uMode:e.getUniformLocation(t,"uMode")}},sendUniformData:function(e,t){e.uniform1i(t.uMode,1)},isNeutralState:function(){return!1}}),t.Image.filters.Grayscale.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.Image.filters,n=t.util.createClass;i.Invert=n(i.BaseFilter,{type:"Invert",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uInvert;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nif (uInvert == 1) {\ngl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\n} else {\ngl_FragColor = color;\n}\n}",invert:!0,mainParameter:"invert",applyTo2d:function(e){var t,i=e.imageData.data,n=i.length;for(t=0;t<n;t+=4)i[t]=255-i[t],i[t+1]=255-i[t+1],i[t+2]=255-i[t+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(e,t){return{uInvert:e.getUniformLocation(t,"uInvert")}},sendUniformData:function(e,t){e.uniform1i(t.uInvert,this.invert)}}),t.Image.filters.Invert.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.util.object.extend,n=t.Image.filters,r=t.util.createClass;n.Noise=r(n.BaseFilter,{type:"Noise",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uStepH;\nuniform float uNoise;\nuniform float uSeed;\nvarying vec2 vTexCoord;\nfloat rand(vec2 co, float seed, float vScale) {\nreturn fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\n}\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\ngl_FragColor = color;\n}",mainParameter:"noise",noise:0,applyTo2d:function(e){if(0!==this.noise){var t,i,n=e.imageData.data,r=n.length,o=this.noise;for(t=0,r=n.length;t<r;t+=4)i=(.5-Math.random())*o,n[t]+=i,n[t+1]+=i,n[t+2]+=i}},getUniformLocations:function(e,t){return{uNoise:e.getUniformLocation(t,"uNoise"),uSeed:e.getUniformLocation(t,"uSeed")}},sendUniformData:function(e,t){e.uniform1f(t.uNoise,this.noise/255),e.uniform1f(t.uSeed,Math.random())},toObject:function(){return i(this.callSuper("toObject"),{noise:this.noise})}}),t.Image.filters.Noise.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.Image.filters,n=t.util.createClass;i.Pixelate=n(i.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBlocksize;\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nfloat blockW = uBlocksize * uStepW;\nfloat blockH = uBlocksize * uStepW;\nint posX = int(vTexCoord.x / blockW);\nint posY = int(vTexCoord.y / blockH);\nfloat fposX = float(posX);\nfloat fposY = float(posY);\nvec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\nvec4 color = texture2D(uTexture, squareCoords);\ngl_FragColor = color;\n}",applyTo2d:function(e){var t,i,n,r,o,a,s,l,c,u,h,d=e.imageData,f=d.data,g=d.height,p=d.width;for(i=0;i<g;i+=this.blocksize)for(n=0;n<p;n+=this.blocksize)for(r=f[t=4*i*p+4*n],o=f[t+1],a=f[t+2],s=f[t+3],u=Math.min(i+this.blocksize,g),h=Math.min(n+this.blocksize,p),l=i;l<u;l++)for(c=n;c<h;c++)f[t=4*l*p+4*c]=r,f[t+1]=o,f[t+2]=a,f[t+3]=s},isNeutralState:function(){return 1===this.blocksize},getUniformLocations:function(e,t){return{uBlocksize:e.getUniformLocation(t,"uBlocksize"),uStepW:e.getUniformLocation(t,"uStepW"),uStepH:e.getUniformLocation(t,"uStepH")}},sendUniformData:function(e,t){e.uniform1f(t.uBlocksize,this.blocksize)}}),t.Image.filters.Pixelate.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.util.object.extend,n=t.Image.filters,r=t.util.createClass;n.RemoveColor=r(n.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uLow;\nuniform vec4 uHigh;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\nif(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\ngl_FragColor.a = 0.0;\n}\n}",distance:.02,useAlpha:!1,applyTo2d:function(e){var i,n,r,o,a=e.imageData.data,s=255*this.distance,l=new t.Color(this.color).getSource(),c=[l[0]-s,l[1]-s,l[2]-s],u=[l[0]+s,l[1]+s,l[2]+s];for(i=0;i<a.length;i+=4)n=a[i],r=a[i+1],o=a[i+2],n>c[0]&&r>c[1]&&o>c[2]&&n<u[0]&&r<u[1]&&o<u[2]&&(a[i+3]=0)},getUniformLocations:function(e,t){return{uLow:e.getUniformLocation(t,"uLow"),uHigh:e.getUniformLocation(t,"uHigh")}},sendUniformData:function(e,i){var n=new t.Color(this.color).getSource(),r=parseFloat(this.distance),o=[0+n[0]/255-r,0+n[1]/255-r,0+n[2]/255-r,1],a=[n[0]/255+r,n[1]/255+r,n[2]/255+r,1];e.uniform4fv(i.uLow,o),e.uniform4fv(i.uHigh,a)},toObject:function(){return i(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),t.Image.filters.RemoveColor.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.Image.filters,n=t.util.createClass,r={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var o in r)i[o]=n(i.ColorMatrix,{type:o,matrix:r[o],mainParameter:!1,colorsOnly:!0}),t.Image.filters[o].fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric,i=t.Image.filters,n=t.util.createClass;i.BlendColor=n(i.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:"gl_FragColor.rgb *= uColor.rgb;\n",screen:"gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\n",add:"gl_FragColor.rgb += uColor.rgb;\n",diff:"gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\n",subtract:"gl_FragColor.rgb -= uColor.rgb;\n",lighten:"gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\n",darken:"gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\n",exclusion:"gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\n",overlay:"if (uColor.r < 0.5) {\ngl_FragColor.r *= 2.0 * uColor.r;\n} else {\ngl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\n}\nif (uColor.g < 0.5) {\ngl_FragColor.g *= 2.0 * uColor.g;\n} else {\ngl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\n}\nif (uColor.b < 0.5) {\ngl_FragColor.b *= 2.0 * uColor.b;\n} else {\ngl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\n}\n",tint:"gl_FragColor.rgb *= (1.0 - uColor.a);\ngl_FragColor.rgb += uColor.rgb;\n"},buildSource:function(e){return"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ngl_FragColor = color;\nif (color.a > 0.0) {\n"+this.fragmentSource[e]+"}\n}"},retrieveShader:function(e){var t,i=this.type+"_"+this.mode;return e.programCache.hasOwnProperty(i)||(t=this.buildSource(this.mode),e.programCache[i]=this.createProgram(e.context,t)),e.programCache[i]},applyTo2d:function(e){var i,n,r,o,a,s,l,c=e.imageData.data,u=c.length,h=1-this.alpha;i=(l=new t.Color(this.color).getSource())[0]*this.alpha,n=l[1]*this.alpha,r=l[2]*this.alpha;for(var d=0;d<u;d+=4)switch(o=c[d],a=c[d+1],s=c[d+2],this.mode){case"multiply":c[d]=o*i/255,c[d+1]=a*n/255,c[d+2]=s*r/255;break;case"screen":c[d]=255-(255-o)*(255-i)/255,c[d+1]=255-(255-a)*(255-n)/255,c[d+2]=255-(255-s)*(255-r)/255;break;case"add":c[d]=o+i,c[d+1]=a+n,c[d+2]=s+r;break;case"diff":case"difference":c[d]=Math.abs(o-i),c[d+1]=Math.abs(a-n),c[d+2]=Math.abs(s-r);break;case"subtract":c[d]=o-i,c[d+1]=a-n,c[d+2]=s-r;break;case"darken":c[d]=Math.min(o,i),c[d+1]=Math.min(a,n),c[d+2]=Math.min(s,r);break;case"lighten":c[d]=Math.max(o,i),c[d+1]=Math.max(a,n),c[d+2]=Math.max(s,r);break;case"overlay":c[d]=i<128?2*o*i/255:255-2*(255-o)*(255-i)/255,c[d+1]=n<128?2*a*n/255:255-2*(255-a)*(255-n)/255,c[d+2]=r<128?2*s*r/255:255-2*(255-s)*(255-r)/255;break;case"exclusion":c[d]=i+o-2*i*o/255,c[d+1]=n+a-2*n*a/255,c[d+2]=r+s-2*r*s/255;break;case"tint":c[d]=i+o*h,c[d+1]=n+a*h,c[d+2]=r+s*h}},getUniformLocations:function(e,t){return{uColor:e.getUniformLocation(t,"uColor")}},sendUniformData:function(e,i){var n=new t.Color(this.color).getSource();n[0]=this.alpha*n[0]/255,n[1]=this.alpha*n[1]/255,n[2]=this.alpha*n[2]/255,n[3]=this.alpha,e.uniform4fv(i.uColor,n)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),t.Image.filters.BlendColor.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric,i=t.Image.filters,n=t.util.createClass;i.BlendImage=n(i.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nuniform mat3 uTransformMatrix;\nvoid main() {\nvTexCoord = aPosition;\nvTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:{multiply:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.rgba *= color2.rgba;\ngl_FragColor = color;\n}",mask:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.a = color2.a;\ngl_FragColor = color;\n}"},retrieveShader:function(e){var t=this.type+"_"+this.mode,i=this.fragmentSource[this.mode];return e.programCache.hasOwnProperty(t)||(e.programCache[t]=this.createProgram(e.context,i)),e.programCache[t]},applyToWebGL:function(e){var t=e.context,i=this.createTexture(e.filterBackend,this.image);this.bindAdditionalTexture(t,i,t.TEXTURE1),this.callSuper("applyToWebGL",e),this.unbindAdditionalTexture(t,t.TEXTURE1)},createTexture:function(e,t){return e.getCachedTexture(t.cacheKey,t._element)},calculateMatrix:function(){var e=this.image,t=e._element.width,i=e._element.height;return[1/e.scaleX,0,0,0,1/e.scaleY,0,-e.left/t,-e.top/i,1]},applyTo2d:function(e){var i,n,r,o,a,s,l,c,u,h,d,f=e.imageData,g=e.filterBackend.resources,p=f.data,m=p.length,_=f.width,v=f.height,y=this.image;g.blendImage||(g.blendImage=t.util.createCanvasElement()),h=(u=g.blendImage).getContext("2d"),u.width!==_||u.height!==v?(u.width=_,u.height=v):h.clearRect(0,0,_,v),h.setTransform(y.scaleX,0,0,y.scaleY,y.left,y.top),h.drawImage(y._element,0,0,_,v),d=h.getImageData(0,0,_,v).data;for(var b=0;b<m;b+=4)switch(a=p[b],s=p[b+1],l=p[b+2],c=p[b+3],i=d[b],n=d[b+1],r=d[b+2],o=d[b+3],this.mode){case"multiply":p[b]=a*i/255,p[b+1]=s*n/255,p[b+2]=l*r/255,p[b+3]=c*o/255;break;case"mask":p[b+3]=o}},getUniformLocations:function(e,t){return{uTransformMatrix:e.getUniformLocation(t,"uTransformMatrix"),uImage:e.getUniformLocation(t,"uImage")}},sendUniformData:function(e,t){var i=this.calculateMatrix();e.uniform1i(t.uImage,1),e.uniformMatrix3fv(t.uTransformMatrix,!1,i)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),t.Image.filters.BlendImage.fromObject=function(e,i){t.Image.fromObject(e.image,(function(n){var r=t.util.object.clone(e);r.image=n,i(new t.Image.filters.BlendImage(r))}))}}(t),function(e){var t=e.fabric||(e.fabric={}),i=Math.pow,n=Math.floor,r=Math.sqrt,o=Math.abs,a=Math.round,s=Math.sin,l=Math.ceil,c=t.Image.filters,u=t.util.createClass;c.Resize=u(c.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(e,t){return{uDelta:e.getUniformLocation(t,"uDelta"),uTaps:e.getUniformLocation(t,"uTaps")}},sendUniformData:function(e,t){e.uniform2fv(t.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),e.uniform1fv(t.uTaps,this.taps)},retrieveShader:function(e){var t=this.getFilterWindow(),i=this.type+"_"+t;if(!e.programCache.hasOwnProperty(i)){var n=this.generateShader(t);e.programCache[i]=this.createProgram(e.context,n)}return e.programCache[i]},getFilterWindow:function(){var e=this.tempScale;return Math.ceil(this.lanczosLobes/e)},getTaps:function(){for(var e=this.lanczosCreate(this.lanczosLobes),t=this.tempScale,i=this.getFilterWindow(),n=new Array(i),r=1;r<=i;r++)n[r-1]=e(r*t);return n},generateShader:function(e){for(var t=new Array(e),i=this.fragmentSourceTOP,n=1;n<=e;n++)t[n-1]=n+".0 * uDelta";return i+="uniform float uTaps["+e+"];\n",i+="void main() {\n",i+="  vec4 color = texture2D(uTexture, vTexCoord);\n",i+="  float sum = 1.0;\n",t.forEach((function(e,t){i+="  color += texture2D(uTexture, vTexCoord + "+e+") * uTaps["+t+"];\n",i+="  color += texture2D(uTexture, vTexCoord - "+e+") * uTaps["+t+"];\n",i+="  sum += 2.0 * uTaps["+t+"];\n"})),i+="  gl_FragColor = color / sum;\n",i+="}"},fragmentSourceTOP:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\n",applyTo:function(e){e.webgl?(e.passes++,this.width=e.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=e.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),e.destinationWidth=this.dW,this._setupFrameBuffer(e),this.applyToWebGL(e),this._swapTextures(e),e.sourceWidth=e.destinationWidth,this.height=e.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),e.destinationHeight=this.dH,this._setupFrameBuffer(e),this.applyToWebGL(e),this._swapTextures(e),e.sourceHeight=e.destinationHeight):this.applyTo2d(e)},isNeutralState:function(){return 1===this.scaleX&&1===this.scaleY},lanczosCreate:function(e){return function(t){if(t>=e||t<=-e)return 0;if(t<1.1920929e-7&&t>-1.1920929e-7)return 1;var i=(t*=Math.PI)/e;return s(t)/t*s(i)/i}},applyTo2d:function(e){var t=e.imageData,i=this.scaleX,n=this.scaleY;this.rcpScaleX=1/i,this.rcpScaleY=1/n;var r,o=t.width,s=t.height,l=a(o*i),c=a(s*n);"sliceHack"===this.resizeType?r=this.sliceByTwo(e,o,s,l,c):"hermite"===this.resizeType?r=this.hermiteFastResize(e,o,s,l,c):"bilinear"===this.resizeType?r=this.bilinearFiltering(e,o,s,l,c):"lanczos"===this.resizeType&&(r=this.lanczosResize(e,o,s,l,c)),e.imageData=r},sliceByTwo:function(e,i,r,o,a){var s,l,c=e.imageData,u=.5,h=!1,d=!1,f=i*u,g=r*u,p=t.filterBackend.resources,m=0,_=0,v=i,y=0;for(p.sliceByTwo||(p.sliceByTwo=document.createElement("canvas")),((s=p.sliceByTwo).width<1.5*i||s.height<r)&&(s.width=1.5*i,s.height=r),(l=s.getContext("2d")).clearRect(0,0,1.5*i,r),l.putImageData(c,0,0),o=n(o),a=n(a);!h||!d;)i=f,r=g,o<n(f*u)?f=n(f*u):(f=o,h=!0),a<n(g*u)?g=n(g*u):(g=a,d=!0),l.drawImage(s,m,_,i,r,v,y,f,g),m=v,_=y,y+=g;return l.getImageData(m,_,o,a)},lanczosResize:function(e,t,a,s,c){var u=e.imageData.data,h=e.ctx.createImageData(s,c),d=h.data,f=this.lanczosCreate(this.lanczosLobes),g=this.rcpScaleX,p=this.rcpScaleY,m=2/this.rcpScaleX,_=2/this.rcpScaleY,v=l(g*this.lanczosLobes/2),y=l(p*this.lanczosLobes/2),b={},S={},w={};return function e(l){var C,x,T,E,I,O,A,R,D,k,L;for(S.x=(l+.5)*g,w.x=n(S.x),C=0;C<c;C++){for(S.y=(C+.5)*p,w.y=n(S.y),I=0,O=0,A=0,R=0,D=0,x=w.x-v;x<=w.x+v;x++)if(!(x<0||x>=t)){k=n(1e3*o(x-S.x)),b[k]||(b[k]={});for(var M=w.y-y;M<=w.y+y;M++)M<0||M>=a||(L=n(1e3*o(M-S.y)),b[k][L]||(b[k][L]=f(r(i(k*m,2)+i(L*_,2))/1e3)),(T=b[k][L])>0&&(I+=T,O+=T*u[E=4*(M*t+x)],A+=T*u[E+1],R+=T*u[E+2],D+=T*u[E+3]))}d[E=4*(C*s+l)]=O/I,d[E+1]=A/I,d[E+2]=R/I,d[E+3]=D/I}return++l<s?e(l):h}(0)},bilinearFiltering:function(e,t,i,r,o){var a,s,l,c,u,h,d,f,g,p=0,m=this.rcpScaleX,_=this.rcpScaleY,v=4*(t-1),y=e.imageData.data,b=e.ctx.createImageData(r,o),S=b.data;for(l=0;l<o;l++)for(c=0;c<r;c++)for(u=m*c-(a=n(m*c)),h=_*l-(s=n(_*l)),g=4*(s*t+a),d=0;d<4;d++)f=y[g+d]*(1-u)*(1-h)+y[g+4+d]*u*(1-h)+y[g+v+d]*h*(1-u)+y[g+v+4+d]*u*h,S[p++]=f;return b},hermiteFastResize:function(e,t,i,a,s){for(var c=this.rcpScaleX,u=this.rcpScaleY,h=l(c/2),d=l(u/2),f=e.imageData.data,g=e.ctx.createImageData(a,s),p=g.data,m=0;m<s;m++)for(var _=0;_<a;_++){for(var v=4*(_+m*a),y=0,b=0,S=0,w=0,C=0,x=0,T=0,E=(m+.5)*u,I=n(m*u);I<(m+1)*u;I++)for(var O=o(E-(I+.5))/d,A=(_+.5)*c,R=O*O,D=n(_*c);D<(_+1)*c;D++){var k=o(A-(D+.5))/h,L=r(R+k*k);L>1&&L<-1||(y=2*L*L*L-3*L*L+1)>0&&(T+=y*f[3+(k=4*(D+I*t))],S+=y,f[k+3]<255&&(y=y*f[k+3]/250),w+=y*f[k],C+=y*f[k+1],x+=y*f[k+2],b+=y)}p[v]=w/b,p[v+1]=C/b,p[v+2]=x/b,p[v+3]=T/S}return g},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),t.Image.filters.Resize.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.Image.filters,n=t.util.createClass;i.Contrast=n(i.BaseFilter,{type:"Contrast",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uContrast;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\ncolor.rgb = contrastF * (color.rgb - 0.5) + 0.5;\ngl_FragColor = color;\n}",contrast:0,mainParameter:"contrast",applyTo2d:function(e){if(0!==this.contrast){var t,i=e.imageData.data,n=i.length,r=Math.floor(255*this.contrast),o=259*(r+255)/(255*(259-r));for(t=0;t<n;t+=4)i[t]=o*(i[t]-128)+128,i[t+1]=o*(i[t+1]-128)+128,i[t+2]=o*(i[t+2]-128)+128}},getUniformLocations:function(e,t){return{uContrast:e.getUniformLocation(t,"uContrast")}},sendUniformData:function(e,t){e.uniform1f(t.uContrast,this.contrast)}}),t.Image.filters.Contrast.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.Image.filters,n=t.util.createClass;i.Saturation=n(i.BaseFilter,{type:"Saturation",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uSaturation;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat rgMax = max(color.r, color.g);\nfloat rgbMax = max(rgMax, color.b);\ncolor.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\ncolor.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\ncolor.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\ngl_FragColor = color;\n}",saturation:0,mainParameter:"saturation",applyTo2d:function(e){if(0!==this.saturation){var t,i,n=e.imageData.data,r=n.length,o=-this.saturation;for(t=0;t<r;t+=4)i=Math.max(n[t],n[t+1],n[t+2]),n[t]+=i!==n[t]?(i-n[t])*o:0,n[t+1]+=i!==n[t+1]?(i-n[t+1])*o:0,n[t+2]+=i!==n[t+2]?(i-n[t+2])*o:0}},getUniformLocations:function(e,t){return{uSaturation:e.getUniformLocation(t,"uSaturation")}},sendUniformData:function(e,t){e.uniform1f(t.uSaturation,-this.saturation)}}),t.Image.filters.Saturation.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.Image.filters,n=t.util.createClass;i.Vibrance=n(i.BaseFilter,{type:"Vibrance",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uVibrance;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat max = max(color.r, max(color.g, color.b));\nfloat avg = (color.r + color.g + color.b) / 3.0;\nfloat amt = (abs(max - avg) * 2.0) * uVibrance;\ncolor.r += max != color.r ? (max - color.r) * amt : 0.00;\ncolor.g += max != color.g ? (max - color.g) * amt : 0.00;\ncolor.b += max != color.b ? (max - color.b) * amt : 0.00;\ngl_FragColor = color;\n}",vibrance:0,mainParameter:"vibrance",applyTo2d:function(e){if(0!==this.vibrance){var t,i,n,r,o=e.imageData.data,a=o.length,s=-this.vibrance;for(t=0;t<a;t+=4)i=Math.max(o[t],o[t+1],o[t+2]),n=(o[t]+o[t+1]+o[t+2])/3,r=2*Math.abs(i-n)/255*s,o[t]+=i!==o[t]?(i-o[t])*r:0,o[t+1]+=i!==o[t+1]?(i-o[t+1])*r:0,o[t+2]+=i!==o[t+2]?(i-o[t+2])*r:0}},getUniformLocations:function(e,t){return{uVibrance:e.getUniformLocation(t,"uVibrance")}},sendUniformData:function(e,t){e.uniform1f(t.uVibrance,-this.vibrance)}}),t.Image.filters.Vibrance.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.Image.filters,n=t.util.createClass;i.Blur=n(i.BaseFilter,{type:"Blur",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\nconst float nSamples = 15.0;\nvec3 v3offset = vec3(12.9898, 78.233, 151.7182);\nfloat random(vec3 scale) {\nreturn fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\n}\nvoid main() {\nvec4 color = vec4(0.0);\nfloat total = 0.0;\nfloat offset = random(v3offset);\nfor (float t = -nSamples; t <= nSamples; t++) {\nfloat percent = (t + offset - 0.5) / nSamples;\nfloat weight = 1.0 - abs(percent);\ncolor += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\ntotal += weight;\n}\ngl_FragColor = color / total;\n}",blur:0,mainParameter:"blur",applyTo:function(e){e.webgl?(this.aspectRatio=e.sourceWidth/e.sourceHeight,e.passes++,this._setupFrameBuffer(e),this.horizontal=!0,this.applyToWebGL(e),this._swapTextures(e),this._setupFrameBuffer(e),this.horizontal=!1,this.applyToWebGL(e),this._swapTextures(e)):this.applyTo2d(e)},applyTo2d:function(e){e.imageData=this.simpleBlur(e)},simpleBlur:function(e){var i,n,r=e.filterBackend.resources,o=e.imageData.width,a=e.imageData.height;r.blurLayer1||(r.blurLayer1=t.util.createCanvasElement(),r.blurLayer2=t.util.createCanvasElement()),i=r.blurLayer1,n=r.blurLayer2,i.width===o&&i.height===a||(n.width=i.width=o,n.height=i.height=a);var s,l,c,u,h=i.getContext("2d"),d=n.getContext("2d"),f=.06*this.blur*.5;for(h.putImageData(e.imageData,0,0),d.clearRect(0,0,o,a),u=-15;u<=15;u++)c=f*(l=u/15)*o+(s=(Math.random()-.5)/4),d.globalAlpha=1-Math.abs(l),d.drawImage(i,c,s),h.drawImage(n,0,0),d.globalAlpha=1,d.clearRect(0,0,n.width,n.height);for(u=-15;u<=15;u++)c=f*(l=u/15)*a+(s=(Math.random()-.5)/4),d.globalAlpha=1-Math.abs(l),d.drawImage(i,s,c),h.drawImage(n,0,0),d.globalAlpha=1,d.clearRect(0,0,n.width,n.height);e.ctx.drawImage(i,0,0);var g=e.ctx.getImageData(0,0,i.width,i.height);return h.globalAlpha=1,h.clearRect(0,0,i.width,i.height),g},getUniformLocations:function(e,t){return{delta:e.getUniformLocation(t,"uDelta")}},sendUniformData:function(e,t){var i=this.chooseRightDelta();e.uniform2fv(t.delta,i)},chooseRightDelta:function(){var e,t=1,i=[0,0];return this.horizontal?this.aspectRatio>1&&(t=1/this.aspectRatio):this.aspectRatio<1&&(t=this.aspectRatio),e=t*this.blur*.12,this.horizontal?i[0]=e:i[1]=e,i}}),i.Blur.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.Image.filters,n=t.util.createClass;i.Gamma=n(i.BaseFilter,{type:"Gamma",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec3 uGamma;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec3 correction = (1.0 / uGamma);\ncolor.r = pow(color.r, correction.r);\ncolor.g = pow(color.g, correction.g);\ncolor.b = pow(color.b, correction.b);\ngl_FragColor = color;\ngl_FragColor.rgb *= color.a;\n}",gamma:[1,1,1],mainParameter:"gamma",initialize:function(e){this.gamma=[1,1,1],i.BaseFilter.prototype.initialize.call(this,e)},applyTo2d:function(e){var t,i=e.imageData.data,n=this.gamma,r=i.length,o=1/n[0],a=1/n[1],s=1/n[2];for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),t=0,r=256;t<r;t++)this.rVals[t]=255*Math.pow(t/255,o),this.gVals[t]=255*Math.pow(t/255,a),this.bVals[t]=255*Math.pow(t/255,s);for(t=0,r=i.length;t<r;t+=4)i[t]=this.rVals[i[t]],i[t+1]=this.gVals[i[t+1]],i[t+2]=this.bVals[i[t+2]]},getUniformLocations:function(e,t){return{uGamma:e.getUniformLocation(t,"uGamma")}},sendUniformData:function(e,t){e.uniform3fv(t.uGamma,this.gamma)}}),t.Image.filters.Gamma.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.Image.filters,n=t.util.createClass;i.Composed=n(i.BaseFilter,{type:"Composed",subFilters:[],initialize:function(e){this.callSuper("initialize",e),this.subFilters=this.subFilters.slice(0)},applyTo:function(e){e.passes+=this.subFilters.length-1,this.subFilters.forEach((function(t){t.applyTo(e)}))},toObject:function(){return t.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map((function(e){return e.toObject()}))})},isNeutralState:function(){return!this.subFilters.some((function(e){return!e.isNeutralState()}))}}),t.Image.filters.Composed.fromObject=function(e,i){var n=(e.subFilters||[]).map((function(e){return new t.Image.filters[e.type](e)})),r=new t.Image.filters.Composed({subFilters:n});return i&&i(r),r}}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.Image.filters,n=t.util.createClass;i.HueRotation=n(i.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var e=this.rotation*Math.PI,i=t.util.cos(e),n=t.util.sin(e),r=1/3,o=Math.sqrt(r)*n,a=1-i;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=i+a/3,this.matrix[1]=r*a-o,this.matrix[2]=r*a+o,this.matrix[5]=r*a+o,this.matrix[6]=i+r*a,this.matrix[7]=r*a-o,this.matrix[10]=r*a-o,this.matrix[11]=r*a+o,this.matrix[12]=i+r*a},isNeutralState:function(e){return this.calculateMatrix(),i.BaseFilter.prototype.isNeutralState.call(this,e)},applyTo:function(e){this.calculateMatrix(),i.BaseFilter.prototype.applyTo.call(this,e)}}),t.Image.filters.HueRotation.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.util.object.clone;if(t.Text)t.warn("fabric.Text is already defined");else{var n="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");t.Text=t.util.createClass(t.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:t.Object.prototype.stateProperties.concat(n),cacheProperties:t.Object.prototype.cacheProperties.concat(n),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(e,t){this.styles=t&&t.styles||{},this.text=e,this.__skipDimension=!0,this.callSuper("initialize",t),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var e=this.path;e&&(e.segmentsInfo=t.util.getPathSegmentsInfo(e.path))},getMeasuringContext:function(){return t._measuringContext||(t._measuringContext=this.canvas&&this.canvas.contextCache||t.util.createCanvasElement().getContext("2d")),t._measuringContext},_splitText:function(){var e=this._splitTextIntoLines(this.text);return this.textLines=e.lines,this._textLines=e.graphemeLines,this._unwrappedTextLines=e._unwrappedLines,this._text=e.graphemeText,e},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var e,t,i,n,r,o,a,s=0,l=this._textLines.length;s<l;s++)if(("justify"===this.textAlign||s!==l-1&&!this.isEndOfWrapping(s))&&(n=0,r=this._textLines[s],(t=this.getLineWidth(s))<this.width&&(a=this.textLines[s].match(this._reSpacesAndTabs)))){i=a.length,e=(this.width-t)/i;for(var c=0,u=r.length;c<=u;c++)o=this.__charBounds[s][c],this._reSpaceAndTab.test(r[c])?(o.width+=e,o.kernedWidth+=e,o.left+=n,n+=e):o.left+=n}},isEndOfWrapping:function(e){return e===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var e=this.callSuper("_getCacheCanvasDimensions"),t=this.fontSize;return e.width+=t*e.zoomX,e.height+=t*e.zoomY,e},_render:function(e){var t=this.path;t&&!t.isNotVisible()&&t._render(e),this._setTextStyles(e),this._renderTextLinesBackground(e),this._renderTextDecoration(e,"underline"),this._renderText(e),this._renderTextDecoration(e,"overline"),this._renderTextDecoration(e,"linethrough")},_renderText:function(e){"stroke"===this.paintFirst?(this._renderTextStroke(e),this._renderTextFill(e)):(this._renderTextFill(e),this._renderTextStroke(e))},_setTextStyles:function(e,t,i){if(e.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":e.textBaseline="middle";break;case"ascender":e.textBaseline="top";break;case"descender":e.textBaseline="bottom"}e.font=this._getFontDeclaration(t,i)},calcTextWidth:function(){for(var e=this.getLineWidth(0),t=1,i=this._textLines.length;t<i;t++){var n=this.getLineWidth(t);n>e&&(e=n)}return e},_renderTextLine:function(e,t,i,n,r,o){this._renderChars(e,t,i,n,r,o)},_renderTextLinesBackground:function(e){if(this.textBackgroundColor||this.styleHas("textBackgroundColor")){for(var t,i,n,r,o,a,s,l=e.fillStyle,c=this._getLeftOffset(),u=this._getTopOffset(),h=0,d=0,f=this.path,g=0,p=this._textLines.length;g<p;g++)if(t=this.getHeightOfLine(g),this.textBackgroundColor||this.styleHas("textBackgroundColor",g)){n=this._textLines[g],i=this._getLineLeftOffset(g),d=0,h=0,r=this.getValueOfPropertyAt(g,0,"textBackgroundColor");for(var m=0,_=n.length;m<_;m++)o=this.__charBounds[g][m],a=this.getValueOfPropertyAt(g,m,"textBackgroundColor"),f?(e.save(),e.translate(o.renderLeft,o.renderTop),e.rotate(o.angle),e.fillStyle=a,a&&e.fillRect(-o.width/2,-t/this.lineHeight*(1-this._fontSizeFraction),o.width,t/this.lineHeight),e.restore()):a!==r?(s=c+i+h,"rtl"===this.direction&&(s=this.width-s-d),e.fillStyle=r,r&&e.fillRect(s,u,d,t/this.lineHeight),h=o.left,d=o.width,r=a):d+=o.kernedWidth;a&&!f&&(s=c+i+h,"rtl"===this.direction&&(s=this.width-s-d),e.fillStyle=a,e.fillRect(s,u,d,t/this.lineHeight)),u+=t}else u+=t;e.fillStyle=l,this._removeShadow(e)}},getFontCache:function(e){var i=e.fontFamily.toLowerCase();t.charWidthsCache[i]||(t.charWidthsCache[i]={});var n=t.charWidthsCache[i],r=e.fontStyle.toLowerCase()+"_"+(e.fontWeight+"").toLowerCase();return n[r]||(n[r]={}),n[r]},_measureChar:function(e,t,i,n){var r,o,a,s,l=this.getFontCache(t),c=i+e,u=this._getFontDeclaration(t)===this._getFontDeclaration(n),h=t.fontSize/this.CACHE_FONT_SIZE;if(i&&void 0!==l[i]&&(a=l[i]),void 0!==l[e]&&(s=r=l[e]),u&&void 0!==l[c]&&(s=(o=l[c])-a),void 0===r||void 0===a||void 0===o){var d=this.getMeasuringContext();this._setTextStyles(d,t,!0)}return void 0===r&&(s=r=d.measureText(e).width,l[e]=r),void 0===a&&u&&i&&(a=d.measureText(i).width,l[i]=a),u&&void 0===o&&(o=d.measureText(c).width,l[c]=o,s=o-a),{width:r*h,kernedWidth:s*h}},getHeightOfChar:function(e,t){return this.getValueOfPropertyAt(e,t,"fontSize")},measureLine:function(e){var t=this._measureLine(e);return 0!==this.charSpacing&&(t.width-=this._getWidthOfCharSpacing()),t.width<0&&(t.width=0),t},_measureLine:function(e){var i,n,r,o,a,s,l=0,c=this._textLines[e],u=new Array(c.length),h=0,d=this.path,f="right"===this.pathSide;for(this.__charBounds[e]=u,i=0;i<c.length;i++)n=c[i],o=this._getGraphemeBox(n,e,i,r),u[i]=o,l+=o.kernedWidth,r=n;if(u[i]={left:o?o.left+o.width:0,width:0,kernedWidth:0,height:this.fontSize},d){switch(s=d.segmentsInfo[d.segmentsInfo.length-1].length,(a=t.util.getPointOnPath(d.path,0,d.segmentsInfo)).x+=d.pathOffset.x,a.y+=d.pathOffset.y,this.textAlign){case"left":h=f?s-l:0;break;case"center":h=(s-l)/2;break;case"right":h=f?0:s-l}for(h+=this.pathStartOffset*(f?-1:1),i=f?c.length-1:0;f?i>=0:i<c.length;f?i--:i++)o=u[i],h>s?h%=s:h<0&&(h+=s),this._setGraphemeOnPath(h,o,a),h+=o.kernedWidth}return{width:l,numOfSpaces:0}},_setGraphemeOnPath:function(e,i,n){var r=e+i.kernedWidth/2,o=this.path,a=t.util.getPointOnPath(o.path,r,o.segmentsInfo);i.renderLeft=a.x-n.x,i.renderTop=a.y-n.y,i.angle=a.angle+("right"===this.pathSide?Math.PI:0)},_getGraphemeBox:function(e,t,i,n,r){var o,a=this.getCompleteStyleDeclaration(t,i),s=n?this.getCompleteStyleDeclaration(t,i-1):{},l=this._measureChar(e,a,n,s),c=l.kernedWidth,u=l.width;0!==this.charSpacing&&(u+=o=this._getWidthOfCharSpacing(),c+=o);var h={width:u,left:0,height:a.fontSize,kernedWidth:c,deltaY:a.deltaY};if(i>0&&!r){var d=this.__charBounds[t][i-1];h.left=d.left+d.width+l.kernedWidth-l.width}return h},getHeightOfLine:function(e){if(this.__lineHeights[e])return this.__lineHeights[e];for(var t=this._textLines[e],i=this.getHeightOfChar(e,0),n=1,r=t.length;n<r;n++)i=Math.max(this.getHeightOfChar(e,n),i);return this.__lineHeights[e]=i*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var e,t=0,i=0,n=this._textLines.length;i<n;i++)e=this.getHeightOfLine(i),t+=i===n-1?e/this.lineHeight:e;return t},_getLeftOffset:function(){return"ltr"===this.direction?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(e,t){e.save();for(var i=0,n=this._getLeftOffset(),r=this._getTopOffset(),o=0,a=this._textLines.length;o<a;o++){var s=this.getHeightOfLine(o),l=s/this.lineHeight,c=this._getLineLeftOffset(o);this._renderTextLine(t,e,this._textLines[o],n+c,r+i+l,o),i+=s}e.restore()},_renderTextFill:function(e){(this.fill||this.styleHas("fill"))&&this._renderTextCommon(e,"fillText")},_renderTextStroke:function(e){(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(e),e.save(),this._setLineDash(e,this.strokeDashArray),e.beginPath(),this._renderTextCommon(e,"strokeText"),e.closePath(),e.restore())},_renderChars:function(e,t,i,n,r,o){var a,s,l,c,u,h=this.getHeightOfLine(o),d=-1!==this.textAlign.indexOf("justify"),f="",g=0,p=this.path,m=!d&&0===this.charSpacing&&this.isEmptyStyles(o)&&!p,_="ltr"===this.direction,v="ltr"===this.direction?1:-1,y=t.canvas.getAttribute("dir");if(t.save(),y!==this.direction&&(t.canvas.setAttribute("dir",_?"ltr":"rtl"),t.direction=_?"ltr":"rtl",t.textAlign=_?"left":"right"),r-=h*this._fontSizeFraction/this.lineHeight,m)return this._renderChar(e,t,o,0,i.join(""),n,r,h),void t.restore();for(var b=0,S=i.length-1;b<=S;b++)c=b===S||this.charSpacing||p,f+=i[b],l=this.__charBounds[o][b],0===g?(n+=v*(l.kernedWidth-l.width),g+=l.width):g+=l.kernedWidth,d&&!c&&this._reSpaceAndTab.test(i[b])&&(c=!0),c||(a=a||this.getCompleteStyleDeclaration(o,b),s=this.getCompleteStyleDeclaration(o,b+1),c=this._hasStyleChanged(a,s)),c&&(p?(t.save(),t.translate(l.renderLeft,l.renderTop),t.rotate(l.angle),this._renderChar(e,t,o,b,f,-g/2,0,h),t.restore()):(u=n,this._renderChar(e,t,o,b,f,u,r,h)),f="",a=s,n+=v*g,g=0);t.restore()},_applyPatternGradientTransformText:function(e){var i,n=t.util.createCanvasElement(),r=this.width+this.strokeWidth,o=this.height+this.strokeWidth;return n.width=r,n.height=o,(i=n.getContext("2d")).beginPath(),i.moveTo(0,0),i.lineTo(r,0),i.lineTo(r,o),i.lineTo(0,o),i.closePath(),i.translate(r/2,o/2),i.fillStyle=e.toLive(i),this._applyPatternGradientTransform(i,e),i.fill(),i.createPattern(n,"no-repeat")},handleFiller:function(e,t,i){var n,r;return i.toLive?"percentage"===i.gradientUnits||i.gradientTransform||i.patternTransform?(n=-this.width/2,r=-this.height/2,e.translate(n,r),e[t]=this._applyPatternGradientTransformText(i),{offsetX:n,offsetY:r}):(e[t]=i.toLive(e,this),this._applyPatternGradientTransform(e,i)):(e[t]=i,{offsetX:0,offsetY:0})},_setStrokeStyles:function(e,t){return e.lineWidth=t.strokeWidth,e.lineCap=this.strokeLineCap,e.lineDashOffset=this.strokeDashOffset,e.lineJoin=this.strokeLineJoin,e.miterLimit=this.strokeMiterLimit,this.handleFiller(e,"strokeStyle",t.stroke)},_setFillStyles:function(e,t){return this.handleFiller(e,"fillStyle",t.fill)},_renderChar:function(e,t,i,n,r,o,a){var s,l,c=this._getStyleDeclaration(i,n),u=this.getCompleteStyleDeclaration(i,n),h="fillText"===e&&u.fill,d="strokeText"===e&&u.stroke&&u.strokeWidth;(d||h)&&(t.save(),h&&(s=this._setFillStyles(t,u)),d&&(l=this._setStrokeStyles(t,u)),t.font=this._getFontDeclaration(u),c&&c.textBackgroundColor&&this._removeShadow(t),c&&c.deltaY&&(a+=c.deltaY),h&&t.fillText(r,o-s.offsetX,a-s.offsetY),d&&t.strokeText(r,o-l.offsetX,a-l.offsetY),t.restore())},setSuperscript:function(e,t){return this._setScript(e,t,this.superscript)},setSubscript:function(e,t){return this._setScript(e,t,this.subscript)},_setScript:function(e,t,i){var n=this.get2DCursorLocation(e,!0),r=this.getValueOfPropertyAt(n.lineIndex,n.charIndex,"fontSize"),o=this.getValueOfPropertyAt(n.lineIndex,n.charIndex,"deltaY"),a={fontSize:r*i.size,deltaY:o+r*i.baseline};return this.setSelectionStyles(a,e,t),this},_hasStyleChanged:function(e,t){return e.fill!==t.fill||e.stroke!==t.stroke||e.strokeWidth!==t.strokeWidth||e.fontSize!==t.fontSize||e.fontFamily!==t.fontFamily||e.fontWeight!==t.fontWeight||e.fontStyle!==t.fontStyle||e.deltaY!==t.deltaY},_hasStyleChangedForSvg:function(e,t){return this._hasStyleChanged(e,t)||e.overline!==t.overline||e.underline!==t.underline||e.linethrough!==t.linethrough},_getLineLeftOffset:function(e){var t=this.getLineWidth(e),i=this.width-t,n=this.textAlign,r=this.direction,o=0,a=this.isEndOfWrapping(e);return"justify"===n||"justify-center"===n&&!a||"justify-right"===n&&!a||"justify-left"===n&&!a?0:("center"===n&&(o=i/2),"right"===n&&(o=i),"justify-center"===n&&(o=i/2),"justify-right"===n&&(o=i),"rtl"===r&&(o-=i),o)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var e=this._forceClearCache;return e||(e=this.hasStateChanged("_dimensionAffectingProps")),e&&(this.dirty=!0,this._forceClearCache=!1),e},getLineWidth:function(e){if(void 0!==this.__lineWidths[e])return this.__lineWidths[e];var t=this.measureLine(e).width;return this.__lineWidths[e]=t,t},_getWidthOfCharSpacing:function(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(e,t,i){var n=this._getStyleDeclaration(e,t);return n&&void 0!==n[i]?n[i]:this[i]},_renderTextDecoration:function(e,t){if(this[t]||this.styleHas(t)){for(var i,n,r,o,a,s,l,c,u,h,d,f,g,p,m,_,v=this._getLeftOffset(),y=this._getTopOffset(),b=this.path,S=this._getWidthOfCharSpacing(),w=this.offsets[t],C=0,x=this._textLines.length;C<x;C++)if(i=this.getHeightOfLine(C),this[t]||this.styleHas(t,C)){l=this._textLines[C],p=i/this.lineHeight,o=this._getLineLeftOffset(C),h=0,d=0,c=this.getValueOfPropertyAt(C,0,t),_=this.getValueOfPropertyAt(C,0,"fill"),u=y+p*(1-this._fontSizeFraction),n=this.getHeightOfChar(C,0),a=this.getValueOfPropertyAt(C,0,"deltaY");for(var T=0,E=l.length;T<E;T++)if(f=this.__charBounds[C][T],g=this.getValueOfPropertyAt(C,T,t),m=this.getValueOfPropertyAt(C,T,"fill"),r=this.getHeightOfChar(C,T),s=this.getValueOfPropertyAt(C,T,"deltaY"),b&&g&&m)e.save(),e.fillStyle=_,e.translate(f.renderLeft,f.renderTop),e.rotate(f.angle),e.fillRect(-f.kernedWidth/2,w*r+s,f.kernedWidth,this.fontSize/15),e.restore();else if((g!==c||m!==_||r!==n||s!==a)&&d>0){var I=v+o+h;"rtl"===this.direction&&(I=this.width-I-d),c&&_&&(e.fillStyle=_,e.fillRect(I,u+w*n+a,d,this.fontSize/15)),h=f.left,d=f.width,c=g,_=m,n=r,a=s}else d+=f.kernedWidth;I=v+o+h,"rtl"===this.direction&&(I=this.width-I-d),e.fillStyle=m,g&&m&&e.fillRect(I,u+w*n+a,d-S,this.fontSize/15),y+=i}else y+=i;this._removeShadow(e)}},_getFontDeclaration:function(e,i){var n=e||this,r=this.fontFamily,o=t.Text.genericFonts.indexOf(r.toLowerCase())>-1,a=void 0===r||r.indexOf("'")>-1||r.indexOf(",")>-1||r.indexOf('"')>-1||o?n.fontFamily:'"'+n.fontFamily+'"';return[t.isLikelyNode?n.fontWeight:n.fontStyle,t.isLikelyNode?n.fontStyle:n.fontWeight,i?this.CACHE_FONT_SIZE+"px":n.fontSize+"px",a].join(" ")},render:function(e){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",e)))},_splitTextIntoLines:function(e){for(var i=e.split(this._reNewline),n=new Array(i.length),r=["\n"],o=[],a=0;a<i.length;a++)n[a]=t.util.string.graphemeSplit(i[a]),o=o.concat(n[a],r);return o.pop(),{_unwrappedLines:n,lines:i,graphemeText:o,graphemeLines:n}},toObject:function(e){var t=n.concat(e),r=this.callSuper("toObject",t);return r.styles=i(this.styles,!0),r.path&&(r.path=this.path.toObject()),r},set:function(e,t){this.callSuper("set",e,t);var i=!1,n=!1;if("object"==typeof e)for(var r in e)"path"===r&&this.setPathInfo(),i=i||-1!==this._dimensionAffectingProps.indexOf(r),n=n||"path"===r;else i=-1!==this._dimensionAffectingProps.indexOf(e),n="path"===e;return n&&this.setPathInfo(),i&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),t.Text.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),t.Text.DEFAULT_SVG_FONT_SIZE=16,t.Text.fromElement=function(e,n,r){if(!e)return n(null);var o=t.parseAttributes(e,t.Text.ATTRIBUTE_NAMES),a=o.textAnchor||"left";if((r=t.util.object.extend(r?i(r):{},o)).top=r.top||0,r.left=r.left||0,o.textDecoration){var s=o.textDecoration;-1!==s.indexOf("underline")&&(r.underline=!0),-1!==s.indexOf("overline")&&(r.overline=!0),-1!==s.indexOf("line-through")&&(r.linethrough=!0),delete r.textDecoration}"dx"in o&&(r.left+=o.dx),"dy"in o&&(r.top+=o.dy),"fontSize"in r||(r.fontSize=t.Text.DEFAULT_SVG_FONT_SIZE);var l="";"textContent"in e?l=e.textContent:"firstChild"in e&&null!==e.firstChild&&"data"in e.firstChild&&null!==e.firstChild.data&&(l=e.firstChild.data),l=l.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var c=r.strokeWidth;r.strokeWidth=0;var u=new t.Text(l,r),h=u.getScaledHeight()/u.height,d=((u.height+u.strokeWidth)*u.lineHeight-u.height)*h,f=u.getScaledHeight()+d,g=0;"center"===a&&(g=u.getScaledWidth()/2),"right"===a&&(g=u.getScaledWidth()),u.set({left:u.left-g,top:u.top-(f-u.fontSize*(.07+u._fontSizeFraction))/u.lineHeight,strokeWidth:void 0!==c?c:1}),n(u)},t.Text.fromObject=function(e,n){var r=i(e),o=e.path;return delete r.path,t.Object._fromObject("Text",r,(function(e){o?t.Object._fromObject("Path",o,(function(t){e.set("path",t),n(e)}),"path"):n(e)}),"text")},t.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],t.util.createAccessors&&t.util.createAccessors(t.Text)}}(t),x.util.object.extend(x.Text.prototype,{isEmptyStyles:function(e){if(!this.styles)return!0;if(void 0!==e&&!this.styles[e])return!0;var t=void 0===e?this.styles:{line:this.styles[e]};for(var i in t)for(var n in t[i])for(var r in t[i][n])return!1;return!0},styleHas:function(e,t){if(!this.styles||!e||""===e)return!1;if(void 0!==t&&!this.styles[t])return!1;var i=void 0===t?this.styles:{0:this.styles[t]};for(var n in i)for(var r in i[n])if(void 0!==i[n][r][e])return!0;return!1},cleanStyle:function(e){if(!this.styles||!e||""===e)return!1;var t,i,n=this.styles,r=0,o=!0,a=0;for(var s in n){for(var l in t=0,n[s]){var c;r++,(c=n[s][l]).hasOwnProperty(e)?(i?c[e]!==i&&(o=!1):i=c[e],c[e]===this[e]&&delete c[e]):o=!1,0!==Object.keys(c).length?t++:delete n[s][l]}0===t&&delete n[s]}for(var u=0;u<this._textLines.length;u++)a+=this._textLines[u].length;o&&r===a&&(this[e]=i,this.removeStyle(e))},removeStyle:function(e){if(this.styles&&e&&""!==e){var t,i,n,r=this.styles;for(i in r){for(n in t=r[i])delete t[n][e],0===Object.keys(t[n]).length&&delete t[n];0===Object.keys(t).length&&delete r[i]}}},_extendStyles:function(e,t){var i=this.get2DCursorLocation(e);this._getLineStyle(i.lineIndex)||this._setLineStyle(i.lineIndex),this._getStyleDeclaration(i.lineIndex,i.charIndex)||this._setStyleDeclaration(i.lineIndex,i.charIndex,{}),x.util.object.extend(this._getStyleDeclaration(i.lineIndex,i.charIndex),t)},get2DCursorLocation:function(e,t){void 0===e&&(e=this.selectionStart);for(var i=t?this._unwrappedTextLines:this._textLines,n=i.length,r=0;r<n;r++){if(e<=i[r].length)return{lineIndex:r,charIndex:e};e-=i[r].length+this.missingNewlineOffset(r)}return{lineIndex:r-1,charIndex:i[r-1].length<e?i[r-1].length:e}},getSelectionStyles:function(e,t,i){void 0===e&&(e=this.selectionStart||0),void 0===t&&(t=this.selectionEnd||e);for(var n=[],r=e;r<t;r++)n.push(this.getStyleAtPosition(r,i));return n},getStyleAtPosition:function(e,t){var i=this.get2DCursorLocation(e);return(t?this.getCompleteStyleDeclaration(i.lineIndex,i.charIndex):this._getStyleDeclaration(i.lineIndex,i.charIndex))||{}},setSelectionStyles:function(e,t,i){void 0===t&&(t=this.selectionStart||0),void 0===i&&(i=this.selectionEnd||t);for(var n=t;n<i;n++)this._extendStyles(n,e);return this._forceClearCache=!0,this},_getStyleDeclaration:function(e,t){var i=this.styles&&this.styles[e];return i?i[t]:null},getCompleteStyleDeclaration:function(e,t){for(var i,n=this._getStyleDeclaration(e,t)||{},r={},o=0;o<this._styleProperties.length;o++)r[i=this._styleProperties[o]]=void 0===n[i]?this[i]:n[i];return r},_setStyleDeclaration:function(e,t,i){this.styles[e][t]=i},_deleteStyleDeclaration:function(e,t){delete this.styles[e][t]},_getLineStyle:function(e){return!!this.styles[e]},_setLineStyle:function(e){this.styles[e]={}},_deleteLineStyle:function(e){delete this.styles[e]}}),function(){function e(e){e.textDecoration&&(e.textDecoration.indexOf("underline")>-1&&(e.underline=!0),e.textDecoration.indexOf("line-through")>-1&&(e.linethrough=!0),e.textDecoration.indexOf("overline")>-1&&(e.overline=!0),delete e.textDecoration)}x.IText=x.util.createClass(x.Text,x.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(e,t){this.callSuper("initialize",e,t),this.initBehavior()},setSelectionStart:function(e){e=Math.max(e,0),this._updateAndFire("selectionStart",e)},setSelectionEnd:function(e){e=Math.min(e,this.text.length),this._updateAndFire("selectionEnd",e)},_updateAndFire:function(e,t){this[e]!==t&&(this._fireSelectionChanged(),this[e]=t),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(e){this.clearContextTop(),this.callSuper("render",e),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(e){this.callSuper("_render",e)},clearContextTop:function(e){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var t=this.canvas.contextTop,i=this.canvas.viewportTransform;t.save(),t.transform(i[0],i[1],i[2],i[3],i[4],i[5]),this.transform(t),this._clearTextArea(t),e||t.restore()}},renderCursorOrSelection:function(){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var e=this._getCursorBoundaries(),t=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(e,t):this.renderSelection(e,t),t.restore()}},_clearTextArea:function(e){var t=this.width+4,i=this.height+4;e.clearRect(-t/2,-i/2,t,i)},_getCursorBoundaries:function(e){void 0===e&&(e=this.selectionStart);var t=this._getLeftOffset(),i=this._getTopOffset(),n=this._getCursorBoundariesOffsets(e);return{left:t,top:i,leftOffset:n.left,topOffset:n.top}},_getCursorBoundariesOffsets:function(e){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var t,i,n,r,o=0,a=0,s=this.get2DCursorLocation(e);n=s.charIndex,i=s.lineIndex;for(var l=0;l<i;l++)o+=this.getHeightOfLine(l);t=this._getLineLeftOffset(i);var c=this.__charBounds[i][n];return c&&(a=c.left),0!==this.charSpacing&&n===this._textLines[i].length&&(a-=this._getWidthOfCharSpacing()),r={top:o,left:t+(a>0?a:0)},"rtl"===this.direction&&(r.left*=-1),this.cursorOffsetCache=r,this.cursorOffsetCache},renderCursor:function(e,t){var i=this.get2DCursorLocation(),n=i.lineIndex,r=i.charIndex>0?i.charIndex-1:0,o=this.getValueOfPropertyAt(n,r,"fontSize"),a=this.scaleX*this.canvas.getZoom(),s=this.cursorWidth/a,l=e.topOffset,c=this.getValueOfPropertyAt(n,r,"deltaY");l+=(1-this._fontSizeFraction)*this.getHeightOfLine(n)/this.lineHeight-o*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(e,t),t.fillStyle=this.cursorColor||this.getValueOfPropertyAt(n,r,"fill"),t.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,t.fillRect(e.left+e.leftOffset-s/2,l+e.top+c,s,o)},renderSelection:function(e,t){for(var i=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,n=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,r=-1!==this.textAlign.indexOf("justify"),o=this.get2DCursorLocation(i),a=this.get2DCursorLocation(n),s=o.lineIndex,l=a.lineIndex,c=o.charIndex<0?0:o.charIndex,u=a.charIndex<0?0:a.charIndex,h=s;h<=l;h++){var d,f=this._getLineLeftOffset(h)||0,g=this.getHeightOfLine(h),p=0,m=0;if(h===s&&(p=this.__charBounds[s][c].left),h>=s&&h<l)m=r&&!this.isEndOfWrapping(h)?this.width:this.getLineWidth(h)||5;else if(h===l)if(0===u)m=this.__charBounds[l][u].left;else{var _=this._getWidthOfCharSpacing();m=this.__charBounds[l][u-1].left+this.__charBounds[l][u-1].width-_}d=g,(this.lineHeight<1||h===l&&this.lineHeight>1)&&(g/=this.lineHeight);var v=e.left+f+p,y=m-p,b=g,S=0;this.inCompositionMode?(t.fillStyle=this.compositionColor||"black",b=1,S=g):t.fillStyle=this.selectionColor,"rtl"===this.direction&&(v=this.width-v-y),t.fillRect(v,e.top+e.topOffset+S,y,b),e.topOffset+=d}},getCurrentCharFontSize:function(){var e=this._getCurrentCharIndex();return this.getValueOfPropertyAt(e.l,e.c,"fontSize")},getCurrentCharColor:function(){var e=this._getCurrentCharIndex();return this.getValueOfPropertyAt(e.l,e.c,"fill")},_getCurrentCharIndex:function(){var e=this.get2DCursorLocation(this.selectionStart,!0),t=e.charIndex>0?e.charIndex-1:0;return{l:e.lineIndex,c:t}}}),x.IText.fromObject=function(t,i){if(e(t),t.styles)for(var n in t.styles)for(var r in t.styles[n])e(t.styles[n][r]);x.Object._fromObject("IText",t,i,"text")}}(),C=x.util.object.clone,x.util.object.extend(x.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var e=this;this.on("added",(function(){var t=e.canvas;t&&(t._hasITextHandlers||(t._hasITextHandlers=!0,e._initCanvasHandlers(t)),t._iTextInstances=t._iTextInstances||[],t._iTextInstances.push(e))}))},initRemovedHandler:function(){var e=this;this.on("removed",(function(){var t=e.canvas;t&&(t._iTextInstances=t._iTextInstances||[],x.util.removeFromArray(t._iTextInstances,e),0===t._iTextInstances.length&&(t._hasITextHandlers=!1,e._removeCanvasHandlers(t)))}))},_initCanvasHandlers:function(e){e._mouseUpITextHandler=function(){e._iTextInstances&&e._iTextInstances.forEach((function(e){e.__isMousedown=!1}))},e.on("mouse:up",e._mouseUpITextHandler)},_removeCanvasHandlers:function(e){e.off("mouse:up",e._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(e,t,i,n){var r;return r={isAborted:!1,abort:function(){this.isAborted=!0}},e.animate("_currentCursorOpacity",t,{duration:i,onComplete:function(){r.isAborted||e[n]()},onChange:function(){e.canvas&&e.selectionStart===e.selectionEnd&&e.renderCursorOrSelection()},abort:function(){return r.isAborted}}),r},_onTickComplete:function(){var e=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout((function(){e._currentTickCompleteState=e._animateCursor(e,0,this.cursorDuration/2,"_tick")}),100)},initDelayedCursor:function(e){var t=this,i=e?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout((function(){t._tick()}),i)},abortCursorAnimation:function(){var e=this._currentTickState||this._currentTickCompleteState,t=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,e&&t&&t.clearContext(t.contextTop||t.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(e){var t=0,i=e-1;if(this._reSpace.test(this._text[i]))for(;this._reSpace.test(this._text[i]);)t++,i--;for(;/\S/.test(this._text[i])&&i>-1;)t++,i--;return e-t},findWordBoundaryRight:function(e){var t=0,i=e;if(this._reSpace.test(this._text[i]))for(;this._reSpace.test(this._text[i]);)t++,i++;for(;/\S/.test(this._text[i])&&i<this._text.length;)t++,i++;return e+t},findLineBoundaryLeft:function(e){for(var t=0,i=e-1;!/\n/.test(this._text[i])&&i>-1;)t++,i--;return e-t},findLineBoundaryRight:function(e){for(var t=0,i=e;!/\n/.test(this._text[i])&&i<this._text.length;)t++,i++;return e+t},searchWordBoundary:function(e,t){for(var i=this._text,n=this._reSpace.test(i[e])?e-1:e,r=i[n],o=x.reNonWord;!o.test(r)&&n>0&&n<i.length;)r=i[n+=t];return o.test(r)&&(n+=1===t?0:1),n},selectWord:function(e){e=e||this.selectionStart;var t=this.searchWordBoundary(e,-1),i=this.searchWordBoundary(e,1);this.selectionStart=t,this.selectionEnd=i,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(e){e=e||this.selectionStart;var t=this.findLineBoundaryLeft(e),i=this.findLineBoundaryRight(e);return this.selectionStart=t,this.selectionEnd=i,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(e){if(!this.isEditing&&this.editable)return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(e),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(e){e._iTextInstances&&e._iTextInstances.forEach((function(e){e.selected=!1,e.isEditing&&e.exitEditing()}))},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(e){if(this.__isMousedown&&this.isEditing){var t=this.getSelectionStartFromPointer(e.e),i=this.selectionStart,n=this.selectionEnd;(t===this.__selectionStartOnMouseDown&&i!==n||i!==t&&n!==t)&&(t>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=t):(this.selectionStart=t,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===i&&this.selectionEnd===n||(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(e,t,i){var n=i.slice(0,e),r=x.util.string.graphemeSplit(n).length;if(e===t)return{selectionStart:r,selectionEnd:r};var o=i.slice(e,t);return{selectionStart:r,selectionEnd:r+x.util.string.graphemeSplit(o).length}},fromGraphemeToStringSelection:function(e,t,i){var n=i.slice(0,e).join("").length;return e===t?{selectionStart:n,selectionEnd:n}:{selectionStart:n,selectionEnd:n+i.slice(e,t).join("").length}},_updateTextarea:function(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){var e=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=e.selectionStart,this.hiddenTextarea.selectionEnd=e.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var e=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=e.selectionEnd,this.inCompositionMode||(this.selectionStart=e.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var e=this._calcTextareaPosition();this.hiddenTextarea.style.left=e.left,this.hiddenTextarea.style.top=e.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var e=this.inCompositionMode?this.compositionStart:this.selectionStart,t=this._getCursorBoundaries(e),i=this.get2DCursorLocation(e),n=i.lineIndex,r=i.charIndex,o=this.getValueOfPropertyAt(n,r,"fontSize")*this.lineHeight,a=t.leftOffset,s=this.calcTransformMatrix(),l={x:t.left+a,y:t.top+t.topOffset+o},c=this.canvas.getRetinaScaling(),u=this.canvas.upperCanvasEl,h=u.width/c,d=u.height/c,f=h-o,g=d-o,p=u.clientWidth/h,m=u.clientHeight/d;return l=x.util.transformPoint(l,s),(l=x.util.transformPoint(l,this.canvas.viewportTransform)).x*=p,l.y*=m,l.x<0&&(l.x=0),l.x>f&&(l.x=f),l.y<0&&(l.y=0),l.y>g&&(l.y=g),l.x+=this.canvas._offset.left,l.y+=this.canvas._offset.top,{left:l.x+"px",top:l.y+"px",fontSize:o+"px",charHeight:o}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var e=this._textBeforeEdit!==this.text,t=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,t&&(t.blur&&t.blur(),t.parentNode&&t.parentNode.removeChild(t)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),e&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),e&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var e in this.styles)this._textLines[e]||delete this.styles[e]},removeStyleFromTo:function(e,t){var i,n,r=this.get2DCursorLocation(e,!0),o=this.get2DCursorLocation(t,!0),a=r.lineIndex,s=r.charIndex,l=o.lineIndex,c=o.charIndex;if(a!==l){if(this.styles[a])for(i=s;i<this._unwrappedTextLines[a].length;i++)delete this.styles[a][i];if(this.styles[l])for(i=c;i<this._unwrappedTextLines[l].length;i++)(n=this.styles[l][i])&&(this.styles[a]||(this.styles[a]={}),this.styles[a][s+i-c]=n);for(i=a+1;i<=l;i++)delete this.styles[i];this.shiftLineStyles(l,a-l)}else if(this.styles[a]){n=this.styles[a];var u,h,d=c-s;for(i=s;i<c;i++)delete n[i];for(h in this.styles[a])(u=parseInt(h,10))>=c&&(n[u-d]=n[h],delete n[h])}},shiftLineStyles:function(e,t){var i=C(this.styles);for(var n in this.styles){var r=parseInt(n,10);r>e&&(this.styles[r+t]=i[r],i[r-t]||delete this.styles[r])}},restartCursorIfNeeded:function(){this._currentTickState&&!this._currentTickState.isAborted&&this._currentTickCompleteState&&!this._currentTickCompleteState.isAborted||this.initDelayedCursor()},insertNewlineStyleObject:function(e,t,i,n){var r,o={},a=!1,s=this._unwrappedTextLines[e].length===t;for(var l in i||(i=1),this.shiftLineStyles(e,i),this.styles[e]&&(r=this.styles[e][0===t?t:t-1]),this.styles[e]){var c=parseInt(l,10);c>=t&&(a=!0,o[c-t]=this.styles[e][l],s&&0===t||delete this.styles[e][l])}var u=!1;for(a&&!s&&(this.styles[e+i]=o,u=!0),u&&i--;i>0;)n&&n[i-1]?this.styles[e+i]={0:C(n[i-1])}:r?this.styles[e+i]={0:C(r)}:delete this.styles[e+i],i--;this._forceClearCache=!0},insertCharStyleObject:function(e,t,i,n){this.styles||(this.styles={});var r=this.styles[e],o=r?C(r):{};for(var a in i||(i=1),o){var s=parseInt(a,10);s>=t&&(r[s+i]=o[s],o[s-i]||delete r[s])}if(this._forceClearCache=!0,n)for(;i--;)Object.keys(n[i]).length&&(this.styles[e]||(this.styles[e]={}),this.styles[e][t+i]=C(n[i]));else if(r)for(var l=r[t?t-1:1];l&&i--;)this.styles[e][t+i]=C(l)},insertNewStyleBlock:function(e,t,i){for(var n=this.get2DCursorLocation(t,!0),r=[0],o=0,a=0;a<e.length;a++)"\n"===e[a]?r[++o]=0:r[o]++;for(r[0]>0&&(this.insertCharStyleObject(n.lineIndex,n.charIndex,r[0],i),i=i&&i.slice(r[0]+1)),o&&this.insertNewlineStyleObject(n.lineIndex,n.charIndex+r[0],o),a=1;a<o;a++)r[a]>0?this.insertCharStyleObject(n.lineIndex+a,0,r[a],i):i&&this.styles[n.lineIndex+a]&&i[0]&&(this.styles[n.lineIndex+a][0]=i[0]),i=i&&i.slice(r[a]+1);r[a]>0&&this.insertCharStyleObject(n.lineIndex+a,0,r[a],i)},setSelectionStartEndWithShift:function(e,t,i){i<=e?(t===e?this._selectionDirection="left":"right"===this._selectionDirection&&(this._selectionDirection="left",this.selectionEnd=e),this.selectionStart=i):i>e&&i<t?"right"===this._selectionDirection?this.selectionEnd=i:this.selectionStart=i:(t===e?this._selectionDirection="right":"left"===this._selectionDirection&&(this._selectionDirection="right",this.selectionStart=t),this.selectionEnd=i)},setSelectionInBoundaries:function(){var e=this.text.length;this.selectionStart>e?this.selectionStart=e:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>e?this.selectionEnd=e:this.selectionEnd<0&&(this.selectionEnd=0)}}),x.util.object.extend(x.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(e){if(this.canvas){this.__newClickTime=+new Date;var t=e.pointer;this.isTripleClick(t)&&(this.fire("tripleclick",e),this._stopEvent(e.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=t,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(e){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===e.x&&this.__lastPointer.y===e.y},_stopEvent:function(e){e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(e){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(e.e))},tripleClickHandler:function(e){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(e.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(e){!this.canvas||!this.editable||e.e.button&&1!==e.e.button||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(e.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(e){!this.canvas||!this.editable||e.e.button&&1!==e.e.button||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(e){if(this.__isMousedown=!1,!(!this.editable||this.group||e.transform&&e.transform.actionPerformed||e.e.button&&1!==e.e.button)){if(this.canvas){var t=this.canvas._activeObject;if(t&&t!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(e.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(e){var t=this.getSelectionStartFromPointer(e),i=this.selectionStart,n=this.selectionEnd;e.shiftKey?this.setSelectionStartEndWithShift(i,n,t):(this.selectionStart=t,this.selectionEnd=t),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(e){for(var t,i=this.getLocalPointer(e),n=0,r=0,o=0,a=0,s=0,l=0,c=this._textLines.length;l<c&&o<=i.y;l++)o+=this.getHeightOfLine(l)*this.scaleY,s=l,l>0&&(a+=this._textLines[l-1].length+this.missingNewlineOffset(l-1));r=this._getLineLeftOffset(s)*this.scaleX,t=this._textLines[s],"rtl"===this.direction&&(i.x=this.width*this.scaleX-i.x+r);for(var u=0,h=t.length;u<h&&(n=r,(r+=this.__charBounds[s][u].kernedWidth*this.scaleX)<=i.x);u++)a++;return this._getNewSelectionStartFromOffset(i,n,r,a,h)},_getNewSelectionStartFromOffset:function(e,t,i,n,r){var o=e.x-t,a=i-e.x,s=n+(a>o||a<0?0:1);return this.flipX&&(s=r-s),s>this._text.length&&(s=this._text.length),s}}),x.util.object.extend(x.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=x.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var e=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+e.top+"; left: "+e.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding\uff70top: "+e.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):x.document.body.appendChild(this.hiddenTextarea),x.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),x.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),x.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),x.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),x.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),x.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),x.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),x.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),x.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(x.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(e){if(this.isEditing){var t="rtl"===this.direction?this.keysMapRtl:this.keysMap;if(e.keyCode in t)this[t[e.keyCode]](e);else{if(!(e.keyCode in this.ctrlKeysMapDown)||!e.ctrlKey&&!e.metaKey)return;this[this.ctrlKeysMapDown[e.keyCode]](e)}e.stopImmediatePropagation(),e.preventDefault(),e.keyCode>=33&&e.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(e){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:e.keyCode in this.ctrlKeysMapUp&&(e.ctrlKey||e.metaKey)&&(this[this.ctrlKeysMapUp[e.keyCode]](e),e.stopImmediatePropagation(),e.preventDefault(),this.canvas&&this.canvas.requestRenderAll())},onInput:function(e){var t=this.fromPaste;if(this.fromPaste=!1,e&&e.stopPropagation(),this.isEditing){var i,n,r,o,a,s=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,l=this._text.length,c=s.length,u=c-l,h=this.selectionStart,d=this.selectionEnd,f=h!==d;if(""===this.hiddenTextarea.value)return this.styles={},this.updateFromTextArea(),this.fire("changed"),void(this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll()));var g=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),p=h>g.selectionStart;f?(i=this._text.slice(h,d),u+=d-h):c<l&&(i=p?this._text.slice(d+u,d):this._text.slice(h,h-u)),n=s.slice(g.selectionEnd-u,g.selectionEnd),i&&i.length&&(n.length&&(r=this.getSelectionStyles(h,h+1,!1),r=n.map((function(){return r[0]}))),f?(o=h,a=d):p?(o=d-i.length,a=d):(o=d,a=d+i.length),this.removeStyleFromTo(o,a)),n.length&&(t&&n.join("")===x.copiedText&&!x.disableStyleCopyPaste&&(r=x.copiedTextStyle),this.insertNewStyleBlock(n,h,r)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(e){this.compositionStart=e.target.selectionStart,this.compositionEnd=e.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(x.copiedText=this.getSelectedText(),x.disableStyleCopyPaste?x.copiedTextStyle=null:x.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(e){return e&&e.clipboardData||x.window.clipboardData},_getWidthBeforeCursor:function(e,t){var i,n=this._getLineLeftOffset(e);return t>0&&(n+=(i=this.__charBounds[e][t-1]).left+i.width),n},getDownCursorOffset:function(e,t){var i=this._getSelectionForOffset(e,t),n=this.get2DCursorLocation(i),r=n.lineIndex;if(r===this._textLines.length-1||e.metaKey||34===e.keyCode)return this._text.length-i;var o=n.charIndex,a=this._getWidthBeforeCursor(r,o),s=this._getIndexOnLine(r+1,a);return this._textLines[r].slice(o).length+s+1+this.missingNewlineOffset(r)},_getSelectionForOffset:function(e,t){return e.shiftKey&&this.selectionStart!==this.selectionEnd&&t?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(e,t){var i=this._getSelectionForOffset(e,t),n=this.get2DCursorLocation(i),r=n.lineIndex;if(0===r||e.metaKey||33===e.keyCode)return-i;var o=n.charIndex,a=this._getWidthBeforeCursor(r,o),s=this._getIndexOnLine(r-1,a),l=this._textLines[r].slice(0,o),c=this.missingNewlineOffset(r-1);return-this._textLines[r-1].length+s-l.length+(1-c)},_getIndexOnLine:function(e,t){for(var i,n,r=this._textLines[e],o=this._getLineLeftOffset(e),a=0,s=0,l=r.length;s<l;s++)if((o+=i=this.__charBounds[e][s].width)>t){n=!0;var c=o-i,u=o,h=Math.abs(c-t);a=Math.abs(u-t)<h?s:s-1;break}return n||(a=r.length-1),a},moveCursorDown:function(e){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",e)},moveCursorUp:function(e){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorUpOrDown("Up",e)},_moveCursorUpOrDown:function(e,t){var i=this["get"+e+"CursorOffset"](t,"right"===this._selectionDirection);t.shiftKey?this.moveCursorWithShift(i):this.moveCursorWithoutShift(i),0!==i&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(e){var t="left"===this._selectionDirection?this.selectionStart+e:this.selectionEnd+e;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,t),0!==e},moveCursorWithoutShift:function(e){return e<0?(this.selectionStart+=e,this.selectionEnd=this.selectionStart):(this.selectionEnd+=e,this.selectionStart=this.selectionEnd),0!==e},moveCursorLeft:function(e){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorLeftOrRight("Left",e)},_move:function(e,t,i){var n;if(e.altKey)n=this["findWordBoundary"+i](this[t]);else{if(!e.metaKey&&35!==e.keyCode&&36!==e.keyCode)return this[t]+="Left"===i?-1:1,!0;n=this["findLineBoundary"+i](this[t])}if(void 0!==typeof n&&this[t]!==n)return this[t]=n,!0},_moveLeft:function(e,t){return this._move(e,t,"Left")},_moveRight:function(e,t){return this._move(e,t,"Right")},moveCursorLeftWithoutShift:function(e){var t=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&0!==this.selectionStart&&(t=this._moveLeft(e,"selectionStart")),this.selectionEnd=this.selectionStart,t},moveCursorLeftWithShift:function(e){return"right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveLeft(e,"selectionEnd"):0!==this.selectionStart?(this._selectionDirection="left",this._moveLeft(e,"selectionStart")):void 0},moveCursorRight:function(e){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",e)},_moveCursorLeftOrRight:function(e,t){var i="moveCursor"+e+"With";this._currentCursorOpacity=1,t.shiftKey?i+="Shift":i+="outShift",this[i](t)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(e){return"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveRight(e,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection="right",this._moveRight(e,"selectionEnd")):void 0},moveCursorRightWithoutShift:function(e){var t=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(t=this._moveRight(e,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,t},removeChars:function(e,t){void 0===t&&(t=e+1),this.removeStyleFromTo(e,t),this._text.splice(e,t-e),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(e,t,i,n){void 0===n&&(n=i),n>i&&this.removeStyleFromTo(i,n);var r=x.util.string.graphemeSplit(e);this.insertNewStyleBlock(r,i,t),this._text=[].concat(this._text.slice(0,i),r,this._text.slice(n)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var e=x.util.toFixed,t=/  +/g;x.util.object.extend(x.Text.prototype,{_toSVG:function(){var e=this._getSVGLeftTopOffsets(),t=this._getSVGTextAndBg(e.textTop,e.textLeft);return this._wrapSVGTextAndBg(t)},toSVG:function(e){return this._createBaseSVGMarkup(this._toSVG(),{reviver:e,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(e){var t=this.getSvgTextDecoration(this);return[e.textBgRects.join(""),'\t\t<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",t?'text-decoration="'+t+'" ':"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",e.textSpans.join(""),"</text>\n"]},_getSVGTextAndBg:function(e,t){var i,n=[],r=[],o=e;this._setSVGBg(r);for(var a=0,s=this._textLines.length;a<s;a++)i=this._getLineLeftOffset(a),(this.textBackgroundColor||this.styleHas("textBackgroundColor",a))&&this._setSVGTextLineBg(r,a,t+i,o),this._setSVGTextLineText(n,a,t+i,o),o+=this.getHeightOfLine(a);return{textSpans:n,textBgRects:r}},_createTextCharSpan:function(i,n,r,o){var a=i!==i.trim()||i.match(t),s=this.getSvgSpanStyles(n,a),l=s?'style="'+s+'"':"",c=n.deltaY,u="",h=x.Object.NUM_FRACTION_DIGITS;return c&&(u=' dy="'+e(c,h)+'" '),['<tspan x="',e(r,h),'" y="',e(o,h),'" ',u,l,">",x.util.string.escapeXml(i),"</tspan>"].join("")},_setSVGTextLineText:function(e,t,i,n){var r,o,a,s,l,c=this.getHeightOfLine(t),u=-1!==this.textAlign.indexOf("justify"),h="",d=0,f=this._textLines[t];n+=c*(1-this._fontSizeFraction)/this.lineHeight;for(var g=0,p=f.length-1;g<=p;g++)l=g===p||this.charSpacing,h+=f[g],a=this.__charBounds[t][g],0===d?(i+=a.kernedWidth-a.width,d+=a.width):d+=a.kernedWidth,u&&!l&&this._reSpaceAndTab.test(f[g])&&(l=!0),l||(r=r||this.getCompleteStyleDeclaration(t,g),o=this.getCompleteStyleDeclaration(t,g+1),l=this._hasStyleChangedForSvg(r,o)),l&&(s=this._getStyleDeclaration(t,g)||{},e.push(this._createTextCharSpan(h,s,i,n)),h="",r=o,i+=d,d=0)},_pushTextBgRect:function(t,i,n,r,o,a){var s=x.Object.NUM_FRACTION_DIGITS;t.push("\t\t<rect ",this._getFillAttributes(i),' x="',e(n,s),'" y="',e(r,s),'" width="',e(o,s),'" height="',e(a,s),'"></rect>\n')},_setSVGTextLineBg:function(e,t,i,n){for(var r,o,a=this._textLines[t],s=this.getHeightOfLine(t)/this.lineHeight,l=0,c=0,u=this.getValueOfPropertyAt(t,0,"textBackgroundColor"),h=0,d=a.length;h<d;h++)r=this.__charBounds[t][h],(o=this.getValueOfPropertyAt(t,h,"textBackgroundColor"))!==u?(u&&this._pushTextBgRect(e,u,i+c,n,l,s),c=r.left,l=r.width,u=o):l+=r.kernedWidth;o&&this._pushTextBgRect(e,o,i+c,n,l,s)},_getFillAttributes:function(e){var t=e&&"string"==typeof e?new x.Color(e):"";return t&&t.getSource()&&1!==t.getAlpha()?'opacity="'+t.getAlpha()+'" fill="'+t.setAlpha(1).toRgb()+'"':'fill="'+e+'"'},_getSVGLineTopOffset:function(e){for(var t,i=0,n=0;n<e;n++)i+=this.getHeightOfLine(n);return t=this.getHeightOfLine(n),{lineTop:i,offset:(this._fontSizeMult-this._fontSizeFraction)*t/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(e){return x.Object.prototype.getSvgStyles.call(this,e)+" white-space: pre;"}})}(),function(e){var t=e.fabric||(e.fabric={});t.Textbox=t.util.createClass(t.IText,t.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:t.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(e){for(var t=0,i=0,n=0,r={},o=0;o<e.graphemeLines.length;o++)"\n"===e.graphemeText[n]&&o>0?(i=0,n++,t++):!this.splitByGrapheme&&this._reSpaceAndTab.test(e.graphemeText[n])&&o>0&&(i++,n++),r[o]={line:t,offset:i},n+=e.graphemeLines[o].length,i+=e.graphemeLines[o].length;return r},styleHas:function(e,i){if(this._styleMap&&!this.isWrapping){var n=this._styleMap[i];n&&(i=n.line)}return t.Text.prototype.styleHas.call(this,e,i)},isEmptyStyles:function(e){if(!this.styles)return!0;var t,i,n=0,r=!1,o=this._styleMap[e],a=this._styleMap[e+1];for(var s in o&&(e=o.line,n=o.offset),a&&(r=a.line===e,t=a.offset),i=void 0===e?this.styles:{line:this.styles[e]})for(var l in i[s])if(l>=n&&(!r||l<t))for(var c in i[s][l])return!1;return!0},_getStyleDeclaration:function(e,t){if(this._styleMap&&!this.isWrapping){var i=this._styleMap[e];if(!i)return null;e=i.line,t=i.offset+t}return this.callSuper("_getStyleDeclaration",e,t)},_setStyleDeclaration:function(e,t,i){var n=this._styleMap[e];e=n.line,t=n.offset+t,this.styles[e][t]=i},_deleteStyleDeclaration:function(e,t){var i=this._styleMap[e];e=i.line,t=i.offset+t,delete this.styles[e][t]},_getLineStyle:function(e){var t=this._styleMap[e];return!!this.styles[t.line]},_setLineStyle:function(e){var t=this._styleMap[e];this.styles[t.line]={}},_wrapText:function(e,t){var i,n=[];for(this.isWrapping=!0,i=0;i<e.length;i++)n=n.concat(this._wrapLine(e[i],i,t));return this.isWrapping=!1,n},_measureWord:function(e,t,i){var n,r=0;i=i||0;for(var o=0,a=e.length;o<a;o++)r+=this._getGraphemeBox(e[o],t,o+i,n,!0).kernedWidth,n=e[o];return r},_wrapLine:function(e,i,n,r){var o=0,a=this.splitByGrapheme,s=[],l=[],c=a?t.util.string.graphemeSplit(e):e.split(this._wordJoiners),u="",h=0,d=a?"":" ",f=0,g=0,p=0,m=!0,_=this._getWidthOfCharSpacing();r=r||0,0===c.length&&c.push([]),n-=r;for(var v=0;v<c.length;v++)u=a?c[v]:t.util.string.graphemeSplit(c[v]),f=this._measureWord(u,i,h),h+=u.length,(o+=g+f-_)>n&&!m?(s.push(l),l=[],o=f,m=!0):o+=_,m||a||l.push(d),l=l.concat(u),g=a?0:this._measureWord([d],i,h),h++,m=!1,f>p&&(p=f);return v&&s.push(l),p+r>this.dynamicMinWidth&&(this.dynamicMinWidth=p-_+r),s},isEndOfWrapping:function(e){return!this._styleMap[e+1]||this._styleMap[e+1].line!==this._styleMap[e].line},missingNewlineOffset:function(e){return this.splitByGrapheme?this.isEndOfWrapping(e)?1:0:1},_splitTextIntoLines:function(e){for(var i=t.Text.prototype._splitTextIntoLines.call(this,e),n=this._wrapText(i.lines,this.width),r=new Array(n.length),o=0;o<n.length;o++)r[o]=n[o].join("");return i.lines=r,i.graphemeLines=n,i},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var e={};for(var t in this._styleMap)this._textLines[t]&&(e[this._styleMap[t].line]=1);for(var t in this.styles)e[t]||delete this.styles[t]},toObject:function(e){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(e))}}),t.Textbox.fromObject=function(e,i){return t.Object._fromObject("Textbox",e,i,"text")}}(t),function(){var e=x.controlsUtils,t=e.scaleSkewCursorStyleHandler,i=e.scaleCursorStyleHandler,n=e.scalingEqually,r=e.scalingYOrSkewingX,o=e.scalingXOrSkewingY,a=e.scaleOrSkewActionName,s=x.Object.prototype.controls;if(s.ml=new x.Control({x:-.5,y:0,cursorStyleHandler:t,actionHandler:o,getActionName:a}),s.mr=new x.Control({x:.5,y:0,cursorStyleHandler:t,actionHandler:o,getActionName:a}),s.mb=new x.Control({x:0,y:.5,cursorStyleHandler:t,actionHandler:r,getActionName:a}),s.mt=new x.Control({x:0,y:-.5,cursorStyleHandler:t,actionHandler:r,getActionName:a}),s.tl=new x.Control({x:-.5,y:-.5,cursorStyleHandler:i,actionHandler:n}),s.tr=new x.Control({x:.5,y:-.5,cursorStyleHandler:i,actionHandler:n}),s.bl=new x.Control({x:-.5,y:.5,cursorStyleHandler:i,actionHandler:n}),s.br=new x.Control({x:.5,y:.5,cursorStyleHandler:i,actionHandler:n}),s.mtr=new x.Control({x:0,y:-.5,actionHandler:e.rotationWithSnapping,cursorStyleHandler:e.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),x.Textbox){var l=x.Textbox.prototype.controls={};l.mtr=s.mtr,l.tr=s.tr,l.br=s.br,l.tl=s.tl,l.bl=s.bl,l.mt=s.mt,l.mb=s.mb,l.mr=new x.Control({x:.5,y:0,actionHandler:e.changeWidth,cursorStyleHandler:t,actionName:"resizing"}),l.ml=new x.Control({x:-.5,y:0,actionHandler:e.changeWidth,cursorStyleHandler:t,actionName:"resizing"})}}()},192:()=>{},898:()=>{},245:()=>{}},I={};function O(e){var t=I[e];if(void 0!==t)return t.exports;var i=I[e]={exports:{}};return E[e](i,i.exports,O),i.exports}O.d=(e,t)=>{for(var i in t)O.o(t,i)&&!O.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},O.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var A={};(()=>{let e;O.d(A,{R:()=>e}),e="undefined"!=typeof document&&"undefined"!=typeof window?O(653).fabric:{version:"5.2.1"}})();var R=A.R;class D{get mediaType(){return this._mediaType}get drawingLayerId(){return this._drawingLayerId}constructor(e,t){this._zIndex=null,this._drawingLayer=null,this._drawingLayerId=null,this._mapStyle=new Map,this.mapEvent_Callbacks=new Map([["selected",new Map],["deselected",new Map],["mousedown",new Map],["mouseup",new Map],["dblclick",new Map],["mouseover",new Map],["mouseout",new Map]]),this.mapNoteName_Content=new Map([]),this.isDrawingItem=!0,this._setFabricObject(e),this._mediaType=e.type,this.styleSelector="default",this.styleId=t}_setFabricObject(e){this._fabricObject=e,this._fabricObject.on("selected",(()=>{this.styleSelector="selected"})),this._fabricObject.on("deselected",(()=>{this._fabricObject.canvas&&this._fabricObject.canvas.getActiveObjects().includes(this._fabricObject)?this.styleSelector="selected":this.styleSelector="default","textbox"===this._fabricObject.type&&(this._fabricObject.isEditing&&this._fabricObject.exitEditing(),this._fabricObject.selected=!1)})),e.getDrawingItem=()=>this}_getFabricObject(){return this._fabricObject}_on(e,t){if(!t)return;const i=e.toLowerCase(),n=this.mapEvent_Callbacks.get(i);if(!n)throw new Error(`Event '${e}' does not exist.`);let r=n.get(t);r||(r=e=>{const i=e.e;if(!i)return void(t&&t.apply(this,[{targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null}]));const n={targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null};if(this._drawingLayer){let e,t,r,o;const a=i.target.getBoundingClientRect();e=a.left,t=a.top,r=e+window.scrollX,o=t+window.scrollY;const s=this._drawingLayer.fabricCanvas.lowerCanvasEl.width,l=this._drawingLayer.fabricCanvas.lowerCanvasEl.height,c=parseFloat(window.getComputedStyle(this._drawingLayer.fabricCanvas.lowerCanvasEl).width),u=parseFloat(window.getComputedStyle(this._drawingLayer.fabricCanvas.lowerCanvasEl).height),h=c/u,d=s/l,f=this._drawingLayer._getObjectFit();let g,p,m,_,v=1;if("contain"===f)h<d?(v=c/s,g=e+this.get("x")*v,p=t+this.get("y")*v+(u-l*v)/2,m=r+this.get("x")*v,_=o+this.get("y")*v+(u-l*v)/2):(v=u/l,g=e+this.get("x")*v+(c-s*v)/2,p=t+this.get("y")*v,m=r+this.get("x")*v+(c-s*v)/2,_=o+this.get("y")*v);else if("cover"===f)if(h<d){v=u/l;let i=this.get("x")*v-(s*v-c)/2;i=Math.max(i,0),i=Math.min(i,c),g=e+i,p=t+this.get("y")*v,m=r+i,_=o+this.get("y")*v}else{v=c/s;let i=this.get("y")*v-(l*v-u)/2;i=Math.max(i,0),i=Math.min(i,u),g=e+this.get("x")*v,p=t+i,m=r+this.get("x")*v,_=o+i}n.itemClientX=Math.round(g),n.itemClientY=Math.round(p),n.itemPageX=Math.round(m),n.itemPageY=Math.round(_)}for(let t of Object.getOwnPropertyNames(n))Object.defineProperty(i,t,{value:n[t],writable:!0});t&&t.apply(this,[i])},n.set(t,r),this._fabricObject.on("dblclick"===i?"mousedblclick":i,r))}on(e,t){this._on(e,t)}_off(e,t){const i=e.toLowerCase(),n=this.mapEvent_Callbacks.get(i);if(!n)throw new Error(`Event '${e}' does not exist.`);let r=n.get(t);r&&(n.delete(t),this._fabricObject.off("dblclick"===i?"mousedblclick":i,r))}off(e,t){this._off(e,t)}_setEditable(e){const t=this._fabricObject;e?(t.selectable=!0,t.hasControls=!0,t.hoverCursor=null):(t.selectable=!1,t.hasControls=!1,t.hoverCursor="default")}hasNote(e){return this.mapNoteName_Content.has(e)}addNote(e,t){if(this.hasNote(e.name)&&!t)throw new Error("A note with the same name already exists, please use a different name.");const i=e.content?JSON.parse(JSON.stringify(e.content)):e.content;this.mapNoteName_Content.set(e.name,[i])}getNote(e){const t=this.mapNoteName_Content.get(e);return t?1===t.length?{name:e,content:t[0]?JSON.parse(JSON.stringify(t[0])):t[0]}:{name:e,content:JSON.parse(JSON.stringify(t))}:null}getNotes(){const e=[];for(let t of this.mapNoteName_Content){let i=1===t[1].length?t[1][0]:t[1];i=i?JSON.parse(JSON.stringify(i)):i,e.push({name:t[0],content:i})}return e}updateNote(e,t,i){const n=this.mapNoteName_Content.get(e);if(!n)throw new Error("The note name does not exist.");i||(n.length=0),t=t?JSON.parse(JSON.stringify(t)):t,n.push(t)}deleteNote(e){this.mapNoteName_Content.delete(e)}clearNotes(){this.mapNoteName_Content.clear()}_extendSet(e,t){return!1}_extendGet(e){}set(e,t){if(!this._extendSet(e,t))if("x"===e){const e=this._fabricObject.group;e?(this._fabricObject.set("left",t-e.left-e.width/2),e.addWithUpdate()):this._fabricObject.set("left",t)}else if("y"===e){const e=this._fabricObject.group;e?(this._fabricObject.set("top",t-e.top-e.height/2),e.addWithUpdate()):this._fabricObject.set("top",t)}else"styleId"===e?this.styleId=t:this._fabricObject.set(e,t);["vertices","startPoint","endPoint","x","y","left","top","width","height","scaleX","scaleY","skewX","skewY","padding","angle","strokeWidth"].includes(e)&&this._fabricObject.setCoords()}get(e){let t=this._extendGet(e);if(void 0===t)if("x"===e){const e=this._fabricObject.group;t=e?this._fabricObject.get("left")+e.left+e.width/2:this._fabricObject.get("left")}else if("y"===e){const e=this._fabricObject.group;t=e?this._fabricObject.get("top")+e.top+e.height/2:this._fabricObject.get("top")}else t=["type","mediaType"].includes(e)?this.mediaType:"styleSelector"===e?this.styleSelector:"styleId"===e?this.styleId:"drawingLayerId"===e?this.drawingLayerId:this._fabricObject.get(e);return t}setAttribute(e,t){this.set(e,t)}getAttribute(e){return this.get(e)}}function k(e,t,i){let n=i.points[this.pointIndex].x-i.pathOffset.x,r=i.points[this.pointIndex].y-i.pathOffset.y;return R.util.transformPoint({x:n,y:r},i.calcTransformMatrix())}function L(e){let t=new R.Point(e.strokeUniform?1/e.scaleX:1,e.strokeUniform?1/e.scaleY:1).multiply(e.strokeWidth);return new R.Point(e.width+t.x,e.height+t.y)}function M(e,t,i,n){let r=t.target,o=r.controls[r.__corner],a=r.toLocalPoint(new R.Point(i,n),"center","center"),s=L(r),l=r._getTransformedDimensions(0,0),c={x:a.x*s.x/l.x+r.pathOffset.x,y:a.y*s.y/l.y+r.pathOffset.y};return r.points[o.pointIndex]=c,!0}function F(e,t){return function(i,n,r,o){let a=n.target,s=R.util.transformPoint({x:a.points[e].x-a.pathOffset.x,y:a.points[e].y-a.pathOffset.y},a.calcTransformMatrix()),l=t(i,n,r,o);a._setPositionDimensions({});let c=L(a),u=(a.points[e].x-a.pathOffset.x)/c.x,h=(a.points[e].y-a.pathOffset.y)/c.y;return a.setPositionByOrigin(s,u+.5,h+.5),l}}D.arrMediaTypes=["rect","arc","polygon","image","text","line","path"],D.arrStyleSelectors=["default","selected"];class P extends D{constructor(e,t){super(new R.Polygon(e,{objectCaching:!1}),t);const i=this._fabricObject;let n=i.points.length-1;i.controls=i.points.reduce((function(e,t,i){return e["p"+i]=new R.Control({positionHandler:k,actionHandler:F(i>0?i-1:n,M),actionName:"modifyPolygon",pointIndex:i}),e}),{})}_extendSet(e,t){if("vertices"===e){const e=this._fabricObject;if(e.group){const i=e.group;e.points=t.map((e=>({x:e.x-i.left-i.width/2,y:e.y-i.top-i.height/2}))),i.addWithUpdate()}else e.points=t;const i=e.points.length-1;return e.controls=e.points.reduce((function(e,t,n){return e["p"+n]=new R.Control({positionHandler:k,actionHandler:F(n>0?n-1:i,M),actionName:"modifyPolygon",pointIndex:n}),e}),{}),e._setPositionDimensions({}),!0}}_extendGet(e){if("vertices"===e){const e=[],t=this._fabricObject;if(t.selectable&&!t.group)for(let i in t.oCoords)e.push({x:t.oCoords[i].x,y:t.oCoords[i].y});else for(let i of t.points){let n=i.x-t.pathOffset.x,r=i.y-t.pathOffset.y;const o=R.util.transformPoint({x:n,y:r},t.calcTransformMatrix());e.push({x:o.x,y:o.y})}return e}}}const B=e=>{let t=(e=>e.split("\n").map((e=>e.split("\t"))))(e);return(e=>{for(let t=0;;t++){let i=-1;for(let n=0;n<e.length;n++){let r=e[n][t];void 0!==r&&r.length>i&&(i=r.length)}if(-1===i)break;for(let n=0;n<e.length;n++){if(t>=e[n].length-1)continue;let r=" ".repeat(i+2-e[n][t].length);e[n][t]=e[n][t].concat(r)}}})(t),(e=>{let t="";for(let i=0;i<e.length;i++)t=t.concat(...e[i],i===e.length-1?"":"\n");return t})(t)};class N extends D{constructor(e,t,i,n,r){if("number"!=typeof n||n<=0)throw new RangeError("Invalid width.");super(new R.Textbox(B(e),{left:t,top:i,width:n}),r),this._mediaType="text",this._text=e}_extendSet(e,t){if("text"===e)return this._text=t,this._fabricObject.set("text",B(t)),!0}_extendGet(e){if("text"===e)return this._text}}"undefined"!=typeof document&&"undefined"!=typeof window&&(R.StaticCanvas.prototype.dispose=function(){return this.isRendering&&(R.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject((function(e){e.dispose&&e.dispose()})),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),R.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},R.Object.prototype.transparentCorners=!1,R.Object.prototype.cornerSize=20,R.Object.prototype.touchCornerSize=100,R.Object.prototype.cornerColor="rgb(254,142,20)",R.Object.prototype.cornerStyle="circle",R.Object.prototype.strokeUniform=!0,R.Object.prototype.hasBorders=!1,R.Canvas.prototype.containerClass="",R.Canvas.prototype.getPointer=function(e,t){if(this._absolutePointer&&!t)return this._absolutePointer;if(this._pointer&&t)return this._pointer;var i,n=this.upperCanvasEl,r=R.util.getPointer(e,n),o=n.getBoundingClientRect(),a=o.width||0,s=o.height||0;a&&s||("top"in o&&"bottom"in o&&(s=Math.abs(o.top-o.bottom)),"right"in o&&"left"in o&&(a=Math.abs(o.right-o.left))),this.calcOffset(),r.x=r.x-this._offset.left,r.y=r.y-this._offset.top,t||(r=this.restorePointerVpt(r));var l=this.getRetinaScaling();if(1!==l&&(r.x/=l,r.y/=l),0!==a&&0!==s){var c=window.getComputedStyle(n).objectFit,u=n.width,h=n.height,d=a,f=s;i={width:u/d,height:h/f};var g,p,m=u/h,_=d/f;return"contain"===c?m>_?(g=d,p=d/m,{x:r.x*i.width,y:(r.y-(f-p)/2)*i.width}):(g=f*m,p=f,{x:(r.x-(d-g)/2)*i.height,y:r.y*i.height}):"cover"===c?m>_?{x:(u-i.height*d)/2+r.x*i.height,y:r.y*i.height}:{x:r.x*i.width,y:(h-i.width*f)/2+r.y*i.width}:{x:r.x*i.width,y:r.y*i.height}}return i={width:1,height:1},{x:r.x*i.width,y:r.y*i.height}},R.Canvas.prototype._onTouchStart=function(e){var t=this.findTarget(e);!this.allowTouchScrolling&&e.cancelable&&e.preventDefault&&e.preventDefault(),t&&e.cancelable&&e.preventDefault&&e.preventDefault(),null===this.mainTouchId&&(this.mainTouchId=this.getPointerId(e)),this.__onMouseDown(e),this._resetTransformEventData();var i=this.upperCanvasEl,n=this._getEventPrefix();R.util.addListener(R.document,"touchend",this._onTouchEnd,{passive:!1}),R.util.addListener(R.document,"touchmove",this._onMouseMove,{passive:!1}),R.util.removeListener(i,n+"down",this._onMouseDown)},R.Textbox.prototype._wrapLine=function(e,t,i,n){const r=e.match(/[\u3040-\u30ff\u3400-\u4dbf\u4e00-\u9fff\uf900-\ufaff\uff66-\uff9f]/g),o=!(!r||!r.length);var a=0,s=this.splitByGrapheme||o,l=[],c=[],u=s?R.util.string.graphemeSplit(e):e.split(this._wordJoiners),h="",d=0,f=s?"":" ",g=0,p=0,m=0,_=!0,v=this._getWidthOfCharSpacing();n=n||0,0===u.length&&u.push([]),i-=n;for(var y=0;y<u.length;y++)h=s?u[y]:R.util.string.graphemeSplit(u[y]),g=this._measureWord(h,t,d),d+=h.length,(a+=p+g-v)>i&&!_?(l.push(c),c=[],a=g,_=!0):a+=v,_||s||c.push(f),c=c.concat(h),p=s?0:this._measureWord([f],t,d),d++,_=!1,g>m&&(m=g);return y&&l.push(c),m+n>this.dynamicMinWidth&&(this.dynamicMinWidth=m-v+n),l});class j{constructor(e,t,i,n){let r,o;switch(this.mapMediaType_Style=new Map,this.mode="viewer",this.onSelectionChange=null,this._arrDrwaingItem=[],this._arrFabricObject=[],this._visible=!0,e.hasOwnProperty("getFabricCanvas")?this.fabricCanvas=e.getFabricCanvas():(this.fabricCanvas=new R.Canvas(e,Object.assign(n,{allowTouchScrolling:!0})),this.fabricCanvas.setDimensions({width:"100%",height:"100%"},{cssOnly:!0}),this.fabricCanvas.lowerCanvasEl.className="",this.fabricCanvas.upperCanvasEl.className="",this.fabricCanvas.on("selection:created",(function(e){const t=e.selected,i=[];for(let n of t){const e=n.getDrawingItem()._drawingLayer;e&&!i.includes(e)&&i.push(e)}for(let n of i){const e=[];for(let i of t){const t=i.getDrawingItem();t._drawingLayer===n&&e.push(t)}setTimeout((()=>{n.onSelectionChange&&n.onSelectionChange(e,[])}),0)}})),this.fabricCanvas.on("before:selection:cleared",(function(e){const t=this.getActiveObjects(),i=[];for(let n of t){const e=n.getDrawingItem()._drawingLayer;e&&!i.includes(e)&&i.push(e)}for(let n of i){const e=[];for(let i of t){const t=i.getDrawingItem();t._drawingLayer===n&&e.push(t)}setTimeout((()=>{const t=[];for(let i of e)n.hasDrawingItem(i)&&t.push(i);t.length>0&&n.onSelectionChange&&n.onSelectionChange([],t)}),0)}})),this.fabricCanvas.on("selection:updated",(function(e){const t=e.selected,i=e.deselected,n=[];for(let r of t){const e=r.getDrawingItem()._drawingLayer;e&&!n.includes(e)&&n.push(e)}for(let r of i){const e=r.getDrawingItem()._drawingLayer;e&&!n.includes(e)&&n.push(e)}for(let r of n){const e=[],n=[];for(let i of t){const t=i.getDrawingItem();t._drawingLayer===r&&e.push(t)}for(let t of i){const e=t.getDrawingItem();e._drawingLayer===r&&n.push(e)}setTimeout((()=>{r.onSelectionChange&&r.onSelectionChange(e,n)}),0)}})),this.fabricCanvas.wrapperEl.style.position="absolute",e.getFabricCanvas=()=>this.fabricCanvas),this.id=t,this._mapDrawingStyles=i,t){case 1:r=i.get(1),o=i.get(5);break;case 2:r=i.get(2),o=i.get(6);break;case 3:r=i.get(3),o=i.get(7);break;default:r=i.get(4),o=i.get(8)}for(let a of D.arrMediaTypes)this.mapMediaType_Style.set(a,{default:r,selected:o})}getId(){return this.id}_getDrawingStyle(e,t){if("number"!=typeof e)throw new Error("Invalid style id.");const i=this._mapDrawingStyles.get(e);return i?t?JSON.parse(JSON.stringify(i)):i:null}setVisible(e){if(e){for(let e of this._arrFabricObject)e.visible=!0;this._visible=!0}else{for(let e of this._arrFabricObject)e.visible=!1;this._visible=!1}this.fabricCanvas.renderAll()}isVisible(){return this._visible}_getItemCurrentStyleId(e){return e.styleId?e.styleId:this.mapMediaType_Style.get(e._mediaType)[e.styleSelector].styleId}_getItemCurrentStyle(e){if(e.styleId)return this._getDrawingStyle(e.styleId);return e._mapStyle.get(e.styleSelector)||null}_changeMediaTypeCurStyleInStyleSelector(e,t,i,n){let r;switch(e){case"rect":r=this.fabricCanvas.getObjects("rect");break;case"arc":r=this.fabricCanvas.getObjects("circle");break;case"polygon":r=this.fabricCanvas.getObjects("polygon");break;case"image":r=this.fabricCanvas.getObjects("image");break;case"text":r=this.fabricCanvas.getObjects("textbox");break;case"line":r=this.fabricCanvas.getObjects("line");break;case"path":r=this.fabricCanvas.getObjects("path")}for(let o of r){if(!this._arrFabricObject.includes(o))continue;const e=o.getDrawingItem();e.styleSelector===t&&this._changeItemStyle(e,i,!0)}n||this.fabricCanvas.renderAll()}_changeItemStyle(e,t,i){if(!e||!t)return;const n=e._getFabricObject();"number"==typeof e.styleId&&(t=this._getDrawingStyle(e.styleId)),n.strokeWidth=t.lineWidth,"fill"===t.paintMode?(n.fill=t.fillStyle,n.stroke=t.fillStyle):"stroke"===t.paintMode?(n.fill="transparent",n.stroke=t.strokeStyle):"strokeAndFill"===t.paintMode&&(n.fill=t.fillStyle,n.stroke=t.strokeStyle),n.fontFamily&&(n.fontFamily=t.fontFamily),n.fontSize&&(n.fontSize=t.fontSize),n.group||(n.dirty=!0),i||this.fabricCanvas.renderAll()}_updateGroupItem(e,t,i){if(!e||!t)return;const n=e.getChildItems();if("add"===i){if(n.includes(t))return;const i=t._getFabricObject();if(this.fabricCanvas.getObjects().includes(i)){if(!this._arrFabricObject.includes(i))throw new Error("Existed in other drawing layers.");t._zIndex=null}else{let i;if(t.styleId)i=this._getDrawingStyle(t.styleId);else{i=this.mapMediaType_Style.get(t._mediaType)[e.styleSelector];const n=()=>{this._changeItemStyle(t,this.mapMediaType_Style.get(t._mediaType).selected,!0)},r=()=>{this._changeItemStyle(t,this.mapMediaType_Style.get(t._mediaType).default,!0)};t._on("selected",n),t._on("deselected",r),t._funcChangeStyleToSelected=n,t._funcChangeStyleToDefault=r}t._drawingLayer=this,t._drawingLayerId=this.id,this._changeItemStyle(t,i,!0)}e._fabricObject.addWithUpdate(t._getFabricObject())}else{if("remove"!==i)return;if(!n.includes(t))return;t._zIndex=null,t._drawingLayer=null,t._drawingLayerId=null,t._off("selected",t._funcChangeStyleToSelected),t._off("deselected",t._funcChangeStyleToDefault),t._funcChangeStyleToSelected=null,t._funcChangeStyleToDefault=null,e._fabricObject.removeWithUpdate(t._getFabricObject())}this.fabricCanvas.renderAll()}_addDrawingItem(e,t){let i=e._getFabricObject();const n=this.fabricCanvas.getObjects();let r,o;if(n.includes(i)){if(this._arrFabricObject.includes(i))return;throw new Error("Existed in other drawing layers.")}if("group"===e._mediaType){r=e.getChildItems();for(let e of r)if(e._drawingLayer&&e._drawingLayer!==this)throw new Error("The childItems of DT_Group have existed in other drawing layers.")}if(t&&"object"==typeof t&&!Array.isArray(t))for(let l in t)i.set(l,t[l]);if(r){for(let e of r){const t=this.mapMediaType_Style.get(e._mediaType);for(let i of D.arrStyleSelectors)e._mapStyle.set(i,t[i]);if(e.styleId)o=this._getDrawingStyle(e.styleId);else{o=t.default;const i=()=>{this._changeItemStyle(e,this.mapMediaType_Style.get(e._mediaType).selected,!0)},n=()=>{this._changeItemStyle(e,this.mapMediaType_Style.get(e._mediaType).default,!0)};e._on("selected",i),e._on("deselected",n),e._funcChangeStyleToSelected=i,e._funcChangeStyleToDefault=n}e._drawingLayer=this,e._drawingLayerId=this.id,this._changeItemStyle(e,o,!0)}i.dirty=!0,this.fabricCanvas.renderAll()}else{const t=this.mapMediaType_Style.get(e._mediaType);for(let i of D.arrStyleSelectors)e._mapStyle.set(i,t[i]);if(e.styleId)o=this._getDrawingStyle(e.styleId);else{o=t.default;const i=()=>{this._changeItemStyle(e,this.mapMediaType_Style.get(e._mediaType).selected)},n=()=>{this._changeItemStyle(e,this.mapMediaType_Style.get(e._mediaType).default)};e._on("selected",i),e._on("deselected",n),e._funcChangeStyleToSelected=i,e._funcChangeStyleToDefault=n}this._changeItemStyle(e,o)}e._zIndex=this.id,e._drawingLayer=this,e._drawingLayerId=this.id;const a=this._arrFabricObject.length;let s=n.length;if(a)s=n.indexOf(this._arrFabricObject[a-1])+1;else for(let l=0;l<n.length;l++)if(e._zIndex<n[l].getDrawingItem()._zIndex){s=l;break}this._arrDrwaingItem.push(e),this._arrFabricObject.push(i),this._visible?i.visible=!0:i.visible=!1,this.fabricCanvas.insertAt(i,s,!1)}addDrawingItem(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");if("viewer"===this.mode)e._setEditable(!1);else{if("editor"!==this.mode)throw new Error("Illegal 'mode'.");e._setEditable(!0)}this._addDrawingItem(e)}addDrawingItems(e){for(let t of e)this.addDrawingItem(t)}removeDrawingItem(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");if(!this.hasDrawingItem(e))return;if(e._zIndex=null,e._drawingLayer=null,e._drawingLayerId=null,"group"===e._mediaType){const t=e.getChildItems();for(let e of t)e._zIndex=null,e._drawingLayer=null,e._drawingLayerId=null,e._off("selected",e._funcChangeStyleToSelected),e._off("deselected",e._funcChangeStyleToDefault),e._funcChangeStyleToSelected=null,e._funcChangeStyleToDefault=null,e._mapStyle.clear()}else e._off("selected",e._funcChangeStyleToSelected),e._off("deselected",e._funcChangeStyleToDefault),e._funcChangeStyleToSelected=null,e._funcChangeStyleToDefault=null,e._mapStyle.clear();const t=e._getFabricObject();"selected"===e.styleSelector&&(t.group?t.group.removeWithUpdate(t):this.fabricCanvas._activeObject=null,e.styleSelector="default"),this.fabricCanvas.remove(t),this._arrDrwaingItem.splice(this._arrDrwaingItem.indexOf(e),1),this._arrFabricObject.splice(this._arrFabricObject.indexOf(t),1)}removeDrawingItems(e){for(let t of e)this.removeDrawingItem(t)}setDrawingItems(e){this.clearDrawingItems(),this.addDrawingItems(e)}getDrawingItems(e){return e&&"function"==typeof e?this._arrDrwaingItem.filter(e):Array.from(this._arrDrwaingItem)}getSelectedDrawingItems(){const e=this.fabricCanvas.getActiveObjects(),t=[];for(let i of e)this._arrFabricObject.includes(i)&&t.push(i.getDrawingItem());return t}hasDrawingItem(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");return this._arrDrwaingItem.includes(e)}clearDrawingItems(){this.removeDrawingItems(Array.from(this._arrDrwaingItem))}setDrawingStyle(e,t,i){t=t?t.toLocaleLowerCase():"all",i=i?i.toLocaleLowerCase():"all";let n,r=this._getDrawingStyle(e);if("all"===t){const e=this.mapMediaType_Style.keys();for(let t of e)if(n=this.mapMediaType_Style.get(t),"all"===i)for(let e of D.arrStyleSelectors){this._changeMediaTypeCurStyleInStyleSelector(t,e,r,!0),n[e]=r;for(let t of this._arrDrwaingItem)t._mapStyle.set(e,r)}else{this._changeMediaTypeCurStyleInStyleSelector(t,i,r,!0),n[i]=r;for(let e of this._arrDrwaingItem)e._mapStyle.set(i,r)}this.fabricCanvas.renderAll()}else if(n=this.mapMediaType_Style.get(t),"all"===i)for(let o of D.arrStyleSelectors){this._changeMediaTypeCurStyleInStyleSelector(t,o,r,!0),n[o]=r;for(let e of this._arrDrwaingItem)e._mediaType===t&&e._mapStyle.set(o,r)}else{this._changeMediaTypeCurStyleInStyleSelector(t,i,r,!0),n[i]=r;for(let e of this._arrDrwaingItem)e._mediaType===t&&e._mapStyle.set(i,r)}}setMode(e){if("viewer"===(e=e.toLocaleLowerCase())){for(let e of this._arrDrwaingItem)e._setEditable(!1);this.fabricCanvas.discardActiveObject(),this.fabricCanvas.renderAll(),this.mode="viewer"}else{if("editor"!==e)throw new RangeError("Invalid value.");for(let e of this._arrDrwaingItem)e._setEditable(!0);this.mode="editor"}this._manager._switchPointerEvent()}getMode(){return this.mode}_setDimensions(e,t){this.fabricCanvas.setDimensions(e,t)}_setObjectFit(e){if(e=e.toLowerCase(),!["contain","cover"].includes(e))throw new Error(`Unsupported value '${e}'.`);this.fabricCanvas.lowerCanvasEl.style.objectFit=e,this.fabricCanvas.upperCanvasEl.style.objectFit=e}_getObjectFit(){return this.fabricCanvas.lowerCanvasEl.style.objectFit}renderAll(){for(let e of this._arrDrwaingItem){const t=this._getItemCurrentStyle(e);this._changeItemStyle(e,t,!0)}this.fabricCanvas.renderAll()}dispose(){this.clearDrawingItems(),1===this._manager._arrDrawingLayer.length&&(this.fabricCanvas.wrapperEl.style.pointerEvents="none",this.fabricCanvas.dispose(),this._arrDrwaingItem.length=0,this._arrFabricObject.length=0)}}class U{constructor(){this._arrDrawingLayer=[],this._mapDrawingStyles=new Map([[1,{id:1,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[2,{id:2,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[3,{id:3,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[4,{id:4,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[5,{id:5,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[6,{id:6,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[7,{id:7,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[8,{id:8,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}]]),this._defaultStyleTemplate={lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}}createDrawingStyle(e){if(!e)throw new Error("Invalid style definition.");let t;if(e.hasOwnProperty("id")){if(this._mapDrawingStyles.has(e.id))throw new Error("Existing drawing style id.");t=e.id}else{let e=100;for(;this._mapDrawingStyles.has(e);)e++;t=e}const i=JSON.parse(JSON.stringify(e));i.id=t;for(let n in this._defaultStyleTemplate)i.hasOwnProperty(n)||(i[n]=this._defaultStyleTemplate[n]);return this._mapDrawingStyles.set(t,i),i.id}_getDrawingStyle(e,t){if("number"!=typeof e)throw new Error("Invalid style id.");const i=this._mapDrawingStyles.get(e);return i?t?JSON.parse(JSON.stringify(i)):i:null}getDrawingStyle(e){return this._getDrawingStyle(e,!0)}getDrawingStyles(){return JSON.parse(JSON.stringify(Array.from(this._mapDrawingStyles.values())))}_updateDrawingStyle(e,t){const i=this._mapDrawingStyles.get(e);if(i)for(let n in t)i.hasOwnProperty(n)&&(i[n]=t[n])}updateDrawingStyle(e,t){this._updateDrawingStyle(e,t);for(let i of this._arrDrawingLayer)i.renderAll()}createDrawingLayer(e,t){const i=e=>{for(let t of this._arrDrawingLayer)if(t.getId()===e)return!0;return!1};if(void 0===t){for(let r=100;;r++)if(!i(r)){t=r;break}}else if(i(t))throw new Error("Existed drawing layer id.");const n=new j(e,t,this._mapDrawingStyles,{enableRetinaScaling:!1});return n._manager=this,this._arrDrawingLayer.push(n),this._switchPointerEvent(),n}deleteDrawingLayer(e){const t=this.getDrawingLayer(e);if(!t)return;const i=this._arrDrawingLayer;t.dispose(),i.splice(i.indexOf(t),1),this._switchPointerEvent()}clearDrawingLayers(){for(let e of this._arrDrawingLayer)e.dispose();this._arrDrawingLayer.length=0}getDrawingLayer(e){for(let t of this._arrDrawingLayer)if(t.getId()===e)return t;return null}getDrawingLayers(){return Array.from(this._arrDrawingLayer)}getSelectedDrawingItems(){if(!this._arrDrawingLayer.length)return;const e=this._arrDrawingLayer[0].fabricCanvas.getActiveObjects(),t=[];for(let i of e)t.push(i.getDrawingItem());return t}setDimensions(e,t){this._arrDrawingLayer.length&&this._arrDrawingLayer[0]._setDimensions(e,t)}setObjectFit(e){for(let t of this._arrDrawingLayer)t&&t._setObjectFit(e)}getObjectFit(){return this._arrDrawingLayer.length?this._arrDrawingLayer[0]._getObjectFit():null}setVisible(e){this._arrDrawingLayer.length&&(this._arrDrawingLayer[0].fabricCanvas.wrapperEl.style.display=e?"block":"none")}_switchPointerEvent(){if(this._arrDrawingLayer.length)for(let e of this._arrDrawingLayer)e.getMode()}}class V{constructor(e){this._controlTarget=null,this._arrUsers=[],this._mapAction_UserArgs=new Map,this._mapProperty_UserValue=new Map,this._mapAction_Callbacks=new Map,this._controlTarget=e}setControlTarget(e){this._controlTarget=e}getControlTarget(){return this._controlTarget}register(e){this._arrUsers.includes(e)||this._arrUsers.push(e)}logout(e){const t=this._arrUsers.indexOf(e);-1!==t&&(this.clearUserDisiredAction({user:e}),this.clearUserDisiredValue({user:e}),this._arrUsers.splice(t,1))}getRegisteredUsers(){return this._arrUsers}ifUserExisted(e){return this._arrUsers.includes(e)}setDisiredValue(e,t,i,n){if(!this._arrUsers.includes(e))throw new Error("Unregistered user.");n&&(this._controlTarget[t]=i),this._mapProperty_UserValue.get(t)?this._mapProperty_UserValue.get(t).set(e,i):this._mapProperty_UserValue.set(t,new Map([[e,i]]))}clearUserDisiredValue(e){if(e&&(e.user||e.property)){if(e.property&&e.user){const t=this._mapProperty_UserValue.get(e.property);if(!t)return;t.delete(e.user)}else if(e.property)this._mapProperty_UserValue.delete(e.property);else if(e.user)for(let t of this._mapProperty_UserValue.values())t.delete(e.user)}else this._mapProperty_UserValue=new Map}getValue(e){if(!this._controlTarget)throw new Error("Control target is not set.");return this._controlTarget[e]}getPropertyDisiredValue(e){if(this._mapProperty_UserValue.get(e)){const t=[],i=this._mapProperty_UserValue.get(e);for(let e of i.values())t.push(e);return t}return null}setDisiredAction(e,t,i,n){if(!this._arrUsers.includes(e))throw new Error("Unregistered user.");return i||(i=[]),n?this._controlTarget[t](...i):(this._mapAction_UserArgs.get(t)?this._mapAction_UserArgs.get(t).set(e,i):this._mapAction_UserArgs.set(t,new Map([[e,i]])),this._render(t))}clearUserDisiredAction(e){if(e&&(e.user||e.actionName)){if(e.actionName&&e.user){const t=this._mapAction_UserArgs.get(e.actionName);if(!t)return;t.delete(e.user)}else if(e.actionName)this._mapAction_UserArgs.delete(e.actionName);else if(e.user)for(let t of this._mapAction_UserArgs.values())t.delete(e.user);this.render()}else this._mapAction_UserArgs=new Map}addCallback(e,t){const i=this._mapAction_Callbacks.get(e);i?i.push(t):this._mapAction_Callbacks.set(e,[t])}removeCallback(e,t){const i=this._mapAction_Callbacks.get(e);if(!i)return;const n=i.indexOf(t);-1!==n&&i.splice(n,1)}clearCallback(e){e?this._mapAction_Callbacks.delete(e):this._mapAction_Callbacks.clear()}_fireCallback(e){const t=this._mapAction_Callbacks.get(e);if(t)for(let i of t){if(!i)return;setTimeout(i.bind(this._controlTarget),0)}}_render(e){const t=this._mapAction_UserArgs.get(e);if(!t)throw new Error("Unrecorded action.");if(t.size===this._arrUsers.length){let i=[];for(let e of t.values())e.length>0&&(i=e);if(this._controlTarget[e]){const t=this._controlTarget[e](...i);return this._mapAction_UserArgs.delete(e),this._fireCallback(e),t}}}render(e){if(e)return this._render(e);for(let t of this._mapAction_UserArgs.keys())this._render(t)}}class W{static multiply(e,t){const i=[];for(let n=0;n<3;n++){const r=t.slice(3*n,3*n+3);for(let t=0;t<3;t++){const n=[e[t],e[t+3],e[t+6]].reduce(((e,t,i)=>e+t*r[i]),0);i.push(n)}}return i}static identity(){return[1,0,0,0,1,0,0,0,1]}static translate(e,t,i){return W.multiply(e,[1,0,0,0,1,0,t,i,1])}static rotate(e,t){var i=Math.cos(t),n=Math.sin(t);return W.multiply(e,[i,-n,0,n,i,0,0,0,1])}static scale(e,t,i){return W.multiply(e,[t,0,0,0,i,0,0,0,1])}}var G;!function(e){e.GREY="grey",e.GREY32="grey32",e.RGBA="rgba",e.RBGA="rbga",e.GRBA="grba",e.GBRA="gbra",e.BRGA="brga",e.BGRA="bgra"}(G||(G={}));const z=(e,t,i,n)=>{if(!i)return e;let r=t+Math.round((e-t)/i)*i;return n&&(r=Math.min(r,n)),r};class H{static getVersion(){return this._version}static async detectEnvironment(){return await(async()=>({wasm:S,worker:w,getUserMedia:C,camera:await x(),browser:b.browser,version:b.version,OS:b.OS}))()}static set engineResourcePath(e){if(this._hasEngineResourceLoaded)throw new Error("`engineResourcePath` is not allowed to change after `createInstance` is called.");H._engineResourcePath=(e=>{if(null==e&&(e="./"),!p){let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e})(e)}static get engineResourcePath(){return this._engineResourcePath}static isStorageAvailable(e){let t;try{t=window[e];const i="__storage_test__";return t.setItem(i,i),t.removeItem(i),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&t&&0!==t.length}}static isDCEFrame(e){return!(!e||"object"!=typeof e||Array.isArray(e))&&"data"in e&&"region"in e&&"sx"in e&&"sy"in e&&"width"in e&&"height"in e&&("colorMode"in e||"pixelFormat"in e)&&"timeSpent"in e&&"timeStamp"in e&&"isCropped"in e&&"toCanvas"in e&&"_sWidth"in e&&"_sHeight"in e&&"_bUseWebGL"in e}static async testCameraAccess(){try{if(!navigator||!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return{ok:!1,message:"Insecure context."};(await navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach((e=>{e.stop()}))}catch(p){if("OverconstrainedError"===p.name||"NotFoundError"===p.name)return{ok:!1,message:"No camera detected."};if("NotAllowedError"===p.name)return{ok:!1,message:"No permission to access camera."};if("AbortError"===p.name)return{ok:!1,message:"Some problem occurred which prevented the device from being used."};if("NotReadableError"===p.name)return{ok:!1,message:"A hardware error occurred."};if("SecurityError"===p.name)return{ok:!1,message:"User media support is disabled."};throw p}return{ok:!0,message:"Successfully accessed the camera."}}set maxCvsSideLength(e){if(e<=0)throw new Error("Invalid value.");this._maxCvsSideLength=e}get maxCvsSideLength(){if(void 0!==this._maxCvsSideLength)return this._maxCvsSideLength;if(this._controler){const e=this._controler.getPropertyDisiredValue("maxCvsSideLength");if(e&&1===e.length)return e[0]}return this._defaultMaxCvsSideLength}static set defaultUIElementURL(e){H._defaultUIElementURL=e}static get defaultUIElementURL(){var e;return null===(e=H._defaultUIElementURL)||void 0===e?void 0:e.replace("@engineResourcePath/",H.engineResourcePath)}getUIElement(){return this.UIElement}async setUIElement(e){if(this._bOpen)throw new Error("It is not allowed to change the UIElement when the camera is open.");if("string"==typeof e||e instanceof String){if(!e.trim().startsWith("<")){let t=await fetch(e);if(!t.ok)throw Error("setUIElement(elementOrUrl): Network Error: "+t.statusText);e=await t.text()}if(!e.trim().startsWith("<"))throw Error("setUIElement(elementOrUrl): Can't get valid HTMLElement.");let t=document.createElement("div");t.innerHTML=e;for(let e=0;e<t.childElementCount;++e){let i=t.children[e];i instanceof HTMLStyleElement&&(this.styleEls.push(i),document.head.append(i))}(e=1==t.childElementCount?t.children[0]:t).remove()}this.UIElement=e,this._uiOriginalState={display:e&&e.style.display,inDom:document.body.contains(e)}}appendAndShowUI(){this.UIElement&&(this.UIElement.parentNode||(this.UIElement.style.position="fixed",this.UIElement.style.left="0",this.UIElement.style.top="0",document.body.append(this.UIElement)),"none"==this.UIElement.style.display&&(this.UIElement.style.display=""))}hideUI(){this.UIElement&&(this.UIElement.style.display="none")}get singleFrameMode(){return this._singleFrameMode}set singleFrameMode(e){var t;if("boolean"!=typeof e&&!["image","camera"].includes(e))throw new Error("Invalid value.");if(this._bOpen)throw new Error("It is not allowed to change `singleFrameMode` when the camera is open.");this._singleFrameMode=e;const i=null===(t=this._singleFrameInputContainer)||void 0===t?void 0:t.firstElementChild;i&&("camera"===e?(i.setAttribute("capture",""),i.setAttribute("accept","image/*")):1!=e&&"image"!==e||(i.removeAttribute("capture"),i.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp")))}set frameColorMode(e){this._framePixelFormat=e}get frameColorMode(){if(void 0!==this._framePixelFormat)return this._framePixelFormat;if(this._controler){const e=this._controler.getPropertyDisiredValue("framePixelFormat")||this._controler.getPropertyDisiredValue("frameColorMode");if(e&&1===e.length)return e[0]}return this._defaultFramePixelFormat}set framePixelFormat(e){this._framePixelFormat=e}get framePixelFormat(){if(void 0!==this._framePixelFormat)return this._framePixelFormat;if(this._controler){const e=this._controler.getPropertyDisiredValue("framePixelFormat")||this._controler.getPropertyDisiredValue("frameColorMode");if(e&&1===e.length)return e[0]}return this._defaultFramePixelFormat}set bOpen(e){if(this._bOpen=e,e){this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let e of this._arrScanRegionOverlays)e&&this._updateScanRegionOverlay(e);this._updateDrawingLayersSize(),this.ifShowScanRegionMask?this.showScanRegionMask():this.hideScanRegionMask(),this.ifShowScanRegionLaser?this.showScanRegionLaser():this.hideScanRegionLaser(),this.showViewDecorator(),this.showScanRegionOverlays(),this._drawingLayerManager.setVisible(!0)}else this._softwareScale=1}set ifSaveLastUsedCamera(e){e?H.isStorageAvailable("localStorage")?this._ifSaveLastUsedCamera=!0:(this._ifSaveLastUsedCamera=!1,console.warn("Local storage is unavailable")):this._ifSaveLastUsedCamera=!1}get ifSaveLastUsedCamera(){return this._ifSaveLastUsedCamera}get video(){return this._video}setVideoFit(e){if(e=e.toLowerCase(),!["contain","cover"].includes(e))throw new Error(`Unsupported value '${e}'.`);if(this.videoFit=e,this._video&&(this._video.style.objectFit=e,!this._isSingleFrameModeEnabled())){this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let e of this._arrScanRegionOverlays)e&&this._updateScanRegionOverlay(e);this._updateVideoContainerStyle(),this._drawingLayerManager.setObjectFit(e)}}getVideoFit(){return this.videoFit}_showElClassName(){this._videoContainer&&this._videoContainer.classList.add("div-video-container"),this._cvsScanRegion&&this._cvsScanRegion.classList.add("cvs-scan-region-mask"),this._cvsViewDecorator&&this._cvsViewDecorator.classList.add("cvs-view-decorator"),this._scanRegionOverlayContainer&&this._scanRegionOverlayContainer.classList.add("div-scan-region-overlay-container"),this._layerBaseCvs&&this._layerBaseCvs.classList.add("cvs-drawing-layer-base"),this._layerBaseCvs&&this._layerBaseCvs.parentElement.classList.add("div-drawing-layer-container"),this._cvsOriginalImage&&this._cvsOriginalImage.classList.add("cvs-original-image"),this._cvsSingleFrameMode&&this._cvsSingleFrameMode.classList.add("cvs-single-frame"),this._singleFrameInputContainer&&this._singleFrameInputContainer.classList.add("div-single-frame-input-container")}_hideElClassName(){this._videoContainer&&(this._videoContainer.className=""),this._cvsScanRegion&&(this._cvsScanRegion.className=""),this._cvsViewDecorator&&(this._cvsViewDecorator.className=""),this._scanRegionOverlayContainer&&(this._scanRegionOverlayContainer.className=""),this._layerBaseCvs&&(this._layerBaseCvs.className=""),this._layerBaseCvs&&(this._layerBaseCvs.className=""),this._cvsOriginalImage&&(this._cvsOriginalImage.className=""),this._cvsSingleFrameMode&&(this._cvsSingleFrameMode.className=""),this._singleFrameInputContainer&&(this._singleFrameInputContainer.className="")}set ifShowScanRegionMask(e){this._bShowScanRegionMask=e,e?this.showScanRegionMask():this.hideScanRegionMask()}get ifShowScanRegionMask(){return this._bShowScanRegionMask}showScanRegionMask(){this._cvsScanRegion&&("none"==this._cvsScanRegion.style.display&&(this._cvsScanRegion.style.display=""),this._recordedStates.maskShow=!0)}hideScanRegionMask(){this._cvsScanRegion&&(this._cvsScanRegion.style.display="none",this._recordedStates.maskShow=!1)}set ifShowScanRegionLaser(e){this._bShowScanRegionLaser=e,e?this.showScanRegionLaser():this.hideScanRegionLaser()}get ifShowScanRegionLaser(){if(void 0!==this._bShowScanRegionLaser)return this._bShowScanRegionLaser;if(this._controler){const e=this._controler.getPropertyDisiredValue("ifShowScanRegionLaser");if(e&&e.length){let t=0;for(let i of e)i||t++;return t!==this._controler.getRegisteredUsers().length}}return this._defaultBShowScanRegionLaser}showScanRegionLaser(){this._divScanLight&&("none"==this._divScanLight.style.display&&(this._divScanLight.style.display="block"),this._recordedStates.laserShow=!0)}hideScanRegionLaser(){this._divScanLight&&(this._divScanLight.style.display="none",this._recordedStates.laserShow=!1)}_checkValidRegion(e){return null===e||!!e&&!!(e.hasOwnProperty("regionLeft")&&e.hasOwnProperty("regionTop")&&e.hasOwnProperty("regionRight")&&e.hasOwnProperty("regionBottom")&&e.hasOwnProperty("regionMeasuredByPercentage"))&&!(e.regionLeft<0||e.regionTop<0||e.regionRight<0||e.regionBottom<0)&&(!e.regionMeasuredByPercentage||!(e.regionLeft>100||e.regionTop>100||e.regionRight>100||e.regionBottom>100))}set scanRegion(e){if(!this._checkValidRegion(e))throw new Error("Invalid region.");this._scanRegion=JSON.parse(JSON.stringify(e)),this._updateScanRegionCanvas(),this._updateScanAreaDiv();for(let t of this._arrScanRegionOverlays)t&&this._updateScanRegionOverlay(t)}setScanRegion(e){this.scanRegion=e}getScanRegion(){return JSON.parse(JSON.stringify(this._scanRegion))}_calculateCvsSize(){var e,t;let i,n,r;if(this._isSingleFrameModeEnabled()?(i=this._imgWidth,n=this._imgHeight,r="contain"):(i=null===(e=this._video)||void 0===e?void 0:e.videoWidth,n=null===(t=this._video)||void 0===t?void 0:t.videoHeight,r=this.getVideoFit()),!i||!n)throw new Error("Invalid content dimensions.");return{width:i,height:n,objectFit:r}}addScanRegionOverlayCanvas(){this._assertOpen();const e=document.createElement("canvas");if(this._updateScanRegionOverlay(e),!this._scanRegionOverlayContainer){const e=document.createElement("div");if(this._scanRegionOverlayContainer=e,e.style.position="absolute",e.style.left="0",e.style.top="0",e.style.width="100%",e.style.height="100%",e.style.overflow="hidden",e.style.pointerEvents="none",this._layerBaseCvs)this._layerBaseCvs.parentElement.after(e);else if(this._cvsScanRegion)this._cvsScanRegion.after(e);else if(this._cvsOriginalImage)this._cvsOriginalImage.after(e);else if(this._cvsSingleFrameMode)this._cvsSingleFrameMode.after(e);else{if(!this._videoContainer)throw new Error("Unable to find video element");this._videoContainer.after(e)}this._recordedStates.overlayShow=!0}return this._scanRegionOverlayContainer.append(e),this._arrScanRegionOverlays.push(e),e}removeScanRegionOverlayCanvas(e){const t=this._arrScanRegionOverlays.indexOf(e);-1!==t&&(e.remove(),this._arrScanRegionOverlays.splice(t,1))}_updateScanRegionOverlay(e){if(!e)return;let t;try{t=this._calculateCvsSize()}catch(e){if("Invalid content dimensions."===(e.message||e))return;throw e}const{width:i,height:n,objectFit:r}=t;if(i<=0||n<=0)return e.width=0,void(e.height=0);const o=this._getRegionInPixels(i,n,this._scanRegion),a=this.getFrameSize(i,n,this._scanRegion,this.maxCvsSideLength),s=a.dWidth,l=a.dHeight;e.width==s&&e.height==l||(e.width=s,e.height=l);const c=window.getComputedStyle(this._elContainer),u=parseFloat(c.width),h=parseFloat(c.height),d=u/h,f=i/n;let g,p,m,_,v=1;"contain"===r?(f>d?(v=u/i,g=0,p=(h-n*v)/2):(v=h/n,g=(u-i*v)/2,p=0),g+=o.regionLeft*v,p+=o.regionTop*v,m=(o.regionRight-o.regionLeft)*v,_=(o.regionBottom-o.regionTop)*v):"cover"===r?(f>d?(v=h/n,g=o.regionLeft*v-(i*v-u)/2,p=o.regionTop*v):(v=u/i,g=o.regionLeft*v,p=o.regionTop*v-(n*v-h)/2),m=(o.regionRight-o.regionLeft)*v,_=(o.regionBottom-o.regionTop)*v):(g=0,p=0,m=0,_=0),e.style.position="absolute",e.style.left=g+"px",e.style.top=p+"px",e.style.width=m+"px",e.style.height=_+"px"}showScanRegionOverlays(){this._scanRegionOverlayContainer&&("none"==this._scanRegionOverlayContainer.style.display&&(this._scanRegionOverlayContainer.style.display=""),this._recordedStates.overlayShow=!0)}hideScanRegionOverlays(){this._scanRegionOverlayContainer&&(this._scanRegionOverlayContainer.style.display="none",this._recordedStates.overlayShow=!1)}setViewDecorator(e,t){if(!e)return void(this._cvsViewDecorator&&(this._cvsViewDecorator.remove(),this._cvsViewDecorator=null));if(!t)throw new Error("Invalid area.");this._assertOpen();let i=[];if("string"==typeof e?i.push(e):Array.isArray(e)&&(i=JSON.parse(JSON.stringify(e))),!this._cvsViewDecorator){if(this._cvsViewDecorator=document.createElement("canvas"),this._scanRegionOverlayContainer)this._scanRegionOverlayContainer.after(this._cvsViewDecorator);else if(this._layerBaseCvs)this._layerBaseCvs.parentElement.after(this._cvsViewDecorator);else if(this._cvsScanRegion)this._cvsScanRegion.after(this._cvsViewDecorator);else if(this._cvsOriginalImage)this._cvsOriginalImage.after(this._cvsViewDecorator);else if(this._cvsSingleFrameMode)this._cvsSingleFrameMode.after(this._cvsViewDecorator);else{if(!this._videoContainer)throw new Error("Unable to find video element");this._videoContainer.after(this._cvsViewDecorator)}this._recordedStates.decoratorShow=!0}this._decoratorArea=JSON.parse(JSON.stringify(t)),this._decoratorType.length=0;const n=["rectangle","focus"],r=["crossline","crosshair"];let o=!1,a=!1;for(let s of i)s=s.toLowerCase(),n.includes(s)&&!o&&(o=!0,this._decoratorType.push(s)),r.includes(s)&&!a&&(a=!0,!this._decoratorType.includes(s)&&this._decoratorType.push(s));this._updateViewDecorator()}getViewDecorator(){return{type:JSON.parse(JSON.stringify(this._decoratorType)),area:JSON.parse(JSON.stringify(this._decoratorArea)),canvas:this._cvsViewDecorator}}showViewDecorator(){this._cvsViewDecorator&&("none"==this._cvsViewDecorator.style.display&&(this._cvsViewDecorator.style.display=""),this._recordedStates.decoratorShow=!0)}hideViewDecorator(){this._cvsViewDecorator&&(this._cvsViewDecorator.style.display="none",this._recordedStates.decoratorShow=!1)}setViewDecoratorLineWidth(e,t){if("string"!=typeof e)throw new Error("The 'type' should be a string.");if(e=e.toLowerCase(),!this._viewDecoratorInfo.hasOwnProperty(e))throw new Error(`The type of '${e}' doesn't exist.`);if(!this._viewDecoratorInfo[e].hasOwnProperty("lineWidth"))throw new Error(`It is not allowed to change the property 'lineWidth' when the decorator type is '${e}'.`);this._viewDecoratorInfo[e].lineWidth=t,this._updateViewDecorator()}setViewDecoratorStrokeStyle(e,t){if("string"!=typeof e)throw new Error("The 'type' should be a string.");if(e=e.toLowerCase(),!this._viewDecoratorInfo.hasOwnProperty(e))throw new Error(`The type of '${e}' doesn't exist.`);if(!this._viewDecoratorInfo[e].hasOwnProperty("strokeStyle"))throw new Error(`It is not allowed to change the property 'strokeStyle' when the decorator type is '${e}'.`);this._viewDecoratorInfo[e].strokeStyle=t,this._updateViewDecorator()}setViewDecoratorFillStyle(e,t){if("string"!=typeof e)throw new Error("The 'type' should be a string.");if(e=e.toLowerCase(),!this._viewDecoratorInfo.hasOwnProperty(e))throw new Error(`The type of '${e}' doesn't exist.`);if(!this._viewDecoratorInfo[e].hasOwnProperty("fillStyle"))throw new Error(`It is not allowed to change the property 'fillStyle' when the decorator type is '${e}'.`);this._viewDecoratorInfo[e].fillStyle=t,this._updateViewDecorator()}setViewDecoratorMaskFillStyle(e,t){if("string"!=typeof e)throw new Error("The 'type' should be a string.");if(e=e.toLowerCase(),!this._viewDecoratorInfo.hasOwnProperty(e))throw new Error(`The type of '${e}' doesn't exist.`);if(!this._viewDecoratorInfo[e].hasOwnProperty("maskFillStyle"))throw new Error(`It is not allowed to change the property 'maskFillStyle' when the decorator type is '${e}'.`);this._viewDecoratorInfo[e].maskFillStyle=t,this._updateViewDecorator()}_updateViewDecorator(){if(!this._bOpen)return;if(!this._cvsViewDecorator||!this._decoratorArea)return;let e;if(this._isSingleFrameModeEnabled())e="contain";else{if(!this._video)return;e=this.getVideoFit()}const t=this._cvsViewDecorator;t.style.position="absolute",t.style.width="100%",t.style.height="100%",t.style.left="0",t.style.top="0",t.style.objectFit=e,t.style.pointerEvents="none";const i=this.getVisibleRegion(!0);if(!i)return;const n=i.regionRight-i.regionLeft,r=i.regionBottom-i.regionTop;if(t.width==n&&t.height==r||(t.width=n,t.height=r),n<=0||r<=0)return;const o=t.getContext("2d");o.clearRect(0,0,t.width,t.height);const a=this._decoratorArea.x/100*n,s=this._decoratorArea.y/100*r,l=this._decoratorArea.width/100*n,c=this._decoratorArea.height/100*r;for(let u of this._decoratorType){if("rectangle"===u){o.fillStyle=this._viewDecoratorInfo.rectangle.maskFillStyle,o.fillRect(0,0,t.width,t.height),o.clearRect(Math.round(a),Math.round(s),Math.round(l),Math.round(c)),o.fillStyle=this._viewDecoratorInfo.rectangle.fillStyle,o.fillRect(Math.round(a),Math.round(s),Math.round(l),Math.round(c)),o.lineWidth=this._viewDecoratorInfo.rectangle.lineWidth,o.strokeStyle=this._viewDecoratorInfo.rectangle.strokeStyle;const e=o.lineWidth/2;o.strokeRect(Math.round(a-e),Math.round(s-e),Math.round(l+o.lineWidth),Math.round(c+o.lineWidth))}if("focus"===u){o.fillStyle=this._viewDecoratorInfo.focus.maskFillStyle,o.fillRect(0,0,t.width,t.height),o.clearRect(Math.round(a),Math.round(s),Math.round(l),Math.round(c)),o.fillStyle=this._viewDecoratorInfo.focus.fillStyle,o.fillRect(Math.round(a),Math.round(s),Math.round(l),Math.round(c)),o.lineWidth=this._viewDecoratorInfo.focus.lineWidth,o.strokeStyle=this._viewDecoratorInfo.focus.strokeStyle;const e=o.lineWidth/2,i=[0,.25,.75,1],n=[0,.25,.75,1];o.beginPath();for(let t=0;t<i.length;t++)if(0==t||3==t)for(let e=0;e<n.length;e+=2)o.moveTo(Math.round(a+i[t]*l),Math.round(s+n[e]*c)),o.lineTo(Math.round(a+i[t]*l),Math.round(s+n[e+1]*c));for(let t=0;t<n.length;t++)if(0==t||3==t)for(let r=0;r<i.length;r+=2)o.moveTo(Math.round(a+i[r]*l-e),Math.round(s+n[t]*c)),o.lineTo(Math.round(a+i[r+1]*l+e),Math.round(s+n[t]*c));o.stroke()}if("crossline"===u&&(o.beginPath(),o.lineWidth=this._viewDecoratorInfo.crossline.lineWidth,o.strokeStyle=this._viewDecoratorInfo.crossline.strokeStyle,o.moveTo(Math.round(a),Math.round(s+c/2)),o.lineTo(Math.round(a+l),Math.round(s+c/2)),o.moveTo(Math.round(a+l/2),Math.round(s)),o.lineTo(Math.round(a+l/2),Math.round(s+c)),o.stroke()),"crosshair"===u){o.beginPath();const e=.05*Math.min(l,c);o.lineWidth=this._viewDecoratorInfo.crosshair.lineWidth,o.strokeStyle=this._viewDecoratorInfo.crosshair.strokeStyle,o.moveTo(Math.round(a+(l-e)/2),Math.round(s+c/2)),o.lineTo(Math.round(a+(l+e)/2),Math.round(s+c/2)),o.moveTo(Math.round(a+l/2),Math.round(s+(c-e)/2)),o.lineTo(Math.round(a+l/2),Math.round(s+(c+e)/2)),o.stroke()}}}getVisibleRegion(e){let t;this._assertOpen();try{t=this._calculateCvsSize()}catch(e){if("Invalid content dimensions."===(e.message||e))return null;throw e}const{width:i,height:n,objectFit:r}=t;let o=(()=>{const e=parseFloat(window.getComputedStyle(this._elContainer).width),t=parseFloat(window.getComputedStyle(this._elContainer).height);let o,a={regionBottom:n,regionRight:i,regionLeft:0,regionTop:0,regionMeasuredByPercentage:!1};return"cover"===r?e/t<i/n?(o=t/n,a.regionLeft=Math.floor((i-e/o)/2),a.regionRight=Math.ceil(i-a.regionLeft),a.regionTop=0,a.regionBottom=n):(o=e/i,a.regionTop=Math.floor((n-t/o)/2),a.regionBottom=Math.ceil(n-a.regionTop),a.regionLeft=0,a.regionRight=i):"none"===r&&(e<i&&t<n?(a.regionLeft=Math.floor((i-e)/2),a.regionRight=Math.ceil(i-a.regionLeft),a.regionTop=Math.floor((n-t)/2),a.regionBottom=Math.ceil(n-a.regionTop)):e<i?(a.regionLeft=Math.floor((i-e)/2),a.regionRight=Math.ceil(i-a.regionLeft),a.regionTop=0,a.regionBottom=n):t<n&&(a.regionTop=Math.floor((n-t)/2),a.regionBottom=Math.ceil(n-a.regionTop),a.regionLeft=0,a.regionRight=i)),a})();return e?o.regionMeasuredByPercentage=!1:(o.regionBottom=Math.ceil(o.regionBottom/n*100),o.regionRight=Math.ceil(o.regionRight/i*100),o.regionLeft=Math.floor(o.regionLeft/i*100),o.regionTop=Math.floor(o.regionTop/n*100),o.regionMeasuredByPercentage=!0),o}setScanRegionMaskStyle(e){e&&(e.fillStyle&&(this.regionMaskFillStyle=e.fillStyle),e.strokeStyle&&(this.regionMaskStrokeStyle=e.strokeStyle),e.lineWidth&&(this.regionMaskLineWidth=e.lineWidth),this._updateScanRegionCanvas())}_getRegionInPixels(e,t,i){if(!(e<=0||t<=0))return i?i.regionMeasuredByPercentage?{regionLeft:Math.round(i.regionLeft/100*e),regionTop:Math.round(i.regionTop/100*t),regionRight:Math.round(i.regionRight/100*e),regionBottom:Math.round(i.regionBottom/100*t),regionMeasuredByPercentage:!1}:JSON.parse(JSON.stringify(i)):{regionLeft:0,regionTop:0,regionRight:e,regionBottom:t,regionMeasuredByPercentage:!1}}_updateScanRegionCanvas(){if(!this._bOpen)return;let e;try{e=this._calculateCvsSize()}catch(e){if("Invalid content dimensions."===(e.message||e))return;throw e}const{width:t,height:i,objectFit:n}=e;if(t<=0||i<=0)return void(this._cvsScanRegion&&(this._cvsScanRegion.width=0,this._cvsScanRegion.height=0));const r=this._getRegionInPixels(t,i,this._scanRegion);if(!this._cvsScanRegion){if(this._cvsScanRegion=document.createElement("canvas"),this._cvsOriginalImage)this._cvsOriginalImage.after(this._cvsScanRegion);else if(this._cvsSingleFrameMode)this._cvsSingleFrameMode.after(this._cvsScanRegion);else{if(!this._videoContainer)throw new Error("Unable to find video element");this._videoContainer.after(this._cvsScanRegion)}this._recordedStates.maskShow=!0}const o=this._cvsScanRegion;o.style.position="absolute",o.style.width="100%",o.style.height="100%",o.style.left="0",o.style.top="0",o.style.objectFit=n,o.style.pointerEvents="none",o.width==t&&o.height==i||(o.width=t,o.height=i);const a=o.getContext("2d");if(a.clearRect(0,0,o.width,o.height),0!=r.regionLeft||r.regionRight!=t||0!=r.regionTop||r.regionBottom!=i){const e=r.regionLeft,t=r.regionTop,i=r.regionRight-r.regionLeft,n=r.regionBottom-r.regionTop;a.fillStyle=this.regionMaskFillStyle,a.fillRect(0,0,o.width,o.height),a.clearRect(Math.round(e),Math.round(t),Math.round(i),Math.round(n)),a.strokeStyle=this.regionMaskStrokeStyle,a.lineWidth=this.regionMaskLineWidth;const s=a.lineWidth/2;a.strokeRect(Math.round(e-s),Math.round(t-s),Math.round(i+a.lineWidth),Math.round(n+a.lineWidth))}}_updateScanAreaDiv(){if(!this._bOpen)return;let e;try{e=this._calculateCvsSize()}catch(e){if("Invalid content dimensions."===(e.message||e))return;throw e}const{width:t,height:i,objectFit:n}=e;if(!this._divScanArea)return;if(t<=0||i<=0)return this._divScanArea.style.width="0",void(this._divScanArea.style.height="0");const r=this._getRegionInPixels(t,i,this._scanRegion),o=window.getComputedStyle(this._elContainer),a=parseFloat(o.width),s=parseFloat(o.height),l=a/s,c=t/i;let u,h,d,f,g=1;if("contain"===n)l<c?(g=a/t,u=0,h=(s-i*g)/2):(g=s/i,u=(a-t*g)/2,h=0),u+=r.regionLeft*g,h+=r.regionTop*g,d=(r.regionRight-r.regionLeft)*g,f=(r.regionBottom-r.regionTop)*g;else if("cover"===n)if(l<c){g=s/i,u=r.regionLeft*g-(t*g-a)/2,u=Math.max(u,0),u=Math.min(u,parseFloat(o.width)),h=r.regionTop*g;let e=r.regionRight*g-(t*g-a)/2;e=Math.max(e,0),e=Math.min(e,parseFloat(o.width)),d=e-u,f=(r.regionBottom-r.regionTop)*g}else{g=a/t,u=r.regionLeft*g,h=r.regionTop*g-(i*g-s)/2,h=Math.max(h,0),h=Math.min(h,parseFloat(o.height));let e=r.regionBottom*g-(i*g-s)/2;e=Math.max(e,0),e=Math.min(e,parseFloat(o.height)),d=(r.regionRight-r.regionLeft)*g,f=e-h}else u=0,h=0,d=0,f=0;this._divScanArea.style.left=u+"px",this._divScanArea.style.top=h+"px",this._divScanArea.style.width=d+"px",this._divScanArea.style.height=f+"px"}set croppingRegions(e){this._croppingRegions=e,this._bFetchingLoopStarted&&(this.bIncreaseRegionIndexAuto&&(this._croppingRegionIndex=0),this._fetchingLoop(!1))}get croppingRegions(){if(void 0!==this._croppingRegions)return this._croppingRegions;if(this._controler){const e=this._controler.getPropertyDisiredValue("croppingRegions");if(e&&1===e.length)return e[0]}return this._defaultCroppingRegions}set croppingRegionIndex(e){e<0?(this.bIncreaseRegionIndexAuto=!0,this._croppingRegionIndex=0):(this.bIncreaseRegionIndexAuto=!1,this._croppingRegionIndex=e)}get croppingRegionIndex(){return this._croppingRegionIndex}set loopInterval(e){if(e<0)throw new Error("'Invalid value.");this._loopInterval=e,this._bFetchingLoopStarted&&this._fetchingLoop(!1)}get loopInterval(){if(void 0!==this._loopInterval)return this._loopInterval;if(this._controler){const e=this._controler.getPropertyDisiredValue("loopInterval");if(e&&1===e.length)return e[0]}return this._defaultLoopInterval}set maxNumberOfFramesInBuffer(e){if(e<=0)throw new Error("Invalid value.");for(this._maxNumberOfFramesInBuffer=e;this._frameQueue&&this._frameQueue.length>this.maxNumberOfFramesInBuffer;)this._frameQueue.shift()}get maxNumberOfFramesInBuffer(){if(void 0!==this._maxNumberOfFramesInBuffer)return this._maxNumberOfFramesInBuffer;if(this._controler){const e=this._controler.getPropertyDisiredValue("maxNumberOfFramesInBuffer");if(e&&1===e.length)return e[0]}return this._defaultMaxNumberOfFramesInBuffer}get numberOfFramesInBuffer(){return this._frameQueue.length}set refreshInterval(e){this._refreshInterval=e}get refreshInterval(){if(void 0!==this._refreshInterval)return this._refreshInterval;if(this._controler){const e=this._controler.getPropertyDisiredValue("refreshInterval");if(e&&1===e.length)return e[0]}return this._defaultRefreshInterval}static async createInstance(e){let t=new H;("string"==typeof e||e instanceof String)&&(e=JSON.parse(e));for(let i in e)t[i]=e[i];return this._hasEngineResourceLoaded=!0,H.onWarning&&(location&&"file:"===location.protocol?setTimeout((()=>{H.onWarning&&H.onWarning({id:1,message:"The page is opened over file:// and Dynamsoft Camera Enhancer may not work properly. Please open the page via https://."})}),0):!1!==window.isSecureContext&&navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||setTimeout((()=>{H.onWarning&&H.onWarning({id:2,message:"Dynamsoft Camera Enhancer may not work properly in a non-secure context. Please open the page via https://."})}),0)),t._drawingLayerManager=new U,t}static async playVideo(e,t,i){if(!e)throw new Error("Invalid 'videoEl'.");if(!t)throw new Error("Invalid 'source'.");return new Promise((async(n,r)=>{let o;const a=()=>{e.removeEventListener("loadstart",u),e.removeEventListener("abort",h),e.removeEventListener("play",d),e.removeEventListener("error",f),e.removeEventListener("loadedmetadata",m)};let s=!1;const l=()=>{s=!0,o&&clearTimeout(o),a(),n(e)},c=e=>{o&&clearTimeout(o),a(),r(e)},u=()=>{e.addEventListener("abort",h,{once:!0})},h=()=>{const e=new Error("Video playing was interrupted.");e.name="AbortError",c(e)},d=()=>{l()},f=()=>{c(new Error(`Video error ${e.error.code}: ${e.error.message}.`))};let g;const p=new Promise((e=>{g=e})),m=()=>{g()};if(e.addEventListener("loadstart",u,{once:!0}),e.addEventListener("play",d,{once:!0}),e.addEventListener("error",f,{once:!0}),e.addEventListener("loadedmetadata",m,{once:!0}),"string"==typeof t||t instanceof String?e.src=t:e.srcObject=t,e.autoplay&&await new Promise((e=>{setTimeout(e,1e3)})),!s){i&&(o=setTimeout((()=>{a(),r(new Error("Failed to play video. Timeout."))}),i));try{e.src&&await e.load(),await e.play(),l()}catch(e){console.warn("1st play error: "+((null==e?void 0:e.message)||e))}if(!s){await p;try{await e.play(),l()}catch(e){console.warn("2rd play error: "+((null==e?void 0:e.message)||e)),c(e)}}}}))}static findBestRearCameraInIOS(e){if(!e||!e.length)return null;const t=["\ud6c4\uba74","\u80cc\u9762","\u5f8c\u7f6e","\u540e\u7f6e","\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07","\u092c\u0948\u0915","\u062e\u0644\u0641\u064a\u0629","\u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u0437\u0430\u0434\u043d\u044f\u044f","\u0437\u0430\u0434\u043d\u0435\u0439","\u0437\u0430\u0434\u043d\u0430","\u03c0\u03af\u03c3\u03c9","zadn\xed","zadn\xe1","tylny","trasera","traseira","taka","stra\u017enja","spate","sau","r\xfcck","posteriore","posterior","h\xe1ts\xf3","belakang","baksidan","bakre","bak","bagside","back","a\u0440\u0442\u049b\u044b","arri\xe8re","arka","achterzijde"],i=["\ud2b8\ub9ac\ud50c","\u4e09\u955c\u5934","\u4e09\u93e1\u982d","\u30c8\u30ea\u30d7\u30eb","\u0e2a\u0e32\u0e21","\u091f\u094d\u0930\u093f\u092a\u0932","\u062b\u0644\u0627\u062b\u064a\u0629","\u05de\u05e9\u05d5\u05dc\u05e9\u05ea","\u04af\u0448\u0442\u0456\u043a","\u0442\u0440\u043e\u0439\u043d\u0430\u044f","\u0442\u0440\u043e\u0439\u043d\u0430","\u043f\u043e\u0442\u0440\u043e\u0454\u043d\u0430","\u03c4\u03c1\u03b9\u03c0\u03bb\u03ae","\xfc\xe7l\xfc","tr\xf3jobiektywowy","trostruka","trojn\xfd","trojit\xe1","trippelt","trippel","tripl\u0103","triple","tripla","tiga","kolmois","ba camera"],n=["\ub4c0\uc5bc \uc640\uc774\ub4dc","\u96d9\u5ee3\u89d2","\u53cc\u5e7f\u89d2","\u30c7\u30e5\u30a2\u30eb\u5e83\u89d2","\u0e04\u0e39\u0e48\u0e14\u0e49\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07\u0e21\u0e38\u0e21\u0e01\u0e27\u0e49\u0e32\u0e07","\u0921\u094d\u092f\u0941\u0905\u0932 \u0935\u093e\u0907\u0921","\u0645\u0632\u062f\u0648\u062c\u0629 \u0639\u0631\u064a\u0636\u0629","\u05db\u05e4\u05d5\u05dc\u05d4 \u05e8\u05d7\u05d1\u05d4","\u049b\u043e\u0441 \u043a\u0435\u04a3 \u0431\u04b1\u0440\u044b\u0448\u0442\u044b","\u0437\u0434\u0432\u043e\u0454\u043d\u0430 \u0448\u0438\u0440\u043e\u043a\u043e\u043a\u0443\u0442\u043d\u0430","\u0434\u0432\u043e\u0439\u043d\u0430\u044f \u0448\u0438\u0440\u043e\u043a\u043e\u0443\u0433\u043e\u043b\u044c\u043d\u0430\u044f","\u0434\u0432\u043e\u0439\u043d\u0430 \u0448\u0438\u0440\u043e\u043a\u043e\u044a\u0433\u044a\u043b\u043d\u0430","\u03b4\u03b9\u03c0\u03bb\u03ae \u03b5\u03c5\u03c1\u03b5\u03af\u03b1","\xe7ift geni\u015f","laajakulmainen kaksois","k\xe9p r\u1ed9ng m\u1eb7t sau","kett\u0151s, sz\xe9les l\xe1t\xf3sz\xf6g\u0171","grande angular dupla","ganda","dwuobiektywowy","dwikamera","dvostruka \u0161iroka","du\xe1ln\xed \u0161iroko\xfahl\xfd","du\xe1lna \u0161irokouhl\xe1","dupla grande-angular","dubl\u0103","dubbel vidvinkel","dual-weitwinkel","dual wide","dual con gran angular","dual","double","doppia con grandangolo","doble","dobbelt vidvinkelkamera"],r=e.filter((e=>{const i=e.label.toLowerCase();return t.some((e=>i.includes(e)))}));if(!r.length)return null;const o=r.find((e=>{const t=e.label.toLowerCase();return i.some((e=>t.includes(e)))}));if(o)return o.deviceId;const a=r.find((e=>{const t=e.label.toLowerCase();return n.some((e=>t.includes(e)))}));return a?a.deviceId:r[0].deviceId}static findBestRearCamera(e){if(!e||!e.length)return null;if(["iPhone","iPad","Mac"].includes(b.OS))return H.findBestRearCameraInIOS(e);const t=["\ud6c4","\u80cc\u9762","\u80cc\u7f6e","\u5f8c\u9762","\u5f8c\u7f6e","\u540e\u9762","\u540e\u7f6e","\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07","\u0e2b\u0e25\u0e31\u0e07","\u092c\u0948\u0915","\u062e\u0644\u0641\u064a\u0629","\u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u0437\u0430\u0434\u043d\u044f\u044f","\u0437\u0430\u0434\u043d\u044f","\u0437\u0430\u0434\u043d\u0435\u0439","\u0437\u0430\u0434\u043d\u0430","\u03c0\u03af\u03c3\u03c9","zadn\xed","zadn\xe1","tylny","tr\xe1s","trasera","traseira","taka","stra\u017enja","spate","sau","r\xfcck","rear","posteriore","posterior","h\xe1ts\xf3","darrere","belakang","baksidan","bakre","bak","bagside","back","a\u0440\u0442\u049b\u044b","arri\xe8re","arka","achterzijde"];for(let i of e){const e=i.label.toLowerCase();if(e&&t.some((t=>e.includes(t)))&&/\b0(\b)?/.test(e))return i.deviceId}return["Android","HarmonyOS"].includes(b.OS)?e[e.length-1].deviceId:null}constructor(){this._maxCvsSideLength=void 0,this._defaultMaxCvsSideLength=null,this._predefinedResolutions=[{width:160,height:120},{width:320,height:240},{width:480,height:360},{width:640,height:480},{width:800,height:600},{width:960,height:720},{width:1280,height:720},{width:1920,height:1080},{width:2560,height:1440},{width:3840,height:2160}],this._mapCameraResolutions=new Map,this._bWebGLSupported=!0,this.extraBindings=[],this._cvsSingleFrameMode=null,this._cvsOriginalImage=null,this._imgWidth=0,this._imgHeight=0,this._singleFrameInputContainer=null,this._clickIptSingleFrameMode=()=>{if(!this._isSingleFrameModeEnabled())return;if(this.getDrawingLayers().some((e=>"editor"==e.getMode())))return;let e;if(this._singleFrameInputContainer)e=this._singleFrameInputContainer.firstElementChild;else{e=document.createElement("input"),e.setAttribute("type","file"),"camera"===this.singleFrameMode?(e.setAttribute("capture",""),e.setAttribute("accept","image/*")):1!=this.singleFrameMode&&"image"!==this.singleFrameMode||(e.removeAttribute("capture"),e.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp")),e.addEventListener("change",(async()=>{const t=e.files[0];e.value="";const i=await(async e=>{let t=null,i=null;if("undefined"!=typeof createImageBitmap)try{if(t=await createImageBitmap(e),t)return t}catch(e){}var n;return t||(i=await(n=e,new Promise(((e,t)=>{let i=URL.createObjectURL(n),r=new Image;r.src=i,r.onload=()=>{URL.revokeObjectURL(r.src),e(r)},r.onerror=e=>{t(new Error("Can't convert blob to image : "+(e instanceof Event?e.type:e)))}})))),i})(t),n=i instanceof HTMLImageElement?i.naturalWidth:i.width,r=i instanceof HTMLImageElement?i.naturalHeight:i.height;this._imgWidth=n,this._imgHeight=r;const o=e=>{const t=Date.now();if(0===n||0===r)return null;if(e instanceof HTMLImageElement&&!e.complete)throw new Error("The source is not loaded.");const i=this._scanRegion,o=this.getFrameSize(n,r,i,this.maxCvsSideLength);if(!o)return null;let a=!0;n===o.sWidth&&r===o.sHeight&&(a=!1);const s=this.mapPixelFormatString_Enum.get(this.framePixelFormat.toLowerCase()),l={data:null,region:i?JSON.parse(JSON.stringify(i)):null,sx:o.sx,sy:o.sy,width:o.dWidth,height:o.dHeight,colorMode:null,pixelFormat:null,timeSpent:null,timeStamp:null,isCropped:a,toCanvas:this._toCanvas,_sWidth:o.sWidth,_sHeight:o.sHeight,_bUseWebGL:null},c=this._getImageData(e,n,r,o,null,{pixelFormat:s});if(!c)return null;const u=Date.now();return H._onLog&&H._onLog("DCE: _getVideoData(region?) END: "+u),l.data=c.data,l.pixelFormat=l.colorMode=c.pixelFormat,l._bUseWebGL=c._bUseWebGL,l.timeSpent=u-t,l.timeStamp=u,c.pixelFormat===G.GREY?l.stride=l.width:l.stride=4*l.width,l};(e=>{let t=this._cvsSingleFrameMode;if(!t){if(t=document.createElement("canvas"),!this._videoContainer)throw new Error("Unable to find video element");this._videoContainer.after(t),t.style.position="absolute",t.style.width="100%",t.style.height="100%",t.style.left="0",t.style.top="0",t.style.objectFit="contain",t.style.pointerEvents="none",this._cvsSingleFrameMode=t}t.width==n&&t.height==r||(t.width=n,t.height=r);const i=t.getContext("2d");i.clearRect(0,0,t.width,t.height),i.drawImage(e,0,0)})(i),this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let e of this._arrScanRegionOverlays)e&&this._updateScanRegionOverlay(e);let a;this._updateDrawingLayersSize();try{a=o(i)}catch(e){throw e}const s=this.mapCameraEvents.get("singleframeacquired");for(let l of s)if(l)try{const e={data:new Uint8Array(a.data),region:JSON.parse(JSON.stringify(a.region)),sx:a.sx,sy:a.sy,width:a.width,height:a.height,stride:a.stride,colorMode:a.colorMode,pixelFormat:a.pixelFormat,timeSpent:a.timeSpent,timeStamp:a.timeStamp,isCropped:a.isCropped,toCanvas:a.toCanvas,_sWidth:a._sWidth,_sHeight:a._sHeight,_bUseWebGL:a._bUseWebGL};await l.apply(this,[e])}catch(e){console.error(e)}})),e.style.position="absolute",e.style.top="-9999px",e.style.backgroundColor="transparent",e.style.color="transparent";const t=document.createElement("div");t.append(e),t.style.position="absolute",t.style.width="1px",t.style.height="1px",t.style.overflow="hidden",t.style.pointerEvents="none",this._elContainer.prepend(t),this._singleFrameInputContainer=t}null==e||e.click()},this.styleEls=[],this._framePixelFormat=void 0,this._defaultFramePixelFormat="rgba",this.mapPixelFormatString_Enum=new Map([["grey",G.GREY],["grey32",G.GREY32],["rgba",G.RGBA],["rbga",G.RBGA],["grba",G.GRBA],["gbra",G.GBRA],["brga",G.BRGA],["bgra",G.BGRA]]),this.shaderPixelFormat=G.RGBA,this.maxVideoCvsLength=3,this._reusedCvs=null,this._reusedWebGLCvs=null,this._tempDataContainer=null,this._webGLTexture=null,this._webGLProgramInfo=null,this._webGLBuffers=null,this._softwareScale=1,this._scaleCenter={x:0,y:0},this._focusParameters={maxTimeout:400,minTimeout:300,kTimeout:void 0,oldDistance:null,fds:null,isDoingFocus:0,taskBackToContinous:null,curFocusTaskId:0,focusCancelableTime:1500,defaultFocusAreaSizeRatio:6,focusBackToContinousTime:5e3,tapFocusMinDistance:null,tapFocusMaxDistance:null,_focusArea:null},this._tapFocusEnabled=!0,this._focusSupported=!0,this._tapDoFocus=async e=>{if(this._touchMoved)return void(this._touchMoved=!1);if(!this._tapFocusEnabled)return;if(!this._bOpen)return;if(this._isSingleFrameModeEnabled())return;if(!this._video||this._video.paused)return;if(!this._videoTrack)return;if(!this._focusSupported)return;if(this.getDrawingLayers().some((e=>"editor"==e.getMode())))return;if(!this._focusParameters.fds&&(this._focusParameters.fds=(await this.getCapabilities()).focusDistance,!this._focusParameters.fds))return void(this._focusSupported=!1);if(null==this._focusParameters.kTimeout&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),1==this._focusParameters.isDoingFocus)return;let t,i,n,r;if(this._focusParameters.taskBackToContinous&&(clearTimeout(this._focusParameters.taskBackToContinous),this._focusParameters.taskBackToContinous=null),e instanceof MouseEvent)t=e.clientX,i=e.clientY;else{if(!(e instanceof TouchEvent))throw new Error("Unknown event type.");if(!e.changedTouches.length)return;t=e.changedTouches[0].clientX,i=e.changedTouches[0].clientY}const o=this.getVideoFit(),a=this._video.videoWidth,s=this._video.videoHeight,l=this._elContainer.getBoundingClientRect(),c=l.left,u=l.top,h=window.getComputedStyle(this._elContainer),d=parseFloat(h.width),f=parseFloat(h.height),g=d/f,p=a/s;let m=1;if("contain"===o)p>g?(m=d/a,n=(t-c)/m,r=(i-u-(f-d/p)/2)/m):(m=f/s,r=(i-u)/m,n=(t-c-(d-f*p)/2)/m);else{if("cover"!==o)throw new Error("Unsupported object-fit.");p>g?(m=f/s,r=(i-u)/m,n=(t-c+(f*p-d)/2)/m):(m=d/a,n=(t-c)/m,r=(i-u+(d/p-f)/2)/m)}const _={x:n+"px",y:r+"px"},v=2*Math.round(Math.min(a,s)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px",y=v;await this._setLocalFocus(_,v,y,this._focusParameters.tapFocusMinDistance,this._focusParameters.tapFocusMaxDistance),this._focusParameters.taskBackToContinous=setTimeout((()=>{this._videoTrack&&this._videoTrack.applyConstraints({advanced:[{focusMode:"continuous"}]}).catch((()=>{}))}),this._focusParameters.focusBackToContinousTime)},this._touchMoved=!1,this._touchMoveEvent=()=>{this._touchMoved=!0},this._recordedStates={},this.playCallbackInfo=null,this._toCanvas=function(){const e=document.createElement("canvas");let t;if(e.width=this.width,e.height=this.height,"grey"===(this.pixelFormat||this.colorMode)){t=new Uint8ClampedArray(this.width*this.height*4);for(let e=0;e<t.length;e+=4)t[e]=this.data[e/4],t[e+1]=this.data[e/4],t[e+2]=this.data[e/4],t[e+3]=255}else t=new Uint8ClampedArray(this.data.buffer);const i=new ImageData(t,this.width,this.height);return e.getContext("2d").putImageData(i,0,0),e},this._onCameraSelChange=async()=>{await this.selectCamera(this._selCam.value),this._bOpen||this.stop()},this._onResolutionSelChange=async()=>{let e,t;if(this._selRsl&&-1!=this._selRsl.selectedIndex){let i=this._selRsl.options[this._selRsl.selectedIndex];e=i.getAttribute("data-width"),t=i.getAttribute("data-height")}await this.setResolution(e,t),this._bOpen||this.stop()},this._onCloseBtnClick=()=>{this.close(!0)},this._bOpen=!1,this.isCameraEnhancer=!0,this.isDisposed=!1,this.disposed=!1,this.videoSrc=null,this.cameraOpenTimeout=4e3,this.videoSettings={video:{width:{ideal:1280},height:{ideal:720},facingMode:{ideal:"environment"}}},this.iPlayRound=0,this.promisePlay=null,this._ifSaveLastUsedCamera=!1,this.ifSkipCameraInspection=!1,this._allCameras=[],this._currentCamera=null,this._videoTrack=null,this._lastDeviceId=void 0,this._vc_bPlayingVideoBeforeHide=!1,this._ev_documentHideEvent=()=>{this._isSingleFrameModeEnabled()||("visible"===document.visibilityState?(H._onLog&&H._onLog("DCE: document visible."),this._video&&this._bOpen&&(async()=>{let e=!1;if(this._video.paused){H._onLog&&H._onLog("document visible. Not auto resume. 1st resume start.");try{await this._video.play(),e=!0}catch(e){H._onLog&&H._onLog("document visible. 1st resume video failed, try open instead.")}e||await this.play()}if(await new Promise((e=>setTimeout(e,300))),this._video.paused){H._onLog&&H._onLog("document visible. 1st open failed. 2rd resume start."),e=!1;try{await this._video.play(),e=!0}catch(e){H._onLog&&H._onLog("document visible. 2rd resume video failed, try open instead.")}e||await this.play()}})()):"hidden"===document.visibilityState&&(H._onLog&&H._onLog("DCE: document hidden."),this._video&&this._bOpen&&(this._video.paused||this.pause())))},this.containerClassName="dce-video-container",this._elContainer=null,this._videoContainer=null,this._video=null,this.videoFit="contain",this._cvsScanRegion=null,this._divScanArea=null,this._divScanLight=null,this._bgLoading=null,this._selCam=null,this._bgCamera=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,this.regionMaskFillStyle="rgba(0,0,0,0.5)",this.regionMaskStrokeStyle="rgb(254,142,20)",this.regionMaskLineWidth=2,this._bShowScanRegionMask=!0,this._bShowScanRegionLaser=void 0,this._defaultBShowScanRegionLaser=!1,this._scanRegion=null,this._arrScanRegionOverlays=[],this._layerBaseCvs=null,this._drawingLayerOfTip=null,this._tipArgs={x:void 0,y:void 0,width:void 0,duration:void 0,autoShowSuggestedTip:void 0},this._hideTipTimeoutId=null,this.onTipSuggested=null,this._cvsViewDecorator=null,this._decoratorType=[],this._decoratorArea=null,this._viewDecoratorInfo={rectangle:{lineWidth:4,strokeStyle:"rgb(254,142,20)",fillStyle:"transparent",maskFillStyle:"transparent"},focus:{lineWidth:4,strokeStyle:"rgb(254,142,20)",fillStyle:"transparent",maskFillStyle:"transparent"},crossline:{lineWidth:2,strokeStyle:"rgb(254,142,20)"},crosshair:{lineWidth:4,strokeStyle:"rgb(254,142,20)"}},this._croppingRegions=void 0,this._defaultCroppingRegions=[null],this.bIncreaseRegionIndexAuto=!0,this._croppingRegionIndex=0,this._loopInterval=void 0,this._defaultLoopInterval=0,this._maxNumberOfFramesInBuffer=void 0,this._defaultMaxNumberOfFramesInBuffer=1,this._frameQueue=[],this._bFetchingLoopStarted=!1,this._refreshInterval=void 0,this._defaultRefreshInterval=-1,this._updateLayersTimeout=500,this._updateLayers=()=>{this._cvsScanRegion&&(this._cvsScanRegion.style.display="none"),this._divScanLight&&(this._divScanLight.style.display="none"),this._cvsViewDecorator&&(this._cvsViewDecorator.style.display="none");for(let e of this._arrScanRegionOverlays)e&&(e.style.display="none");this._resizeTimeoutId&&clearTimeout(this._resizeTimeoutId),this._resizeTimeoutId=setTimeout((()=>{if(!this.isDisposed||!this.disposed){this.ifShowScanRegionMask&&this.showScanRegionMask(),this.ifShowScanRegionLaser&&this.showScanRegionLaser(),this._cvsViewDecorator&&this.showViewDecorator(),this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let e of this._arrScanRegionOverlays)e&&(e.style.display="",this._updateScanRegionOverlay(e));this._updateDrawingLayersSize(),this._updateVideoContainerStyle()}}),this._updateLayersTimeout)},this._windowResizeListener=()=>{this._windowWidth!==document.documentElement.clientWidth&&(this._windowWidth=document.documentElement.clientWidth,this._updateLayers())},this.mapCameraEvents=new Map([["cameraopen",[]],["cameraclose",[]],["camerachange",[]],["resolutionchange",[]],["played",[]],["singleframeacquired",[]],["frameaddedtobuffer",[]]]),this._controler=null,navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?this._singleFrameMode=!1:this._singleFrameMode=!0}_isSingleFrameModeEnabled(){return 0!=this.singleFrameMode}async play(e,t,i,n){let r;if(this._video&&this.videoSrc){H._onLog&&(r=Date.now(),H._onLog("DCE: start loading static video: "+r));const e=await H.playVideo(this._video,this.videoSrc,this.cameraOpenTimeout);if(H._onLog&&H._onLog("DCE: finish loading static video. Costs: "+(Date.now()-r)),!this._video)return e.pause(),this.playCallbackInfo={width:0,height:0,deviceId:null},{width:0,height:0,deviceId:null};const t={width:this._video.videoWidth,height:this._video.videoHeight,deviceId:this._currentCamera&&this._currentCamera.deviceId};this.playCallbackInfo=JSON.parse(JSON.stringify(t));const i=this.mapCameraEvents.get("played");for(let n of i){if(!n)continue;const e=JSON.parse(JSON.stringify(t));setTimeout((()=>{this.isDisposed&&this.disposed||n.apply(this,[e])}),0)}return this._recordedStates.videoPlaying=!0,t}if(this._isSingleFrameModeEnabled())return n&&n.notTriggerSingleFrameClick||this._clickIptSingleFrameMode(),this.playCallbackInfo={width:0,height:0,deviceId:null},{width:0,height:0,deviceId:null};if(!this._video)throw new Error("'video' is null or undefined.");const o=++this.iPlayRound;if(this.promisePlay&&(await this.promisePlay,o<this.iPlayRound))return this.playCallbackInfo={width:this._video.videoWidth,height:this._video.videoHeight,deviceId:this._currentCamera&&this._currentCamera.deviceId},{width:this._video.videoWidth,height:this._video.videoHeight,deviceId:this._currentCamera&&this._currentCamera.deviceId};this.promisePlay=(async()=>{var r;try{this._video&&this._video.srcObject&&this.stop(),H._onLog&&H._onLog("DCE: ======before video========");const o=()=>{if(!this._video)throw l&&l.getTracks().forEach((e=>{e.stop()})),this._videoTrack=null,this._currentCamera=null,new Error("'video' is null or undefined.")},a=this.getVideoSettings();let s,l;if("boolean"==typeof a.video&&(a.video={}),e)delete a.video.facingMode,a.video.deviceId={exact:e};else if(a.video.deviceId);else if(this._lastDeviceId)delete a.video.facingMode,a.video.deviceId={exact:this._lastDeviceId};else if(this.ifSaveLastUsedCamera&&H.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")){delete a.video.facingMode,a.video.deviceId={ideal:window.localStorage.getItem("dce_last_camera_id")};const e=JSON.parse(window.localStorage.getItem("dce_last_apply_width")),t=JSON.parse(window.localStorage.getItem("dce_last_apply_height"));e&&t&&(a.video.width=e,a.video.height=t)}else if(this.ifSkipCameraInspection);else if(a.video.facingMode){if(await this.getAllCameras(!1),!this._video)throw new Error("'video' is null or undefined.");let e=a.video.facingMode;if(e instanceof Array&&e.length&&(e=e[0]),e=e.exact||e.ideal||e,"environment"===e){s=!0;const e=H.findBestRearCamera(this._allCameras);e&&(delete a.video.facingMode,a.video.deviceId={exact:e})}}t&&(a.video.width={ideal:t}),i&&(a.video.height={ideal:i}),H._onLog&&H._onLog("======try getUserMedia========");let c=[0,500,1e3,2e3],u=null;const h=async e=>{for(let t of c){t&&(await new Promise((e=>setTimeout(e,t))),o());try{H._onLog&&H._onLog("ask "+JSON.stringify(e)),l=await navigator.mediaDevices.getUserMedia(e),o();break}catch(e){if("NotFoundError"===e.name||"NotAllowedError"===e.name||"AbortError"===e.name||"OverconstrainedError"===e.name)throw e;u=e,H._onLog&&H._onLog(e.message||e)}}};try{if(await h(a),l||"object"!=typeof a.video||(a.video.deviceId&&(delete a.video.deviceId,await h(a)),!l&&a.video.facingMode&&(delete a.video.facingMode,await h(a)),l||!a.video.width&&!a.video.height||(delete a.video.width,delete a.video.height,await h(a))),!l)throw u}catch(e){throw null==l||l.getTracks().forEach((e=>{e.stop()})),"NotFoundError"===e.name&&(DOMException?e=new DOMException("No camera available, please use a device with an accessible camera.",e.name):(e=new Error("No camera available, please use a device with an accessible camera.")).name="NotFoundError"),e}const d=()=>{const e=l.getVideoTracks();let t,i;if(e.length&&(t=this._videoTrack=e[0]),this._video&&t){const e=t.getSettings();if(e)for(let n of this._allCameras)if(e.deviceId===n.deviceId){n._checked=!0,n.label=t.label,i=n;break}}this._currentCamera=i};if(await this.getAllCameras(!1),o(),s&&!this.ifSkipCameraInspection){d();const e=H.findBestRearCamera(this._allCameras),t=null===(r=this._currentCamera)||void 0===r?void 0:r.deviceId;e&&e!=t&&(l.getTracks().forEach((e=>{e.stop()})),a.video.deviceId={exact:e},await h(a))}H._onLog&&H._onLog("DCE: ======play video========"),o(),await H.playVideo(this._video,l,this.cameraOpenTimeout),o(),H._onLog&&H._onLog("DCE: ======played video========"),this._bgLoading&&(this._bgLoading.style.animationPlayState="paused");const f="got "+this._video.videoWidth+"x"+this._video.videoHeight;this._optGotRsl&&(this._optGotRsl.setAttribute("data-width",this._video.videoWidth),this._optGotRsl.setAttribute("data-height",this._video.videoHeight),this._optGotRsl.innerText=f,this._selRsl&&this._optGotRsl.parentNode==this._selRsl&&(this._selRsl.value="got")),H._onLog&&H._onLog("DCE: got "+f),d(),this._renderSelCameraInfo();const g={width:this._video.videoWidth,height:this._video.videoHeight,deviceId:this._currentCamera&&this._currentCamera.deviceId};if(g.deviceId&&(this._lastDeviceId=g.deviceId,this.ifSaveLastUsedCamera&&H.isStorageAvailable&&(window.localStorage.setItem("dce_last_camera_id",this._lastDeviceId),a.video.width&&a.video.height&&(window.localStorage.setItem("dce_last_apply_width",JSON.stringify(a.video.width)),window.localStorage.setItem("dce_last_apply_height",JSON.stringify(a.video.height))))),!n||!n.notTriggerPlayedEvent){const e=this.mapCameraEvents.get("played");for(let t of e){if(!t)continue;const e=JSON.parse(JSON.stringify(g));setTimeout((()=>{this.isDisposed&&this.disposed||t.apply(this,[e])}),0)}}return this.promisePlay=null,g}catch(e){throw this.promisePlay=null,this._bgLoading&&(this._bgLoading.style.display="none"),"NotFoundError"===e.name&&(DOMException?e=new DOMException("No camera available, please use a device with an accessible camera.",e.name):(e=new Error("No camera available, please use a device with an accessible camera.")).name="NotFoundError"),e}})(),H._onLog&&(r=Date.now(),H._onLog("DCE: start opening camera: "+r));const a=await this.promisePlay;return H._onLog&&H._onLog("DCE: finish opening camera. Costs: "+(Date.now()-r)),this.playCallbackInfo=JSON.parse(JSON.stringify(a)),this._recordedStates.videoPlaying=!0,a}async resume(){this._assertOpen(),this._video&&(await this._video.play(),this._recordedStates.videoPlaying=!0),this.ifShowScanRegionLaser&&this.showScanRegionLaser()}pause(){this._assertOpen(),this._video&&(this._video.pause(),this._recordedStates.videoPlaying=!1),this.ifShowScanRegionLaser&&this.hideScanRegionLaser()}isPaused(){var e;return!this._isSingleFrameModeEnabled()&&!0===(null===(e=this._video)||void 0===e?void 0:e.paused)}_bindUI(){if(!this.UIElement)throw new Error("Need to define `UIElement` before opening.");const e=[this.UIElement];for(let t=0;t<e.length;++t)for(let i of e[t].children)e.push(i);for(let t of e){if(!this._video&&t.classList.contains(this.containerClassName)){this._elContainer=t;const e=document.createElement("video");e.style.position="absolute",e.style.left="0",e.style.top="0",e.style.width="100%",e.style.height="100%",e.style.objectFit=this.getVideoFit(),e.setAttribute("autoplay","true"),e.setAttribute("playsinline","true"),e.setAttribute("muted","true"),["iPhone","iPad","Mac"].includes(b.OS)&&b.version>=17&&e.setAttribute("poster","data:image/gif;base64,R0lGODlhAQABAIEAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAgEAAEEBAA7"),this._video=e;const i=document.createElement("div");i.append(e),i.style.position="absolute",i.style.left="0",i.style.top="0",i.style.width="100%",i.style.height="100%",i.style.overflow="hidden",this._videoContainer=i,t.prepend(i)}else!this._divScanArea&&t.classList.contains("dce-scanarea")?this._divScanArea=t:!this._divScanLight&&t.classList.contains("dce-scanlight")?this._divScanLight=t:!this._bgLoading&&t.classList.contains("dce-bg-loading")?this._bgLoading=t:!this._bgCamera&&t.classList.contains("dce-bg-camera")?this._bgCamera=t:!this._selCam&&t.classList.contains("dce-sel-camera")?this._selCam=t:!this._selRsl&&t.classList.contains("dce-sel-resolution")?(this._selRsl=t,this.videoSrc||this._isSingleFrameModeEnabled()||this._selRsl.options.length||(this._selRsl.innerHTML=[this._optGotRsl?"":'<option class="dce-opt-gotResolution" value="got"></option>','<option data-width="1920" data-height="1080">ask 1920x1080</option>','<option data-width="1280" data-height="720">ask 1280x720</option>','<option data-width="640" data-height="480">ask 640x480</option>'].join(""),this._optGotRsl=this._optGotRsl||this._selRsl.options[0])):!this._optGotRsl&&t.classList.contains("dce-opt-gotResolution")?this._optGotRsl=t:!this._btnClose&&t.classList.contains("dce-btn-close")?this._btnClose=t:!this._selMinLtr&&t.classList.contains("dlr-sel-minletter")?(this._selMinLtr=t,this._selMinLtr.options.length||(this._selMinLtr.innerHTML=[this._optGotMinLtr?"":'<option class="dlr-opt-gotMinLtr" value="got"></option>','<option value="0" selected>any letter</option>','<option value="3">3+ letters</option>','<option value="5">5+ letters</option>','<option value="8">8+ letters</option>','<option value="12">12+ letters</option>','<option value="17">17+ letters</option>','<option value="30">30+ letters</option>','<option value="50">50+ letters</option>','<option value="80">80+ letters</option>','<option value="120">120+ letters</option>'].join(""),this._optGotMinLtr=this._optGotMinLtr||this._selMinLtr.options[0])):!this._optGotMinLtr&&t.classList.contains("dlr-opt-gotMinLtr")&&(this._optGotMinLtr=t);if(this.extraBindings&&this.extraBindings.length)for(let i of this.extraBindings)try{i(t)}catch(e){}}if(!this._video)throw this._unbindUI(),Error(`Can not find the video container element with class '${this.containerClassName}'`);this._isSingleFrameModeEnabled()||this.videoSrc?(this._isSingleFrameModeEnabled()&&(this._elContainer&&(this._elContainer.addEventListener("click",this._clickIptSingleFrameMode),this._elContainer.setAttribute("title","Take a photo")),this._bgCamera&&(this._bgCamera.style.display="block")),this._selCam&&(this._selCam.style.display="none"),this._selRsl&&(this._selRsl.style.display="none"),this._selMinLtr&&(this._selMinLtr.style.display="none")):(this._elContainer&&(["Android","HarmonyOS"].includes(b.OS)?(this._elContainer.addEventListener("touchend",this._tapDoFocus),this._elContainer.addEventListener("touchmove",this._touchMoveEvent)):this._elContainer.addEventListener("click",this._tapDoFocus)),this._selCam&&(this._selCam.style.display="block",this._selCam.addEventListener("change",this._onCameraSelChange)),this._selRsl&&(this._selRsl.style.display="block",this._selRsl.addEventListener("change",this._onResolutionSelChange)),this._selMinLtr&&(this._selMinLtr.style.display="block"),this._bgLoading&&(this._bgLoading.style.display="block")),this._btnClose&&this._btnClose.addEventListener("click",this._onCloseBtnClick),document.addEventListener("visibilitychange",this._ev_documentHideEvent),window.ResizeObserver&&(this._resizeObserver||(this._resizeObserver=new ResizeObserver((e=>{for(let t of e)t.target===this._elContainer&&this._updateLayers()}))),this._elContainer&&this._resizeObserver.observe(this._elContainer)),this._windowWidth=document.documentElement.clientWidth,window.addEventListener("resize",this._windowResizeListener)}_unbindUI(){this._isSingleFrameModeEnabled()?(this._elContainer&&(this._elContainer.removeEventListener("click",this._clickIptSingleFrameMode),this._elContainer.removeAttribute("title")),this._bgCamera&&(this._bgCamera.style.display="none")):this._bgLoading&&(this._bgLoading.style.display="none"),this._elContainer&&(this._elContainer.removeEventListener("click",this._tapDoFocus),this._elContainer.removeEventListener("touchend",this._tapDoFocus),this._elContainer.removeEventListener("touchmove",this._touchMoveEvent)),this._selCam&&this._selCam.removeEventListener("change",this._onCameraSelChange),this._selRsl&&this._selRsl.removeEventListener("change",this._onResolutionSelChange),this._btnClose&&this._btnClose.removeEventListener("click",this._onCloseBtnClick),this.hideScanRegionLaser(),this.hideViewDecorator(),this.hideScanRegionOverlays(),this._drawingLayerManager.setVisible(!1),this._hideOriginalImageCvs(),this._videoContainer&&this._videoContainer.remove(),this._video=null,this._videoContainer=null,this._elContainer=null,this._selCam=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,this._divScanArea=null,this._divScanLight=null,this._cvsScanRegion&&(this._cvsScanRegion.remove(),this._cvsScanRegion=null),this._singleFrameInputContainer&&(this._singleFrameInputContainer.remove(),this._singleFrameInputContainer=null),this._cvsSingleFrameMode&&(this._cvsSingleFrameMode.remove(),this._cvsSingleFrameMode=null),document.removeEventListener("visibilitychange",this._ev_documentHideEvent),window.ResizeObserver&&this._resizeObserver&&this._resizeObserver.disconnect(),window.removeEventListener("resize",this._windowResizeListener)}_assertOpen(){if(!this._bOpen)throw Error("The camera is not open.")}async open(e){this.UIElement||await this.setUIElement(H.defaultUIElementURL),this._bindUI(),e&&this.appendAndShowUI();let t=await this.play();this.bOpen=!0,this._focusParameters.fds=null,this._focusParameters.kTimeout=void 0,this._focusSupported=!0,this._tapFocusEnabled&&!this._isSingleFrameModeEnabled()&&(this._focusParameters.fds=(await this.getCapabilities()).focusDistance,this._focusParameters.fds||(this._focusSupported=!1,this._tapFocusEnabled=!1));const i=this.mapCameraEvents.get("cameraopen");for(let n of i){if(!n)continue;const e=JSON.parse(JSON.stringify(t));setTimeout((()=>{this.isDisposed&&this.disposed||n.apply(this,[e])}),0)}return t}close(e){if(!this._video)return;this.stop(),this._hideOriginalImage(!1),this.hideTip(),this._unbindUI(),e&&this.hideUI(),this.stopFetchingLoop(),this.bOpen=!1;const t=this.mapCameraEvents.get("cameraclose");for(let i of t){if(!i)continue;const e={width:0,height:0,deviceId:null};setTimeout((()=>{this.isDisposed&&this.disposed||i.apply(this,[e])}),0)}}stop(){this._video&&this._video.srcObject&&(H._onLog&&H._onLog("DCE: ======stop video========"),this._video.srcObject.getTracks().forEach((e=>{e.stop()})),this._video.srcObject=null,this._videoTrack=null,this._currentCamera=null),this._video&&this.videoSrc&&(H._onLog&&H._onLog("DCE: ======stop existing video========"),this._video.pause(),this._video.currentTime=0),this._bgLoading&&(this._bgLoading.style.animationPlayState=""),this._frameQueue.length=0,this._reusedCvs&&this._reusedCvs.ctx2d&&this._reusedCvs.ctx2d.clearRect(0,0,this._reusedCvs.width,this._reusedCvs.height),this.forceLoseContext()}async getAllCameras(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=(await navigator.mediaDevices.enumerateDevices()).filter((e=>"videoinput"===e.kind));if(e&&t&&t.length&&!t[0].deviceId){let e=await navigator.mediaDevices.getUserMedia({video:!0});t=(await navigator.mediaDevices.enumerateDevices()).filter((e=>"videoinput"===e.kind)),e.getTracks().forEach((e=>{e.stop()}))}const i=[],n=[];if(this._allCameras)for(let r of this._allCameras)r._checked&&n.push(r);for(let r=0;r<t.length;r++){let e,o=t[r];for(let t of n)if(o.deviceId==t.deviceId){e=t;break}e||(e={deviceId:o.deviceId,label:o.label?o.label:"camera "+r,_checked:!1}),e.deviceId&&i.push(e)}return this._allCameras=i,H._onLog&&H._onLog("DCE: "+JSON.stringify(this._allCameras)),i}_renderSelCameraInfo(){if(!this._selCam)return;let e;this._selCam.textContent="";for(let t of this._allCameras){const i=document.createElement("option");i.value=t.deviceId,i.innerText=t.label,this._selCam.append(i),t.deviceId&&this._currentCamera&&this._currentCamera.deviceId==t.deviceId&&(e=i)}this._selCam.value=e?e.value:""}getSelectedCamera(){if(!this._bOpen){let e="";const t=this.videoSettings.video.deviceId;t&&(e=t.exact||t.ideal||t);for(let i of this._allCameras)if(i.deviceId===e)return JSON.parse(JSON.stringify(i));return{deviceId:e,label:"",_checked:!1}}return this._currentCamera}async selectCamera(e){let t="";if(e&&(t=e.deviceId||e),this.videoSettings.video.deviceId={exact:t},!this._bOpen||this._video.paused)return null;let i=null;this._currentCamera&&(i=this._currentCamera.deviceId);const n=this._video.videoWidth,r=this._video.videoHeight,o=await this.play(e.deviceId||e);if(this._focusParameters.fds=null,this._focusParameters.kTimeout=void 0,this._focusSupported=!0,this._tapFocusEnabled&&!this._isSingleFrameModeEnabled()&&(this._focusParameters.fds=(await this.getCapabilities()).focusDistance,this._focusParameters.fds||(this._focusSupported=!1,this._tapFocusEnabled=!1)),i!==o.deviceId){const e=this.mapCameraEvents.get("camerachange");for(let t of e){if(!t)continue;const e=JSON.parse(JSON.stringify(o));setTimeout((()=>{this.isDisposed&&this.disposed||t.apply(this,[e])}),0)}}if(n!==o.width||r!==o.height){this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let t of this._arrScanRegionOverlays)t&&this._updateScanRegionOverlay(t);this._updateDrawingLayersSize(),this._updateVideoContainerStyle();const e=this.mapCameraEvents.get("resolutionchange");for(let t of e){if(!t)continue;const e=JSON.parse(JSON.stringify(o));setTimeout((()=>{this.isDisposed&&this.disposed||t.apply(this,[e])}),0)}}return o}getResolution(){if(this._bOpen)return[this._video.videoWidth,this._video.videoHeight];{let e=0,t=0;const i=this.videoSettings.video.width,n=this.videoSettings.video.height;return i&&(e=i.exact||i.ideal||i),n&&(t=n.exact||n.ideal||n),[e,t]}}async setResolution(e,t){let i,n;if(e instanceof Array?(i=e[0],n=e[1]):(i=e,n=t),this.videoSettings.video.width={ideal:i},this.videoSettings.video.height={ideal:n},!this._bOpen||this._video.paused)return null;const r=this._video.videoWidth,o=this._video.videoHeight,a=await this.play(null,i,n);if(r!==a.width||o!==a.height){this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let t of this._arrScanRegionOverlays)t&&this._updateScanRegionOverlay(t);this._updateDrawingLayersSize(),this._updateVideoContainerStyle();const e=this.mapCameraEvents.get("resolutionchange");for(let t of e){if(!t)continue;const e=JSON.parse(JSON.stringify(a));setTimeout((()=>{this.isDisposed&&this.disposed||t.apply(this,[e])}),0)}}return a}async getResolutions(e){var t,i;let n="";const r=(e,t)=>{const i=this._mapCameraResolutions.get(e);if(!i||!i.length)return!1;for(let n of i)if(n[0]===t.width&&n[1]===t.height)return!0;return!1},o=async(e,t,i)=>{const n={video:{deviceId:{exact:e},width:{ideal:t},height:{ideal:i}}};let r=null;try{r=await navigator.mediaDevices.getUserMedia(n)}catch(e){return null}if(!r)return null;const o=r.getVideoTracks();let a=null;try{const e=o[0].getSettings();a={width:e.width,height:e.height}}catch(e){const t=document.createElement("video");t.srcObject=r,a={width:t.videoWidth,height:t.videoHeight},t.srcObject=null}return o.forEach((e=>{e.stop()})),a};if(!this._bOpen){const a=null===(i=null===(t=this.videoSettings)||void 0===t?void 0:t.video)||void 0===i?void 0:i.deviceId;if(!a)return null;if(n=a.hasOwnProperty("exact")?this.videoSettings.video.deviceId.exact:a.hasOwnProperty("ideal")?this.videoSettings.video.deviceId.ideal:this.videoSettings.video.deviceId,!n)return null;let s=this._mapCameraResolutions.get(n);if(s&&!e)return this._mapCameraResolutions.get(n);this._mapCameraResolutions.set(n,[]),s=this._mapCameraResolutions.get(n);for(let e of this._predefinedResolutions){const t=await o(n,e.width,e.height);t&&!r(n,t)&&s.push([t.width,t.height])}return s}if(this._currentCamera){n=this._currentCamera.deviceId;let t=this._mapCameraResolutions.get(n);if(t&&!e)return this._mapCameraResolutions.get(n);this._mapCameraResolutions.set(n,[]),t=this._mapCameraResolutions.get(n);let i=this._videoTrack;for(let e of this._predefinedResolutions){await i.applyConstraints({width:{ideal:e.width},height:{ideal:e.height}});const o=i.getSettings(),a={width:o.width,height:o.height};r(n,a)||t.push([a.width,a.height])}return this._video.srcObject.getTracks().forEach((e=>{e.stop()})),await this.play(n,null,null,{notTriggerPlayedEvent:!0}),t}return null}on(e,t){if(!t)return;const i=this.mapCameraEvents.get(e.toLowerCase());if(!i)throw new Error(`Event '${e}' does not exist.`);i.includes(t)||i.push(t)}off(e,t){const i=this.mapCameraEvents.get(e.toLowerCase());if(!i)throw new Error(`Event '${e}' does not exist.`);const n=i.indexOf(t);-1!==n&&i.splice(n,1)}offAll(e){if(e){if("string"==typeof e){const t=this.mapCameraEvents.get(e);t&&(t.length=0)}}else for(let t of this.mapCameraEvents.values())t&&(t.length=0)}getVideoSettings(){return JSON.parse(JSON.stringify(this.videoSettings))}updateVideoSettings(e){if(this.videoSettings=JSON.parse(JSON.stringify(e)),this._lastDeviceId=null,this._bOpen)return this.play()}isOpen(){return this._bOpen}getCapabilities(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'getCapabilities()' is unavailable in singleFrameMode.");return this._videoTrack&&this._videoTrack.getCapabilities?this._videoTrack.getCapabilities():{}}getCameraSettings(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'getCameraSettings()' is unavailable in singleFrameMode.");return this._videoTrack?this._videoTrack.getSettings():null}getConstraints(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'getConstraints()' is unavailable in singleFrameMode.");return this._videoTrack?this._videoTrack.getConstraints():null}async applyConstraints(e){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'applyConstraints()' is unavailable in singleFrameMode.");if(!this._videoTrack)throw new Error('"_videoTrack" is null.');if(!this._videoTrack.applyConstraints)throw Error("Not supported.");return await this._videoTrack.applyConstraints(e)}async turnOnTorch(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'turnOnTorch()' is unavailable in singleFrameMode.");if(this.getCapabilities().torch)return await this._videoTrack.applyConstraints({advanced:[{torch:!0}]});throw Error("Not supported.")}async turnOffTorch(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'turnOffTorch()' is unavailable in singleFrameMode.");if(this.getCapabilities().torch)return await this._videoTrack.applyConstraints({advanced:[{torch:!1}]});throw Error("Not supported.")}async setColorTemperature(e){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'setColorTemperature()' is unavailable in singleFrameMode.");let t=this.getCapabilities().colorTemperature;if(!t)throw Error("Not supported.");return e<t.min?e=t.min:e>t.max&&(e=t.max),await this._videoTrack.applyConstraints({advanced:[{colorTemperature:e,whiteBalanceMode:"manual"}]})}getColorTemperature(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'getColorTemperature()' is unavailable in singleFrameMode.");return this._videoTrack?this._videoTrack.getSettings().colorTemperature||0:null}async setExposureCompensation(e){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'setExposureCompensation()' is unavailable in singleFrameMode.");let t=this.getCapabilities().exposureCompensation;if(!t)throw Error("Not supported.");return e<t.min?e=t.min:e>t.max&&(e=t.max),await this._videoTrack.applyConstraints({advanced:[{exposureCompensation:e}]})}getExposureCompensation(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'getExposureCompensation()' is unavailable in singleFrameMode.");return this._videoTrack?this._videoTrack.getSettings().exposureCompensation||0:null}async _setHardwareScale(e){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'_setHardwareScale()' is unavailable in singleFrameMode.");if(e<1)throw new RangeError("Invalid value.");if(!this._videoTrack)return;const t=this.getCapabilities().zoom;if(!t)throw new Error("Not supported.");return e<t.min?e=t.min:e>t.max&&(e=t.max),e=z(e,t.min,t.step,t.max),await this._videoTrack.applyConstraints({advanced:[{zoom:e}]}),e}_getHardwareScale(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'_getHardwareScale()' is unavailable in singleFrameMode.");return this._videoTrack?this._videoTrack.getSettings().zoom||1:null}_setSoftwareScale(e,t){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'_setSoftwareScale()' is unavailable in singleFrameMode.");if(e<1)throw new RangeError("Invalid value.");t&&this._setScaleCenter(t),this._softwareScale=e,this._scaleVideo(e,t)}_getSoftwareScale(){return this._softwareScale}_setScaleCenter(e){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'_setScaleCenter()' is unavailable in singleFrameMode.");if(!e||"string"!=typeof e.x||"string"!=typeof e.y)throw new Error("Invalid center.");const t=this._video.videoWidth,i=this._video.videoHeight;let n=0,r=0;if(e.x.endsWith("px"))n=parseFloat(e.x);else{if(!e.x.endsWith("%"))throw new Error("Invalid scale center.");n=parseFloat(e.x)/100*t}if(e.y.endsWith("px"))r=parseFloat(e.y);else{if(!e.y.endsWith("%"))throw new Error("Invalid scale center.");r=parseFloat(e.y)/100*i}this._scaleCenter={x:n,y:r}}_resetScaleCenter(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'_resetScaleCenter()' is unavailable in singleFrameMode.");const e=this._video.videoWidth,t=this._video.videoHeight;this._scaleCenter={x:e/2,y:t/2}}_isVideoCenter(e){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'_isVideoCenter()' is unavailable in singleFrameMode.");return e&&e.x==this._video.videoWidth/2&&e.y==this._video.videoHeight/2}async _setZoom(e){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'setZoom()' is unavailable in singleFrameMode.");if(e<1)throw new RangeError("Invalid value.");this._resetScaleCenter();try{if(this._isVideoCenter(this._scaleCenter)){const t=await this._setHardwareScale(e);let i=this._getHardwareScale();1==i&&1!=t&&(i=t),e>i?this._setSoftwareScale(e/i):this._setSoftwareScale(1)}else await this._setHardwareScale(1),this._setSoftwareScale(e)}catch(m){if("Not supported."!==(m.message||m))throw m;this._setSoftwareScale(e)}}async setZoom(e){if("number"!=typeof e&&"object"!=typeof e)throw new TypeError("Illegal type of argument.");if("number"==typeof e)return this._setZoom(e);if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'setZoom()' is unavailable in singleFrameMode.");if(e){if("number"!=typeof e.factor)throw new TypeError("Illegal type of 'factor'.");if(e.factor<1)throw new RangeError("Invalid value.");e.centerPoint?this._setScaleCenter(e.centerPoint):this._resetScaleCenter();try{if(this._isVideoCenter(this._scaleCenter)){const t=await this._setHardwareScale(e.factor);let i=this._getHardwareScale();1==i&&1!=t&&(i=t),e.factor>i?this._setSoftwareScale(e.factor/i):this._setSoftwareScale(1)}else await this._setHardwareScale(1),this._setSoftwareScale(e.factor)}catch(m){if("Not supported."!==(m.message||m))throw m;this._setSoftwareScale(e.factor)}}}getZoom(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'getZoom()' is unavailable in singleFrameMode.");return this._videoTrack?this._getHardwareScale()*this._softwareScale:null}getZoomSettings(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'getZoom()' is unavailable in singleFrameMode.");return this._videoTrack?{factor:this._getHardwareScale()*this._softwareScale}:null}async resetZoom(){await this.setZoom({factor:1})}async setFrameRate(e){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'setFrameRate()' is unavailable in singleFrameMode.");let t=this.getCapabilities().frameRate;if(!t)throw Error("Not supported.");return e<t.min?e=t.min:e>t.max&&(e=t.max),await this._videoTrack.applyConstraints({width:{ideal:Math.max(this._video.videoWidth,this._video.videoHeight)},frameRate:e})}getFrameRate(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'getFrameRate()' is unavailable in singleFrameMode.");return this._videoTrack?this._videoTrack.getSettings().frameRate:null}async _setFocus(e,t){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'setFocus()' is unavailable in singleFrameMode.");if("string"!=typeof e)throw Error("Invalid focus mode.");e=e.toLowerCase();const i=this.getCapabilities().focusMode,n=this.getCapabilities().focusDistance;if(!i)throw Error("Not supported.");if(!i.includes(e))throw Error("Unsupported mode.");if(t>=0){if(!n)throw Error("Manual focus unsupported.");return t<n.min?t=n.min:t>n.max&&(t=n.max),t=z(t,n.min,n.step,n.max),await this._videoTrack.applyConstraints({advanced:[{focusMode:e,focusDistance:t}]})}return await this._videoTrack.applyConstraints({advanced:[{focusMode:e}]})}async setFocus(e,t){if("string"==typeof e)return this._setFocus(e,t);if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'setFocus()' is unavailable in singleFrameMode.");if(!e)return;const i=this.getCapabilities(),n=i.focusMode,r=i.focusDistance;if(!n)throw Error("Not supported.");if("string"!=typeof e.mode)throw Error("Invalid focus mode.");const o=e.mode.toLowerCase();if(!n.includes(o))throw Error("Unsupported focus mode.");if("manual"!==o)return this._focusParameters._focusArea=null,await this._videoTrack.applyConstraints({advanced:[{focusMode:o}]});if(!r)throw Error("Manual focus unsupported.");if(e.hasOwnProperty("distance")){let t=e.distance;return t<r.min?t=r.min:t>r.max&&(t=r.max),t=z(t,r.min,r.step,r.max),this._focusParameters._focusArea=null,await this._videoTrack.applyConstraints({advanced:[{focusMode:o,focusDistance:t}]})}if(!e.area)throw new Error("'distance' or 'area' should be specified in 'manual' mode.");{const t=e.area.centerPoint;let i=e.area.width,n=e.area.height;if(!i||!n){const e=this._video.videoWidth,t=this._video.videoHeight;i||(i=2*Math.round(Math.min(e,t)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px"),n||(n=2*Math.round(Math.min(e,t)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px")}this._focusParameters._focusArea={centerPoint:{x:t.x,y:t.y},width:i,height:n},await this._setLocalFocus(t,i,n)}}getFocus(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'_getHardwareScale()' is unavailable in singleFrameMode.");if(!this._videoTrack)return null;const e=this._videoTrack.getSettings().focusMode;return e?"continuous"===e?{mode:e}:{mode:e,distance:this._videoTrack.getSettings().focusDistance}:null}getFocusSettings(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'_getHardwareScale()' is unavailable in singleFrameMode.");if(!this._videoTrack)return null;const e=this._videoTrack.getSettings(),t=e.focusMode;return t?"manual"===t?this._focusParameters._focusArea?{mode:"manual",area:JSON.parse(JSON.stringify(this._focusParameters._focusArea))}:{mode:"manual",distance:e.focusDistance}:{mode:t}:null}async _setFocusAndGetContract(e,t){const i=e=>{if(!this._bOpen||!this._videoTrack||this.video.paused||e.focusTaskId!=this._focusParameters.curFocusTaskId){this._bOpen&&this._videoTrack&&!this.video.paused||(this._focusParameters.isDoingFocus=0);const t=new Error(`Focus task ${e.focusTaskId} canceled.`);throw t.name="DeprecatedTaskError",t}1===this._focusParameters.isDoingFocus&&Date.now()-e.timeStart>this._focusParameters.focusCancelableTime&&(this._focusParameters.isDoingFocus=-1)};let n;t=z(t,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),await this._videoTrack.applyConstraints({advanced:[{focusMode:"manual",focusDistance:t}]}),i(e),n=null==this._focusParameters.oldDistance?this._focusParameters.kTimeout*Math.max(Math.abs(1/this._focusParameters.fds.min-1/t),Math.abs(1/this._focusParameters.fds.max-1/t))+this._focusParameters.minTimeout:this._focusParameters.kTimeout*Math.abs(1/this._focusParameters.oldDistance-1/t)+this._focusParameters.minTimeout,this._focusParameters.oldDistance=t,await new Promise((e=>{setTimeout(e,n)})),i(e);let r=e.focusL-e.focusW/2,o=e.focusT-e.focusH/2,a=e.focusW,s=e.focusH;if(r>=this.video.videoWidth||o>=this.video.videoHeight)throw new Error("Invalid area.");r+a>this.video.videoWidth&&(a=this.video.videoWidth-r),o+s>this.video.videoHeight&&(s=this.video.videoHeight-o);const l=this._getImageData(this.video,this.video.videoWidth,this.video.videoHeight,{sx:r,sy:o,sWidth:a,sHeight:s,dWidth:a,dHeight:s},null,{pixelFormat:G.RGBA});if(!l)return this._setFocusAndGetContract(e,t);const c=l.data;let u=0;for(let h=0,d=c.length-8;h<d;++h){let e=c[h]-c[h+8];++h;let t=c[h]-c[h+8];++h;let i=c[h]-c[h+8];++h,u+=e*e+t*t+i*i}return-u}async _doFocusDetail(e,t,i,n,r,o,a){let s;if(t=z(t,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),n=z(n,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),o?o=z(o,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max):(o=z(Math.sqrt((t||this._focusParameters.fds.step)*(n||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),a=await this._setFocusAndGetContract(e,o)),a<=i&&a<=r?s=3:i<r&&i<a?s=1:r<i&&r<a&&(s=2),(n-t)/2<=this._focusParameters.fds.step)return 3===s||(1===s?await this._videoTrack.applyConstraints({advanced:[{focusMode:"manual",focusDistance:t}]}):2===s&&await this._videoTrack.applyConstraints({advanced:[{focusMode:"manual",focusDistance:n}]})),!0;if(1===s)return await this._doFocusDetail(e,t,i,o,a);if(2===s)return await this._doFocusDetail(e,o,a,n,r);if(3!==s)return i=await this._setFocusAndGetContract(e,t),r=await this._setFocusAndGetContract(e,n),await this._doFocusDetail(e,t,i,n,r);let l=z(Math.sqrt((t||this._focusParameters.fds.step)*(o||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),c=z(Math.sqrt((n||this._focusParameters.fds.step)*(o||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max);if(Math.abs(1/this._focusParameters.oldDistance-1/l)<=Math.abs(1/this._focusParameters.oldDistance-1/c)){let s=await this._setFocusAndGetContract(e,l);if(s<a)return await this._doFocusDetail(e,t,i,o,a,l,s);if(s==a)return await this._doFocusDetail(e,l,s,o,a);let u=await this._setFocusAndGetContract(e,c);if(s>a&&a<u)return await this._doFocusDetail(e,l,s,c,u,o,a);if(a==u)return await this._doFocusDetail(e,o,a,c,u);if(a>u)return await this._doFocusDetail(e,o,a,n,r,c,u)}else{let s=await this._setFocusAndGetContract(e,c);if(a>s)return await this._doFocusDetail(e,o,a,n,r,c,s);if(a==s)return await this._doFocusDetail(e,o,a,c,s);let u=await this._setFocusAndGetContract(e,l);if(u>a&&a<s)return await this._doFocusDetail(e,l,u,c,s,o,a);if(u==a)return await this._doFocusDetail(e,l,u,o,a);if(u<a)return await this._doFocusDetail(e,t,i,o,a,l,u)}return!1}async _setLocalFocus(e,t,i,n,r){if(1==this._focusParameters.isDoingFocus)return!1;if(!e||"string"!=typeof e.x||"string"!=typeof e.y)throw new Error("Invalid centerPoint.");if(!t||"string"!=typeof t)throw new Error("Invalid width.");if(!i||"string"!=typeof i)throw new Error("Invalid height.");const o=this._video.videoWidth,a=this._video.videoHeight;let s=0,l=0;if(e.x.endsWith("px"))s=parseFloat(e.x);else{if(!e.x.endsWith("%"))throw new Error("Invalid centerPoint.");s=parseFloat(e.x)/100*o}if(e.y.endsWith("px"))l=parseFloat(e.y);else{if(!e.y.endsWith("%"))throw new Error("Invalid centerPoint.");l=parseFloat(e.y)/100*a}let c=0;if(t.endsWith("px"))c=parseFloat(t);else{if(!t.endsWith("%"))throw new Error("Invalid width.");c=parseFloat(t)/100*o}let u=0;if(i.endsWith("px"))u=parseFloat(i);else{if(!i.endsWith("%"))throw new Error("Invalid height.");u=parseFloat(i)/100*a}if(1!==this._softwareScale){const e=this._softwareScale,t=this._scaleCenter;c/=e,u/=e,s=(1-1/e)*t.x+s/e,l=(1-1/e)*t.y+l/e}if(!this._focusSupported)throw new Error("Manual focus unsupported.");if(!this._focusParameters.fds&&(this._focusParameters.fds=(await this.getCapabilities()).focusDistance,!this._focusParameters.fds))throw this._focusSupported=!1,new Error("Manual focus unsupported.");null==this._focusParameters.kTimeout&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),this._focusParameters.isDoingFocus=1;const h={focusL:s,focusT:l,focusW:c,focusH:u,focusTaskId:++this._focusParameters.curFocusTaskId,timeStart:Date.now()},d=async(e,t,i)=>{try{(null==t||t<this._focusParameters.fds.min)&&(t=this._focusParameters.fds.min),(null==i||i>this._focusParameters.fds.max)&&(i=this._focusParameters.fds.max),this._focusParameters.oldDistance=null;let n=z(Math.sqrt(i*(t||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),r=z(Math.sqrt((t||this._focusParameters.fds.step)*n),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),o=z(Math.sqrt(n*i),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),a=await this._setFocusAndGetContract(e,o),s=await this._setFocusAndGetContract(e,r),l=await this._setFocusAndGetContract(e,n);if(s>l&&l<a){const t=await this._doFocusDetail(e,r,s,o,a,n,l);return this._focusParameters.isDoingFocus=0,t}if(s<l&&s<a){let i=await this._setFocusAndGetContract(e,t);const o=await this._doFocusDetail(e,t,i,n,l,r,s);return this._focusParameters.isDoingFocus=0,o}if(l>a&&s>a){let t=await this._setFocusAndGetContract(e,i);const r=await this._doFocusDetail(e,n,l,i,t,o,a);return this._focusParameters.isDoingFocus=0,r}if(s==l&&l<a){const t=await this._doFocusDetail(e,r,s,n,l);return this._focusParameters.isDoingFocus=0,t}if(l==a&&s>l){const t=await this._doFocusDetail(e,n,l,o,a);return this._focusParameters.isDoingFocus=0,t}return d(e,t,i)}catch(e){if("DeprecatedTaskError"!==e.name)throw e}};return d(h,n,r)}async enableTapToFocus(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'enableTapToFocus()' is unavailable in singleFrameMode.");if(!this._videoTrack)throw new Error("Video is not playing.");if(!this._focusSupported)throw new Error("Tapping to focus unsupported.");if(!this._focusParameters.fds&&(this._focusParameters.fds=(await this.getCapabilities()).focusDistance,!this._focusParameters.fds))throw this._focusSupported=!1,this._tapFocusEnabled=!1,new Error("Tapping to focus unsupported.");this._tapFocusEnabled=!0}disableTapToFocus(){this._tapFocusEnabled=!1}isTapToFocusEnabled(){return this._tapFocusEnabled}_updateVideoContainerStyle(){if(!this._video)return;if(this._isSingleFrameModeEnabled())return;const e=this._getSoftwareScale(),t=this._videoContainer;if("contain"===this.videoFit&&e>1){const e=this._video.videoWidth,i=this._video.videoHeight,n=window.getComputedStyle(this._elContainer),r=parseFloat(n.width),o=parseFloat(n.height),a=e/i;if(r/o<a){let e=r/a;t.style.left="0",t.style.top=(o-e)/2/o*100+"%",t.style.width="100%",t.style.height=e/o*100+"%"}else{let e=o*a;t.style.left=(r-e)/2/r*100+"%",t.style.top="0",t.style.width=e/r*100+"%",t.style.height="100%"}}else t.style.left="0",t.style.top="0",t.style.width="100%",t.style.height="100%"}_scaleVideo(e,t){if(this._video&&!this._isSingleFrameModeEnabled()){if(e<1)throw new RangeError("Invalid scale value.");if(t&&this._setScaleCenter(t),1===e)this._video.style.transform="";else{const t=this.getVideoFit(),i=this._video.videoWidth,n=this._video.videoHeight,r=window.getComputedStyle(this._elContainer),o=parseFloat(r.width),a=parseFloat(r.height),s=o/a,l=i/n;let c=1;"contain"===t?c=s<l?o/(i/e):a/(n/e):"cover"===t&&(c=l>s?a/(i/e):o/(n/e));const u=c*(1-1/e)*(i/2-this._scaleCenter.x),h=c*(1-1/e)*(n/2-this._scaleCenter.y);this._video.style.transform=`translate(${u}px, ${h}px) scale(${e})`}this._updateVideoContainerStyle()}}getFrameSize(e,t,i,n){if(!e||!t)return null;let r,o,a,s,l=e,c=t;const u={regionLeft:0,regionTop:0,regionRight:l,regionBottom:c,regionMeasuredByPercentage:!1};i?(i.regionMeasuredByPercentage?(u.regionLeft=i.regionLeft*l/100,u.regionTop=i.regionTop*c/100,u.regionRight=i.regionRight*l/100,u.regionBottom=i.regionBottom*c/100):(u.regionLeft=i.regionLeft,u.regionTop=i.regionTop,u.regionRight=i.regionRight,u.regionBottom=i.regionBottom),r=Math.round(u.regionLeft),o=Math.round(u.regionTop),l=Math.round(u.regionRight-u.regionLeft),c=Math.round(u.regionBottom-u.regionTop)):(r=0,o=0,l=Math.round(l),c=Math.round(c));const h=Math.max(l,c);if(n&&n>0&&h>n){const e=n/h;l>c?(a=n,s=Math.round(c*e)):(a=Math.round(l*e),s=n)}else a=l,s=c;return a<=0||s<=0?null:{sx:r,sy:o,sWidth:l,sHeight:c,dWidth:a,dHeight:s}}getFrame(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'getFrame()' is unavailable in singleFrameMode.");return this._getVideoData()}getImage(){return this.getFrame()}_drawImage(e,t,i,n,r,o,a){if(this.isDisposed&&this.disposed)throw Error("The 'CameraEnhancer' instance has been disposed.");if(!i||!n)return null;if(t instanceof HTMLVideoElement&&4!==t.readyState||t instanceof HTMLImageElement&&!t.complete)throw new Error("The source is not loaded.");let s;H._onLog&&(s=Date.now(),H._onLog("DCE: _drawImage(), START: "+s));let l=0,c=0,u=i,h=n,d=0,f=0,g=i,p=n;r&&(r.sx&&(l=Math.round(r.sx)),r.sy&&(c=Math.round(r.sy)),r.sWidth&&(u=Math.round(r.sWidth)),r.sHeight&&(h=Math.round(r.sHeight)),r.dx&&(d=Math.round(r.dx)),r.dy&&(f=Math.round(r.dy)),r.dWidth&&(g=Math.round(r.dWidth)),r.dHeight&&(p=Math.round(r.dHeight)));let m=G.RGBA;a&&a.pixelFormat&&(m=a.pixelFormat);const _=e;if(!a||!a.bUseWebGL){H._onLog&&H._onLog("DCE: _drawImage() in context2d."),_.ctx2d||(_.ctx2d=_.getContext("2d",{willReadFrequently:!0}));const e=_.ctx2d;if(!e)throw new Error("Unable to get 'CanvasRenderingContext2D' from canvas.");return(_.width<d+g||_.height<f+p)&&(_.width=d+g,_.height=f+p),e.drawImage(t,l,c,u,h,d,f,g,p),H._onLog&&H._onLog("DCE: _drawImage() in context2d end. Costs: "+(Date.now()-s)),{context:e,pixelFormat:G.RGBA,_bUseWebGL:!1}}H._onLog&&H._onLog("DCE: _drawImage() in WebGL.");try{(_.width<d+g||_.height<f+p)&&(_.width=d+g,_.height=f+p,_.ctxWebGL&&_.ctxWebGL.viewport(0,0,d+g,f+p));const e=_.ctxWebGL||_.getContext("webgl",{antialias:!1})||_.getContext("experimental-webgl",{antialias:!1});if(!e){H._onLog&&H._onLog("DCE: WebGL unavailable.");const e=new Error("WebGL error: unable to initialize WebGL. Your browser or machine may not support it.");throw e.name="WebGLError",e}if(!_.ctxWebGL||m!==this.shaderPixelFormat){_.ctxWebGL=e;const t=e=>{const t=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,t),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),e.STATIC_DRAW);const i=e.createBuffer();return e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),e.STATIC_DRAW),{positions:t,texCoords:i}},i=e=>{const t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),t},n=(e,t)=>{const i=e.createProgram();if(t.forEach((t=>e.attachShader(i,t))),e.linkProgram(i),!e.getProgramParameter(i,e.LINK_STATUS)){const t=new Error(`An error occured linking the program: ${e.getProgramInfoLog(i)}.`);throw t.name="WebGLError",t}return e.useProgram(i),i},r=(e,t,i)=>{const n=e.createShader(t);if(e.shaderSource(n,i),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS)){const t=new Error(`An error occured compiling the shader: ${e.getShaderInfoLog(n)}.`);throw t.name="WebGLError",t}return n},o="\n                        attribute vec2 a_position;\n                        attribute vec2 a_texCoord;\n    \n                        uniform mat3 u_matrix;\n                        uniform mat3 u_textureMatrix;\n    \n                        varying vec2 v_texCoord;\n                        void main(void) {\n                        gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1.0);\n                        v_texCoord = vec4((u_textureMatrix * vec3(a_texCoord, 1)).xy, 0, 1.0).xy;\n                        }\n                    ";let a="rgb";["rgba","rbga","grba","gbra","brga","bgra"].includes(m)&&(a=m.slice(0,3));const s=`\n                        precision mediump float;\n                        varying vec2 v_texCoord;\n                        uniform sampler2D u_image;\n                        uniform float uColorFactor;\n    \n                        void main() {\n                            vec4 sample = texture2D(u_image, v_texCoord);\n                            float grey = 0.21 * sample.r + 0.71 * sample.g + 0.07 * sample.b;\n                            gl_FragColor = vec4(sample.${a} * (1.0 - uColorFactor) + (grey * uColorFactor), sample.a);\n                        }\n                    `,l=n(e,[r(e,e.VERTEX_SHADER,o),r(e,e.FRAGMENT_SHADER,s)]);this._webGLProgramInfo={program:l,attribLocations:{vertexPosition:e.getAttribLocation(l,"a_position"),texPosition:e.getAttribLocation(l,"a_texCoord")},uniformLocations:{uSampler:e.getUniformLocation(l,"u_image"),uColorFactor:e.getUniformLocation(l,"uColorFactor"),uMatrix:e.getUniformLocation(l,"u_matrix"),uTextureMatrix:e.getUniformLocation(l,"u_textureMatrix")}},this._webGLBuffers=t(e),this._webGLTexture=i(e),this.shaderPixelFormat=m}const r=(e,t,i)=>{e.bindBuffer(e.ARRAY_BUFFER,t),e.enableVertexAttribArray(i),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0)},a=(e,t,i)=>{const n=e.RGBA,r=e.RGBA,o=e.UNSIGNED_BYTE;e.bindTexture(e.TEXTURE_2D,t),e.texImage2D(e.TEXTURE_2D,0,n,r,o,i)},v=(e,t,o,a)=>{e.clearColor(0,0,0,1),e.clearDepth(1),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),r(e,o.positions,t.attribLocations.vertexPosition),r(e,o.texCoords,t.attribLocations.texPosition),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,a),e.uniform1i(t.uniformLocations.uSampler,0),e.uniform1f(t.uniformLocations.uColorFactor,[G.GREY,G.GREY32].includes(m)?1:0);let s,_,v=W.translate(W.identity(),-1,-1);v=W.scale(v,2,2),v=W.scale(v,1/e.canvas.width,1/e.canvas.height),s=W.translate(v,d,f),s=W.scale(s,g,p),e.uniformMatrix3fv(t.uniformLocations.uMatrix,!1,s),_=W.translate(W.identity(),l/i,c/n),_=W.scale(_,u/i,h/n),e.uniformMatrix3fv(t.uniformLocations.uTextureMatrix,!1,_),e.drawArrays(e.TRIANGLES,0,6)};let y;if(a(e,this._webGLTexture,t),v(e,this._webGLProgramInfo,this._webGLBuffers,this._webGLTexture),o){if(o.length<g*p*4)throw new Error("Unexpected size of the 'bufferContainer'.");y=o}else y=new Uint8Array(g*p*4);if(e.readPixels(d,f,g,p,e.RGBA,e.UNSIGNED_BYTE,y),255!==y[3]){H._onLog&&H._onLog("DCE: WebGL drawing incorrect."),this._bWebGLSupported=!1;const e=new Error("WebGL error: incorrect WebGL drawing.");throw e.name="WebGLError",e}return H._onLog&&H._onLog("DCE: _drawImage() in WebGL end. Costs: "+(Date.now()-s)),{context:e,pixelFormat:m===G.GREY?G.GREY32:m,_bUseWebGL:!0}}catch(e){throw this._bWebGLSupported=!1,e.name="WebGLError",e}}_readCvsData(e,t,i){let n,r=0,o=0,a=e.canvas.width,s=e.canvas.height;if(t&&(t.x&&(r=t.x),t.y&&(o=t.y),t.width&&(a=t.width),t.height&&(s=t.height)),e instanceof WebGLRenderingContext){const t=e;if(i){if(i.length<a*s*4)throw new Error("Unexpected size of the 'bufferContainer'.");t.readPixels(r,o,a,s,t.RGBA,t.UNSIGNED_BYTE,i),n=new Uint8Array(i.buffer,0,a*s*4)}else n=new Uint8Array(a*s*4),t.readPixels(r,o,a,s,t.RGBA,t.UNSIGNED_BYTE,n)}else if(e instanceof CanvasRenderingContext2D){let t;if(t=e.getImageData(r,o,a,s),n=new Uint8Array(t.data.buffer),i){if(i.length<n.length)throw new Error("Unexpected size of the 'bufferContainer'.");i.set(n)}}return n}_transformPixelFormat(e,t,i,n){let r,o;if(H._onLog&&(r=Date.now(),H._onLog("DCE: _transformPixelFormat(), START: "+r)),t===i)return H._onLog&&H._onLog("DCE: _transformPixelFormat() end. Costs: "+(Date.now()-r)),n?new Uint8Array(e):e;const a=[G.RGBA,G.RBGA,G.GRBA,G.GBRA,G.BRGA,G.BGRA];if(a.includes(t))if(i===G.GREY){o=new Uint8Array(e.length/4);for(let t=0;t<e.length;t+=4){const i=.21*e[t]+.71*e[t+1]+.07*e[t+2];o[t/4]=i}}else if(i===G.GREY32){o=n?new Uint8Array(e):e;for(let t=0;t<e.length;t+=4){const i=.21*e[t]+.71*e[t+1]+.07*e[t+2];o[t]=i,o[t+1]=i,o[t+2]=i}}else{if(!a.includes(i))throw new Error("Unable to transform.");if(n){o=new Uint8Array(e);const n=t.indexOf("r"),r=t.indexOf("g"),a=t.indexOf("b"),s=i.indexOf("r"),l=i.indexOf("g"),c=i.indexOf("b");for(let t=0;t<e.length;t+=4)o[t+s]=e[t+n],o[t+l]=e[t+r],o[t+c]=e[t+a]}else{o=e;const n=t.indexOf("r"),r=t.indexOf("g"),a=t.indexOf("b"),s=i.indexOf("r"),l=i.indexOf("g"),c=i.indexOf("b");for(let t=0;t<e.length;t+=4){let i=[e[t],e[t+1],e[t+2]];o[t+s]=i[n],o[t+l]=i[r],o[t+c]=i[a]}}}else if(t===G.GREY){if(i!==G.GREY32)throw new Error("Unable to transform.");o=new Uint8Array(4*e.length);for(let t=0;t<e.length;t++)o[4*t]=e[t],o[4*t+1]=e[t],o[4*t+2]=e[t],o[4*t+3]=255}else{if(t!==G.GREY32)throw new Error("Unable to transform.");if(i!==G.GREY)throw new Error("Unable to transform.");o=new Uint8Array(e.length/4);for(let t=0;t<e.length;t+=4)o[t/4]=e[t]}return H._onLog&&H._onLog("DCE: _transformPixelFormat() end. Costs: "+(Date.now()-r)),o}_getImageData(e,t,i,n,r,o){if(this.isDisposed&&this.disposed)throw Error("The 'CameraEnhancer' instance has been disposed.");if(!t||!i)return null;if(n.sx>t||n.sy>i||n.sx+n.sWidth>t||n.sy+n.sHeight>i)throw new Error("Invalid position.");if(e instanceof HTMLVideoElement&&4!==e.readyState||e instanceof HTMLImageElement&&!e.complete)throw new Error("The source is not loaded.");let a;H._onLog&&(a=Date.now(),H._onLog("DCE: _getImageData(), START: "+a));const s=Math.round(n.sx),l=Math.round(n.sy),c=Math.round(n.sWidth),u=Math.round(n.sHeight),h=Math.round(n.dWidth),d=Math.round(n.dHeight);let f=G.RGBA;o&&o.pixelFormat&&(f=o.pixelFormat);let g,p,m,_=this._bWebGLSupported;o&&0==o.bUseWebGL&&(_=!1),_?(this._reusedWebGLCvs||(this._reusedWebGLCvs=document.createElement("canvas")),g=this._reusedWebGLCvs):(this._reusedCvs||(this._reusedCvs=document.createElement("canvas")),g=this._reusedCvs);try{if(_)if(H._onLog&&H._onLog("DCE: _getImageData() in WebGL."),r)if(f===G.GREY){if(m=new Uint8Array(h*d*4),p=this._drawImage(g,e,t,i,{sx:s,sy:l,sWidth:c,sHeight:u,dWidth:h,dHeight:d},m,{pixelFormat:f,bUseWebGL:_}),m=this._transformPixelFormat(m,p.pixelFormat,f),r){if(r.length<m.length)throw new Error("Unexpected size of the 'bufferContainer'.");r.set(m)}}else p=this._drawImage(g,e,t,i,{sx:s,sy:l,sWidth:c,sHeight:u,dWidth:h,dHeight:d},r,{pixelFormat:f,bUseWebGL:_}),m=new Uint8Array(r.buffer,0,h*d*4),m=this._transformPixelFormat(m,p.pixelFormat,f);else f===G.GREY?((!this._tempDataContainer||this._tempDataContainer.length<h*d*4)&&(this._tempDataContainer=new Uint8Array(h*d*4)),m=new Uint8Array(this._tempDataContainer.buffer,0,h*d*4)):m=new Uint8Array(h*d*4),p=this._drawImage(g,e,t,i,{sx:s,sy:l,sWidth:c,sHeight:u,dWidth:h,dHeight:d},m,{pixelFormat:f,bUseWebGL:_}),m=this._transformPixelFormat(m,p.pixelFormat,f);else if(H._onLog&&H._onLog("DCE: _getImageData() in context2d."),p=this._drawImage(g,e,t,i,{sx:s,sy:l,sWidth:c,sHeight:u,dWidth:h,dHeight:d},null,{pixelFormat:G.RGBA,bUseWebGL:_}),m=this._readCvsData(p.context,{width:h,height:d},null),m=this._transformPixelFormat(m,p.pixelFormat,f),r){if(r.length<m.length)throw new Error("Unexpected size of the 'bufferContainer'.");r.set(m)}}catch(n){if("WebGLError"===n.name)return H._onLog&&H._onLog("DCE: _getImageData() in WebGL failed, try again in context2d."),this.forceLoseContext(),this._bWebGLSupported=!1,this._getImageData(e,t,i,{sx:s,sy:l,sWidth:c,sHeight:u,dWidth:h,dHeight:d},r,o);throw n}return H._onLog&&H._onLog("DCE: _getImageData() end. Costs: "+(Date.now()-a)),{data:m,pixelFormat:f,_bUseWebGL:p._bUseWebGL}}forceLoseContext(){if(!this._reusedWebGLCvs)return;const e=this._reusedWebGLCvs.ctxWebGL;e&&!e.isContextLost()&&e.getExtension("WEBGL_lose_context")&&e.getExtension("WEBGL_lose_context").loseContext(),this._webGLTexture=null,this._webGLProgramInfo=null,this._webGLBuffers=null,this._reusedWebGLCvs=null}_getVideoData(e,t){if(this.isDisposed&&this.disposed)throw Error("The 'CameraEnhancer' instance has been disposed.");if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'_getVideoData()' is unavailable in singleFrameMode.");if(!this._video||4!==this._video.readyState)return null;const i=Date.now();H._onLog&&H._onLog("DCE: _getVideoData() START: "+i);let n=this._scanRegion;t&&t.hasOwnProperty("region")&&(n=t.region);let r=this.mapPixelFormatString_Enum.get(this.framePixelFormat.toLowerCase());t&&t.pixelFormat&&(r=this.mapPixelFormatString_Enum.get(t.pixelFormat.toLowerCase()));let o=this._softwareScale;t&&t.scale&&(o=t.scale);const a=this._video.videoWidth,s=this._video.videoHeight;let l=this._scaleCenter;if(t&&t.scaleCenter){if("string"!=typeof t.scaleCenter.x||"string"!=typeof t.scaleCenter.y)throw new Error("Invalid scale center.");let e=0,i=0;if(t.scaleCenter.x.endsWith("px"))e=parseFloat(t.scaleCenter.x);else{if(!t.scaleCenter.x.endsWith("%"))throw new Error("Invalid scale center.");e=parseFloat(t.scaleCenter.x)/100*a}if(t.scaleCenter.y.endsWith("px"))i=parseFloat(t.scaleCenter.y);else{if(!t.scaleCenter.y.endsWith("%"))throw new Error("Invalid scale center.");i=parseFloat(t.scaleCenter.y)/100*s}l.x=Math.round(e),l.y=Math.round(i)}if(0===a||0===s)return null;const c=this.getFrameSize(a,s,n,this.maxCvsSideLength);if(!c)return null;let u=!0;a===c.sWidth&&s===c.sHeight&&(u=!1);const h={data:null,region:n?JSON.parse(JSON.stringify(n)):null,sx:c.sx,sy:c.sy,width:c.dWidth,height:c.dHeight,colorMode:null,pixelFormat:null,timeSpent:null,timeStamp:null,isCropped:u,toCanvas:this._toCanvas,_sWidth:c.sWidth,_sHeight:c.sHeight,_bUseWebGL:null};1!==o&&(c.sWidth=Math.round(c.sWidth/o),c.sHeight=Math.round(c.sHeight/o),c.sx=Math.round((1-1/o)*l.x+c.sx/o),c.sy=Math.round((1-1/o)*l.y+c.sy/o));const d=this._getImageData(this._video,a,s,c,e,{pixelFormat:r});if(!d)return null;const f=Date.now();return H._onLog&&H._onLog("DCE: _getVideoData() END: "+f),h.data=d.data,h.pixelFormat=h.colorMode=d.pixelFormat,h._bUseWebGL=d._bUseWebGL,h.timeSpent=f-i,h.timeStamp=f,d.pixelFormat===G.GREY?h.stride=h.width:h.stride=4*h.width,h}getCurrentRegion(){let e=null;if(this._scanRegion)e=this._scanRegion;else if(this.croppingRegions){if(this._croppingRegionIndex>=this.croppingRegions.length||this._croppingRegionIndex<0)throw new Error("The 'croppingRegionIndex' is out of bounds.");e=this.croppingRegions[this._croppingRegionIndex],this.bIncreaseRegionIndexAuto&&++this._croppingRegionIndex>=this.croppingRegions.length&&(this._croppingRegionIndex=0)}return e}_fetchingLoop(e){if(this.isDisposed&&this.disposed)return;if(!this._bOpen||!this.isFetchingLoopStarted())return void this.stopFetchingLoop();const t=()=>{H._onLog&&H._onLog("DCE: start fetching a frame into buffer: "+Date.now());const e=this.getCurrentRegion();let t=this._getVideoData(null,{region:e});if(!t)return void(H._onLog&&H._onLog("DCE: get a invalid frame, abandon it: "+Date.now()));for(;this._frameQueue&&this._frameQueue.length>=this.maxNumberOfFramesInBuffer;)this._frameQueue.shift();this._frameQueue.push(t),H._onLog&&H._onLog("DCE: finish fetching a frame into buffer: "+Date.now());const i=this.mapCameraEvents.get("frameaddedtobuffer");for(let n of i)n&&setTimeout((()=>{this.isDisposed&&this.disposed||n.apply(this)}),0)},i=()=>{this.isDisposed&&this.disposed||(this._frameLoopTimeoutId2&&clearTimeout(this._frameLoopTimeoutId2),this.refreshInterval<=0||(this._frameLoopTimeoutId2=setTimeout((()=>{this.isDisposed&&this.disposed||(this._bOpen&&this.isFetchingLoopStarted()?(H._onLog&&H._onLog("DCE: second timeout executes: "+Date.now()),t(),i()):this.stopFetchingLoop())}),this.refreshInterval)))};e&&(this._frameQueue.length<this.maxNumberOfFramesInBuffer?(t(),this.refreshInterval>0&&i()):0===this.refreshInterval&&t()),this._frameLoopTimeoutId&&clearTimeout(this._frameLoopTimeoutId),this._frameLoopTimeoutId=setTimeout((()=>{this.isDisposed&&this.disposed||this._fetchingLoop(!0)}),this.loopInterval)}startFetchingLoop(){if(this.isDisposed&&this.disposed)throw Error("The 'CameraEnhancer' instance has been disposed.");if(this._assertOpen(),this._isSingleFrameModeEnabled())throw Error("'startFetchingLoop()' is unavailable in singleFrameMode.");this.isFetchingLoopStarted()||(this._bFetchingLoopStarted=!0,this._recordedStates.fetchingLoopStart=!0,H._onLog&&H._onLog("DCE: start fetching loop: "+Date.now()),this._fetchingLoop(!0))}isFetchingLoopStarted(){return this._bFetchingLoopStarted}stopFetchingLoop(){this._bFetchingLoopStarted&&(H._onLog&&H._onLog("DCE: stop fetching loop: "+Date.now()),this._frameLoopTimeoutId&&clearTimeout(this._frameLoopTimeoutId),this._frameQueue.length=0,this._bFetchingLoopStarted=!1,this._recordedStates.fetchingLoopStart=!1)}getFrameFromBuffer(e){return this._frameQueue&&this._frameQueue.length?e?e<this._frameQueue.length?(this._frameLoopTimeoutId2&&clearTimeout(this._frameLoopTimeoutId2),this._frameQueue.splice(e,1)[0]):void 0:(this._frameLoopTimeoutId2&&clearTimeout(this._frameLoopTimeoutId2),this._frameQueue.pop()):null}clearFrameBuffer(){this._frameQueue&&(this._frameQueue.length=0)}_createDrawingLayerBaseCvs(){let e;this._assertOpen();try{e=this._calculateCvsSize()}catch(e){throw e}let{width:t,height:i,objectFit:n}=e;(t<=0||i<=0)&&(t=2,i=2);const r=document.createElement("canvas");if(r.width==t&&r.height==i||(r.width=t,r.height=i),r.style.objectFit=n,this._cvsScanRegion)this._cvsScanRegion.after(r);else if(this._cvsOriginalImage)this._cvsOriginalImage.after(r);else if(this._cvsSingleFrameMode)this._cvsSingleFrameMode.after(r);else{if(!this._videoContainer)throw new Error("Unable to find video element");this._videoContainer.after(r)}return r}_updateDrawingLayersSize(e){let t;try{t=e&&e.width&&e.height&&e.objectFit?{width:e.width,height:e.height,objectFit:e.objectFit}:this._calculateCvsSize()}catch(e){if("Invalid content dimensions."===(e.message||e))return;throw e}const{width:i,height:n,objectFit:r}=t;this._drawingLayerManager.setDimensions({width:i,height:n},{backstoreOnly:!0}),this._drawingLayerManager.setObjectFit(r)}_createDrawingLayer(e){this._layerBaseCvs||(this._layerBaseCvs=this._createDrawingLayerBaseCvs());const t=this._layerBaseCvs;return this._drawingLayerManager.createDrawingLayer(t,e)}deleteDrawingLayer(e){this._drawingLayerManager.deleteDrawingLayer(e),this._drawingLayerManager.getDrawingLayers().length||this._layerBaseCvs&&(this._layerBaseCvs.remove(),this._layerBaseCvs=null)}createDrawingLayer(){return this._createDrawingLayer()}getDrawingLayer(e){return this._drawingLayerManager.getDrawingLayer(e)||([1,2,3].includes(e)?this._createDrawingLayer(e):null)}getDrawingLayers(){return this._drawingLayerManager.getDrawingLayers().filter((e=>e.getId()>=0))}getSelectedDrawingItems(){return this._drawingLayerManager.getSelectedDrawingItems()}createDrawingStyle(e){return this._drawingLayerManager.createDrawingStyle(e)}getDrawingStyle(e){return this._drawingLayerManager.getDrawingStyle(e)}getDrawingStyles(){return this._drawingLayerManager.getDrawingStyles()}updateDrawingStyle(e,t){return this._drawingLayerManager.updateDrawingStyle(e,t)}clearDrawingLayers(){const e=this.getDrawingLayers();for(let t of e)this.deleteDrawingLayer(t.getId())}showTip(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e3,o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];this._assertOpen(),this._tipArgs.x=e,this._tipArgs.y=t,this._tipArgs.width=i,this._tipArgs.autoShowSuggestedTip=!!o,this._drawingLayerOfTip||(this._drawingLayerOfTip=this._createDrawingLayer(-1)),this._tipStyleId||(this._tipStyleId=this.createDrawingStyle({fillStyle:"#FFFFFF",paintMode:"fill",fontFamily:"Open Sans",fontSize:40})),this._drawingLayerOfTip.clearDrawingItems();const a=new N(n||"",e,t,i,this._tipStyleId);a._fabricObject.paddingTop=15,a._fabricObject.calcTextHeight=function(){for(var e=0,t=0,i=this._textLines.length;t<i;t++)e+=this.getHeightOfLine(t);return e+2*this.paddingTop},a._fabricObject._getTopOffset=function(){return-this.height/2+this.getHeightOfLine(0)*(1-1/this.lineHeight)/2+this.paddingTop},a.setAttribute("backgroundColor","rgba(50, 50, 52, .8)"),a.setAttribute("lineHeight",1.3),a.setAttribute("textAlign","center"),this._drawingLayerOfTip.addDrawingItem(a),this._hideTipTimeoutId&&clearTimeout(this._hideTipTimeoutId),this._tipArgs.duration=void 0===r?3e3:r,this._tipArgs.duration>0&&(this._hideTipTimeoutId=setTimeout((()=>{this.isDisposed&&this.disposed||this._hideTip()}),this._tipArgs.duration))}_hideTip(){this._drawingLayerOfTip&&(this.deleteDrawingLayer(this._drawingLayerOfTip.getId()),this._drawingLayerOfTip=null,this._hideTipTimeoutId&&clearTimeout(this._hideTipTimeoutId))}hideTip(){this._hideTip(),this._tipArgs.x=null,this._tipArgs.y=null,this._tipArgs.width=null,this._tipArgs.autoShowSuggestedTip=null}updateTipMessage(e){if(!this._drawingLayerOfTip)throw new Error("The Tip is not showing.");this._drawingLayerOfTip.getDrawingItems()[0].setAttribute("text",e),this._drawingLayerOfTip.renderAll(),this._tipArgs.duration>0&&(this._hideTipTimeoutId&&clearTimeout(this._hideTipTimeoutId),this._hideTipTimeoutId=setTimeout((()=>{this.isDisposed&&this.disposed||this._hideTip()}),this._tipArgs.duration))}suggestTip(e,t){this._tipArgs.autoShowSuggestedTip&&(this._drawingLayerOfTip?this.updateTipMessage(t):void 0!==this._tipArgs.x&&this.showTip(this._tipArgs.x,this._tipArgs.y,this._tipArgs.width,t,this._tipArgs.duration)),this.onTipSuggested&&setTimeout((()=>{this.isDisposed&&this.disposed||this.onTipSuggested.apply(this,[e,t])}),0)}_createControler(){if(this._controler||(this._controler=new V(this)),this._controler)return this._controler}_destroyControler(){this._controler=null}setOriginalImage(e,t,i){if(!e||!t||!i)throw new Error("Invalid arguments");this._originalImageData={imageData:e,width:t,height:i};let n=this._cvsOriginalImage;n||(n=document.createElement("canvas"),n.style.position="absolute",n.style.width="100%",n.style.height="100%",n.style.left="0",n.style.top="0",n.style.backgroundColor="white",n.style.objectFit="contain",this._cvsOriginalImage=n),n.width===t&&n.height===i||(n.width=t,n.height=i);const r=n.getContext("2d");r.clearRect(0,0,n.width,n.height),e instanceof Uint8Array||e instanceof Uint8ClampedArray?(e instanceof Uint8Array&&(e=new Uint8ClampedArray(e.buffer)),r.putImageData(new ImageData(e,t,i),0,0)):e instanceof HTMLCanvasElement&&r.drawImage(e,0,0),document.body.contains(n)&&""===n.style.display&&this._updateDrawingLayersSize({width:t,height:i,objectFit:"contain"})}getOriginalImage(){return this._originalImageData?Object.assign({},this._originalImageData):null}async deleteOriginalImage(){await this.hideOriginalImage(),this._cvsOriginalImage&&(this._cvsOriginalImage.remove(),this._cvsOriginalImage=null),this._originalImageData=null}_showOriginalImageCvs(){this._cvsOriginalImage&&"none"==this._cvsOriginalImage.style.display&&(this._cvsOriginalImage.style.display="")}_hideOriginalImageCvs(){this._cvsOriginalImage&&(this._cvsOriginalImage.style.display="none")}showOriginalImage(){if(!this._originalImageData)throw new Error("No original image is set.");const e=this._cvsOriginalImage;if(""===e.style.display&&document.body.contains(e))return;const{width:t,height:i}=this._originalImageData;if(this._updateDrawingLayersSize({width:t,height:i,objectFit:"contain"}),this._bOpen&&(this._video&&!this._video.paused&&this._video.pause(),this._bFetchingLoopStarted&&(this.stopFetchingLoop(),this._recordedStates.fetchingLoopStart=!0),this.ifShowScanRegionMask&&this._cvsScanRegion&&(this._cvsScanRegion.style.display="none"),this.ifShowScanRegionLaser&&this._divScanLight&&(this._divScanLight.style.display="none"),this._cvsViewDecorator&&(this._cvsViewDecorator.style.display="none"),this._scanRegionOverlayContainer&&(this._scanRegionOverlayContainer.style.display="none"),this._selCam&&(this._selCam.parentElement.style.display="none")),!document.body.contains(e))if(this._cvsSingleFrameMode)this._cvsSingleFrameMode.after(e);else{if(!this._videoContainer)throw new Error("Unable to find video element");this._videoContainer.after(e)}this._showOriginalImageCvs()}async _hideOriginalImage(e){this._originalImageData&&this._cvsOriginalImage&&"none"!==this._cvsOriginalImage.style.display&&(this._updateDrawingLayersSize(),this._bOpen&&e&&(this._video&&this._recordedStates.videoPlaying&&await this.play(null,null,null,{notTriggerSingleFrameClick:!0}),this._recordedStates.fetchingLoopStart&&!this._isSingleFrameModeEnabled()&&this.startFetchingLoop(),this.ifShowScanRegionMask&&this._cvsScanRegion&&this._recordedStates.maskShow&&this.showScanRegionMask(),this.ifShowScanRegionLaser&&this._divScanLight&&this._recordedStates.laserShow&&this.showScanRegionLaser(),this._cvsViewDecorator&&this._recordedStates.decoratorShow&&this.showViewDecorator(),this._scanRegionOverlayContainer&&this._recordedStates.overlayShow&&this.showScanRegionOverlays()),this._selCam&&(this._selCam.parentElement.style.display=""),this._hideOriginalImageCvs())}async hideOriginalImage(){return this._hideOriginalImage(!0)}transformCoord(e){if(!this.isOpen())throw new Error("Unavailable when the camera is not open.");if(this._isSingleFrameModeEnabled()&&!this._cvsSingleFrameMode)throw new Error("No image is selected. ");const t=this._elContainer.getBoundingClientRect();let i,n,r,o,a,s=t.left,l=t.top,c=s+window.scrollX,u=l+window.scrollY;this._isSingleFrameModeEnabled()?(i=this._cvsSingleFrameMode.width,n=this._cvsSingleFrameMode.height,r=parseFloat(window.getComputedStyle(this._cvsSingleFrameMode).width),o=parseFloat(window.getComputedStyle(this._cvsSingleFrameMode).height),a="contain"):(i=this.video.videoWidth,n=this.video.videoHeight,r=parseFloat(window.getComputedStyle(this._elContainer).width),o=parseFloat(window.getComputedStyle(this._elContainer).height),a=this.videoFit);const h=r/o,d=i/n;let f,g,p,m,_=1;if("contain"===a)h<d?(_=r/i,f=s+e.x*_,g=l+e.y*_+(o-n*_)/2,p=c+e.x*_,m=u+e.y*_+(o-n*_)/2):(_=o/n,f=s+e.x*_+(r-i*_)/2,g=l+e.y*_,p=c+e.x*_+(r-i*_)/2,m=u+e.y*_);else if("cover"===a)if(h<d){_=o/n;let t=e.x*_-(i*_-r)/2;t=Math.max(t,0),t=Math.min(t,r),f=s+t,g=l+e.y*_,p=c+t,m=u+e.y*_}else{_=r/i;let t=e.y*_-(n*_-o)/2;t=Math.max(t,0),t=Math.min(t,o),f=s+e.x*_,g=l+t,p=c+e.x*_,m=u+t}return{clientX:f,clientY:g,pageX:p,pageY:m}}convertToPageCoordinates(e){const t=this.transformCoord(e);return{x:t.pageX,y:t.pageY}}convertToClientCoordinates(e){const t=this.transformCoord(e);return{x:t.clientX,y:t.clientY}}dispose(e){this.UIElement&&(this._uiOriginalState&&this._uiOriginalState.inDom?this.UIElement.style.display=this._uiOriginalState.display:this.UIElement.style.display="none"),this.clearDrawingLayers(),this.close(),this.forceLoseContext(),this.setViewDecorator(null,null),this._scanRegionOverlayContainer&&this._scanRegionOverlayContainer.remove(),this._arrScanRegionOverlays.length=0,e&&this.UIElement&&this.UIElement.remove(),this.__proto__=null;for(let t in this)delete this[t];Object.defineProperty(this,"isCameraEnhancer",{value:!0}),Object.defineProperty(this,"isDisposed",{value:!0}),Object.defineProperty(this,"disposed",{value:!0})}}H._jsVersion="3.3.10",H._jsEditVersion="20240130",H._version="JS "+H._jsVersion+"."+H._jsEditVersion,H.browserInfo=b,H._hasEngineResourceLoaded=!1,H._engineResourcePath=T,H._defaultUIElementURL="@engineResourcePath/dce.ui.html";const Y={DT_Arc:class extends D{constructor(e,t,i,n,r,o){super(new R.Circle({left:e,top:t,radius:i,startAngle:n,endAngle:r}),o),this._mediaType="arc"}},DT_Polygon:P,DT_Rect:class extends D{constructor(e,t,i,n,r){super(new R.Rect({left:e,top:t,width:i,height:n}),r)}},DT_Image:class extends D{constructor(e,t,i,n){super(new R.Image(e,{left:t,top:i}),n),this.image=e}_extendSet(e,t){if("image"===e){if(t instanceof HTMLImageElement)return this._fabricObject.setElement(t),this.image=t,!0;if(t instanceof HTMLCanvasElement){const e=new Image;return e.src=t.toDataURL(),this._fabricObject.setElement(e),this.image=t,!0}throw new Error("Unsupported value.")}}_extendGet(e){if("image"===e)return this.image}},DT_Text:N,DT_Line:class extends P{constructor(e,t,i){super([e,t],i),this._mediaType="line"}_extendSet(e,t){if("startPoint"===e||"endPoint"===e){t="startPoint"===e?[t,this.get("endPoint")]:[this.get("startPoint"),t];const i=this._fabricObject;if(i.group){const e=i.group;i.points=t.map((t=>({x:t.x-e.left-e.width/2,y:t.y-e.top-e.height/2}))),e.addWithUpdate()}else i.points=t;const n=i.points.length-1;return i.controls=i.points.reduce((function(e,t,i){return e["p"+i]=new R.Control({positionHandler:k,actionHandler:F(i>0?i-1:n,M),actionName:"modifyPolygon",pointIndex:i}),e}),{}),i._setPositionDimensions({}),!0}}_extendGet(e){if("startPoint"===e||"endPoint"===e){const t=[],i=this._fabricObject;if(i.selectable&&!i.group)for(let e in i.oCoords)t.push({x:i.oCoords[e].x,y:i.oCoords[e].y});else for(let e of i.points){let n=e.x-i.pathOffset.x,r=e.y-i.pathOffset.y;const o=R.util.transformPoint({x:n,y:r},i.calcTransformMatrix());t.push({x:o.x,y:o.y})}return"startPoint"===e?t[0]:t[1]}}},DT_Group:class extends D{constructor(e){super(new R.Group(e.map((e=>e._getFabricObject())))),this._fabricObject.on("selected",(()=>{this.styleSelector="selected";const e=this._fabricObject._objects;for(let t of e)setTimeout((()=>{t&&t.fire("selected")}),0);setTimeout((()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())}),0)})),this._fabricObject.on("deselected",(()=>{this.styleSelector="default";const e=this._fabricObject._objects;for(let t of e)setTimeout((()=>{t&&t.fire("deselected")}),0);setTimeout((()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())}),0)}))}getChildItems(){return this._fabricObject._objects.map((e=>e.getDrawingItem()))}addChildItem(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");this._drawingLayer?this._drawingLayer._updateGroupItem(this,e,"add"):this._fabricObject.addWithUpdate(e._getFabricObject())}removeChildItem(e){e&&e.isDrawingItem&&(this._drawingLayer?this._drawingLayer._updateGroupItem(this,e,"remove"):this._fabricObject.removeWithUpdate(e._getFabricObject()))}}},X="undefined"==typeof self,q=X?{}:self;let Z,K,J,Q,$;"undefined"!=typeof navigator&&(Z=navigator,K=Z.userAgent,J=Z.platform,Q=Z.mediaDevices),function(){if(!X){const e={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Z.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},t={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:J,search:"Win"},Mac:{str:J},Linux:{str:J}};let i="unknownBrowser",n=0,r="unknownOS";for(let o in e){const t=e[o]||{};let r=t.str||K,a=t.search||o,s=t.verStr||K,l=t.verSearch||o;if(l instanceof Array||(l=[l]),-1!=r.indexOf(a)){i=o;for(let e of l){let t=s.indexOf(e);if(-1!=t){n=parseFloat(s.substring(t+e.length+1));break}}break}}for(let o in t){const e=t[o]||{};let i=e.str||K,n=e.search||o;if(-1!=i.indexOf(n)){r=o;break}}"Linux"==r&&-1!=K.indexOf("Windows NT")&&(r="HarmonyOS"),$={browser:i,version:n,OS:r}}X&&($={browser:"ssr",version:0,OS:"ssr"})}();const ee="undefined"!=typeof WebAssembly&&K&&!(/Safari/.test(K)&&!/Chrome/.test(K)&&/\(.+\s11_2_([2-6]).*\)/.test(K)),te=!("undefined"==typeof Worker),ie=!(!Q||!Q.getUserMedia),ne=async()=>{let e=!1;if(ie)try{(await Q.getUserMedia({video:!0})).getTracks().forEach((e=>{e.stop()})),e=!0}catch(e){}return e};"Chrome"===$.browser&&$.version>66||"Safari"===$.browser&&$.version>13||"OPR"===$.browser&&$.version>43||"Edge"===$.browser&&$.version;const re=(()=>{if(!X&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"})(),oe=" is not allowed to change after `createInstance` or `loadWasm` is called.",ae=!X&&document.currentScript&&(document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID"))||"",se=!X&&document.currentScript&&document.currentScript.getAttribute("data-sessionPassword")||"",le=e=>{if(null==e)e=[];else{e=e instanceof Array?[...e]:[e];for(let t=0;t<e.length;++t){if(!X){let i=document.createElement("a");i.href=e[t],e[t]=i.href}e[t].endsWith("/")||(e[t]+="/")}}return e};var ce,ue,he,de,fe;!function(e){e[e.IPF_Binary=0]="IPF_Binary",e[e.IPF_BinaryInverted=1]="IPF_BinaryInverted",e[e.IPF_GrayScaled=2]="IPF_GrayScaled",e[e.IPF_NV21=3]="IPF_NV21",e[e.IPF_RGB_565=4]="IPF_RGB_565",e[e.IPF_RGB_555=5]="IPF_RGB_555",e[e.IPF_RGB_888=6]="IPF_RGB_888",e[e.IPF_ARGB_8888=7]="IPF_ARGB_8888",e[e.IPF_RGB_161616=8]="IPF_RGB_161616",e[e.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",e[e.IPF_ABGR_8888=10]="IPF_ABGR_8888",e[e.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",e[e.IPF_BGR_888=12]="IPF_BGR_888"}(ce||(ce={})),function(e){e[e.DBR_SYSTEM_EXCEPTION=1]="DBR_SYSTEM_EXCEPTION",e[e.DBR_SUCCESS=0]="DBR_SUCCESS",e[e.DBR_UNKNOWN=-1e4]="DBR_UNKNOWN",e[e.DBR_NO_MEMORY=-10001]="DBR_NO_MEMORY",e[e.DBR_NULL_REFERENCE=-10002]="DBR_NULL_REFERENCE",e[e.DBR_LICENSE_INVALID=-10003]="DBR_LICENSE_INVALID",e[e.DBR_LICENSE_EXPIRED=-10004]="DBR_LICENSE_EXPIRED",e[e.DBR_FILE_NOT_FOUND=-10005]="DBR_FILE_NOT_FOUND",e[e.DBR_FILETYPE_NOT_SUPPORTED=-10006]="DBR_FILETYPE_NOT_SUPPORTED",e[e.DBR_BPP_NOT_SUPPORTED=-10007]="DBR_BPP_NOT_SUPPORTED",e[e.DBR_INDEX_INVALID=-10008]="DBR_INDEX_INVALID",e[e.DBR_BARCODE_FORMAT_INVALID=-10009]="DBR_BARCODE_FORMAT_INVALID",e[e.DBR_CUSTOM_REGION_INVALID=-10010]="DBR_CUSTOM_REGION_INVALID",e[e.DBR_MAX_BARCODE_NUMBER_INVALID=-10011]="DBR_MAX_BARCODE_NUMBER_INVALID",e[e.DBR_IMAGE_READ_FAILED=-10012]="DBR_IMAGE_READ_FAILED",e[e.DBR_TIFF_READ_FAILED=-10013]="DBR_TIFF_READ_FAILED",e[e.DBR_QR_LICENSE_INVALID=-10016]="DBR_QR_LICENSE_INVALID",e[e.DBR_1D_LICENSE_INVALID=-10017]="DBR_1D_LICENSE_INVALID",e[e.DBR_DIB_BUFFER_INVALID=-10018]="DBR_DIB_BUFFER_INVALID",e[e.DBR_PDF417_LICENSE_INVALID=-10019]="DBR_PDF417_LICENSE_INVALID",e[e.DBR_DATAMATRIX_LICENSE_INVALID=-10020]="DBR_DATAMATRIX_LICENSE_INVALID",e[e.DBR_PDF_READ_FAILED=-10021]="DBR_PDF_READ_FAILED",e[e.DBR_PDF_DLL_MISSING=-10022]="DBR_PDF_DLL_MISSING",e[e.DBR_PAGE_NUMBER_INVALID=-10023]="DBR_PAGE_NUMBER_INVALID",e[e.DBR_CUSTOM_SIZE_INVALID=-10024]="DBR_CUSTOM_SIZE_INVALID",e[e.DBR_CUSTOM_MODULESIZE_INVALID=-10025]="DBR_CUSTOM_MODULESIZE_INVALID",e[e.DBR_RECOGNITION_TIMEOUT=-10026]="DBR_RECOGNITION_TIMEOUT",e[e.DBR_JSON_PARSE_FAILED=-10030]="DBR_JSON_PARSE_FAILED",e[e.DBR_JSON_TYPE_INVALID=-10031]="DBR_JSON_TYPE_INVALID",e[e.DBR_JSON_KEY_INVALID=-10032]="DBR_JSON_KEY_INVALID",e[e.DBR_JSON_VALUE_INVALID=-10033]="DBR_JSON_VALUE_INVALID",e[e.DBR_JSON_NAME_KEY_MISSING=-10034]="DBR_JSON_NAME_KEY_MISSING",e[e.DBR_JSON_NAME_VALUE_DUPLICATED=-10035]="DBR_JSON_NAME_VALUE_DUPLICATED",e[e.DBR_TEMPLATE_NAME_INVALID=-10036]="DBR_TEMPLATE_NAME_INVALID",e[e.DBR_JSON_NAME_REFERENCE_INVALID=-10037]="DBR_JSON_NAME_REFERENCE_INVALID",e[e.DBR_PARAMETER_VALUE_INVALID=-10038]="DBR_PARAMETER_VALUE_INVALID",e[e.DBR_DOMAIN_NOT_MATCHED=-10039]="DBR_DOMAIN_NOT_MATCHED",e[e.DBR_RESERVEDINFO_NOT_MATCHED=-10040]="DBR_RESERVEDINFO_NOT_MATCHED",e[e.DBR_AZTEC_LICENSE_INVALID=-10041]="DBR_AZTEC_LICENSE_INVALID",e[e.DBR_LICENSE_DLL_MISSING=-10042]="DBR_LICENSE_DLL_MISSING",e[e.DBR_LICENSEKEY_NOT_MATCHED=-10043]="DBR_LICENSEKEY_NOT_MATCHED",e[e.DBR_REQUESTED_FAILED=-10044]="DBR_REQUESTED_FAILED",e[e.DBR_LICENSE_INIT_FAILED=-10045]="DBR_LICENSE_INIT_FAILED",e[e.DBR_PATCHCODE_LICENSE_INVALID=-10046]="DBR_PATCHCODE_LICENSE_INVALID",e[e.DBR_POSTALCODE_LICENSE_INVALID=-10047]="DBR_POSTALCODE_LICENSE_INVALID",e[e.DBR_DPM_LICENSE_INVALID=-10048]="DBR_DPM_LICENSE_INVALID",e[e.DBR_FRAME_DECODING_THREAD_EXISTS=-10049]="DBR_FRAME_DECODING_THREAD_EXISTS",e[e.DBR_STOP_DECODING_THREAD_FAILED=-10050]="DBR_STOP_DECODING_THREAD_FAILED",e[e.DBR_SET_MODE_ARGUMENT_ERROR=-10051]="DBR_SET_MODE_ARGUMENT_ERROR",e[e.DBR_LICENSE_CONTENT_INVALID=-10052]="DBR_LICENSE_CONTENT_INVALID",e[e.DBR_LICENSE_KEY_INVALID=-10053]="DBR_LICENSE_KEY_INVALID",e[e.DBR_LICENSE_DEVICE_RUNS_OUT=-10054]="DBR_LICENSE_DEVICE_RUNS_OUT",e[e.DBR_GET_MODE_ARGUMENT_ERROR=-10055]="DBR_GET_MODE_ARGUMENT_ERROR",e[e.DBR_IRT_LICENSE_INVALID=-10056]="DBR_IRT_LICENSE_INVALID",e[e.DBR_MAXICODE_LICENSE_INVALID=-10057]="DBR_MAXICODE_LICENSE_INVALID",e[e.DBR_GS1_DATABAR_LICENSE_INVALID=-10058]="DBR_GS1_DATABAR_LICENSE_INVALID",e[e.DBR_GS1_COMPOSITE_LICENSE_INVALID=-10059]="DBR_GS1_COMPOSITE_LICENSE_INVALID",e[e.DBR_PANORAMA_LICENSE_INVALID=-10060]="DBR_PANORAMA_LICENSE_INVALID",e[e.DBR_DOTCODE_LICENSE_INVALID=-10061]="DBR_DOTCODE_LICENSE_INVALID",e[e.DBR_PHARMACODE_LICENSE_INVALID=-10062]="DBR_PHARMACODE_LICENSE_INVALID",e[e.DBR_IMAGE_ORIENTATION_INVALID=-10063]="DBR_IMAGE_ORIENTATION_INVALID",e[e.DMERR_NO_LICENSE=-2e4]="DMERR_NO_LICENSE",e[e.DMERR_LICENSE_SYNC_FAILED=-20003]="DMERR_LICENSE_SYNC_FAILED",e[e.DMERR_TRIAL_LICENSE=-20010]="DMERR_TRIAL_LICENSE",e[e.DMERR_FAILED_TO_REACH_LTS=-20200]="DMERR_FAILED_TO_REACH_LTS"}(ue||(ue={})),function(e){e[e.IMRDT_IMAGE=1]="IMRDT_IMAGE",e[e.IMRDT_CONTOUR=2]="IMRDT_CONTOUR",e[e.IMRDT_LINESEGMENT=4]="IMRDT_LINESEGMENT",e[e.IMRDT_LOCALIZATIONRESULT=8]="IMRDT_LOCALIZATIONRESULT",e[e.IMRDT_REGIONOFINTEREST=16]="IMRDT_REGIONOFINTEREST",e[e.IMRDT_QUADRILATERAL=32]="IMRDT_QUADRILATERAL"}(he||(he={})),function(e){e[e.BF_ALL=-29360129]="BF_ALL",e[e.BF_ONED=3147775]="BF_ONED",e[e.BF_GS1_DATABAR=260096]="BF_GS1_DATABAR",e[e.BF_CODE_39=1]="BF_CODE_39",e[e.BF_CODE_128=2]="BF_CODE_128",e[e.BF_CODE_93=4]="BF_CODE_93",e[e.BF_CODABAR=8]="BF_CODABAR",e[e.BF_ITF=16]="BF_ITF",e[e.BF_EAN_13=32]="BF_EAN_13",e[e.BF_EAN_8=64]="BF_EAN_8",e[e.BF_UPC_A=128]="BF_UPC_A",e[e.BF_UPC_E=256]="BF_UPC_E",e[e.BF_INDUSTRIAL_25=512]="BF_INDUSTRIAL_25",e[e.BF_CODE_39_EXTENDED=1024]="BF_CODE_39_EXTENDED",e[e.BF_GS1_DATABAR_OMNIDIRECTIONAL=2048]="BF_GS1_DATABAR_OMNIDIRECTIONAL",e[e.BF_GS1_DATABAR_TRUNCATED=4096]="BF_GS1_DATABAR_TRUNCATED",e[e.BF_GS1_DATABAR_STACKED=8192]="BF_GS1_DATABAR_STACKED",e[e.BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL=16384]="BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL",e[e.BF_GS1_DATABAR_EXPANDED=32768]="BF_GS1_DATABAR_EXPANDED",e[e.BF_GS1_DATABAR_EXPANDED_STACKED=65536]="BF_GS1_DATABAR_EXPANDED_STACKED",e[e.BF_GS1_DATABAR_LIMITED=131072]="BF_GS1_DATABAR_LIMITED",e[e.BF_PATCHCODE=262144]="BF_PATCHCODE",e[e.BF_PDF417=33554432]="BF_PDF417",e[e.BF_QR_CODE=67108864]="BF_QR_CODE",e[e.BF_DATAMATRIX=134217728]="BF_DATAMATRIX",e[e.BF_AZTEC=268435456]="BF_AZTEC",e[e.BF_MAXICODE=536870912]="BF_MAXICODE",e[e.BF_MICRO_QR=1073741824]="BF_MICRO_QR",e[e.BF_MICRO_PDF417=524288]="BF_MICRO_PDF417",e[e.BF_GS1_COMPOSITE=-2147483648]="BF_GS1_COMPOSITE",e[e.BF_MSI_CODE=1048576]="BF_MSI_CODE",e[e.BF_CODE_11=2097152]="BF_CODE_11",e[e.BF_NULL=0]="BF_NULL"}(de||(de={})),function(e){e[e.IRT_NO_RESULT=0]="IRT_NO_RESULT",e[e.IRT_ORIGINAL_IMAGE=1]="IRT_ORIGINAL_IMAGE",e[e.IRT_COLOUR_CLUSTERED_IMAGE=2]="IRT_COLOUR_CLUSTERED_IMAGE",e[e.IRT_COLOUR_CONVERTED_GRAYSCALE_IMAGE=4]="IRT_COLOUR_CONVERTED_GRAYSCALE_IMAGE",e[e.IRT_TRANSFORMED_GRAYSCALE_IMAGE=8]="IRT_TRANSFORMED_GRAYSCALE_IMAGE",e[e.IRT_PREDETECTED_REGION=16]="IRT_PREDETECTED_REGION",e[e.IRT_PREPROCESSED_IMAGE=32]="IRT_PREPROCESSED_IMAGE",e[e.IRT_BINARIZED_IMAGE=64]="IRT_BINARIZED_IMAGE",e[e.IRT_TEXT_ZONE=128]="IRT_TEXT_ZONE",e[e.IRT_CONTOUR=256]="IRT_CONTOUR",e[e.IRT_LINE_SEGMENT=512]="IRT_LINE_SEGMENT",e[e.IRT_FORM=1024]="IRT_FORM",e[e.IRT_SEGMENTATION_BLOCK=2048]="IRT_SEGMENTATION_BLOCK",e[e.IRT_TYPED_BARCODE_ZONE=4096]="IRT_TYPED_BARCODE_ZONE",e[e.IRT_PREDETECTED_QUADRILATERAL=8192]="IRT_PREDETECTED_QUADRILATERAL"}(fe||(fe={}));const ge=e=>e&&"object"==typeof e&&"function"==typeof e.then;class pe extends Promise{constructor(e){let t,i;super(((e,n)=>{t=e,i=n})),this._s="pending",this.resolve=e=>{this.isPending&&(ge(e)?this.task=e:(this._s="fulfilled",t(e)))},this.reject=e=>{this.isPending&&(this._s="rejected",i(e))},this.task=e}get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(e){let t;this._task=e,ge(e)?t=e:"function"==typeof e&&(t=new Promise(e)),t&&(async()=>{try{const i=await t;e===this._task&&this.resolve(i)}catch(t){e===this._task&&this.reject(t)}})()}get isEmpty(){return null==this._task}}const me=["iPhone","iPad","Android","HarmonyOS"].includes($.OS)?2048:4096;class _e{static get version(){return this._version}static get license(){return this._license}static set license(e){((e,t)=>{const i=e;if(!i._pLoad.isEmpty)throw new Error("`license`"+oe);i._license=t})(_e,e)}static get productKeys(){return this._license}static set productKeys(e){_e.license=e}static get handshakeCode(){return this._license}static set handshakeCode(e){_e.license=e}static get organizationID(){return this._license}static set organizationID(e){_e.license=e}static set sessionPassword(e){((e,t)=>{const i=e;if(!i._pLoad.isEmpty)throw new Error("`sessionPassword`"+oe);i._sessionPassword=t})(_e,e)}static get sessionPassword(){return this._sessionPassword}static async detectEnvironment(){return await(async()=>({wasm:ee,worker:te,getUserMedia:ie,camera:await ne(),browser:$.browser,version:$.version,OS:$.OS}))()}static get engineResourcePath(){return this._engineResourcePath}static set engineResourcePath(e){if(!this._pLoad.isEmpty)throw new Error("`engineResourcePath` is not allowed to change after `createInstance` or `loadWasm` is called.");_e._engineResourcePath=(e=>{if(null==e&&(e="./"),X);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e})(e)}static get licenseServer(){return this._licenseServer}static set licenseServer(e){((e,t)=>{const i=e;if(!i._pLoad.isEmpty)throw new Error("`licenseServer`"+oe);i._licenseServer=le(t)})(_e,e)}static get deviceFriendlyName(){return this._deviceFriendlyName}static set deviceFriendlyName(e){((e,t)=>{const i=e;if(!i._pLoad.isEmpty)throw new Error("`deviceFriendlyName`"+oe);i._deviceFriendlyName=t||""})(_e,e)}static get _bUseFullFeature(){return this.__bUseFullFeature}static set _bUseFullFeature(e){if(!this._pLoad.isEmpty)throw new Error("`_bUseFullFeature` is not allowed to change after `createInstance` or `loadWasm` is called.");_e.__bUseFullFeature=e}static isImageSource(e){return!(!e||"object"!=typeof e||Array.isArray(e))&&"getImage"in e}static isDSImage(e){return!(!e||"object"!=typeof e||Array.isArray(e))&&"data"in e&&"width"in e&&"height"in e&&"pixelFormat"in e}static isDCEFrame(e){return!(!e||"object"!=typeof e||Array.isArray(e))&&"data"in e&&"region"in e&&"sx"in e&&"sy"in e&&"width"in e&&"height"in e&&("colorMode"in e||"pixelFormat"in e)&&"timeSpent"in e&&"timeStamp"in e&&"isCropped"in e&&"toCanvas"in e&&"_sWidth"in e&&"_sHeight"in e&&"_bUseWebGL"in e}get ifSaveOriginalImageInACanvas(){return this._ifSaveOriginalImageInACanvas}set ifSaveOriginalImageInACanvas(e){this._ifSaveOriginalImageInACanvas=e}getOriginalImageInACanvas(){return!this.oriCanvas&&this.oriCanvasData?this.oriCanvasData.toCanvas():this.oriCanvas}set region(e){this._region=e,this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0}get region(){return this._region}static isWasmLoaded(){return this._pLoad.isFulfilled}isContextDestroyed(){return this.bDestroyed}static get lastErrorCode(){return this._lastErrorCode}static get lastErrorString(){return this._lastErrorString}get lastErrorCode(){return this._lastErrorCode}get lastErrorString(){return this._lastErrorString}static get defaultUIElementURL(){var e;return null===(e=_e._defaultUIElementURL)||void 0===e?void 0:e.replace("@engineResourcePath/",_e.engineResourcePath)}static set defaultUIElementURL(e){_e._defaultUIElementURL=e}static _fireHTTPSWarnning(){_e.onWarning&&location&&"https:"!==location.protocol&&setTimeout((()=>{_e.onWarning&&_e.onWarning({id:2,message:"Not connected via SSL (HTTPS), the SDK may not work correctly."})}),0)}get soundSource(){return this._soundSource}set soundSource(e){this._soundSource=e,this.beepSound=new s({src:[this._soundSource],onplayerror:(e,t)=>{console.warn(`Sound '${e}' playback failure: ${t}`)}})}get whenToPlaySoundforSuccessfulRead(){return!0===this.bPlaySoundOnSuccessfulRead?"frame":this.bPlaySoundOnSuccessfulRead?this.bPlaySoundOnSuccessfulRead:"never"}set whenToPlaySoundforSuccessfulRead(e){this.bPlaySoundOnSuccessfulRead="never"!==e&&e}get whenToVibrateforSuccessfulRead(){return!0===this.bVibrateOnSuccessfulRead?"frame":this.bVibrateOnSuccessfulRead?this.bVibrateOnSuccessfulRead:"never"}set whenToVibrateforSuccessfulRead(e){this.bVibrateOnSuccessfulRead="never"!==e&&e}set dce(e){this._dce=e}get dce(){return!this._dce||this._dce.isDisposed||this._dce.disposed?null:this._dce}set maxCvsSideLength(e){this._maxCvsSideLength=e,this._dceControler&&this._dceControler.setDisiredValue(this,"maxCvsSideLength",e)}get maxCvsSideLength(){return this._maxCvsSideLength}async _registerDCEControler(){if(!this.dce)return;_e._onLog&&_e._onLog("_registerDCEControler()");const e=this.dce;this._dceControler=e._createControler();const t=this._dceControler;t.register(this),t.setDisiredValue(this,"refreshInterval",200),t.setDisiredValue(this,"maxCvsSideLength",this._maxCvsSideLength),this._styleIdBeforeVerification=this.dce.createDrawingStyle({fillStyle:"rgba(248,252,0,0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill"});try{ResizeObserver}catch(e){"ReferenceError"===e.name&&window&&(window.ResizeObserver=void 0)}const i=e.getUIElement(),n=this.dce.constructor;if("@engineResourcePath/dce.ui.html"===n._defaultUIElementURL)try{i?i===t._innerSetUI&&(await e.setUIElement(`${n.engineResourcePath}dce.ui.html`),t._innerSetUI=e.getUIElement()):(await e.setUIElement(`${n.engineResourcePath}dbr.ui.html`),t._innerSetUI=e.getUIElement())}catch(t){await e.setUIElement(n.defaultUIElementURL)}else i||await e.setUIElement(n.defaultUIElementURL);this.callbackCameraChange=()=>{this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0},this.callbackResolutionChange=()=>{this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0},this.callbackCameraClose=()=>{this.stopScanning(!0),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0,this._bPauseScan=!1},this.callbackSingleFrameAcquired=async e=>{this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null);let t=await this._decode_DCEFrame(e,{bCopyData:!1}),i=null;if(t&&t.length){const{sx:n,sy:r,width:o,height:a,_sWidth:s,_sHeight:l}=e;i=t.map((e=>({localizationResult:JSON.parse(JSON.stringify(e.localizationResult))}))),_e.recalculateResultLocation(i,n,r,s,l,o,a)}if(this._drawResults(i,t),await this.clearMapDecodeRecord(),this.onImageRead&&this.dce.isOpen()&&!this._bPauseScan){let e=this._cloneDecodeResults(t);this.onImageRead(e)}if(this.onUniqueRead&&this.dce.isOpen()&&!this._bPauseScan)for(let n of t)this.onUniqueRead(n.barcodeText,this._cloneDecodeResults(n))},e.on("cameraChange",this.callbackCameraChange),e.on("resolutionChange",this.callbackResolutionChange),e.on("cameraClose",this.callbackCameraClose),e.on("singleFrameAcquired",this.callbackSingleFrameAcquired)}_logoutDCEControler(){this.dce&&this._dceControler&&(_e._onLog&&_e._onLog("_logoutDCEControler()"),this._dceControler.logout(this),this.dce.off("cameraChange",this.callbackCameraChange),this.dce.off("resolutionChange",this.callbackResolutionChange),this.dce.off("cameraClose",this.callbackCameraClose),this.dce.off("singleFrameAcquired",this.callbackSingleFrameAcquired),this._dceControler=null,this.dce=null)}async setImageSource(e,t){if(null==e)return this._imgSource=null,this._logoutDCEControler(),void(this._drawingItemNamespace=null);if(e&&e.isCameraEnhancer)this.dce=e,await this._registerDCEControler(),this._imgSource=null;else{if(!_e.isImageSource(e))throw new Error("Invalid value.");this._logoutDCEControler(),this._imgSource=e}t&&t.resultsHighlightBaseShapes&&(this._drawingItemNamespace=t.resultsHighlightBaseShapes)}static async loadWasm(){if(this._pLoad.isEmpty){let{lt:e,l:t,ls:i,sp:n,rmk:r}=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=e;if(i._pLoad.isEmpty){let n,r,o,a=i._license||"",s=JSON.parse(JSON.stringify(i._licenseServer)),l=i._sessionPassword,c=0;if(a.startsWith("t")||a.startsWith("f"))c=0;else if(0===a.length||a.startsWith("P")||a.startsWith("L")||a.startsWith("Y")||a.startsWith("A"))c=1;else{c=2;const t=a.indexOf(":");-1!=t&&(a=a.substring(t+1));const i=a.indexOf("?");if(-1!=i&&(r=a.substring(i+1),a=a.substring(0,i)),a.startsWith("DLC2"))c=0;else{if(a.startsWith("DLS2")){let t;try{let e=a.substring(4);e=atob(e),t=JSON.parse(e)}catch(e){throw new Error("Format Error: The license string you specified is invalid, please check to make sure it is correct.")}if(a=t.handshakeCode?t.handshakeCode:t.organizationID?t.organizationID:"","number"==typeof a&&(a=JSON.stringify(a)),0===s.length){let e=[];t.mainServerURL&&(e[0]=t.mainServerURL),t.standbyServerURL&&(e[1]=t.standbyServerURL),s=le(e)}!l&&t.sessionPassword&&(l=t.sessionPassword),n=t.remark}a&&"200001"!==a&&!a.startsWith("200001-")||(c=1)}}if(c&&(t||(q.crypto||(o="Please upgrade your browser to support online key."),q.crypto.subtle||(o="Require https to use online key in this browser."))),o){if(1!==c)throw new Error(o);c=0,console.warn(o),i._lastErrorCode=-1,i._lastErrorString=o}return 1===c&&(a="",console.warn("Applying for a public trial license ...")),{lt:c,l:a,ls:s,sp:l,rmk:n,cv:r}}throw new Error("Can't preprocess license again"+oe)}(_e);this._pLoad.task=async(o,a)=>{let s=_e.engineResourcePath+_e._workerName;_e.engineResourcePath.startsWith(location.origin)||(s=await fetch(s).then((e=>e.blob())).then((e=>URL.createObjectURL(e)))),_e._dbrWorker=new Worker(s),URL.revokeObjectURL(s),_e._dbrWorker.onerror=e=>{let t=new Error(e.message);a(t)},_e._dbrWorker.onmessage=async t=>{let i=t.data?t.data:t;switch(i.type){case"log":_e._onLog&&_e._onLog(i.message);break;case"load":{i.message&&(i.message=i.message.replace("(https://www.dynamsoft.com/purchase-center/)","(https://www.dynamsoft.com/store/dynamsoft-barcode-reader/#javascript)"));let t,n=!1;1===e&&(n=!0,i.message||(i.message="Using a temporary license. [Register for a 30-day trial license >>>](https://www.dynamsoft.com/customer/license/trialLicense?product=dbr&deploymenttype=browser)")),i.success?(_e._dbrWorker.onerror=null,_e._version=i.version+"(JS "+_e._jsVersion+"."+_e._jsEditVersion+")",_e._onLog&&_e._onLog("load dbr worker success"),i.message&&console.warn(i.message)):(t=new Error(i.message),t.stack=i.stack+"\n"+t.stack,t.ltsErrorCode=i.ltsErrorCode,n||111==i.ltsErrorCode&&-1!=i.message.toLowerCase().indexOf("trial license")&&(n=!0)),n&&_e.showDialog(i.success?"warn":"error",i.message),i.success?o():a(t);break}case"task":{let e=i.id,n=i.body;try{_e._taskCallbackMap.get(e)(n),_e._taskCallbackMap.delete(e)}catch(t){throw _e._taskCallbackMap.delete(e),t}break}default:_e._onLog&&_e._onLog(t)}},_e._dbrWorker.postMessage({type:"loadWasm",engineResourcePath:_e.engineResourcePath,bUseFullFeature:_e._bUseFullFeature,bd:_e._bWasmDebug,v:_e._jsVersion,brtk:!!e,bptk:1===e,l:t,dm:location.origin.startsWith("http")?location.origin:"https://localhost",os:$,cv:_e.authCacheVersion,fn:_e.deviceFriendlyName,ls:i,sp:n,rmk:r})}}await this._pLoad}static async showDialog(e,t){await(async(e,t,i)=>{if(!e._bNeverShowDialog)try{let n=await fetch(e.engineResourcePath+"dls.license.dialog.html");if(!n.ok)throw Error("Get license dialog fail. Network Error: "+n.statusText);let r=await n.text();if(!r.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let o=document.createElement("div");o.innerHTML=r;let a=[];for(let e=0;e<o.childElementCount;++e){let t=o.children[e];t instanceof HTMLStyleElement&&(a.push(t),document.head.append(t))}let s=1==o.childElementCount?o.children[0]:o;s.remove();let l,c,u,h,d,f=[s],g=s.children;for(let e of g)f.push(e);for(let e=0;e<f.length;++e)for(let t of f[e].children)f.push(t);for(let e of f)if(!l&&e.classList.contains("dls-license-mask"))l=e,e.addEventListener("click",(t=>{if(e==t.target){s.remove();for(let e of a)e.remove()}}));else if(!c&&e.classList.contains("dls-license-icon-close"))c=e,e.addEventListener("click",(()=>{s.remove();for(let e of a)e.remove()}));else if(!u&&e.classList.contains("dls-license-icon-error"))u=e,"error"!=t&&e.remove();else if(!h&&e.classList.contains("dls-license-icon-warn"))h=e,"warn"!=t&&e.remove();else if(!d&&e.classList.contains("dls-license-msg-content")){d=e;let t=i;for(;t;){let i=t.indexOf("["),n=t.indexOf("]",i),r=t.indexOf("(",n),o=t.indexOf(")",r);if(-1==i||-1==n||-1==r||-1==o){e.appendChild(new Text(t));break}i>0&&e.appendChild(new Text(t.substring(0,i)));let a=document.createElement("a"),s=t.substring(i+1,n);a.innerText=s;let l=t.substring(r+1,o);a.setAttribute("href",l),a.setAttribute("target","_blank"),e.appendChild(a),t=t.substring(o+1)}}document.body.appendChild(s)}catch(t){e._onLog&&e._onLog(t.message||t)}})(this,e,t)}static async createInstanceInWorker(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return await _e.loadWasm(),await new Promise(((t,i)=>{let n=_e._nextTaskID++;_e._taskCallbackMap.set(n,(e=>{if(e.success)return t(e.instanceID);{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}})),_e._dbrWorker.postMessage({type:"createInstance",id:n,bScanner:e})}))}constructor(){this._instanceID=void 0,this._ifSaveOriginalImageInACanvas=!1,this.oriCanvas=null,this.oriCanvasData=null,this.canvas=null,this.bFilterRegionInJs=!1,this._region=null,this._timeStartDecode=null,this._timeEnterInnerDBR=null,this._timeGetMessage=null,this.decodeRecords={},this.bDestroyed=!1,this._lastErrorCode=0,this._lastErrorString="",this._lastInnerDecodeDuration=0,this.intervalTime=0,this._intervalGetVideoFrame=0,this.array_getFrameTimeCost=[],this.array_decodeFrameTimeCost=[],this._indexCurrentDecodingFrame=0,this._arrPolygons=[],this._bPauseScan=!1,this._intervalDetectVideoPause=1e3,this._soundSource="data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",this.bPlaySoundOnSuccessfulRead=!1,this.bVibrateOnSuccessfulRead=!1,this.vibrateDuration=300,this.captureAndDecodeInParallel=!0,this.autoSuggestTip=!1,this.suggestTipFrameArray=[],this.suggestTipFrameLimit=[5,3],this.noIntermediateResultsCount=0,this.noIntermediateResultsTipLimit=100,this.tinyBarcodeTipModuleSizeLimit=3,this.hugeBarcodeTipLimit=.9,this.autoZoomInFrameArray=[],this.autoZoomInFrameLimit=[5,3],this.autoZoomInStepRate=1/3,this.autoZoomInMaxStep=1.5,this.autoZoomInMaxTimes=5,this.autoZoomInMinStep=Math.pow(10,1/this.autoZoomInMaxTimes),this.autoZoomInIdealModuleSize=6,this.autoZoomOutFrameCount=0,this.autoZoomOutFrameLimit=3,this.autoZoomOutStepRate=1/3,this.autoZoomOutMinValue=1,this.autoZoomOutMinStep=2,this.autoZoomOutStepRate_2=.05,this.autoZoomOutMinValue_2=2,this.frameArrayInIdealZoom=[],this.frameLimitInIdealZoom=[5,3],this.enableZoomOutInIdealZoom=!1,this.nextActionInIdealZoom="focus",this.autoFocusFrameArray=[],this.autoFocusFrameLimit=[5,3],this.autoZoomIdealArea=[0,.05],this.autoZoomTargetBorder=.9,this.autoZoomDetectionArea=.5,this.autoZoom=!1,this.autoFocus=!1,this._resultHighlightingDuration=-1,this._dce=null,this._imgSource=null,this._maxCvsSideLength=me,this._promiseStartScan=null,this.beepSound=new s({src:[this._soundSource],onplayerror:(e,t)=>{console.warn(`Sound '${e}' playback failure: ${t}`)}})}static async createInstance(){const e=new _e;return e._instanceID=await _e.createInstanceInWorker(),_e._fireHTTPSWarnning(),e}async clearMapDecodeRecord(){return await new Promise(((e,t)=>{let i=_e._nextTaskID++;_e._taskCallbackMap.set(i,(i=>{if(i.success)return e();{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}})),_e._dbrWorker.postMessage({type:"clearMapDecodeRecord",id:i,instanceID:this._instanceID})}))}async decode(e){_e._onLog&&_e._onLog("decode(source: any)"),_e._onLog&&(this._timeStartDecode=Date.now());let t={};return!this.region||this.region instanceof Array||(t.region=JSON.parse(JSON.stringify(this.region))),e instanceof Blob?await this._decode_Blob(e,t):e instanceof ArrayBuffer?await this._decode_ArrayBuffer(e,t):e instanceof Uint8Array||e instanceof Uint8ClampedArray?await this._decode_Uint8Array(e,t):e instanceof HTMLImageElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?await this._decode_Image(e,t):e instanceof HTMLCanvasElement?await this._decode_Canvas(e,t):e instanceof HTMLVideoElement?await this._decode_Video(e,t):"string"==typeof e?"data:image/"==e.substring(0,11)?await this._decode_Base64(e,t):await this._decode_Url(e,t):_e.isDCEFrame(e)?(t.bCopyData=!0,await this._decode_DCEFrame(e,t)):_e.isDSImage(e)?(t.bCopyData=!0,await this._decode_DSImage(e,t)):await Promise.reject(TypeError("'_decode(source, config)': Type of 'source' should be 'Blob', 'ArrayBuffer', 'Uint8Array', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement', 'String(base64 with image mime)' or 'String(url)'."))}async decodeBase64String(e){let t={};return!this.region||this.region instanceof Array||(t.region=JSON.parse(JSON.stringify(this.region))),this._decode_Base64(e,t)}async decodeUrl(e){let t={};return!this.region||this.region instanceof Array||(t.region=JSON.parse(JSON.stringify(this.region))),this._decode_Url(e,t)}async _decodeBuffer_Uint8Array(e,t,i,n,r,o,a){return await new Promise(((s,l)=>{let c=_e._nextTaskID++;_e._taskCallbackMap.set(c,(e=>{if(e.success){let t,i=_e._onLog?Date.now():0;_e._onLog&&_e._onLog("worker return result: "+i),this._lastInnerDecodeDuration=e.duration;try{t=this._handleRetJsonString(e.decodeReturn)}catch(e){return l(e)}if(_e._onLog){let e=Date.now();_e._onLog("DBR getting message from worker timestamp: "+i),_e._onLog("From DBR staring decoding to entering worker costs: "+(this._timeEnterInnerDBR-this._timeStartDecode)),_e._onLog("From DBR entering worker to returning message from worker costs: "+(i-this._timeEnterInnerDBR)),_e._onLog("Handling results from DBR worker costs: "+(e-i)),_e._onLog("Total decoding image costs: "+(e-this._timeStartDecode))}return s(t)}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,l(t)}})),this._timeEnterInnerDBR=Date.now(),_e._onLog&&_e._onLog("Sending buffer to worker timestamp:"+this._timeEnterInnerDBR),_e._dbrWorker.postMessage({type:"decodeBuffer",id:c,instanceID:this._instanceID,body:{buffer:e,width:t,height:i,stride:n,format:r,orientation:o,config:a}},[e.buffer]),_e._onLog&&a&&a.timeStamp&&_e._onLog("Delay of decoding image: "+(this._timeEnterInnerDBR-a.timeStamp))}))}async _decodeBuffer_Blob(e,t,i,n,r,o,a){_e._onLog&&_e._onLog("_decodeBuffer_Blob(buffer,width,height,stride,format)");const s=e.arrayBuffer?await e.arrayBuffer():await new Promise(((t,i)=>{let n=new FileReader;n.readAsArrayBuffer(e),n.onload=()=>{t(n.result)},n.onerror=()=>{i(n.error)}}));return await this._decodeBuffer_Uint8Array(new Uint8Array(s),t,i,n,r,o,a)}async decodeBuffer(e,t,i,n,r,o,a){let s;return _e._onLog&&_e._onLog("decodeBuffer(buffer,width,height,stride,format)"),_e._onLog&&(this._timeStartDecode=Date.now()),e instanceof Uint8Array||e instanceof Uint8ClampedArray?s=await this._decodeBuffer_Uint8Array(e,t,i,n,r,o,a):e instanceof ArrayBuffer?s=await this._decodeBuffer_Uint8Array(new Uint8Array(e),t,i,n,r,o,a):e instanceof Blob&&(s=await this._decodeBuffer_Blob(e,t,i,n,r,o,a)),s}async _decodeFileInMemory_Uint8Array(e){return await new Promise(((t,i)=>{let n=_e._nextTaskID++;_e._taskCallbackMap.set(n,(e=>{if(e.success){let n;this._lastInnerDecodeDuration=e.duration;try{n=this._handleRetJsonString(e.decodeReturn)}catch(e){return i(e)}return t(n)}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}})),_e._dbrWorker.postMessage({type:"decodeFileInMemory",id:n,instanceID:this._instanceID,body:{bytes:e}})}))}async getRuntimeSettings(){return await new Promise(((e,t)=>{let i=_e._nextTaskID++;_e._taskCallbackMap.set(i,(i=>{if(i.success){let t=JSON.parse(i.results);return null!=this.userDefinedRegion&&(t.region=JSON.parse(JSON.stringify(this.userDefinedRegion))),e(t)}{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}})),_e._dbrWorker.postMessage({type:"getRuntimeSettings",id:i,instanceID:this._instanceID})}))}async updateRuntimeSettings(e){let t;if("string"==typeof e)if("speed"==e){let e=await this.getRuntimeSettings();await this.resetRuntimeSettings(),t=await this.getRuntimeSettings(),t.barcodeFormatIds=e.barcodeFormatIds,t.barcodeFormatIds_2=e.barcodeFormatIds_2,t.region=e.region,t.deblurLevel=3,t.expectedBarcodesCount=0,t.localizationModes=[2,0,0,0,0,0,0,0]}else if("balance"==e){let e=await this.getRuntimeSettings();await this.resetRuntimeSettings(),t=await this.getRuntimeSettings(),t.barcodeFormatIds=e.barcodeFormatIds,t.barcodeFormatIds_2=e.barcodeFormatIds_2,t.region=e.region,t.deblurLevel=5,t.expectedBarcodesCount=512,t.localizationModes=[2,16,0,0,0,0,0,0]}else if("coverage"==e){let e=await this.getRuntimeSettings();await this.resetRuntimeSettings(),t=await this.getRuntimeSettings(),t.barcodeFormatIds=e.barcodeFormatIds,t.barcodeFormatIds_2=e.barcodeFormatIds_2,t.region=e.region}else if("dense"==e){let e=await this.getRuntimeSettings();await this.resetRuntimeSettings(),this.maxCvsSideLength=4096,t=await this.getRuntimeSettings(),t.barcodeFormatIds=e.barcodeFormatIds,t.barcodeFormatIds_2=e.barcodeFormatIds_2,t.region=e.region,t.deblurLevel=9,t.expectedBarcodesCount=0,t.localizationModes=[2,8,0,0,0,0,0,0]}else if("distance"==e){let e=await this.getRuntimeSettings();await this.resetRuntimeSettings(),this.maxCvsSideLength=4096,t=await this.getRuntimeSettings(),t.barcodeFormatIds=e.barcodeFormatIds,t.barcodeFormatIds_2=e.barcodeFormatIds_2,t.region=e.region,t.deblurLevel=3,t.expectedBarcodesCount=0,t.localizationModes=[2,8,0,0,0,0,0,0]}else t=JSON.parse(e);else{if("object"!=typeof e)throw TypeError("'UpdateRuntimeSettings(settings)': Type of 'settings' should be 'string' or 'PlainObject'.");if(t=JSON.parse(JSON.stringify(e)),t.region instanceof Array){let e=t.region;[e.regionLeft,e.regionTop,e.regionLeft,e.regionBottom,e.regionMeasuredByPercentage].some((e=>void 0!==e))&&(t.region={regionLeft:e.regionLeft||0,regionTop:e.regionTop||0,regionRight:e.regionRight||0,regionBottom:e.regionBottom||0,regionMeasuredByPercentage:e.regionMeasuredByPercentage||0})}}if(!_e._bUseFullFeature){if(t.barcodeFormatIds&~(de.BF_ONED|de.BF_QR_CODE|de.BF_PDF417|de.BF_DATAMATRIX)||0!=t.barcodeFormatIds_2)throw Error("Some of the specified barcode formats are not supported in the compact version. Please try the full-featured version.");if(0!=t.intermediateResultTypes)throw Error("Intermediate results is not supported in the compact version. Please try the full-featured version.")}if(this.bFilterRegionInJs){let e=t.region;if(e instanceof Array)throw Error("The `region` of type `Array` is only allowed in `BarcodeScanner`.");this.userDefinedRegion=JSON.parse(JSON.stringify(e)),(e.regionLeft||e.regionTop||e.regionRight||e.regionBottom||e.regionMeasuredByPercentage)&&(e.regionLeft||e.regionTop||100!=e.regionRight||100!=e.regionBottom||!e.regionMeasuredByPercentage)?this.region=e:this.region=null,t.region={regionLeft:0,regionTop:0,regionRight:0,regionBottom:0,regionMeasuredByPercentage:0}}else this.userDefinedRegion=null,this.region=null;return(this.autoZoom||this.autoFocus)&&(t.intermediateResultTypes|=fe.IRT_TYPED_BARCODE_ZONE),await new Promise(((e,i)=>{let n=_e._nextTaskID++;_e._taskCallbackMap.set(n,(t=>{if(t.success){try{this._handleRetJsonString(t.updateReturn)}catch(e){i(e)}return e()}{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,i(e)}})),_e._dbrWorker.postMessage({type:"updateRuntimeSettings",id:n,instanceID:this._instanceID,body:{settings:JSON.stringify(t)}})}))}async resetRuntimeSettings(){return this.userDefinedRegion=null,this.region=null,this.maxCvsSideLength=me,await new Promise(((e,t)=>{let i=_e._nextTaskID++;_e._taskCallbackMap.set(i,(i=>{if(i.success)return e();{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}})),_e._dbrWorker.postMessage({type:"resetRuntimeSettings",id:i,instanceID:this._instanceID})}))}async _resetRuntimeSettingsToCppDefault(){return this.userDefinedRegion=null,this.region=null,this.maxCvsSideLength=me,await new Promise(((e,t)=>{let i=_e._nextTaskID++;_e._taskCallbackMap.set(i,(i=>{if(i.success)return e();{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}})),_e._dbrWorker.postMessage({type:"resetRuntimeSettingsToCppDefault",id:i,instanceID:this._instanceID})}))}async outputRuntimeSettingsToString(){if(!_e._bUseFullFeature)throw Error("outputRuntimeSettingsToString() is not supported in the compact version. Please try the full-featured version.");return await new Promise(((e,t)=>{let i=_e._nextTaskID++;_e._taskCallbackMap.set(i,(i=>{if(i.success)return e(i.results);{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}})),_e._dbrWorker.postMessage({type:"outputRuntimeSettingsToString",id:i,instanceID:this._instanceID})}))}async initRuntimeSettingsWithString(e){if(!_e._bUseFullFeature)throw Error("initRuntimeSettingsWithString() is not supported in the compact version. Please try the full-featured version.");if("string"==typeof e);else{if("object"!=typeof e)throw TypeError("'initRuntimeSettingstWithString(settings)': Type of 'settings' should be 'string' or 'PlainObject'.");e=JSON.stringify(e)}return await new Promise(((t,i)=>{let n=_e._nextTaskID++;_e._taskCallbackMap.set(n,(e=>{if(e.success){try{this._handleRetJsonString(e.initReturn)}catch(e){i(e)}return t()}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}})),_e._dbrWorker.postMessage({type:"initRuntimeSettingsWithString",id:n,instanceID:this._instanceID,body:{settings:e}})}))}async _decode_Blob(e,t){_e._onLog&&_e._onLog("_decode_Blob(blob: Blob)");let i=null,n=null;if("undefined"!=typeof createImageBitmap)try{i=await createImageBitmap(e)}catch(e){}i||(n=await function(e){return new Promise(((t,i)=>{let n=URL.createObjectURL(e),r=new Image;r.src=n,r.onload=()=>{URL.revokeObjectURL(r.src),t(r)},r.onerror=e=>{i(new Error("Can't convert blob to image : "+(e instanceof Event?e.type:e)))}}))}(e));let r=await this._decode_Image(i||n,t);return i&&i.close(),r}async _decode_ArrayBuffer(e,t){return await this._decode_Blob(new Blob([e]),t)}async _decode_Uint8Array(e,t){return await this._decode_Blob(new Blob([e]),t)}async _decode_Image(e,t){_e._onLog&&_e._onLog("_decode_Image(image: HTMLImageElement|ImageBitmap)"),t=t||{};let i,n,r=e instanceof HTMLImageElement?e.naturalWidth:e.width,o=e instanceof HTMLImageElement?e.naturalHeight:e.height,a=Math.max(r,o);if(a>this._maxCvsSideLength){let e=this._maxCvsSideLength/a;i=Math.round(r*e),n=Math.round(o*e)}else i=r,n=o;this.canvas||(this.canvas=document.createElement("canvas"));const s=this.canvas;s.width===i&&s.height===n||(s.width=i,s.height=n),s.ctx2d||(s.ctx2d=s.getContext("2d",{willReadFrequently:!0})),s.ctx2d.drawImage(e,0,0,r,o,0,0,i,n);let l=await this._decode_Canvas(s,t);if(this.ifSaveOriginalImageInACanvas){const t=document.createElement("canvas");t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),this.oriCanvas=t,this.oriCanvasData=null}return _e.recalculateResultLocation(l,0,0,r,o,i,n),l}async _decode_Canvas(e,t){if(_e._onLog&&_e._onLog("_decode_Canvas(canvas:HTMLCanvasElement)"),e.crossOrigin&&"anonymous"!=e.crossOrigin)throw"cors";if(0===e.width||0===e.height)throw Error("The width or height of the 'canvas' is 0.");this.ifSaveOriginalImageInACanvas&&(this.oriCanvas=e,this.oriCanvasData=null);let i=(e.ctx2d||e.getContext("2d",{willReadFrequently:!0})).getImageData(0,0,e.width,e.height).data;return await this._decodeBuffer_Uint8Array(i,e.width,e.height,4*e.width,ce.IPF_ABGR_8888,0,t)}async _decode_Video(e,t){if(_e._onLog&&_e._onLog("_decode_Video(video)"),!(e instanceof HTMLVideoElement))throw TypeError("'_decode_Video(video [, config] )': Type of 'video' should be 'HTMLVideoElement'.");if(e.crossOrigin&&"anonymous"!=e.crossOrigin)throw"cors";t=t||{};let i,n,r=e.videoWidth,o=e.videoHeight,a=Math.max(r,o);if(a>this._maxCvsSideLength){let e=this._maxCvsSideLength/a;i=Math.round(r*e),n=Math.round(o*e)}else i=r,n=o;this.canvas||(this.canvas=document.createElement("canvas"));const s=this.canvas;s.width===i&&s.height===n||(s.width=i,s.height=n),s.ctx2d||(s.ctx2d=s.getContext("2d",{willReadFrequently:!0})),s.ctx2d.drawImage(e,0,0,r,o,0,0,i,n);let l=await this._decode_Canvas(s,t);if(this.ifSaveOriginalImageInACanvas){const t=document.createElement("canvas");t.width=e.videoWidth,t.height=e.videoHeight,t.getContext("2d").drawImage(e,0,0),this.oriCanvas=t,this.oriCanvasData=null}return _e.recalculateResultLocation(l,0,0,r,o,i,n),l}async _decode_DCEFrame(e,t){if(_e._onLog&&_e._onLog("_decode_DCEFrame(dceFrame)"),!_e.isDCEFrame(e))return[];let i=[];this.ifSaveOriginalImageInACanvas&&(this.oriCanvas=null,this.oriCanvasData={width:e.width,height:e.height,colorMode:e.colorMode,pixelFormat:e.pixelFormat,data:new Uint8Array(e.data),toCanvas:e.toCanvas});const{width:n,height:r,colorMode:o,pixelFormat:a,stride:s,timeStamp:l}=e;let c;c=t&&t.bCopyData?new Uint8Array(e.data):e.data;let u=null;if(t?(u=JSON.parse(JSON.stringify(t)),u.timeStamp=l):u={timeStamp:l},a&&s)if("grey"===a)i=await this._decodeBuffer_Uint8Array(c,n,r,s,ce.IPF_GrayScaled,0,u);else if("rgba"===a)i=await this._decodeBuffer_Uint8Array(c,n,r,s,ce.IPF_ABGR_8888,0,u);else{if("bgra"!==a)throw new Error(`Pixel format '${a}' is not supported to decode.`);i=await this._decodeBuffer_Uint8Array(c,n,r,s,ce.IPF_ARGB_8888,0,u)}else if("grey"===o)i=await this._decodeBuffer_Uint8Array(c,n,r,n,ce.IPF_GrayScaled,0,u);else if("rgba"===o)i=await this._decodeBuffer_Uint8Array(c,n,r,4*n,ce.IPF_ABGR_8888,0,u);else{if("bgra"!==o)throw new Error(`Color mode '${o}' is not supported to decode.`);i=await this._decodeBuffer_Uint8Array(c,n,r,4*n,ce.IPF_ARGB_8888,0,u)}return i}async _decode_DSImage(e,t){if(_e._onLog&&_e._onLog("_decode_DSImage(dsImage)"),!_e.isDSImage(e))return null;this.ifSaveOriginalImageInACanvas&&(this.oriCanvas=null,this.oriCanvasData={width:e.width,height:e.height,pixelFormat:e.pixelFormat.toLowerCase(),data:new Uint8Array(e.data),toCanvas:function(){const e=document.createElement("canvas");let t;switch(e.width=this.width,e.height=this.height,this.pixelFormat){case"grey":t=new Uint8ClampedArray(this.width*this.height*4);for(let e=0;e<t.length;e+=4)t[e]=this.data[e/4],t[e+1]=this.data[e/4],t[e+2]=this.data[e/4],t[e+3]=255;break;case"rgb":t=new Uint8ClampedArray(this.width*this.height*4);for(let e=0;e<t.length;e+=4)t[e]=this.data[e],t[e+1]=this.data[e+1],t[e+2]=this.data[e+2],t[e+3]=255;break;case"bgr":t=new Uint8ClampedArray(this.width*this.height*4);for(let e=0;e<t.length;e+=4)t[e]=this.data[e],t[e+1]=this.data[e+1],t[e+2]=this.data[e+2],t[e+3]=255;break;case"rgba":case"bgra":t=new Uint8ClampedArray(this.data);break;default:throw new Error("The content of 2D Canvas is currently limited to the sRGB color space.")}const i=new ImageData(t,this.width,this.height);return e.getContext("2d").putImageData(i,0,0),e}});const{width:i,height:n}=e;let r,o,a,s=e.pixelFormat.toLowerCase();switch(r=t&&t.bCopyData?new Uint8Array(e.data):e.data,s){case"grey":a=ce.IPF_GrayScaled,o=i;break;case"rgb":a=ce.IPF_BGR_888,o=3*i;break;case"bgr":a=ce.IPF_RGB_888,o=3*i;break;case"rgba":a=ce.IPF_ABGR_8888,o=4*i;break;case"bgra":a=ce.IPF_ARGB_8888,o=4*i;break;default:throw new Error("The pixel format is not supported to decode.")}return await this._decodeBuffer_Uint8Array(r,i,n,o,a,0,t)}async _decode_Base64(e,t){if(_e._onLog&&_e._onLog("_decode_Base64(base64Str)"),"string"!=typeof e)return Promise.reject("'_decode_Base64(base64Str, config)': Type of 'base64Str' should be 'string'.");"data:image/"==e.substring(0,11)&&(e=e.substring(e.indexOf(",")+1));let i=atob(e),n=i.length,r=new Uint8Array(n);for(;n--;)r[n]=i.charCodeAt(n);return await this._decode_Blob(new Blob([r]),t)}async _decode_Url(e,t){if(_e._onLog&&_e._onLog("_decode_Url(url)"),"string"!=typeof e)throw TypeError("'_decode_Url(url, config)': Type of 'url' should be 'string'.");let i=await new Promise(((t,i)=>{let n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="blob",n.send(),n.onloadend=async()=>{t(n.response)},n.onerror=()=>{i(new Error("Network Error: "+n.statusText))}}));return await this._decode_Blob(i,t)}static recalculateResultLocation(e,t,i,n,r,o,a){if(e.length>0)for(let s of e){let e=s.localizationResult;2==e.resultCoordinateType&&(e.x1*=.01*o,e.x2*=.01*o,e.x3*=.01*o,e.x4*=.01*o,e.y1*=.01*a,e.y2*=.01*a,e.y3*=.01*a,e.y4*=.01*a);let l=o/n,c=a/r;e.x1=e.x1/l+t,e.x2=e.x2/l+t,e.x3=e.x3/l+t,e.x4=e.x4/l+t,e.y1=e.y1/c+i,e.y2=e.y2/c+i,e.y3=e.y3/c+i,e.y4=e.y4/c+i,2==e.resultCoordinateType&&(e.x1*=100/n,e.x2*=100/n,e.x3*=100/n,e.x4*=100/n,e.y1*=100/r,e.y2*=100/r,e.y3*=100/r,e.y4*=100/r),e.x1=Math.round(e.x1),e.x2=Math.round(e.x2),e.x3=Math.round(e.x3),e.x4=Math.round(e.x4),e.y1=Math.round(e.y1),e.y2=Math.round(e.y2),e.y3=Math.round(e.y3),e.y4=Math.round(e.y4)}}static BarcodeReaderException(e,t){let i,n=ue.DBR_UNKNOWN;return"number"==typeof e?(n=e,i=new Error(t)):i=new Error(e),i.code=n,i}_handleRetJsonString(e){let t=ue;if(e.textResults){for(let t=0;t<e.textResults.length;t++){let i=e.textResults[t];try{let t=i.barcodeText,n="";for(let e=0;e<t.length;e++)n+=String.fromCharCode(t[e]);try{i.barcodeText=decodeURIComponent(escape(n))}catch(e){i.barcodeText=n}}catch(e){i.barcodeText=""}if(null!=i.exception){_e._setWarnnedEx.has(i.exception)||(_e._setWarnnedEx.add(i.exception),console.warn(i.exception));let e={};i.exception.split(";").forEach((t=>{let i=t.indexOf(":");e[t.substring(0,i)]=t.substring(i+1)})),i.exception=e}}return e.decodeRecords?this.decodeRecords=e.decodeRecords:this.decodeRecords={},this._lastErrorCode=e.exception,this._lastErrorString=e.description,e.exception&&!_e._setWarnnedEx.has(e.description)&&(_e._setWarnnedEx.add(e.description),console.warn(e.description)),e.textResults}if(e.exception==t.DBR_SUCCESS)return e.data;throw _e.BarcodeReaderException(e.exception,e.description)}async setModeArgument(e,t,i,n){return await new Promise(((r,o)=>{let a=_e._nextTaskID++;_e._taskCallbackMap.set(a,(e=>{if(e.success){try{this._handleRetJsonString(e.setReturn)}catch(e){return o(e)}return r()}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,o(t)}})),_e._dbrWorker.postMessage({type:"setModeArgument",id:a,instanceID:this._instanceID,body:{modeName:e,index:t,argumentName:i,argumentValue:n}})}))}async getModeArgument(e,t,i){return await new Promise(((n,r)=>{let o=_e._nextTaskID++;_e._taskCallbackMap.set(o,(e=>{if(e.success){let t;try{t=this._handleRetJsonString(e.getReturn)}catch(e){return r(e)}return n(t)}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,r(t)}})),_e._dbrWorker.postMessage({type:"getModeArgument",id:o,instanceID:this._instanceID,body:{modeName:e,index:t,argumentName:i}})}))}async getIntermediateResults(){return await new Promise(((e,t)=>{let i=_e._nextTaskID++;_e._taskCallbackMap.set(i,(i=>{if(i.success)return e(i.results);{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}})),_e._dbrWorker.postMessage({type:"getIntermediateResults",id:i,instanceID:this._instanceID,body:{isCharge:!0}})}))}async getIntermediateCanvas(){let e=await this.getIntermediateResults(),t=[];for(let i of e)if(i.dataType==he.IMRDT_IMAGE)for(let e of i.results){const i=e.bytes;let n;switch(_e._onLog&&_e._onLog(" "+i.length+" "+i.byteLength+" "+e.width+" "+e.height+" "+e.stride+" "+e.format),e.format){case ce.IPF_ABGR_8888:n=new Uint8ClampedArray(i);break;case ce.IPF_RGB_888:{const e=i.length/3;n=new Uint8ClampedArray(4*e);for(let t=0;t<e;++t)n[4*t]=i[3*t+2],n[4*t+1]=i[3*t+1],n[4*t+2]=i[3*t],n[4*t+3]=255;break}case ce.IPF_GrayScaled:{const e=i.length;n=new Uint8ClampedArray(4*e);for(let t=0;t<e;t++)n[4*t]=n[4*t+1]=n[4*t+2]=i[t],n[4*t+3]=255;break}case ce.IPF_Binary:case ce.IPF_BinaryInverted:{const t=i.length,r=e.width,o=e.height,a=e.stride;n=new Uint8ClampedArray(r*o*4);for(let e=0;e<t;e++){let t=i[e],o=e%a*8,s=Math.floor(e/a);for(let e=0;e<8;e++){let i=o+e,a=4*(s*r+i);if(i>=r)break;n[a]=n[a+1]=n[a+2]=(128&t)/128*255,n[a+3]=255,t<<=1}}break}default:console.warn("unknow intermediate image",e)}if(!n)continue;let r=new ImageData(n,e.width,e.height),o=document.createElement("canvas");o.width=e.width,o.height=e.height,o.getContext("2d").putImageData(r,0,0),t.push(o)}return t}async getScanSettings(){return await new Promise(((e,t)=>{let i=_e._nextTaskID++;_e._taskCallbackMap.set(i,(i=>{if(i.success){let t=i.results;return t.intervalTime=this.intervalTime,t.whenToPlaySoundforSuccessfulRead=this.whenToPlaySoundforSuccessfulRead,t.soundOnSuccessfullRead=this.soundSource,t.whenToVibrateforSuccessfulRead=this.whenToVibrateforSuccessfulRead,t.vibrateDuration=this.vibrateDuration,t.captureAndDecodeInParallel=this.captureAndDecodeInParallel,t.autoZoom=this.autoZoom,t.autoFocus=this.autoFocus,t.autoSuggestTip=this.autoSuggestTip,e(t)}{let e=new Error(i.message);return e.stack+="\n"+i.stack,t(e)}})),_e._dbrWorker.postMessage({type:"getScanSettings",id:i,instanceID:this._instanceID})}))}async updateScanSettings(e){if(!e)return;const t=JSON.parse(JSON.stringify(e));if(t.autoZoom||t.autoFocus||t.autoSuggestTip){if(!_e._bUseFullFeature)throw new Error("'autoZoom', 'autoFocus' and 'autoSuggestTip' are not supported in the compact version. Please try the full-featured version.");const e=await this.getRuntimeSettings();e.intermediateResultTypes|=fe.IRT_TYPED_BARCODE_ZONE,await this.updateRuntimeSettings(e)}return t.hasOwnProperty("intervalTime")&&(this.intervalTime=Math.max(t.intervalTime,0),delete t.intervalTime),t.hasOwnProperty("whenToPlaySoundforSuccessfulRead")&&(this.whenToPlaySoundforSuccessfulRead=t.whenToPlaySoundforSuccessfulRead,delete t.whenToPlaySoundforSuccessfulRead),t.hasOwnProperty("soundOnSuccessfullRead")&&(this.soundSource=t.soundOnSuccessfullRead,delete t.soundOnSuccessfullRead),t.hasOwnProperty("whenToVibrateforSuccessfulRead")&&(this.whenToVibrateforSuccessfulRead=t.whenToVibrateforSuccessfulRead,delete t.whenToVibrateforSuccessfulRead),t.hasOwnProperty("vibrateDuration")&&(this.vibrateDuration=t.vibrateDuration,delete t.vibrateDuration),t.hasOwnProperty("captureAndDecodeInParallel")&&(this.captureAndDecodeInParallel=t.captureAndDecodeInParallel,delete t.captureAndDecodeInParallel),t.hasOwnProperty("autoZoom")&&(this.autoZoom&&this.autoZoom!=t.autoZoom&&this.dce&&this.dce.setZoom({factor:1}).catch((()=>{})),this.autoZoom=t.autoZoom,delete t.autoZoom),t.hasOwnProperty("autoFocus")&&(this.autoFocus=t.autoFocus,this.dce&&this.dce.setFocus({mode:"continuous"}).catch((()=>{})),delete t.autoFocus),t.hasOwnProperty("autoSuggestTip")&&(this.autoSuggestTip=t.autoSuggestTip,delete t.autoFocus),await new Promise(((e,i)=>{let n=_e._nextTaskID++;_e._taskCallbackMap.set(n,(t=>{if(t.success)return e();{let e=new Error(t.message);return e.stack+="\n"+t.stack,i(e)}})),_e._dbrWorker.postMessage({type:"updateScanSettings",id:n,instanceID:this._instanceID,body:{settings:t}})}))}_cloneDecodeResults(e){if(e instanceof Array){let t=[];for(let i of e)t.push(this._cloneDecodeResults(i));return t}{let t=e;return JSON.parse(JSON.stringify(t,((e,t)=>"oriVideoCanvas"==e||"searchRegionCanvas"==e?void 0:t)))}}async _loopReadVideo(){if(this.bDestroyed)return this.dce&&this._dceControler&&this._dceControler.setDisiredAction(this,"stopFetchingLoop"),this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),void this._drawResults(null);if(this.dce&&!this.dce.isOpen())return this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),void await this.clearMapDecodeRecord();if(!this.dce&&!this._imgSource||this._bPauseScan)return _e._onLog&&_e._onLog("Scan is paused, or imageSource is not set. Ask in 1s."),await this.clearMapDecodeRecord(),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),void(this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo()}),this._intervalDetectVideoPause));_e._onLog&&_e._onLog("======= once read ======="),_e._onLog&&(this._timeStartDecode=Date.now());let e=null,t=null;if(this.dce)e=this._getVideoFrame();else if(this._imgSource&&(t=await this._imgSource.getImage(),!_e.isDSImage(t)))throw new Error("Invalid DSImage.");if(!e&&!t)return _e._onLog&&_e._onLog("Get invalid frame."),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),void(this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo()}),0));(async()=>{let i=[];if(e){i=await this._decode_DCEFrame(e,{bScanner:!0,bCopyData:!1});let t=null;if(i&&i.length){const{sx:n,sy:r,width:o,height:a,_sWidth:s,_sHeight:l}=e;t=i.map((e=>({resultState:e.resultState,localizationResult:JSON.parse(JSON.stringify(e.localizationResult))}))),_e.recalculateResultLocation(t,n,r,s,l,o,a)}0==this._resultHighlightingDuration?this._drawResults(null):this._drawResults(t,i),this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._resultHighlightingDuration>0&&(this._clearResultsCanvasTimeoutId=setTimeout((()=>{this.bDestroyed||this._drawResults(null)}),this._resultHighlightingDuration))}else t&&(i=await this._decode_DSImage(t,{bScanner:!0,bCopyData:!1}));return i})().then((e=>{if(_e._onLog&&_e._onLog(e),this.dce&&this.captureAndDecodeInParallel){let e=this.array_decodeFrameTimeCost,t=this.array_getFrameTimeCost;const i=()=>{let i=0;if(t&&t.length){let n=Math.min(...e),r=Math.max(...t);n&&r&&(i=n-r)}else i=0;return i>0?i:0};(()=>{for(;e.length>=5;)e.shift();e.push(this._lastInnerDecodeDuration)})(),this._intervalGetVideoFrame=i()+this.intervalTime}if((this.dce&&this.dce.isOpen()||this._imgSource)&&!this._bPauseScan){if(this.bPlaySoundOnSuccessfulRead&&e.length){let t=!1;!0===this.bPlaySoundOnSuccessfulRead||"frame"===this.bPlaySoundOnSuccessfulRead?t=e.some((e=>e.resultState>=0)):"unique"===this.bPlaySoundOnSuccessfulRead&&(t=e.some((e=>0==e.resultState))),t&&this.beepSound&&(this.beepSound.stop(),this.beepSound.play())}if(navigator.vibrate&&this.bVibrateOnSuccessfulRead&&e.length){let t=!1;if(!0===this.bVibrateOnSuccessfulRead||"frame"===this.bVibrateOnSuccessfulRead?t=e.some((e=>e.resultState>=0)):"unique"===this.bVibrateOnSuccessfulRead&&(t=e.some((e=>0==e.resultState))),t)try{navigator.vibrate(this.vibrateDuration)}catch(e){console.warn("Vibration not allowed. User interaction required: "+(e.message||e))}}if(this.onImageRead){e=e.filter((e=>e.resultState>=0));const t=this._cloneDecodeResults(e);this.onImageRead(t)}if(this.onUniqueRead){e=e.filter((e=>0==e.resultState));const t=this._cloneDecodeResults(e);for(let e of t)this.onUniqueRead(e.barcodeText,e)}}this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this.intervalTime?this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo()}),this.intervalTime):this._loopReadVideo()})).catch((e=>{this.dce&&this._dceControler&&this._dceControler.setDisiredAction(this,"stopFetchingLoop"),_e._onLog&&_e._onLog(e.message||e),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout((()=>{this.dce&&(this.dce.startFetchingLoop(),this._dceControler&&this._dceControler.clearUserDisiredAction({user:this,actionName:"stopFetchingLoop"})),this._loopReadVideo()}),Math.max(this.intervalTime,1e3)),"platform error"==e.message||console.warn(e.message)}))}_getVideoFrame(){if(!this.dce)return null;let e;if(this.captureAndDecodeInParallel){if(_e._onLog&&_e._onLog("Get frame in parallel."),this._dceControler&&this._dceControler.setDisiredValue(this,"loopInterval",this._intervalGetVideoFrame),!this.dce.numberOfFramesInBuffer)return this._dceControler&&this._dceControler.setDisiredValue(this,"loopInterval",0),null;e=this.dce.getFrameFromBuffer();const t=e=>{if(!e)return;let t=e.timeSpent,i=this.array_getFrameTimeCost;for(;i.length>=5;)i.shift();i.push(t)};t(e)}else _e._onLog&&_e._onLog("Get frame in serial."),this._dceControler&&this._dceControler.setDisiredAction(this,"stopFetchingLoop"),e=this.dce.getFrame();return e}_drawResults(e,t){if(!this.dce||this.dce.disposed||this._bPauseScan||!this._drawingItemNamespace||!this._drawingItemNamespace.DT_Polygon)return;if(!this._dbrDrawingLayer){if(!this.dce.isOpen())return;if(!(this.dce.singleFrameMode||this.dce.video&&this.dce._videoTrack))return;const t=e=>this.dce.getDrawingLayers().some((t=>t.getId()===e));if(!t(3)&&!(null==e?void 0:e.length))return;this._dbrDrawingLayer=this.dce.getDrawingLayer(3)}const i=this._dbrDrawingLayer;e||(e=[]);let n=this._arrPolygons;for(let r=0;r<e.length;r++){let o,a=e[r].localizationResult;n[r]?(o=n[r],i.hasDrawingItem(o)||i.addDrawingItem(o),o.set("vertices",[{x:a.x1,y:a.y1},{x:a.x2,y:a.y2},{x:a.x3,y:a.y3},{x:a.x4,y:a.y4}]),(o.set||o.setAttribute).call(o,"vertices",[{x:a.x1,y:a.y1},{x:a.x2,y:a.y2},{x:a.x3,y:a.y3},{x:a.x4,y:a.y4}])):(o=new this._drawingItemNamespace.DT_Polygon([{x:a.x1,y:a.y1},{x:a.x2,y:a.y2},{x:a.x3,y:a.y3},{x:a.x4,y:a.y4}]),i.addDrawingItem(o),n[r]=o),-1===e[r].resultState?(o.styleId=this._styleIdBeforeVerification,o._mapStyle.set("default",this.dce.getDrawingStyle(this._styleIdBeforeVerification)),o._mapStyle.set("selected",this.dce.getDrawingStyle(this._styleIdBeforeVerification))):(o.styleId=null,o._mapStyle.set("default",this.dce.getDrawingStyle(3)),o._mapStyle.set("selected",this.dce.getDrawingStyle(7))),t&&t[r]?o.addNote({name:"Barcode_Result",content:t[r]},!0):o.addNote({name:"Barcode_Result",content:e[r]},!0)}for(let r=e.length;r<n.length;r++)n[r].deleteNote("Barcode_Result"),i.removeDrawingItem(n[r]);i.renderAll()}async startScanning(e){if(!this.dce&&!this._imgSource)throw new Error("'imageSource' is not set. call 'setImageSource()' before 'startScanning()'.");if(this._promiseStartScan&&this._promiseStartScan.isPending)return this._promiseStartScan;this._promiseStartScan=new pe;let t=null;if(this.dce){if(this.dce.isOpen())if(e&&this.dce.appendAndShowUI(),this.dce.playCallbackInfo)t=JSON.parse(JSON.stringify(this.dce.playCallbackInfo));else{const e=this.dce.getSelectedCamera();t={width:this.dce.video.videoWidth,height:this.dce.video.videoHeight,deviceId:e&&e.deviceId}}else if(t=await this.dce.open(e),!this._promiseStartScan)return null;this._dceControler&&(this._dceControler.clearUserDisiredAction({user:this,actionName:"close"}),this._dceControler.setDisiredValue(this,"ifShowScanRegionLaser",!0),this.dce.ifShowScanRegionLaser&&this.dce.showScanRegionLaser())}return this._bPauseScan=!1,this.dce&&this.dce.singleFrameMode||(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout((()=>{this.dce&&(this.dce.startFetchingLoop(),this._dceControler&&this._dceControler.clearUserDisiredAction({user:this,actionName:"stopFetchingLoop"})),this._loopReadVideo()}),0)),this._promiseStartScan.resolve(t),t}stopScanning(e){this.dce&&(this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),this._dceControler&&(this._dceControler.setDisiredValue(this,"ifShowScanRegionLaser",!1),this.dce.ifShowScanRegionLaser||this.dce.hideScanRegionLaser(),this._dceControler.setDisiredAction(this,"close",[e]))),this._bPauseScan=!0,this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0,this._promiseStartScan=null}pauseScanning(e){if(this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),e&&e.keepResultsHighlighted||this._drawResults(null),this._bPauseScan=!0,this.dce){if(this.dce.singleFrameMode)throw new Error("'pauseScanning()' is unavailable when property 'singleFrameMode' of the 'CameraEnhancer' instance is true.");this._dceControler&&(this._dceControler.setDisiredValue(this,"ifShowScanRegionLaser",!1),this.dce.ifShowScanRegionLaser||this.dce.hideScanRegionLaser(),this._dceControler.setDisiredAction(this,"stopFetchingLoop"))}}resumeScanning(){if(this._bPauseScan=!1,this.dce){if(this.dce.singleFrameMode)throw new Error("'resumeScanning()' is unavailable when property 'singleFrameMode' of the 'CameraEnhancer' instance is true.");this.dce.startFetchingLoop(),this._dceControler&&(this._dceControler.clearUserDisiredAction({user:this,actionName:"stopFetchingLoop"}),this._dceControler.setDisiredValue(this,"ifShowScanRegionLaser",!0),this.dce.ifShowScanRegionLaser&&this.dce.showScanRegionLaser())}}destroyContext(){if(_e._onLog&&_e._onLog("destroyContext()"),this.bDestroyed)return;this.bDestroyed=!0,(this.dce||this._promiseStartScan)&&this.stopScanning(),this.setImageSource(null);let e=_e._nextTaskID++;_e._taskCallbackMap.set(e,(e=>{if(!e.success){let t=new Error(e.message);throw t.stack=e.stack+"\n"+t.stack,t}})),_e._dbrWorker.postMessage({type:"destroyContext",id:e,instanceID:this._instanceID})}}function ve(e,t,i){return(i.x-e.x)*(t.y-e.y)==(t.x-e.x)*(i.y-e.y)&&Math.min(e.x,t.x)<=i.x&&i.x<=Math.max(e.x,t.x)&&Math.min(e.y,t.y)<=i.y&&i.y<=Math.max(e.y,t.y)}function ye(e){return Math.abs(e)<1e-6?0:e<0?-1:1}function be(e,t,i,n){let r=e[0]*(i[1]-t[1])+t[0]*(e[1]-i[1])+i[0]*(t[1]-e[1]),o=e[0]*(n[1]-t[1])+t[0]*(e[1]-n[1])+n[0]*(t[1]-e[1]);return!((r^o)>=0&&0!==r&&0!==o)&&(r=i[0]*(e[1]-n[1])+n[0]*(i[1]-e[1])+e[0]*(n[1]-i[1]),o=i[0]*(t[1]-n[1])+n[0]*(i[1]-t[1])+t[0]*(n[1]-i[1]),!((r^o)>=0&&0!==r&&0!==o))}var Se,we,Ce,xe,Te,Ee,Ie,Oe,Ae,Re,De,ke,Le,Me,Fe,Pe,Be,Ne,je,Ue,Ve,We,Ge,ze,He,Ye,Xe;_e._jsVersion="9.6.42",_e._jsEditVersion="20240426",_e._version=`loading...(JS ${_e._jsVersion}.${_e._jsEditVersion})`,_e._license=ae,_e._sessionPassword=se,_e.browserInfo=$,_e._workerName=`dbr-${_e._jsVersion}.browser.worker.js`,_e._engineResourcePath=re,_e._licenseServer=[],_e._deviceFriendlyName="",_e._isShowRelDecodeTimeInResults=!1,_e._bWasmDebug=!1,_e._bNeverShowDialog=!1,_e.__bUseFullFeature=!0,_e._nextTaskID=0,_e._taskCallbackMap=new Map,_e._pLoad=new pe,_e._lastErrorCode=0,_e._lastErrorString="",_e._setWarnnedEx=new Set,_e._defaultUIElementURL="@engineResourcePath/dbr.ui.html","function"==typeof SuppressedError&&SuppressedError;class qe extends _e{static set _onLog(e){!function(e,t,i,n,r){if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");r?r.value=i:t.set(e,i)}(qe,Se,e,0,we),H._onLog=e}static get _onLog(){return function(e,t,i,n){if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n?n.value:t.get(e)}(qe,Se,0,we)}static get version(){return this._version+`(DCE ${H.getVersion()})`}static _fireHTTPSWarnning(){qe.onWarning&&location&&"https:"!==location.protocol&&setTimeout((()=>{qe.onWarning&&qe.onWarning({id:2,message:"Not connected via SSL (HTTPS), the SDK may not work correctly."})}),0)}static async testCameraAccess(){return H.testCameraAccess()}_fireResolutionWarning(){if(!this.singleFrameMode&&this.onWarning&&this.dce.isOpen()){const e=this.dce.getConstraints();e&&e.width<1280&&e.height<720&&setTimeout((()=>{this.onWarning&&this.onWarning({id:3,message:"Camera resolution too low, please use a higher resolution (720P or better)."})}),0)}}getUIElement(){return this.dce.getUIElement()}async setUIElement(e){await this.dce.setUIElement(e)}get singleFrameMode(){return this.dce.singleFrameMode}set singleFrameMode(e){if("boolean"!=typeof e&&!["image","camera"].includes(e))throw new Error("Invalid value.");this.dce.singleFrameMode=e,e&&(this.dce.ifShowScanRegionLaser=!1,(async()=>{let e=await this.getScanSettings();e.oneDTrustFrameCount=1,await this.updateScanSettings(e)})())}get onUnduplicatedRead(){return this.onUniqueRead}set onUnduplicatedRead(e){this.onUniqueRead=e}get video(){return this.dce&&this.dce.video}set videoSrc(e){this.dce&&(this.dce.videoSrc=e)}get videoSrc(){return this.dce&&this.dce.videoSrc}set cameraOpenTimeout(e){this.dce&&(this.dce.cameraOpenTimeout=e)}get cameraOpenTimeout(){return this.dce&&this.dce.cameraOpenTimeout}set onTipSuggested(e){this.dce&&(this.dce.onTipSuggested=e)}get onTipSuggested(){return this.dce&&this.dce.onTipSuggested}_assertOpen(){if(!this.dce.isOpen())throw Error("The scanner is not open.")}set barcodeFillStyle(e){this._barcodeFillStyle=e,this.dce&&this.dce.updateDrawingStyle(3,{fillStyle:e})}get barcodeFillStyle(){return this._barcodeFillStyle}set barcodeStrokeStyle(e){this._barcodeStrokeStyle=e,this.dce&&this.dce.updateDrawingStyle(3,{strokeStyle:e})}get barcodeStrokeStyle(){return this._barcodeStrokeStyle}set barcodeLineWidth(e){this._barcodeLineWidth=e,this.dce&&this.dce.updateDrawingStyle(3,{lineWidth:e})}get barcodeLineWidth(){return this._barcodeLineWidth}set barcodeFillStyleBeforeVerification(e){this._barcodeFillStyleBeforeVerification=e,this._styleIdBeforeVerification&&this.dce.updateDrawingStyle(this._styleIdBeforeVerification,{fillStyle:e})}get barcodeFillStyleBeforeVerification(){return this._barcodeFillStyleBeforeVerification}set barcodeStrokeStyleBeforeVerification(e){this._barcodeStrokeStyleBeforeVerification=e,this._styleIdBeforeVerification&&this.dce.updateDrawingStyle(this._styleIdBeforeVerification,{strokeStyle:e})}get barcodeStrokeStyleBeforeVerification(){return this._barcodeStrokeStyleBeforeVerification}set barcodeLineWidthBeforeVerification(e){this._barcodeLineWidthBeforeVerification=e,this._styleIdBeforeVerification&&this.dce.updateDrawingStyle(this._styleIdBeforeVerification,{lineWidth:e})}get barcodeLineWidthBeforeVerification(){return this._barcodeLineWidthBeforeVerification}set regionMaskFillStyle(e){this.dce.setScanRegionMaskStyle({fillStyle:e})}get regionMaskFillStyle(){return this.dce.regionMaskFillStyle}set regionMaskStrokeStyle(e){this.dce.setScanRegionMaskStyle({strokeStyle:e})}get regionMaskStrokeStyle(){return this.dce.regionMaskStrokeStyle}set regionMaskLineWidth(e){this.dce.setScanRegionMaskStyle({lineWidth:e})}get regionMaskLineWidth(){return this.dce.regionMaskLineWidth}set region(e){this._region=e,this.dce&&(e?e instanceof Array||this.dce.setScanRegion(e):this.dce.setScanRegion(null)),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0}get region(){return this._region}set ifSaveOriginalImageInACanvas(e){this._ifSaveOriginalImageInACanvas=e,this.dce.framePixelFormat=e?"rgba":"grey"}get ifSaveOriginalImageInACanvas(){return this._ifSaveOriginalImageInACanvas}async createDCEInstance(){this.dce||(_e._onLog&&_e._onLog("createDCEInstance()"),H.defaultUIElementURL=null,this.dce=await H.createInstance(),this.dce.cameraOpenTimeout<15e3&&(this.dce.cameraOpenTimeout=15e3),this.dce.refreshInterval=200,this.dce.framePixelFormat="grey",this.dce.maxCvsSideLength=this.maxCvsSideLength,this._drawingItemNamespace=Y,["iPhone","iPad","Android","HarmonyOS"].includes(_e.browserInfo.OS)||this.dce.setResolution(1920,1080),this._styleIdBeforeVerification=this.dce.createDrawingStyle({fillStyle:"rgba(248,252,0,0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill"}),this.barcodeLineWidth=this._barcodeLineWidth,this.dce.on("cameraChange",(()=>{this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0})),this.dce.on("resolutionChange",(()=>{this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0})),this.dce.on("cameraClose",(()=>{this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0,this._bPauseScan=!1})),this.dce.on("singleFrameAcquired",(async e=>{if(!e)return;if(!e.data)return;let t;this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),this.ifSaveOriginalImageInACanvas&&(this.oriCanvas=null,this.oriCanvasData={width:e.width,height:e.height,pixelFormat:e.pixelFormat,data:new Uint8Array(e.data),toCanvas:e.toCanvas});const{data:i,sx:n,sy:r,width:o,height:a,stride:s,pixelFormat:l,timeStamp:c,_sWidth:u,_sHeight:h}=e,d={timeStamp:c};if("grey"===l)t=await this._decodeBuffer_Uint8Array(i,o,a,s,ce.IPF_GrayScaled,0,d);else if("rgba"===l)t=await this._decodeBuffer_Uint8Array(i,o,a,s,ce.IPF_ABGR_8888,0,d);else{if("bgra"!==l)throw new Error(`Pixel format '${l}' is not supported.`);t=await this._decodeBuffer_Uint8Array(i,o,a,s,ce.IPF_ARGB_8888,0,d)}if(await this.clearMapDecodeRecord(),_e.recalculateResultLocation(t,n,r,u,h,o,a),this._drawResults(t),this.onFrameRead&&this.isOpen()&&!this._bPauseScan){let e=this._cloneDecodeResults(t);this.onFrameRead(e)}if(this.onUniqueRead&&this.isOpen()&&!this._bPauseScan)for(let f of t)this.onUniqueRead(f.barcodeText,this._cloneDecodeResults(f))})))}set maxCvsSideLength(e){this._maxCvsSideLength=e,this.dce.maxCvsSideLength=e}get maxCvsSideLength(){return this._maxCvsSideLength}constructor(){super(),this._barcodeFillStyle="rgba(254,180,32,0.3)",this._barcodeStrokeStyle="rgba(254,180,32,0.9)",this._barcodeLineWidth=1,this._barcodeFillStyleBeforeVerification="rgba(248,252,0,0.2)",this._barcodeStrokeStyleBeforeVerification="transparent",this._barcodeLineWidthBeforeVerification=2,this.bFilterRegionInJs=!0,this._onPlayed=null}static async createInstance(e){const t=new qe;t._instanceID=await qe.createInstanceInWorker(!0),await t.createDCEInstance(),"string"==typeof e&&(e=JSON.parse(e));for(let i in e)t[i]=e[i];return await t.dce.setUIElement(qe.defaultUIElementURL),t.singleFrameMode&&console.warn("The `navigator.mediaDevices.getUserMedia` is unavailable. automatically change to `singleFrameMode`."),qe._fireHTTPSWarnning(),t.singleFrameMode||await t.updateRuntimeSettings("single"),t}async decodeCurrentFrame(e){this._assertOpen();let t=null;e&&e.region&&(t=e.region);const i=this.dce._getVideoData(null,{region:t});return this._decode_DCEFrame(i)}async updateRuntimeSettings(e){let t;if("string"==typeof e)if("speed"==e){let e=await this.getRuntimeSettings();await this.resetRuntimeSettings(),t=await this.getRuntimeSettings(),t.barcodeFormatIds=e.barcodeFormatIds,t.barcodeFormatIds_2=e.barcodeFormatIds_2,e.region&&(t.region=e.region),t.expectedBarcodesCount=0,t.localizationModes=[2,0,0,0,0,0,0,0],t.barcodeZoneMinDistanceToImageBorders=9}else if("balance"==e){let e=await this.getRuntimeSettings();await this.resetRuntimeSettings(),t=await this.getRuntimeSettings(),t.barcodeFormatIds=e.barcodeFormatIds,t.barcodeFormatIds_2=e.barcodeFormatIds_2,e.region&&(t.region=e.region),t.expectedBarcodesCount=512,t.deblurLevel=3,t.localizationModes=[2,16,0,0,0,0,0,0],t.barcodeZoneMinDistanceToImageBorders=9,t.timeout=1e5}else if("coverage"==e){let e=await this.getRuntimeSettings();await this.resetRuntimeSettings(),t=await this.getRuntimeSettings(),t.barcodeFormatIds=e.barcodeFormatIds,t.barcodeFormatIds_2=e.barcodeFormatIds_2,e.region&&(t.region=e.region),t.expectedBarcodesCount=512,t.deblurLevel=5,t.scaleDownThreshold=1e5,t.localizationModes=[2,16,4,8,0,0,0,0],t.barcodeZoneMinDistanceToImageBorders=9,t.timeout=1e5}else if("single"==e){let e=await this.getRuntimeSettings();await this.resetRuntimeSettings(),t=await this.getRuntimeSettings(),t.barcodeFormatIds=e.barcodeFormatIds,t.barcodeFormatIds_2=e.barcodeFormatIds_2,e.region&&(t.region=e.region)}else if("dense"==e){let e=await this.getRuntimeSettings();await this.resetRuntimeSettings(),this.maxCvsSideLength=4096,t=await this.getRuntimeSettings(),t.barcodeFormatIds=e.barcodeFormatIds,t.barcodeFormatIds_2=e.barcodeFormatIds_2,e.region&&(t.region=e.region),t.expectedBarcodesCount=0,t.deblurLevel=7,t.scaleDownThreshold=1e5,t.localizationModes=[2,8,0,0,0,0,0,0],t.minResultConfidence=0,t.barcodeZoneMinDistanceToImageBorders=9,t.timeout=1e5}else if("distance"==e){let e=await this.getRuntimeSettings();await this.resetRuntimeSettings(),this.maxCvsSideLength=4096,t=await this.getRuntimeSettings(),t.barcodeFormatIds=e.barcodeFormatIds,t.barcodeFormatIds_2=e.barcodeFormatIds_2,e.region&&(t.region=e.region),t.expectedBarcodesCount=0,t.scaleDownThreshold=1e5,t.localizationModes=[2,8,0,0,0,0,0,0],t.barcodeZoneMinDistanceToImageBorders=9,t.timeout=1e5}else t=JSON.parse(e);else{if("object"!=typeof e)throw TypeError("'UpdateRuntimeSettings(settings)': Type of 'settings' should be 'string' or 'PlainObject'.");if(t=JSON.parse(JSON.stringify(e)),t.region instanceof Array){let i=e.region;[i.regionLeft,i.regionTop,i.regionLeft,i.regionBottom,i.regionMeasuredByPercentage].some((e=>void 0!==e))&&(t.region={regionLeft:i.regionLeft||0,regionTop:i.regionTop||0,regionRight:i.regionRight||0,regionBottom:i.regionBottom||0,regionMeasuredByPercentage:i.regionMeasuredByPercentage||0})}}if(!_e._bUseFullFeature){if(t.barcodeFormatIds&~(de.BF_ONED|de.BF_QR_CODE|de.BF_PDF417|de.BF_DATAMATRIX)||0!=t.barcodeFormatIds_2)throw Error("Some of the specified barcode formats are not supported in the compact version. Please try the full-featured version.");if(0!=t.intermediateResultTypes)throw Error("Intermediate results is not supported in the compact version. Please try the full-featured version.")}{let e=t.region;if(this.bFilterRegionInJs?this.userDefinedRegion=JSON.parse(JSON.stringify(e)):this.userDefinedRegion=null,e instanceof Array)if(e.length){for(let t=0;t<e.length;++t){let i=e[t];i&&((i.regionLeft||i.regionTop||i.regionRight||i.regionBottom||i.regionMeasuredByPercentage)&&(i.regionLeft||i.regionTop||100!=i.regionRight||100!=i.regionBottom||!i.regionMeasuredByPercentage)||(e[t]=null))}this.region=e}else this.region=null;else e&&(e.regionLeft||e.regionTop||e.regionRight||e.regionBottom||e.regionMeasuredByPercentage)&&(e.regionLeft||e.regionTop||100!=e.regionRight||100!=e.regionBottom||!e.regionMeasuredByPercentage)?this.region=e:this.region=null;this.bFilterRegionInJs&&(t.region={regionLeft:0,regionTop:0,regionRight:0,regionBottom:0,regionMeasuredByPercentage:0})}(this.autoZoom||this.autoFocus)&&(t.intermediateResultTypes|=fe.IRT_TYPED_BARCODE_ZONE),await new Promise(((e,i)=>{let n=_e._nextTaskID++;_e._taskCallbackMap.set(n,(t=>{if(t.success){try{this._handleRetJsonString(t.updateReturn)}catch(e){i(e)}return e()}{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,i(e)}})),_e._dbrWorker.postMessage({type:"updateRuntimeSettings",id:n,instanceID:this._instanceID,body:{settings:JSON.stringify(t)}})})),"string"==typeof e&&["speed","balance","coverage","dense","distance"].includes(e)&&(await this.setModeArgument("BinarizationModes",0,"EnableFillBinaryVacancy","1"),await this.setModeArgument("BinarizationModes",0,"BlockSizeX","0"),await this.setModeArgument("BinarizationModes",0,"BlockSizeY","0"))}_bindUI(){if(!this.getUIElement())throw new Error("Need to define `UIElement` before opening.");if(this.dce._bindUI(),!this.dce.video)throw this._unbindUI(),Error("Can not find the video container element with class 'dce-video-container'")}_unbindUI(){this.dce._unbindUI()}set onPlayed(e){this.dce.off("played",this._onPlayed),this._onPlayed=e,this.dce.on("played",this._onPlayed)}get onPlayed(){return this._onPlayed}async getAllCameras(){return this.dce.getAllCameras()}async getCurrentCamera(){return this.dce.getSelectedCamera()}async setCurrentCamera(e){const t=await this.dce.selectCamera(e);return this._fireResolutionWarning(),t}getResolution(){return this.dce.getResolution()}async setResolution(e,t){const i=await this.dce.setResolution(e,t);return this._fireResolutionWarning(),i}getVideoSettings(){return this.dce.getVideoSettings()}updateVideoSettings(e){return this.dce.updateVideoSettings(e)}isOpen(){return this.dce&&this.dce.isOpen()}setVideoFit(e){return this.dce&&this.dce.setVideoFit(e)}getVideoFit(){return this.dce&&this.dce.getVideoFit()}set ifShowScanRegionMask(e){this.dce&&(this.dce.ifShowScanRegionMask=e)}get ifShowScanRegionMask(){return this.dce&&this.dce.ifShowScanRegionMask}set ifSaveLastUsedCamera(e){this.dce&&(this.dce.ifSaveLastUsedCamera=e)}get ifSaveLastUsedCamera(){return this.dce&&this.dce.ifSaveLastUsedCamera}set ifSkipCameraInspection(e){this.dce&&(this.dce.ifSkipCameraInspection=e)}get ifSkipCameraInspection(){return this.dce&&this.dce.ifSkipCameraInspection}stop(){this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),this.dce.stop(),this.dce.ifShowScanRegionLaser=!1,this.dce.hideViewDecorator(),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0}pause(){this.dce.pause()}async play(e,t,i){this.dce.ifShowScanRegionLaser=!0;const n=await this.dce.play(e,t,i);return this._fireResolutionWarning(),n}pauseScan(e){this._assertOpen(),this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),e&&e.keepResultsHighlighted||this._drawResults(null),this._bPauseScan=!0,this.dce.ifShowScanRegionLaser=!1,this.dce.stopFetchingLoop()}resumeScan(){this._assertOpen(),this._bPauseScan=!1,this.dce.ifShowScanRegionLaser=!0}getCapabilities(){return this.dce.getCapabilities()}getCameraSettings(){return this.dce.getCameraSettings()}getConstraints(){return this.dce.getConstraints()}async applyConstraints(e){return this.dce.applyConstraints(e)}async turnOnTorch(){return this.dce.turnOnTorch()}async turnOffTorch(){return this.dce.turnOffTorch()}async setColorTemperature(e){return this.dce.setColorTemperature(e)}getColorTemperature(){return this.dce.getColorTemperature()}async setExposureCompensation(e){return this.dce.setExposureCompensation(e)}getExposureCompensation(){return this.dce.getExposureCompensation()}async setZoom(e){return this.dce.setZoom(e)}getZoomSettings(){return this.dce.getZoomSettings()}resetZoom(){return this.dce.resetZoom()}async setFrameRate(e){return this.dce.setFrameRate(e)}getFrameRate(){return this.dce.getFrameRate()}async setFocus(e,t){return this.dce.setFocus(e,t)}getFocus(){return this.dce.getFocus()}getFocusSettings(){return this.dce.getFocusSettings()}async _loopReadVideo(){if(this.bDestroyed)return this.dce&&this.dce.stopFetchingLoop(),this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),void this._drawResults(null);if(!this.isOpen())return this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),void await this.clearMapDecodeRecord();if(!this.dce.video||this.dce.video.paused||this._bPauseScan)return _e._onLog&&_e._onLog("Video or scan is paused. Ask in 1s."),await this.clearMapDecodeRecord(),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),void(this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo()}),this._intervalDetectVideoPause));_e._onLog&&_e._onLog("======= once read ======="),_e._onLog&&(this._timeStartDecode=Date.now());const e=this._getVideoFrame();if(!e)return _e._onLog&&_e._onLog("Get invalid frame."),this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),void(this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo()}),0));(async()=>{e._bUseWebGL||"grey"!==e.pixelFormat||(this.dce.framePixelFormat="rgba");let t=[];this.ifSaveOriginalImageInACanvas&&(this.oriCanvas=null,this.oriCanvasData={width:e.width,height:e.height,pixelFormat:e.pixelFormat,data:new Uint8Array(e.data),toCanvas:e.toCanvas});const{data:i,sx:n,sy:r,width:o,height:a,stride:s,pixelFormat:l,timeStamp:c,_sWidth:u,_sHeight:h}=e,d={timeStamp:c};if("grey"===l)t=await this._decodeBuffer_Uint8Array(i,o,a,s,ce.IPF_GrayScaled,0,d);else if("rgba"===l)t=await this._decodeBuffer_Uint8Array(i,o,a,s,ce.IPF_ABGR_8888,0,d);else{if("bgra"!==l)throw new Error(`Pixel format '${l}' is not supported.`);t=await this._decodeBuffer_Uint8Array(i,o,a,s,ce.IPF_ARGB_8888,0,d)}if(_e.recalculateResultLocation(t,n,r,u,h,o,a),0==this._resultHighlightingDuration?this._drawResults(null):this._drawResults(t),this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._resultHighlightingDuration>0&&(this._clearResultsCanvasTimeoutId=setTimeout((()=>{this.bDestroyed||this._drawResults(null)}),this._resultHighlightingDuration)),this.isOpen()&&this.dce.video&&!this.dce.video.paused&&!this._bPauseScan&&(this.autoZoom||this.autoFocus||this.autoSuggestTip))if(t.length)this.autoZoomInFrameArray.length=0,this.autoZoomOutFrameCount=0,this.frameArrayInIdealZoom.length=0,this.suggestTipFrameArray.length=0,this.autoZoom&&this.autoFocus&&(this.nextActionInIdealZoom="focus"),this.autoFocusFrameArray.length=0,this.noIntermediateResultsCount=0;else{const t=async()=>new Promise(((e,t)=>{let i=_e._nextTaskID++;_e._taskCallbackMap.set(i,(i=>{if(i.success)return e(i.results);{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}})),_e._dbrWorker.postMessage({type:"getIntermediateResults",id:i,instanceID:this._instanceID,body:{isCharge:!1}})})),i=await t(),s=(e,t,i,n,r,o,a)=>{let s=o/n,l=a/r;e.x1=e.x1/s+t,e.x2=e.x2/s+t,e.x3=e.x3/s+t,e.x4=e.x4/s+t,e.y1=e.y1/l+i,e.y2=e.y2/l+i,e.y3=e.y3/l+i,e.y4=e.y4/l+i},l=e=>{if(!e)return null;const t={};let i,l,c,d,f;{const e=this.video.videoWidth*(1-this.autoZoomDetectionArea)/2,t=this.video.videoWidth*(1+this.autoZoomDetectionArea)/2,i=t,n=e,r=this.video.videoHeight*(1-this.autoZoomDetectionArea)/2,o=r,a=this.video.videoHeight*(1+this.autoZoomDetectionArea)/2;f={x1:e,x2:t,x3:i,x4:n,y1:r,y2:o,y3:a,y4:a}}const g=(e,t)=>{const i=(e,t)=>{if(!e&&!t)throw new Error("Invalid arguments.");return function(e,t,i){let n=!1;const r=e.length;if(r<=2)return!1;for(let o=0;o<r;o++){const a=e[o],s=e[(o+1)%r];if(ve(a,s,{x:t,y:i}))return!0;ye(a.y-i)>0!=ye(s.y-i)>0&&ye(t-(i-a.y)*(a.x-s.x)/(a.y-s.y)-a.x)<0&&(n=!n)}return n}([{x:t.x1,y:t.y1},{x:t.x2,y:t.y2},{x:t.x3,y:t.y3},{x:t.x4,y:t.y4}],e.x,e.y)},n=(e,t)=>!!(be([e[0],e[1]],[e[2],e[3]],[t.x1,t.y1],[t.x2,t.y2])||be([e[0],e[1]],[e[2],e[3]],[t.x2,t.y2],[t.x3,t.y3])||be([e[0],e[1]],[e[2],e[3]],[t.x3,t.y3],[t.x4,t.y4])||be([e[0],e[1]],[e[2],e[3]],[t.x4,t.y4],[t.x1,t.y1]));return!!(i({x:e.x1,y:e.y1},t)||i({x:e.x2,y:e.y2},t)||i({x:e.x3,y:e.y3},t)||i({x:e.x4,y:e.y4},t))||!!(i({x:t.x1,y:t.y1},e)||i({x:t.x2,y:t.y2},e)||i({x:t.x3,y:t.y3},e)||i({x:t.x4,y:t.y4},e))||!!(n([t.x1,t.y1,t.x2,t.y2],e)||n([t.x2,t.y2,t.x3,t.y3],e)||n([t.x3,t.y3,t.x4,t.y4],e)||n([t.x4,t.y4,t.x1,t.y1],e))},p=[];for(let T of e){if(T.resultType!==fe.IRT_TYPED_BARCODE_ZONE)continue;const e=T.scaleDownRatio;for(let t of T.results){if(!t)continue;const i={x1:t.x1=t.x1*e,x2:t.x2=t.x2*e,x3:t.x3=t.x3*e,x4:t.x4=t.x4*e,y1:t.y1=t.y1*e,y2:t.y2=t.y2*e,y3:t.y4=t.y3*e,y4:t.y4=t.y4*e};s(i,n,r,u,h,o,a),g(f,i)&&p.push(t)}}const m=(e=>{if(!e||!e.length)return null;const t=e=>{const t=(e.x1+e.x2+e.x3+e.x4)/4,i=(e.y1+e.y2+e.y3+e.y4)/4;return(t-o/2)*(t-o/2)+(i-a/2)*(i-a/2)};let i,n=e.filter((e=>e.barcodeFormat==de.BF_QR_CODE||e.barcodeFormat==de.BF_DATAMATRIX));if(n.length||(n=e.filter((e=>e.barcodeFormat==de.BF_ONED)),n.length||(n=e)),!n.length)return null;i=n[0];let r=t(i);if(1!=n.length)for(let o=1;o<n.length;o++){const e=t(n[o]);(n[o].confidence>1.1*i.confidence||n[o].confidence>.9*i.confidence&&e<r)&&(i=n[o],r=e)}return i})(p);if(!m)return null;const _=m.x1,v=m.x2,y=m.x3,b=m.x4,S=m.y1,w=m.y2,C=m.y3,x=m.y4;return i=Math.min(_,v,y,b),l=Math.max(_,v,y,b),c=Math.min(S,w,C,x),d=Math.max(S,w,C,x),t.x1=t.x4=i,t.x2=t.x3=l,t.y1=t.y2=c,t.y3=t.y4=d,t.result=m,t},c=l(i);if(c&&c.x1){if(this.autoZoomOutFrameCount=0,this.noIntermediateResultsCount=0,this.suggestTipFrameArray.push(!0),this.suggestTipFrameArray.splice(0,this.suggestTipFrameArray.length-this.suggestTipFrameLimit[0]),this.autoSuggestTip&&this.suggestTipFrameArray.filter((e=>!0===e)).length>=this.suggestTipFrameLimit[1]){this.suggestTipFrameArray.length=0;const e=c.x3-c.x1,t=c.y3-c.y1;c.result.moduleSize<this.tinyBarcodeTipModuleSizeLimit?this.dce&&this.dce.suggestTip("tiny-barcode","Please zoom in or move closer."):e>t?e>o*this.hugeBarcodeTipLimit?this.dce&&this.dce.suggestTip("huge-barcode","Please zoom out or move farther."):e>.6*o&&Math.max(this.video.videoWidth,this.video.videoHeight)<=1280&&Math.min(this.video.videoWidth,this.video.videoHeight)<=720&&this.dce&&this.dce.suggestTip("low-resolution","Please use a higher resolution."):e<=t&&(t>a*this.hugeBarcodeTipLimit?this.dce&&this.dce.suggestTip("huge-barcode","Please zoom out or move farther."):t>.6*a&&Math.max(this.video.videoWidth,this.video.videoHeight)<=1280&&Math.min(this.video.videoWidth,this.video.videoHeight)<=720&&this.dce&&this.dce.suggestTip("low-resolution","Please use a higher resolution."))}if(this.autoZoom){const t=this.autoZoomIdealArea[1];let i=(1-this.autoZoomTargetBorder)/2;const l=c.x1/u,d=(u-c.x3)/u,f=c.y1/h,g=(h-c.y3)/h;if(l>t&&d>t&&f>t&&g>t&&c.result.moduleSize<this.autoZoomInIdealModuleSize){if(this.autoZoomInFrameArray.push(!0),this.autoZoomInFrameArray.splice(0,this.autoZoomInFrameArray.length-this.autoZoomInFrameLimit[0]),this.frameArrayInIdealZoom.length=0,this.autoFocus&&(this.nextActionInIdealZoom="focus",this.setFocus({mode:"continuous"}).catch((()=>{}))),this.autoZoomInFrameArray.filter((e=>!0===e)).length>=this.autoZoomInFrameLimit[1]){this.autoZoomInFrameArray.length=0;const t=[(.5-i)/(.5-l),(.5-i)/(.5-d),(.5-i)/(.5-f),(.5-i)/(.5-g)].filter((e=>e>0)),n=Math.min(...t,this.autoZoomInIdealModuleSize/c.result.moduleSize),r=this.dce.getZoomSettings().factor;let o=Math.max(Math.pow(r*n,1/this.autoZoomInMaxTimes),this.autoZoomInMinStep);o=Math.min(o,n);const a=r*o;try{await this.setZoom({factor:a})}catch(e){const i=e.message||e;console.warn(i)}this.dce.clearFrameBuffer()}}else if(this.autoZoomInFrameArray.length=0,this.frameArrayInIdealZoom.push(!0),this.frameArrayInIdealZoom.splice(0,this.frameArrayInIdealZoom.length-this.frameLimitInIdealZoom[0]),this.frameArrayInIdealZoom.filter((e=>!0===e)).length>=this.frameLimitInIdealZoom[1])if(this.frameArrayInIdealZoom.length=0,"focus"===this.nextActionInIdealZoom&&this.autoFocus){s(c,n,r,u,h,o,a);try{await this.setFocus({mode:"manual",area:{centerPoint:{x:(c.x1+c.x3)/2+"px",y:(c.y1+c.y3)/2+"px"},width:c.x3-c.x1+"px",height:c.y3-c.y1+"px"}})}catch(e){const i=e.message||e;console.warn(i)}this.dce.clearFrameBuffer(),this.nextActionInIdealZoom="zoomOut"}else{if("zoomOut"!==this.nextActionInIdealZoom&&this.autoFocus)throw new Error("Invalid action.");if(this.enableZoomOutInIdealZoom){i=this.autoZoomIdealArea[1]+this.autoZoomOutStepRate_2;const t=[(.5-i)/(.5-l),(.5-i)/(.5-d),(.5-i)/(.5-f),(.5-i)/(.5-g)].filter((e=>e>0));let n=Math.min(...t)*this.dce.getZoomSettings().factor;try{await this.setZoom({factor:n})}catch(e){const i=e.message||e;console.warn(i)}this.dce.clearFrameBuffer(),this.autoFocus&&(this.nextActionInIdealZoom="focus",this.setFocus({mode:"continuous"}).catch((()=>{})))}}}else if(this.autoFocus&&(this.autoFocusFrameArray.push(!0),this.autoFocusFrameArray.splice(0,this.autoFocusFrameArray.length-this.autoFocusFrameLimit[0]),this.autoFocusFrameArray.filter((e=>!0===e)).length>=this.autoFocusFrameLimit[1])){this.autoFocusFrameArray.length=0;try{s(c,n,r,u,h,o,a),await this.setFocus({mode:"manual",area:{centerPoint:{x:(c.x1+c.x3)/2+"px",y:(c.y1+c.y3)/2+"px"},width:c.x3-c.x1+"px",height:c.y3-c.y1+"px"}})}catch(e){const i=e.message||e;console.warn(i)}this.dce.clearFrameBuffer()}}else if(this.noIntermediateResultsCount++,this.suggestTipFrameArray.push(!1),this.autoZoom){if(this.autoZoomInFrameArray.push(!1),this.autoZoomInFrameArray.splice(0,this.autoZoomInFrameArray.length-this.autoZoomInFrameLimit[0]),this.autoZoomOutFrameCount++,this.frameArrayInIdealZoom.push(!1),this.frameArrayInIdealZoom.splice(0,this.frameArrayInIdealZoom.length-this.frameLimitInIdealZoom[0]),this.autoZoomOutFrameCount>=this.autoZoomOutFrameLimit){this.autoZoomOutFrameCount=0;const t=this.getZoomSettings().factor;if(t>this.autoZoomOutMinValue){const i=Math.max((t-1)*this.autoZoomOutStepRate,this.autoZoomOutMinStep),n=Math.max(t-i,this.autoZoomOutMinValue);try{await this.setZoom({factor:n})}catch(e){const i=e.message||e;console.warn(i)}this.dce.clearFrameBuffer()}}this.autoFocus&&(this.nextActionInIdealZoom="focus",this.setFocus({mode:"continuous"}).catch((()=>{})))}else this.autoFocus&&(this.autoFocusFrameArray.length=0,this.setFocus({mode:"continuous"}).catch((()=>{})))}return t})().then((e=>{if(_e._onLog&&_e._onLog(e),this.captureAndDecodeInParallel){let e=this.array_decodeFrameTimeCost,t=this.array_getFrameTimeCost,i=this._indexCurrentDecodingFrame;const n=()=>{let n=0;if(this.region instanceof Array){let r=0,o=0;r=i+1>=this.region.length?0:i+1,o=r+1>=this.region.length?0:r+1,n=e[r]&&e[r].length&&t[o]&&t[o].length?Math.min(...e[r])-Math.max(...t[o]):0}else if(t&&t.length){let i=Math.min(...e),r=Math.max(...t);i&&r&&(n=i-r)}else n=0;return n>0?n:0};(()=>{if(this.region instanceof Array){for(e[i]&&e[i]instanceof Array||(e[i]=[]);e[i].length>=5;)e[i].shift();e[i].push(this._lastInnerDecodeDuration)}else{for(;e.length>=5;)e.shift();e.push(this._lastInnerDecodeDuration)}})(),this._intervalGetVideoFrame=n()+this.intervalTime,_e._onLog&&_e._onLog("Next fetching frame loop interval: "+this._intervalGetVideoFrame)}if(this.isOpen()&&this.dce.video&&!this.dce.video.paused&&!this._bPauseScan){if(this.bPlaySoundOnSuccessfulRead&&e.length){let t=!1;!0===this.bPlaySoundOnSuccessfulRead||"frame"===this.bPlaySoundOnSuccessfulRead?t=e.some((e=>e.resultState>=0)):"unique"===this.bPlaySoundOnSuccessfulRead&&(t=e.some((e=>0==e.resultState))),t&&this.beepSound&&(this.beepSound.stop(),this.beepSound.play())}if(navigator.vibrate&&this.bVibrateOnSuccessfulRead&&e.length){let t=!1;if(!0===this.bVibrateOnSuccessfulRead||"frame"===this.bVibrateOnSuccessfulRead?t=e.some((e=>e.resultState>=0)):"unique"===this.bVibrateOnSuccessfulRead&&(t=e.some((e=>0==e.resultState))),t)try{navigator.vibrate(this.vibrateDuration)}catch(e){console.warn("Vibration not allowed. User interaction required: "+(e.message||e))}}if(this.onFrameRead){e=e.filter((e=>e.resultState>=0));const t=this._cloneDecodeResults(e);this.onFrameRead(t)}if(this.onUniqueRead){e=e.filter((e=>0==e.resultState));const t=this._cloneDecodeResults(e);for(let e of t)this.onUniqueRead(e.barcodeText,e)}}this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this.intervalTime?this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo()}),this.intervalTime):this._loopReadVideo()}))}_getVideoFrame(){if(!this.dce)return null;let e;if(this.captureAndDecodeInParallel){_e._onLog&&_e._onLog("Get frame in parallel.");let t=this.dce.isFetchingLoopStarted();if(this.dce.loopInterval=this._intervalGetVideoFrame,t||this.dce.startFetchingLoop(),!this.dce.numberOfFramesInBuffer)return this.dce.loopInterval=0,null;e=this.dce.getFrameFromBuffer();const i=e=>{if(!e)return;let t=e.timeSpent,i=this.array_getFrameTimeCost;for(;i.length>=5;)i.shift();i.push(t)};i(e)}else _e._onLog&&_e._onLog("Get frame in serial."),this.dce.stopFetchingLoop(),e=this.dce.getFrame();return e}async open(){this._bindUI();const e=await this.dce.open();return this._bPauseScan=!1,this.singleFrameMode||(this.dce&&(this.dce.ifShowScanRegionLaser=!0),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo()}),0)),this._fireResolutionWarning(),e}async openVideo(){this._bindUI(),this.dce.ifShowScanRegionLaser=!1;const e=await this.dce.open();return this._bPauseScan=!0,this.singleFrameMode||(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo()}),0)),this._fireResolutionWarning(),e}close(){this._drawResults(null),this.dce.close(),this._bPauseScan=!0,this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId)}async show(){this._bindUI();const e=await this.dce.open(!0);return this._bPauseScan=!1,this.singleFrameMode||(this.dce&&(this.dce.ifShowScanRegionLaser=!0),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo()}),0)),this._fireResolutionWarning(),e}async showVideo(){this._bindUI(),this.dce.ifShowScanRegionLaser=!1;const e=await this.dce.open(!0);return this._bPauseScan=!0,this.singleFrameMode||(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo()}),0)),this._fireResolutionWarning(),e}hide(){this.dce.close(!0),this._bPauseScan=!0,this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId)}showTip(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e3,o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];this.dce&&this.dce.showTip(e,t,i,n,r,o)}hideTip(){this.dce&&this.dce.hideTip()}updateTipMessage(e){this.dce&&this.dce.updateTipMessage(e)}async enableTapToFocus(){this.dce&&this.dce.enableTapToFocus()}disableTapToFocus(){this.dce&&this.dce.disableTapToFocus()}isTapToFocusEnabled(){return this.dce.isTapToFocusEnabled()}convertToPageCoordinates(e){return this.dce.convertToPageCoordinates(e)}convertToClientCoordinates(e){return this.dce.convertToClientCoordinates(e)}destroyContext(){this.close(),this.dce&&this.dce.dispose(!1),this.bDestroyed||super.destroyContext()}}Se=qe,we={value:void 0},function(e){e[e.BICM_DARK_ON_LIGHT=1]="BICM_DARK_ON_LIGHT",e[e.BICM_LIGHT_ON_DARK=2]="BICM_LIGHT_ON_DARK",e[e.BICM_DARK_ON_DARK=4]="BICM_DARK_ON_DARK",e[e.BICM_LIGHT_ON_LIGHT=8]="BICM_LIGHT_ON_LIGHT",e[e.BICM_DARK_LIGHT_MIXED=16]="BICM_DARK_LIGHT_MIXED",e[e.BICM_DARK_ON_LIGHT_DARK_SURROUNDING=32]="BICM_DARK_ON_LIGHT_DARK_SURROUNDING",e[e.BICM_SKIP=0]="BICM_SKIP",e[e.BICM_REV=2147483648]="BICM_REV"}(Ce||(Ce={})),function(e){e[e.BCM_AUTO=1]="BCM_AUTO",e[e.BCM_GENERAL=2]="BCM_GENERAL",e[e.BCM_SKIP=0]="BCM_SKIP",e[e.BCM_REV=2147483648]="BCM_REV"}(xe||(xe={})),function(e){e[e.BF2_NULL=0]="BF2_NULL",e[e.BF2_POSTALCODE=32505856]="BF2_POSTALCODE",e[e.BF2_NONSTANDARD_BARCODE=1]="BF2_NONSTANDARD_BARCODE",e[e.BF2_USPSINTELLIGENTMAIL=1048576]="BF2_USPSINTELLIGENTMAIL",e[e.BF2_POSTNET=2097152]="BF2_POSTNET",e[e.BF2_PLANET=4194304]="BF2_PLANET",e[e.BF2_AUSTRALIANPOST=8388608]="BF2_AUSTRALIANPOST",e[e.BF2_RM4SCC=16777216]="BF2_RM4SCC",e[e.BF2_DOTCODE=2]="BF2_DOTCODE",e[e.BF2_PHARMACODE_ONE_TRACK=4]="BF2_PHARMACODE_ONE_TRACK",e[e.BF2_PHARMACODE_TWO_TRACK=8]="BF2_PHARMACODE_TWO_TRACK",e[e.BF2_PHARMACODE=12]="BF2_PHARMACODE",e[e.BF2_ALL=-1]="BF2_ALL"}(Te||(Te={})),function(e){e[e.BM_AUTO=1]="BM_AUTO",e[e.BM_LOCAL_BLOCK=2]="BM_LOCAL_BLOCK",e[e.BM_SKIP=0]="BM_SKIP",e[e.BM_THRESHOLD=4]="BM_THRESHOLD",e[e.BM_REV=2147483648]="BM_REV"}(Ee||(Ee={})),function(e){e[e.ECCM_CONTRAST=1]="ECCM_CONTRAST"}(Ie||(Ie={})),function(e){e[e.CFM_GENERAL=1]="CFM_GENERAL"}(Oe||(Oe={})),function(e){e[e.CCM_AUTO=1]="CCM_AUTO",e[e.CCM_GENERAL_HSV=2]="CCM_GENERAL_HSV",e[e.CCM_SKIP=0]="CCM_SKIP",e[e.CCM_REV=2147483648]="CCM_REV"}(Ae||(Ae={})),function(e){e[e.CICM_GENERAL=1]="CICM_GENERAL",e[e.CICM_SKIP=0]="CICM_SKIP",e[e.CICM_REV=2147483648]="CICM_REV"}(Re||(Re={})),function(e){e[e.CM_IGNORE=1]="CM_IGNORE",e[e.CM_OVERWRITE=2]="CM_OVERWRITE"}(De||(De={})),function(e){e[e.DM_SKIP=0]="DM_SKIP",e[e.DM_DIRECT_BINARIZATION=1]="DM_DIRECT_BINARIZATION",e[e.DM_THRESHOLD_BINARIZATION=2]="DM_THRESHOLD_BINARIZATION",e[e.DM_GRAY_EQUALIZATION=4]="DM_GRAY_EQUALIZATION",e[e.DM_SMOOTHING=8]="DM_SMOOTHING",e[e.DM_MORPHING=16]="DM_MORPHING",e[e.DM_DEEP_ANALYSIS=32]="DM_DEEP_ANALYSIS",e[e.DM_SHARPENING=64]="DM_SHARPENING",e[e.DM_BASED_ON_LOC_BIN=128]="DM_BASED_ON_LOC_BIN",e[e.DM_SHARPENING_SMOOTHING=256]="DM_SHARPENING_SMOOTHING"}(ke||(ke={})),function(e){e[e.DRM_AUTO=1]="DRM_AUTO",e[e.DRM_GENERAL=2]="DRM_GENERAL",e[e.DRM_BROAD_WARP=4]="DRM_BROAD_WARP",e[e.DRM_LOCAL_REFERENCE=8]="DRM_LOCAL_REFERENCE",e[e.DRM_DEWRINKLE=16]="DRM_DEWRINKLE",e[e.DRM_SKIP=0]="DRM_SKIP",e[e.DRM_REV=2147483648]="DRM_REV"}(Le||(Le={})),function(e){e[e.DPMCRM_AUTO=1]="DPMCRM_AUTO",e[e.DPMCRM_GENERAL=2]="DPMCRM_GENERAL",e[e.DPMCRM_SKIP=0]="DPMCRM_SKIP",e[e.DPMCRM_REV=2147483648]="DPMCRM_REV"}(Me||(Me={})),function(e){e[e.GTM_INVERTED=1]="GTM_INVERTED",e[e.GTM_ORIGINAL=2]="GTM_ORIGINAL",e[e.GTM_SKIP=0]="GTM_SKIP",e[e.GTM_REV=2147483648]="GTM_REV"}(Fe||(Fe={})),function(e){e[e.IPM_AUTO=1]="IPM_AUTO",e[e.IPM_GENERAL=2]="IPM_GENERAL",e[e.IPM_GRAY_EQUALIZE=4]="IPM_GRAY_EQUALIZE",e[e.IPM_GRAY_SMOOTH=8]="IPM_GRAY_SMOOTH",e[e.IPM_SHARPEN_SMOOTH=16]="IPM_SHARPEN_SMOOTH",e[e.IPM_MORPHOLOGY=32]="IPM_MORPHOLOGY",e[e.IPM_SKIP=0]="IPM_SKIP",e[e.IPM_REV=2147483648]="IPM_REV"}(Pe||(Pe={})),function(e){e[e.IRSM_MEMORY=1]="IRSM_MEMORY",e[e.IRSM_FILESYSTEM=2]="IRSM_FILESYSTEM",e[e.IRSM_BOTH=4]="IRSM_BOTH"}(Be||(Be={})),function(e){e[e.LM_SKIP=0]="LM_SKIP",e[e.LM_AUTO=1]="LM_AUTO",e[e.LM_CONNECTED_BLOCKS=2]="LM_CONNECTED_BLOCKS",e[e.LM_LINES=8]="LM_LINES",e[e.LM_STATISTICS=4]="LM_STATISTICS",e[e.LM_SCAN_DIRECTLY=16]="LM_SCAN_DIRECTLY",e[e.LM_STATISTICS_MARKS=32]="LM_STATISTICS_MARKS",e[e.LM_STATISTICS_POSTAL_CODE=64]="LM_STATISTICS_POSTAL_CODE",e[e.LM_CENTRE=128]="LM_CENTRE",e[e.LM_ONED_FAST_SCAN=256]="LM_ONED_FAST_SCAN",e[e.LM_REV=2147483648]="LM_REV"}(Ne||(Ne={})),function(e){e[e.QRECL_ERROR_CORRECTION_H=0]="QRECL_ERROR_CORRECTION_H",e[e.QRECL_ERROR_CORRECTION_L=1]="QRECL_ERROR_CORRECTION_L",e[e.QRECL_ERROR_CORRECTION_M=2]="QRECL_ERROR_CORRECTION_M",e[e.QRECL_ERROR_CORRECTION_Q=3]="QRECL_ERROR_CORRECTION_Q"}(je||(je={})),function(e){e[e.RPM_AUTO=1]="RPM_AUTO",e[e.RPM_GENERAL=2]="RPM_GENERAL",e[e.RPM_GENERAL_RGB_CONTRAST=4]="RPM_GENERAL_RGB_CONTRAST",e[e.RPM_GENERAL_GRAY_CONTRAST=8]="RPM_GENERAL_GRAY_CONTRAST",e[e.RPM_GENERAL_HSV_CONTRAST=16]="RPM_GENERAL_HSV_CONTRAST",e[e.RPM_SKIP=0]="RPM_SKIP",e[e.RPM_REV=2147483648]="RPM_REV"}(Ue||(Ue={})),function(e){e[e.RCT_PIXEL=1]="RCT_PIXEL",e[e.RCT_PERCENTAGE=2]="RCT_PERCENTAGE"}(Ve||(Ve={})),function(e){e[e.RT_STANDARD_TEXT=0]="RT_STANDARD_TEXT",e[e.RT_RAW_TEXT=1]="RT_RAW_TEXT",e[e.RT_CANDIDATE_TEXT=2]="RT_CANDIDATE_TEXT",e[e.RT_PARTIAL_TEXT=3]="RT_PARTIAL_TEXT"}(We||(We={})),function(e){e[e.SUM_AUTO=1]="SUM_AUTO",e[e.SUM_LINEAR_INTERPOLATION=2]="SUM_LINEAR_INTERPOLATION",e[e.SUM_NEAREST_NEIGHBOUR_INTERPOLATION=4]="SUM_NEAREST_NEIGHBOUR_INTERPOLATION",e[e.SUM_SKIP=0]="SUM_SKIP",e[e.SUM_REV=2147483648]="SUM_REV"}(Ge||(Ge={})),function(e){e[e.TP_REGION_PREDETECTED=1]="TP_REGION_PREDETECTED",e[e.TP_IMAGE_PREPROCESSED=2]="TP_IMAGE_PREPROCESSED",e[e.TP_IMAGE_BINARIZED=4]="TP_IMAGE_BINARIZED",e[e.TP_BARCODE_LOCALIZED=8]="TP_BARCODE_LOCALIZED",e[e.TP_BARCODE_TYPE_DETERMINED=16]="TP_BARCODE_TYPE_DETERMINED",e[e.TP_BARCODE_RECOGNIZED=32]="TP_BARCODE_RECOGNIZED"}(ze||(ze={})),function(e){e[e.TFM_AUTO=1]="TFM_AUTO",e[e.TFM_GENERAL_CONTOUR=2]="TFM_GENERAL_CONTOUR",e[e.TFM_SKIP=0]="TFM_SKIP",e[e.TFM_REV=2147483648]="TFM_REV"}(He||(He={})),function(e){e[e.TROM_CONFIDENCE=1]="TROM_CONFIDENCE",e[e.TROM_POSITION=2]="TROM_POSITION",e[e.TROM_FORMAT=4]="TROM_FORMAT",e[e.TROM_SKIP=0]="TROM_SKIP",e[e.TROM_REV=2147483648]="TROM_REV"}(Ye||(Ye={})),function(e){e[e.TDM_AUTO=1]="TDM_AUTO",e[e.TDM_GENERAL_WIDTH_CONCENTRATION=2]="TDM_GENERAL_WIDTH_CONCENTRATION",e[e.TDM_SKIP=0]="TDM_SKIP",e[e.TDM_REV=2147483648]="TDM_REV"}(Xe||(Xe={}));var Ze=i(414);qe.license="DLS2eyJoYW5kc2hha2VDb2RlIjoiMTAzODcxODkyLVRYbFhaV0pRY205cSIsIm1haW5TZXJ2ZXJVUkwiOiJodHRwczovL21kbHMuZHluYW1zb2Z0b25saW5lLmNvbSIsIm9yZ2FuaXphdGlvbklEIjoiMTAzODcxODkyIiwic3RhbmRieVNlcnZlclVSTCI6Imh0dHBzOi8vc2Rscy5keW5hbXNvZnRvbmxpbmUuY29tIiwiY2hlY2tDb2RlIjozMDM1NzAwMjh9",qe.engineResourcePath="https://cdn.jsdelivr.net/npm/dynamsoft-javascript-barcode@9.6.42/dist/";const Ke=function(){const e=(0,n.useRef)(null),[t,i]=(0,n.useState)(null),[r,o]=(0,n.useState)(!1),[a,s]=(0,n.useState)(null),[l,c]=(0,n.useState)(null);return(0,n.useEffect)((()=>{(async()=>{if(t&&e.current)try{await t.setUIElement(e.current),t.onFrameRead=e=>{if(e.length>0){const t=e[0].barcodeText;console.log("\ud83c\udfaf \uc778\uc2dd\ub41c \ubc14\ucf54\ub4dc:",t),s(t);const i=t.match(/3202(\d{5})/);if(i){const e=parseInt(i[1],10)/100;c((.45359237*e).toFixed(2))}else c(null)}},await t.open()}catch(i){console.error("\u274c \uc2a4\uce90\ub108 \ucd08\uae30\ud654 \uc2e4\ud328:",i)}})()}),[t]),(0,Ze.jsxs)("div",{style:{fontFamily:"sans-serif",padding:"20px",maxWidth:"480px",margin:"0 auto",textAlign:"center"},children:[(0,Ze.jsx)("h1",{style:{fontSize:"1.5rem",fontWeight:"bold",marginBottom:"1.5rem"},children:"\ud83d\udce6 GS1 \ubc14\ucf54\ub4dc \uc911\ub7c9 \uc2a4\uce90\ub108"}),r?(0,Ze.jsx)("div",{ref:e,className:"dce-video-container",style:{position:"relative",width:"100%",height:"300px",border:"1px solid #ccc",borderRadius:"8px",overflow:"hidden"}}):(0,Ze.jsx)("button",{onClick:async()=>{try{const e=await qe.createInstance();await e.updateVideoSettings({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}}),await e.updateRuntimeSettings("coverage"),i(e),o(!0)}catch(e){console.error("\u274c \uc2a4\uce90\ub108 \uc0dd\uc131 \uc2e4\ud328:",e)}},style:{backgroundColor:"#2563eb",color:"white",padding:"12px 24px",fontSize:"1.1rem",borderRadius:"8px",border:"none",cursor:"pointer",width:"100%",maxWidth:"320px"},children:"\ud83d\udcf7 \uce74\uba54\ub77c \uc2dc\uc791"}),a&&(0,Ze.jsxs)("div",{style:{position:"absolute",bottom:0,left:0,width:"100%",padding:"12px",backgroundColor:"rgba(0,0,0,0.7)",color:"#fff",zIndex:10,fontSize:"1rem"},children:[(0,Ze.jsxs)("div",{children:["\ud83d\udcc4 \ubc14\ucf54\ub4dc: ",a]}),l?(0,Ze.jsxs)("div",{children:["\u2696\ufe0f \uc911\ub7c9: ",l," kg"]}):(0,Ze.jsx)("div",{children:"\u2757 \uc911\ub7c9 \uc815\ubcf4 \uc5c6\uc74c"})]})]})},Je=e=>{e&&e instanceof Function&&i.e(206).then(i.bind(i,206)).then((t=>{let{getCLS:i,getFID:n,getFCP:r,getLCP:o,getTTFB:a}=t;i(e),n(e),r(e),o(e),a(e)}))};r.createRoot(document.getElementById("root")).render((0,Ze.jsx)(n.StrictMode,{children:(0,Ze.jsx)(Ke,{})})),Je()})();